import{r,j as e}from"./vendor-radix-CUH4rfwv.js";import{u as xe,b as he,C as W,c as y,L as ue}from"./index-BirWVvBx.js";import{c as $}from"./confetti.module-B5JVzsfH.js";import{B as P}from"./button-DHe2tcZM.js";import{I as A}from"./input-B1HON56t.js";import{L as E}from"./label-BPXceD-S.js";import{C as fe}from"./card-QsINfKB9.js";import{P as ge}from"./PhoneInput-Dkvsm_hY.js";import{K as ye,A as be,O as je}from"./OTPInput-HgM0PObl.js";import{A as Ne}from"./AddressAutocomplete-BOPpNXF8.js";import"./slider-DwAIm4oF.js";import{v as ve,c as u,a as b}from"./auth.service-qU9X3PjQ.js";import{u as we}from"./useAuthStore-zZ7TxdTJ.js";import{P as H,m as I}from"./auth-utils-fKxqvWVK.js";import{P as q}from"./phone-DamiK3A5.js";import{U as D}from"./user-MoTUdxzm.js";import{M as G}from"./map-pin-DCAIRw4A.js";import{m as o,A as Ce}from"./vendor-motion-BFiVL1R0.js";import{A as ke}from"./arrow-left-BAu7bnZv.js";import{L as K}from"./loader-circle-DvJb5jhJ.js";import{P as Se}from"./party-popper-BlbYKcJF.js";import{H as Pe}from"./house-DPpaKg6A.js";import{S as Ae}from"./sparkles-CbOcSn2R.js";import{M as Ee}from"./mail-CCRumkEZ.js";import{L as U}from"./lock-CfXr5ing.js";import{E as Oe,a as Ve}from"./eye-Czg6aQ-5.js";import"./vendor-utils-DF9nhviX.js";import"./vendor-query-BEEFX5y8.js";import"./useHaptics-9RCaLgIn.js";import"./check-q7rdmbil.js";import"./circle-alert-Yida3pmO.js";import"./message-circle-CgHmm5Fs.js";import"./smartphone-Ph9U_qYB.js";import"./building-2-Cp8Iu1FX.js";import"./client-w4Cmw8pS.js";import"./middleware-WYGlAF-S.js";const O=[{id:"phone",icon:q,label:"Telefone"},{id:"verify",icon:ye,label:"Verificar"},{id:"profile",icon:D,label:"Perfil"},{id:"address",icon:G,label:"Endereço"},{id:"done",icon:W,label:"Pronto"}];function hs(){const M=xe(),J=he(),V=we(s=>s.setAuth),F=J.state,X=F?.phone,_=F?.otpVerified,[a,p]=r.useState(_?"profile":"phone"),j=O.findIndex(s=>s.id===a),[i,Q]=r.useState(X||""),[w,L]=r.useState(""),[Y,T]=r.useState(null),[c,Z]=r.useState(""),[C,ee]=r.useState(""),[d,se]=r.useState(""),[x,ae]=r.useState(""),[t,te]=r.useState({}),[k,re]=r.useState(!1),[f,m]=r.useState(!1),[N,l]=r.useState(null),oe=ve(u(i)),ie=w.length===6,S=H.test(d),v=d===x,ne=c.trim().length>=2&&S&&v,z=t.cep&&t.logradouro&&t.bairro,ce=r.useCallback(()=>{const s=Math.max(0,j-1);p(O[s].id),l(null)},[j]),le=r.useCallback(async()=>{l(null),m(!0);try{switch(a){case"phone":const s=await b.sendOtp({phone:u(i)});if(s.userExists){l("Este telefone já está cadastrado. Faça login.");return}const n=new Date(Date.now()+s.expiresIn*1e3);T(n),p("verify");break;case"verify":await b.verifyOtp({phone:u(i),code:w}),p("profile");break;case"profile":if(!H.test(d))throw new Error("A senha deve ter min. 8 chars, maiúscula, minúscula e número.");if(!v)throw new Error("As senhas não conferem");p("address");break;case"address":if(!t.cep||!t.logradouro||!t.bairro||!t.localidade||!t.uf)throw new Error("Endereço incompleto");const g={zipCode:t.cep,street:t.logradouro,number:t.numero||"S/N",neighborhood:t.bairro,city:t.localidade,state:t.uf,complement:t.complemento},h=await b.register({phone:u(i),nome:c.trim(),email:C.trim()||void 0,password:d,confirmPassword:x,address:g});V(h.user,h.token,h.refreshToken),p("done");break}}catch(s){l(I(s))}finally{m(!1)}},[a,i,w,c,C,d,x,S,v,t,V]),de=r.useCallback(async()=>{m(!0),l(null);try{const s=await b.sendOtp({phone:u(i)}),n=new Date(Date.now()+s.expiresIn*1e3);T(n),L("")}catch(s){l(s instanceof Error?s.message:"Erro ao reenviar código")}finally{m(!1)}},[i]),me=r.useCallback(async s=>{m(!0),l(null);try{await b.verifyOtp({phone:u(i),code:s}),p("profile")}catch(n){l(I(n)),L("")}finally{m(!1)}},[i]);r.useEffect(()=>{if(a==="done"){const n=Date.now()+3e3,g=()=>{$({particleCount:3,angle:60,spread:55,origin:{x:0},colors:["#22c55e","#3b82f6","#f59e0b"]}),$({particleCount:3,angle:120,spread:55,origin:{x:1},colors:["#22c55e","#3b82f6","#f59e0b"]}),Date.now()<n&&requestAnimationFrame(g)};g()}},[a]);const B=()=>{switch(a){case"phone":return oe;case"verify":return ie;case"profile":return ne;case"address":return z;default:return!1}},pe=()=>{switch(a){case"phone":return e.jsxs(o.div,{initial:{opacity:0,x:30},animate:{opacity:1,x:0},exit:{opacity:0,x:-30},className:"space-y-6",children:[e.jsxs("div",{className:"text-center mb-4",children:[e.jsx("div",{className:"inline-flex p-4 rounded-2xl bg-primary/10 mb-4",children:e.jsx(q,{className:"h-8 w-8 text-primary"})}),e.jsx("h2",{className:"text-xl font-semibold",children:"Seu WhatsApp"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Vamos enviar um código de verificação"})]}),e.jsx(ge,{value:i,onChange:Q,error:N||void 0,autoFocus:!0})]},"phone");case"verify":return e.jsx(o.div,{initial:{opacity:0,x:30},animate:{opacity:1,x:0},exit:{opacity:0,x:-30},className:"space-y-4",children:e.jsx(je,{value:w,onChange:L,onComplete:me,onResend:de,expiresAt:Y||void 0,error:N||void 0,isResending:f,isVerifying:f,phone:`(${i.slice(0,2)}) ${i.slice(2,7)}-${i.slice(7)}`})},"verify");case"profile":return e.jsxs(o.div,{initial:{opacity:0,x:30},animate:{opacity:1,x:0},exit:{opacity:0,x:-30},className:"space-y-5",children:[e.jsxs("div",{className:"text-center mb-4",children:[e.jsx("div",{className:"inline-flex p-4 rounded-2xl bg-primary/10 mb-4",children:e.jsx(D,{className:"h-8 w-8 text-primary"})}),e.jsx("h2",{className:"text-xl font-semibold",children:"Seus dados"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Crie sua conta com segurança"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(E,{className:"flex items-center gap-2",children:[e.jsx(D,{className:"h-4 w-4"}),"Nome completo"]}),e.jsx(A,{type:"text",placeholder:"Seu nome",value:c,onChange:s=>Z(s.target.value),className:y("h-12 text-base",c.length>0&&c.trim().length<2&&"border-amber-400"),autoFocus:!0}),c.length>0&&c.trim().length<2&&e.jsx("p",{className:"text-xs text-amber-600 dark:text-amber-400",children:"Nome muito curto (mínimo 2 caracteres)"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(E,{className:"flex items-center gap-2",children:[e.jsx(Ee,{className:"h-4 w-4"}),"E-mail ",e.jsx("span",{className:"text-muted-foreground text-xs",children:"(opcional)"})]}),e.jsx(A,{type:"email",placeholder:"seu@email.com",value:C,onChange:s=>ee(s.target.value),className:"h-12 text-base"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(E,{className:"flex items-center gap-2",children:[e.jsx(U,{className:"h-4 w-4"}),"Senha"]}),e.jsxs("div",{className:"relative",children:[e.jsx(A,{type:k?"text":"password",placeholder:"Mínimo 8 caracteres",value:d,onChange:s=>se(s.target.value),className:y("h-12 text-base pr-10",d.length>0&&!S&&"border-amber-400")}),e.jsx("button",{type:"button",onClick:()=>re(!k),className:"absolute right-3 top-3 text-muted-foreground hover:text-foreground",children:k?e.jsx(Oe,{className:"h-5 w-5"}):e.jsx(Ve,{className:"h-5 w-5"})})]}),d.length>0&&!S&&e.jsx("p",{className:"text-xs text-amber-600 dark:text-amber-400",children:"Mínimo 8 caracteres"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(E,{className:"flex items-center gap-2",children:[e.jsx(U,{className:"h-4 w-4"}),"Confirmar Senha"]}),e.jsx(A,{type:k?"text":"password",placeholder:"Repita a senha",value:x,onChange:s=>ae(s.target.value),className:y("h-12 text-base",x.length>0&&!v&&"border-red-400")}),x.length>0&&!v&&e.jsx("p",{className:"text-xs text-red-600 dark:text-red-400",children:"As senhas não conferem"})]})]},"profile");case"address":return e.jsxs(o.div,{initial:{opacity:0,x:30},animate:{opacity:1,x:0},exit:{opacity:0,x:-30},className:"space-y-4",children:[e.jsxs("div",{className:"text-center mb-4",children:[e.jsx("div",{className:"inline-flex p-4 rounded-2xl bg-primary/10 mb-4",children:e.jsx(G,{className:"h-8 w-8 text-primary"})}),e.jsx("h2",{className:"text-xl font-semibold",children:"Seu endereço"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Digite o CEP para preencher automaticamente"})]}),e.jsx(Ne,{value:t,onChange:te,error:N||void 0})]},"address");case"done":return e.jsxs(o.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"text-center py-8",children:[e.jsx(o.div,{initial:{scale:0},animate:{scale:1},transition:{type:"spring",delay:.2,bounce:.5},className:"inline-flex p-6 rounded-full bg-green-100 dark:bg-green-900/30 mb-6",children:e.jsx(Se,{className:"h-12 w-12 text-green-600 dark:text-green-400"})}),e.jsx(o.h2,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},className:"text-2xl font-bold",children:"Bem-vindo(a)!"}),e.jsxs(o.p,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4},className:"text-muted-foreground mt-2",children:[c,", sua conta foi criada com sucesso!"]}),e.jsx(o.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.6},className:"mt-8",children:e.jsxs(P,{size:"lg",className:"h-14 px-8 rounded-2xl bg-gradient-to-r from-green-600 to-green-500",onClick:()=>M("/"),children:[e.jsx(Pe,{className:"h-5 w-5 mr-2"}),"Explorar o app",e.jsx(Ae,{className:"h-5 w-5 ml-2"})]})})]},"done")}};return e.jsxs("div",{className:"min-h-screen flex flex-col bg-gradient-to-br from-primary/5 via-background to-primary/10",children:[e.jsxs(o.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"p-4 flex items-center justify-between",children:[a!=="done"?e.jsx(P,{variant:"ghost",size:"icon",onClick:j>0?ce:()=>M("/login"),className:"rounded-xl",children:e.jsx(ke,{className:"h-5 w-5"})}):e.jsx("div",{}),e.jsx("h1",{className:"font-semibold text-lg",children:a==="done"?"Sucesso!":"Criar conta"}),e.jsx("div",{className:"w-10"})]}),a!=="done"&&e.jsx(o.div,{initial:{opacity:0},animate:{opacity:1},className:"px-6 mb-6",children:e.jsx("div",{className:"flex items-center justify-between mb-2",children:O.slice(0,-1).map((s,n)=>{const g=s.icon,h=n===j,R=n<j;return e.jsxs("div",{className:"flex items-center",children:[e.jsx(o.div,{animate:{scale:h?1.1:1,backgroundColor:R?"rgb(34, 197, 94)":h?"hsl(var(--primary))":"hsl(var(--muted))"},className:y("w-10 h-10 rounded-full flex items-center justify-center","transition-colors"),children:R?e.jsx(W,{className:"h-5 w-5 text-white"}):e.jsx(g,{className:y("h-5 w-5",h?"text-white":"text-muted-foreground")})}),n<O.length-2&&e.jsx(o.div,{animate:{backgroundColor:R?"rgb(34, 197, 94)":"hsl(var(--muted))"},className:"w-8 h-1 mx-1 rounded-full"})]},s.id)})})}),e.jsx("div",{className:"flex-1 px-6 overflow-y-auto pb-32",children:e.jsxs(fe,{className:"p-6 shadow-xl border-0 bg-background/80 backdrop-blur-xl",children:[e.jsx(Ce,{mode:"wait",children:pe()}),N&&a!=="verify"&&e.jsx(o.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"mt-4 p-3 rounded-xl bg-red-50 dark:bg-red-950/30 border border-red-200 dark:border-red-800",children:e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400 text-center",children:N})})]})}),a!=="done"&&a!=="verify"&&e.jsxs(o.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"fixed bottom-0 left-0 right-0 p-4 pb-8 bg-background/90 backdrop-blur-lg border-t",children:[a==="address"&&!z&&e.jsx(P,{variant:"ghost",size:"lg",onClick:async()=>{m(!0),l(null);try{const s=await b.register({phone:u(i),nome:c.trim(),email:C.trim()||void 0,password:d,confirmPassword:x});V(s.user,s.token,s.refreshToken),p("done")}catch(s){l(I(s))}finally{m(!1)}},disabled:f,className:"w-full h-12 mb-3 text-muted-foreground",children:f?e.jsxs(e.Fragment,{children:[e.jsx(K,{className:"h-4 w-4 mr-2 animate-spin"}),"Criando conta..."]}):"Pular esta etapa"}),e.jsx(P,{size:"lg",onClick:le,disabled:!B()||f,className:y("w-full h-14 text-lg font-semibold rounded-2xl","bg-gradient-to-r from-primary to-primary/80","shadow-lg shadow-primary/30",B()&&"hover:shadow-xl hover:shadow-primary/40"),children:f?e.jsxs(e.Fragment,{children:[e.jsx(K,{className:"h-5 w-5 mr-2 animate-spin"}),a==="address"?"Criando conta...":"Verificando..."]}):e.jsxs(e.Fragment,{children:[a==="address"?"Criar conta com endereço":"Continuar",e.jsx(be,{className:"h-5 w-5 ml-2"})]})}),a==="phone"&&e.jsxs("p",{className:"text-center text-sm text-muted-foreground mt-4",children:["Já tem conta?"," ",e.jsx(ue,{to:"/login",className:"text-primary font-semibold hover:underline",children:"Entrar"})]})]})]})}export{hs as default};
