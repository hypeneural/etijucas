const O="/api/v1",l={baseURL:O,timeout:1e4,retryAttempts:3,retryDelay:1e3},k={auth:{login:"/auth/login",sendOtp:"/auth/send-otp",resendOtp:"/auth/resend-otp",verifyOtp:"/auth/verify-otp",register:"/auth/register",forgotPassword:"/auth/forgot-password",resetPassword:"/auth/reset-password",refresh:"/auth/refresh",logout:"/auth/logout",me:"/auth/me"},users:{me:"/users/me",update:"/users/me",avatar:"/users/me/avatar",password:"/users/me/password",notifications:"/users/me/notifications"},reports:{categories:"/report-categories",create:"/reports",myReports:"/reports/me",get:e=>`/reports/${e}`,addMedia:e=>`/reports/${e}/media`,removeMedia:(e,t)=>`/reports/${e}/media/${t}`,updateStatus:e=>`/reports/${e}/status`,adminList:"/admin/reports"},geocode:{autocomplete:"/geocode/autocomplete",reverse:"/geocode/reverse"},forum:{topics:"/forum/topics",topic:e=>`/forum/topics/${e}`,createTopic:"/forum/topics",updateTopic:e=>`/forum/topics/${e}`,deleteTopic:e=>`/forum/topics/${e}`,likeTopic:e=>`/forum/topics/${e}/like`,saveTopic:e=>`/forum/topics/${e}/save`,reportTopic:e=>`/forum/topics/${e}/report`,savedTopics:"/forum/saved",comments:e=>`/forum/topics/${e}/comments`,deleteComment:(e,t)=>`/forum/topics/${e}/comments/${t}`,likeComment:e=>`/forum/comments/${e}/like`,reportComment:e=>`/forum/comments/${e}/report`,upload:"/forum/upload"},topics:{list:"/forum/topics",get:e=>`/forum/topics/${e}`,create:"/forum/topics",update:e=>`/forum/topics/${e}`,delete:e=>`/forum/topics/${e}`,like:e=>`/forum/topics/${e}/like`,unlike:e=>`/forum/topics/${e}/like`,comments:e=>`/forum/topics/${e}/comments`},events:{list:"/events",get:e=>`/events/${e}`,upcoming:"/events/upcoming",today:"/events/today",weekend:"/events/weekend",featured:"/events/featured",search:"/events/search",homeFeatured:"/events/home-featured",calendarSummary:"/events/calendar-summary",byDate:e=>`/events/date/${e}`,byMonth:(e,t)=>`/events/month/${e}/${t}`,byCategory:e=>`/events/category/${e}`,byBairro:e=>`/events/bairro/${e}`,byVenue:e=>`/events/venue/${e}`,byTag:e=>`/events/tag/${e}`,byOrganizer:e=>`/events/organizer/${e}`,categories:"/events/categories",tags:"/events/tags",tagsTrending:"/events/tags/trending",rsvp:e=>`/events/${e}/rsvp`,attendees:e=>`/events/${e}/attendees`,favorite:e=>`/events/${e}/favorite`,myEvents:"/users/me/events",myFavorites:"/users/me/favorites/events"},trash:{schedules:"/trash/schedules",byBairro:e=>`/trash/schedules/bairro/${e}`,today:"/trash/today",next:"/trash/next",types:"/trash/types"},masses:{list:"/masses",byBairro:e=>`/masses/bairro/${e}`,today:"/masses/today",tomorrow:"/masses/tomorrow"},phones:{list:"/phones",byCategory:e=>`/phones/category/${e}`,search:"/phones/search"},alerts:{list:"/alerts",get:e=>`/alerts/${e}`,active:"/alerts/active"},bairros:{list:"/bairros",get:e=>`/bairros/${e}`},tourism:{spots:"/tourism/spots",get:e=>`/tourism/spots/${e}`,categories:"/tourism/categories",like:e=>`/tourism/spots/${e}/like`,save:e=>`/tourism/spots/${e}/save`,reviews:e=>`/tourism/spots/${e}/reviews`,createReview:e=>`/tourism/spots/${e}/reviews`,deleteReview:e=>`/tourism/reviews/${e}`},uploads:{image:"/uploads/image",images:"/uploads/images"}},R={topics:{all:["topics"],list:e=>["topics","list",e],detail:e=>["topics","detail",e],comments:e=>["topics",e,"comments"]},tourism:{all:["tourism"],spots:e=>["tourism","spots",e],detail:e=>["tourism","detail",e],reviews:e=>["tourism",e,"reviews"],categories:["tourism","categories"]}},N=Object.freeze(Object.defineProperty({__proto__:null,API_CONFIG:l,ENDPOINTS:k,QUERY_KEYS:R},Symbol.toStringTag,{value:"Module"})),y="etijucas_token",$="etijucas_refresh_token";let g=!1,d=null;function T(){return localStorage.getItem(y)}function A(){return localStorage.getItem($)}function S(e,t){localStorage.setItem(y,e),localStorage.setItem($,t)}function v(){localStorage.removeItem(y),localStorage.removeItem($)}class i extends Error{constructor(t,s,c,r){super(t),this.status=s,this.code=c,this.errors=r,this.name="ApiError"}}const _=e=>new Promise(t=>setTimeout(t,e));function w(e,t){const s=l.baseURL.endsWith("/")?l.baseURL.slice(0,-1):l.baseURL,c=e.startsWith("/")?e:`/${e}`;let r=`${s}${c}`;if(t){const u=new URLSearchParams;Object.entries(t).forEach(([m,f])=>{f!=null&&u.append(m,String(f))});const a=u.toString();a&&(r+=(r.includes("?")?"&":"?")+a)}return r}function P(e){if(typeof navigator<"u"&&"connection"in navigator){const t=navigator.connection;if(t?.saveData||t?.effectiveType==="slow-2g"||t?.effectiveType==="2g")return 3e3;if(t?.effectiveType==="3g")return 5e3}return e}async function j(){if(g&&d)return d;const e=A();return e?(g=!0,d=(async()=>{try{const t=await fetch(w(k.auth.refresh,void 0),{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({refreshToken:e})});if(!t.ok)return v(),null;const s=await t.json();return S(s.token,s.refreshToken),s.token}catch{return v(),null}finally{g=!1,d=null}})(),d):null}async function p(e,t={},s=1){if(typeof navigator<"u"&&!navigator.onLine)throw new i("Você está offline. Os dados serão sincronizados quando a conexão voltar.",0,"OFFLINE");const{params:c,timeout:r,...u}=t,a=r??P(l.timeout),m=w(e,c),f=new AbortController,b=setTimeout(()=>f.abort(),a);try{const o=T(),E={"Content-Type":"application/json",Accept:"application/json","X-App-Version":"1.0.0",...o&&{Authorization:`Bearer ${o}`},...u.headers},n=await fetch(m,{...u,signal:f.signal,headers:E});if(clearTimeout(b),n.status===401){if(!t._skipRefresh&&!g&&await j())return p(e,{...t,_skipRefresh:!0},s);throw v(),new i("Sessão expirada. Faça login novamente.",401,"UNAUTHENTICATED")}if(!n.ok){const h=await n.json().catch(()=>({}));throw new i(h.message||`HTTP ${n.status}: ${n.statusText}`,n.status,h.code,h.errors)}return n.status===204?{}:n.json()}catch(o){if(clearTimeout(b),o instanceof i&&o.status>=400&&o.status<500)throw o;if(s<l.retryAttempts)return await _(l.retryDelay*s),p(e,t,s+1);throw o instanceof Error&&o.name==="AbortError"?new i("Request timeout",408):o instanceof i?o:new i(o instanceof Error?o.message:"Network error",0)}}const U={get:(e,t)=>p(e,{method:"GET",params:t}),post:(e,t)=>p(e,{method:"POST",body:t?JSON.stringify(t):void 0}),put:(e,t)=>p(e,{method:"PUT",body:t?JSON.stringify(t):void 0}),patch:(e,t)=>p(e,{method:"PATCH",body:t?JSON.stringify(t):void 0}),postFormData:async(e,t,s)=>{const c=w(e),r=T(),u={Accept:"application/json","X-App-Version":"1.0.0",...r&&{Authorization:`Bearer ${r}`},...s?.headers||{}},a=await fetch(c,{method:"POST",headers:u,body:t});if(!a.ok){const m=await a.json().catch(()=>({}));throw new i(m.message||"Upload failed",a.status,m.code,m.errors)}return a.json()},delete:e=>p(e,{method:"DELETE"})},C=Object.freeze(Object.defineProperty({__proto__:null,ApiError:i,apiClient:U,clearAuthToken:v,getAuthToken:T,setTokens:S},Symbol.toStringTag,{value:"Module"}));export{l as A,k as E,R as Q,U as a,N as b,v as c,C as d,S as s};
