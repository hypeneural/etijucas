import{r as y}from"./vendor-radix-i3jPA7eY.js";import{c as B}from"./vendor-query-1wfeA5IL.js";import{t as E}from"./formatTimeAgo-CF6War-s.js";import{i as w}from"./index-Cf6IGVLO.js";function S(s={}){const{maxSizeMB:u=5}=s,[i,o]=y.useState(0),[m,d]=y.useState(!1),t=B({mutationFn:async e=>{o(0);const r=e.size/(1024*1024);if(r>u)throw new Error(`Imagem muito grande (${r.toFixed(1)}MB). MÃ¡ximo: ${u}MB`);if(!e.type.startsWith("image/"))throw new Error("Arquivo deve ser uma imagem (JPEG, PNG ou WebP)");let a=e;if(r>1){d(!0);try{a=await M(e)}finally{d(!1)}}o(30);const n=await E.uploadImage(a);return o(100),n},onSuccess:e=>{w.success("ðŸ“· Imagem enviada!"),s.onSuccess?.(e)},onError:e=>{const r=e instanceof Error?e.message:"Erro ao enviar imagem";r.includes("413")||r.includes("too large")?w.error("âŒ Imagem muito grande. MÃ¡ximo 5MB."):w.error(`âŒ ${r}`),s.onError?.(e instanceof Error?e:new Error(r))}});return{upload:t.mutate,uploadAsync:t.mutateAsync,isUploading:t.isPending,isCompressing:m,progress:i,error:t.error,reset:()=>{t.reset(),o(0)}}}async function M(s,u=2e3){return new Promise((i,o)=>{const m=new FileReader;m.onload=d=>{const t=new Image;t.onload=async()=>{const e=s.size/1048576;let r=e>3?.6:e>2?.7:.8,a=e>3?1024:1280;const n=document.createElement("canvas");let c=t.width,g=t.height;c>a&&(g=g*a/c,c=a),n.width=c,n.height=g;const f=n.getContext("2d");if(!f){i(s);return}f.drawImage(t,0,0,c,g);const h=p=>{n.toBlob(l=>{if(!l){i(s);return}if(l.size/1024>u&&p>.3){h(p-.1);return}const x=new File([l],s.name.replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg",lastModified:Date.now()});console.log(`[useUploadImage] Compressed: ${(s.size/1024).toFixed(0)}KB â†’ ${(x.size/1024).toFixed(0)}KB (quality: ${p.toFixed(1)})`),i(x)},"image/jpeg",p)};h(r)},t.onerror=o,t.src=d.target?.result},m.onerror=o,m.readAsDataURL(s)})}export{S as u};
