import{q as G,K as H,r as a,j as e,m as r,O as L,l as J,x as Q,o as Z,Y as ee,$ as te,a1 as se,a2 as ae}from"./vendor-app-D_TKIhWN.js";import{v as D,c as re,a as P}from"./auth.service-DpXf2-5D.js";import{u as ne,a as ie,B as oe,c as R}from"./index-BDc33GXV.js";import{C as ce}from"./card-DBjlm3ej.js";import{P as le}from"./PhoneInput-ClWnOJ-v.js";import"./input-pQWe_kXp.js";import"./label-RRyQ9UrU.js";import"./slider-DM1nM9rS.js";import"./checkbox-CNVwStle.js";import{u as de}from"./useClipboardOTP-BG-JFlN1.js";function ve(){const E=ne(),T=G(),[A]=H(),O=ie(t=>t.setAuth),x=T.state?.phone,[o,h]=a.useState("phone"),[m,q]=a.useState(x||""),[v,I]=a.useState(null),[$,M]=a.useState(null),[p,u]=a.useState(""),[N,w]=a.useState(300),[l,g]=a.useState(0),[W,V]=a.useState(!1),[C,c]=a.useState(!1),[f,i]=a.useState(null),b=a.useRef([]),{detectedCode:y,showPasteChip:_,readClipboard:B,clearDetectedCode:F}=de(),S=D(re(m));a.useEffect(()=>{const t=A.get("sid");t&&z(t)},[A]),a.useEffect(()=>{x&&D(x)&&!W&&!v&&(V(!0),k())},[x]),a.useEffect(()=>{y&&o==="otp"&&(u(y),c(!0),setTimeout(()=>{j(y)},300))},[y]),a.useEffect(()=>{if(l<=0)return;const t=setInterval(()=>{g(s=>Math.max(0,s-1))},1e3);return()=>clearInterval(t)},[l]),a.useEffect(()=>{if(o!=="otp"||N<=0)return;const t=setInterval(()=>{w(s=>s<=1?(i("Código expirado. Solicite novo código."),0):s-1)},1e3);return()=>clearInterval(t)},[o,N]);const z=async t=>{c(!0),i(null);try{const s=await P.getOtpSession(t);I(t),M(s.maskedPhone),w(s.expiresIn),g(s.cooldown),h("otp")}catch(s){s.status===410?i("Link expirado. Digite seu telefone para receber novo código."):i("Link inválido.")}finally{c(!1)}},k=async t=>{if(t?.preventDefault(),!!S){c(!0),i(null);try{const s=await P.requestOtpLogin(m);I(s.sid),w(s.expiresIn),g(s.cooldown),h("otp")}catch(s){s.data?.code==="RATE_LIMITED"?(i(`Aguarde ${s.data.retryAfter}s para solicitar novo código.`),g(s.data.retryAfter)):i(s.message||"Erro ao enviar código")}finally{c(!1)}}},j=async t=>{const s=t||p;if(!(s.length!==6||!v)){c(!0),i(null);try{const n=await P.verifyOtpLogin(v,s);"vibrate"in navigator&&navigator.vibrate([50,50,100]),O(n.user,n.token,n.refreshToken),h("success"),F(),setTimeout(()=>{n.next_step==="onboarding"?E("/",{replace:!0}):E("/",{replace:!0})},1500)}catch(n){const d=n.data?.code;d==="OTP_INVALID"?(i("Código incorreto. Tente novamente."),u(""),b.current[0]?.focus()):d==="OTP_EXPIRED"||d==="SID_EXPIRED"?(i("Código expirado. Solicite novo código."),h("phone")):i(n.message||"Erro ao verificar código")}finally{c(!1)}}},K=(t,s)=>{if(!/^\d*$/.test(s))return;const n=p.split("");n[t]=s.slice(-1);const d=n.join("").slice(0,6);u(d),s&&t<5&&b.current[t+1]?.focus(),d.length===6&&(c(!0),j(d))},X=t=>{t.preventDefault();const s=t.clipboardData.getData("text").replace(/\D/g,"").slice(0,6);s.length===6&&(u(s),c(!0),j(s))},U=async()=>{const t=await B();t&&(u(t),j(t))},Y=t=>{const s=Math.floor(t/60),n=t%60;return`${s}:${n.toString().padStart(2,"0")}`};return e.jsxs("div",{className:"min-h-screen flex flex-col bg-gradient-to-br from-green-500/5 via-background to-green-600/10",children:[e.jsxs(r.div,{initial:{opacity:0,y:-30},animate:{opacity:1,y:0},transition:{duration:.6},className:"pt-12 pb-8 px-6 text-center",children:[e.jsx(r.div,{initial:{scale:.8},animate:{scale:1},transition:{type:"spring",bounce:.5,delay:.2},className:"inline-flex p-4 rounded-3xl bg-gradient-to-br from-green-500 to-green-600 shadow-xl shadow-green-500/30 mb-4",children:e.jsx(L,{className:"h-12 w-12 text-white"})}),e.jsx(r.h1,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.3},className:"text-3xl font-bold bg-gradient-to-r from-green-600 to-green-500 bg-clip-text text-transparent",children:"eTijucas"}),e.jsxs(r.p,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.4},className:"text-muted-foreground mt-1",children:[o==="phone"&&"Login rápido via WhatsApp",o==="otp"&&"Digite o código recebido",o==="success"&&"Bem-vindo!"]})]}),e.jsx(r.div,{initial:{opacity:0,y:30},animate:{opacity:1,y:0},transition:{duration:.5,delay:.3},className:"flex-1 px-6",children:e.jsx(ce,{className:"p-6 shadow-xl border-0 bg-background/80 backdrop-blur-xl",children:e.jsxs(J,{mode:"wait",children:[o==="phone"&&e.jsxs(r.form,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},onSubmit:k,className:"space-y-6",children:[e.jsxs("div",{className:"text-center mb-4",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Seu número WhatsApp"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Enviaremos um código de 6 dígitos"})]}),e.jsx(le,{value:m,onChange:q,error:void 0,autoFocus:!0}),f&&e.jsx(r.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"p-3 rounded-xl bg-red-50 dark:bg-red-950/30 border border-red-200 dark:border-red-800",children:e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400 text-center",children:f})}),e.jsx(oe,{type:"submit",size:"lg",disabled:!S||C||l>0,className:R("w-full h-14 text-lg font-semibold rounded-2xl","bg-gradient-to-r from-green-500 to-green-600","shadow-lg shadow-green-500/30",S&&"hover:shadow-xl hover:shadow-green-500/40"),children:C?e.jsxs(e.Fragment,{children:[e.jsx(Q,{className:"h-5 w-5 mr-2 animate-spin"}),"Enviando..."]}):l>0?e.jsxs(e.Fragment,{children:[e.jsx(Z,{className:"h-5 w-5 mr-2"}),"Aguarde ",l,"s"]}):e.jsxs(e.Fragment,{children:[e.jsx(L,{className:"h-5 w-5 mr-2"}),"Receber código via WhatsApp"]})})]},"phone"),o==="otp"&&e.jsxs(r.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},className:"space-y-6",children:[e.jsxs("div",{className:"text-center mb-4",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Verifique seu WhatsApp"}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:["Código enviado para ",$||`(${m.slice(0,2)}) *****-${m.slice(-4)}`]}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-2",children:["Expira em ",Y(N)]})]}),_&&e.jsxs(r.button,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},onClick:U,className:"w-full flex items-center justify-center gap-2 py-3 rounded-xl bg-green-500/10 border border-green-500/30 text-green-600 hover:bg-green-500/20 transition-all",children:[e.jsx(ee,{className:"h-4 w-4"}),e.jsx("span",{className:"font-medium",children:"Colar código do WhatsApp"})]}),e.jsx("div",{className:"flex justify-center gap-3",onPaste:X,children:[0,1,2,3,4,5].map(t=>e.jsx("input",{ref:s=>b.current[t]=s,type:"text",inputMode:"numeric",maxLength:1,value:p[t]||"",onChange:s=>K(t,s.target.value),onKeyDown:s=>{s.key==="Backspace"&&!p[t]&&t>0&&b.current[t-1]?.focus()},className:R("w-12 h-14 text-center text-2xl font-bold rounded-xl border-2 transition-all","focus:border-green-500 focus:ring-2 focus:ring-green-500/20",p[t]?"border-green-500 bg-green-50 dark:bg-green-950/30":"border-border bg-muted/50")},t))}),e.jsxs("div",{className:"text-center space-y-2",children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["1. Vá ao WhatsApp e toque em ",e.jsx("span",{className:"font-medium text-green-600",children:'"Copiar código"'})]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["2. Volte aqui e toque em ",e.jsx("span",{className:"font-medium text-green-600",children:'"Colar código"'})]})]}),f&&e.jsx(r.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"p-3 rounded-xl bg-red-50 dark:bg-red-950/30 border border-red-200 dark:border-red-800",children:e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400 text-center",children:f})}),e.jsx("div",{className:"text-center",children:e.jsx("button",{onClick:()=>k(),disabled:l>0||C,className:"text-sm text-primary hover:underline disabled:text-muted-foreground disabled:no-underline",children:l>0?`Reenviar em ${l}s`:"Reenviar código"})})]},"otp"),o==="success"&&e.jsxs(r.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"py-8 text-center",children:[e.jsx(r.div,{initial:{scale:0},animate:{scale:1},transition:{type:"spring",bounce:.5},className:"inline-flex p-6 rounded-full bg-green-500 mb-6",children:e.jsx(te,{className:"h-12 w-12 text-white"})}),e.jsx("h2",{className:"text-2xl font-bold text-green-600",children:"Login realizado!"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Redirecionando..."})]},"success")]})})}),e.jsx(r.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.8},className:"py-8 px-6",children:e.jsxs("div",{className:"flex items-center justify-center gap-6 text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(se,{className:"h-5 w-5 text-green-500"}),e.jsx("span",{className:"text-sm font-medium",children:"1.234 moradores"})]}),e.jsx("div",{className:"w-px h-4 bg-border"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ae,{className:"h-5 w-5 text-amber-500"}),e.jsx("span",{className:"text-sm font-medium",children:"App oficial"})]})]})})]})}export{ve as default};
