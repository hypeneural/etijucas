import{r as s,j as e}from"./vendor-radix-CUH4rfwv.js";import{a as G,u as J,b as Q,d as Y,R as Z,c as T}from"./index-CbKpFPTn.js";import{B as ee}from"./button-DrTFAdrY.js";import{C as te}from"./card-BWAMV2Rj.js";import{P as ae}from"./PhoneInput-B5Om3l2x.js";import"./input-DD4zTMhp.js";import"./label-BucF1SCA.js";import"./slider-BemVW8m3.js";import{v as O,c as se,a as D}from"./auth.service-qU9X3PjQ.js";import{u as re}from"./useAuthStore-zZ7TxdTJ.js";import{m as r,A as ie}from"./vendor-motion-BFiVL1R0.js";import{M}from"./message-circle-DmZBUsL7.js";import{L as ne}from"./loader-circle-WPTifHtP.js";import{C as oe}from"./check-CBVsDyiX.js";import{U as ce}from"./users-Ci_wi5hA.js";import{S as le}from"./sparkles-msoEWQC2.js";import"./vendor-utils-DF9nhviX.js";import"./vendor-query-BEEFX5y8.js";import"./useHaptics-9RCaLgIn.js";import"./phone-S8ASjKXQ.js";import"./circle-alert-WeE3Wz7e.js";import"./client-w4Cmw8pS.js";import"./middleware-WYGlAF-S.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const de=G("Clipboard",[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}]]);function me(x){const p=x.match(/\b(\d{6})\b/);return p?p[1]:null}function pe(){const[x,p]=s.useState(null),[v,h]=s.useState(!1),l=typeof navigator<"u"&&"clipboard"in navigator&&typeof navigator.clipboard.readText=="function",o=s.useCallback(async()=>{if(!l)return null;try{const i=await navigator.clipboard.readText(),g=me(i);if(g)return p(g),h(!1),g}catch(i){console.debug("Clipboard read failed:",i)}return null},[l]),f=s.useCallback(()=>{p(null),h(!1)},[]);return s.useEffect(()=>{if(!l)return;const i=()=>{document.visibilityState==="visible"&&(h(!0),setTimeout(()=>{h(!1)},1e4))};return document.addEventListener("visibilitychange",i),()=>{document.removeEventListener("visibilitychange",i)}},[l]),{detectedCode:x,showPasteChip:v,readClipboard:o,clearDetectedCode:f,isSupported:l}}function Me(){const x=J(),p=Q(),[v]=Y(),h=re(t=>t.setAuth),l=p.state?.phone,[o,f]=s.useState("phone"),[i,g]=s.useState(l||""),[k,R]=s.useState(null),[q,V]=s.useState(null),[b,y]=s.useState(""),[P,E]=s.useState(300),[m,j]=s.useState(0),[W,$]=s.useState(!1),[A,d]=s.useState(!1),[N,c]=s.useState(null),C=s.useRef([]),{detectedCode:w,showPasteChip:F,readClipboard:_,clearDetectedCode:B}=pe(),L=O(se(i));s.useEffect(()=>{const t=v.get("sid");t&&z(t)},[v]),s.useEffect(()=>{l&&O(l)&&!W&&!k&&($(!0),I())},[l]),s.useEffect(()=>{w&&o==="otp"&&(y(w),d(!0),setTimeout(()=>{S(w)},300))},[w]),s.useEffect(()=>{if(m<=0)return;const t=setInterval(()=>{j(a=>Math.max(0,a-1))},1e3);return()=>clearInterval(t)},[m]),s.useEffect(()=>{if(o!=="otp"||P<=0)return;const t=setInterval(()=>{E(a=>a<=1?(c("Código expirado. Solicite novo código."),0):a-1)},1e3);return()=>clearInterval(t)},[o,P]);const z=async t=>{d(!0),c(null);try{const a=await D.getOtpSession(t);R(t),V(a.maskedPhone),E(a.expiresIn),j(a.cooldown),f("otp")}catch(a){a.status===410?c("Link expirado. Digite seu telefone para receber novo código."):c("Link inválido.")}finally{d(!1)}},I=async t=>{if(t?.preventDefault(),!!L){d(!0),c(null);try{const a=await D.requestOtpLogin(i);R(a.sid),E(a.expiresIn),j(a.cooldown),f("otp")}catch(a){a.data?.code==="RATE_LIMITED"?(c(`Aguarde ${a.data.retryAfter}s para solicitar novo código.`),j(a.data.retryAfter)):c(a.message||"Erro ao enviar código")}finally{d(!1)}}},S=async t=>{const a=t||b;if(!(a.length!==6||!k)){d(!0),c(null);try{const n=await D.verifyOtpLogin(k,a);"vibrate"in navigator&&navigator.vibrate([50,50,100]),h(n.user,n.token,n.refreshToken),f("success"),B(),setTimeout(()=>{n.next_step==="onboarding"?x("/",{replace:!0}):x("/",{replace:!0})},1500)}catch(n){const u=n.data?.code;u==="OTP_INVALID"?(c("Código incorreto. Tente novamente."),y(""),C.current[0]?.focus()):u==="OTP_EXPIRED"||u==="SID_EXPIRED"?(c("Código expirado. Solicite novo código."),f("phone")):c(n.message||"Erro ao verificar código")}finally{d(!1)}}},U=(t,a)=>{if(!/^\d*$/.test(a))return;const n=b.split("");n[t]=a.slice(-1);const u=n.join("").slice(0,6);y(u),a&&t<5&&C.current[t+1]?.focus(),u.length===6&&(d(!0),S(u))},X=t=>{t.preventDefault();const a=t.clipboardData.getData("text").replace(/\D/g,"").slice(0,6);a.length===6&&(y(a),d(!0),S(a))},H=async()=>{const t=await _();t&&(y(t),S(t))},K=t=>{const a=Math.floor(t/60),n=t%60;return`${a}:${n.toString().padStart(2,"0")}`};return e.jsxs("div",{className:"min-h-screen flex flex-col bg-gradient-to-br from-green-500/5 via-background to-green-600/10",children:[e.jsxs(r.div,{initial:{opacity:0,y:-30},animate:{opacity:1,y:0},transition:{duration:.6},className:"pt-12 pb-8 px-6 text-center",children:[e.jsx(r.div,{initial:{scale:.8},animate:{scale:1},transition:{type:"spring",bounce:.5,delay:.2},className:"inline-flex p-4 rounded-3xl bg-gradient-to-br from-green-500 to-green-600 shadow-xl shadow-green-500/30 mb-4",children:e.jsx(M,{className:"h-12 w-12 text-white"})}),e.jsx(r.h1,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.3},className:"text-3xl font-bold bg-gradient-to-r from-green-600 to-green-500 bg-clip-text text-transparent",children:"eTijucas"}),e.jsxs(r.p,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.4},className:"text-muted-foreground mt-1",children:[o==="phone"&&"Login rápido via WhatsApp",o==="otp"&&"Digite o código recebido",o==="success"&&"Bem-vindo!"]})]}),e.jsx(r.div,{initial:{opacity:0,y:30},animate:{opacity:1,y:0},transition:{duration:.5,delay:.3},className:"flex-1 px-6",children:e.jsx(te,{className:"p-6 shadow-xl border-0 bg-background/80 backdrop-blur-xl",children:e.jsxs(ie,{mode:"wait",children:[o==="phone"&&e.jsxs(r.form,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},onSubmit:I,className:"space-y-6",children:[e.jsxs("div",{className:"text-center mb-4",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Seu número WhatsApp"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Enviaremos um código de 6 dígitos"})]}),e.jsx(ae,{value:i,onChange:g,error:void 0,autoFocus:!0}),N&&e.jsx(r.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"p-3 rounded-xl bg-red-50 dark:bg-red-950/30 border border-red-200 dark:border-red-800",children:e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400 text-center",children:N})}),e.jsx(ee,{type:"submit",size:"lg",disabled:!L||A||m>0,className:T("w-full h-14 text-lg font-semibold rounded-2xl","bg-gradient-to-r from-green-500 to-green-600","shadow-lg shadow-green-500/30",L&&"hover:shadow-xl hover:shadow-green-500/40"),children:A?e.jsxs(e.Fragment,{children:[e.jsx(ne,{className:"h-5 w-5 mr-2 animate-spin"}),"Enviando..."]}):m>0?e.jsxs(e.Fragment,{children:[e.jsx(Z,{className:"h-5 w-5 mr-2"}),"Aguarde ",m,"s"]}):e.jsxs(e.Fragment,{children:[e.jsx(M,{className:"h-5 w-5 mr-2"}),"Receber código via WhatsApp"]})})]},"phone"),o==="otp"&&e.jsxs(r.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},className:"space-y-6",children:[e.jsxs("div",{className:"text-center mb-4",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Verifique seu WhatsApp"}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:["Código enviado para ",q||`(${i.slice(0,2)}) *****-${i.slice(-4)}`]}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-2",children:["Expira em ",K(P)]})]}),F&&e.jsxs(r.button,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},onClick:H,className:"w-full flex items-center justify-center gap-2 py-3 rounded-xl bg-green-500/10 border border-green-500/30 text-green-600 hover:bg-green-500/20 transition-all",children:[e.jsx(de,{className:"h-4 w-4"}),e.jsx("span",{className:"font-medium",children:"Colar código do WhatsApp"})]}),e.jsx("div",{className:"flex justify-center gap-3",onPaste:X,children:[0,1,2,3,4,5].map(t=>e.jsx("input",{ref:a=>C.current[t]=a,type:"text",inputMode:"numeric",maxLength:1,value:b[t]||"",onChange:a=>U(t,a.target.value),onKeyDown:a=>{a.key==="Backspace"&&!b[t]&&t>0&&C.current[t-1]?.focus()},className:T("w-12 h-14 text-center text-2xl font-bold rounded-xl border-2 transition-all","focus:border-green-500 focus:ring-2 focus:ring-green-500/20",b[t]?"border-green-500 bg-green-50 dark:bg-green-950/30":"border-border bg-muted/50")},t))}),e.jsxs("div",{className:"text-center space-y-2",children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["1. Vá ao WhatsApp e toque em ",e.jsx("span",{className:"font-medium text-green-600",children:'"Copiar código"'})]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["2. Volte aqui e toque em ",e.jsx("span",{className:"font-medium text-green-600",children:'"Colar código"'})]})]}),N&&e.jsx(r.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"p-3 rounded-xl bg-red-50 dark:bg-red-950/30 border border-red-200 dark:border-red-800",children:e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400 text-center",children:N})}),e.jsx("div",{className:"text-center",children:e.jsx("button",{onClick:()=>I(),disabled:m>0||A,className:"text-sm text-primary hover:underline disabled:text-muted-foreground disabled:no-underline",children:m>0?`Reenviar em ${m}s`:"Reenviar código"})})]},"otp"),o==="success"&&e.jsxs(r.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"py-8 text-center",children:[e.jsx(r.div,{initial:{scale:0},animate:{scale:1},transition:{type:"spring",bounce:.5},className:"inline-flex p-6 rounded-full bg-green-500 mb-6",children:e.jsx(oe,{className:"h-12 w-12 text-white"})}),e.jsx("h2",{className:"text-2xl font-bold text-green-600",children:"Login realizado!"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Redirecionando..."})]},"success")]})})}),e.jsx(r.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.8},className:"py-8 px-6",children:e.jsxs("div",{className:"flex items-center justify-center gap-6 text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ce,{className:"h-5 w-5 text-green-500"}),e.jsx("span",{className:"text-sm font-medium",children:"1.234 moradores"})]}),e.jsx("div",{className:"w-px h-4 bg-border"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(le,{className:"h-5 w-5 text-amber-500"}),e.jsx("span",{className:"text-sm font-medium",children:"App oficial"})]})]})})]})}export{Me as default};
