import{r as a,j as e,m as n,O as X,a4 as J,l as B,$ as Q,x as K,a5 as U,a2 as Y,a6 as Z,a7 as _,n as ee,L as te,a8 as se,a9 as ae,aa as re,ab as ne,w as ie}from"./vendor-app-D_TKIhWN.js";import{v as oe,c as V,a as G}from"./auth.service-BKIEn6Um.js";import{c as F,B as R,u as le}from"./index-BCFZkY3k.js";import{I as W}from"./input-Cnt5jzPU.js";import{L as q}from"./label-eaaWd06i.js";import{C as ce}from"./card-wTS1cbq2.js";import{P as de}from"./PhoneInput-C8O24MAC.js";import"./slider-Ca0J5M2G.js";import"./checkbox-DMr_ZSP7.js";import{P as me,m as H}from"./auth-utils-B5I9WPFS.js";function ue({value:x,onChange:i,onComplete:u,onResend:p,error:o,expiresAt:y,disabled:j=!1,isResending:T=!1,isVerifying:C=!1,phone:h}){const g=a.useRef([]),b=a.useRef(null),[L,l]=a.useState(null),[w,P]=a.useState(0),[k,N]=a.useState(!1),[O,E]=a.useState(null),d=6,m=x.padEnd(d," ").split("").slice(0,d);a.useEffect(()=>{if(y){const t=()=>{const r=Math.max(0,Math.floor((y.getTime()-Date.now())/1e3));return P(r),r};t();const s=setInterval(()=>{t()===0&&clearInterval(s)},1e3);return()=>clearInterval(s)}},[y]),a.useEffect(()=>{if(o){N(!0);const t=setTimeout(()=>N(!1),600);return()=>clearTimeout(t)}},[o]),a.useEffect(()=>{const t=setTimeout(()=>{g.current[0]?.focus(),l(0)},300);return()=>clearTimeout(t)},[]),a.useEffect(()=>{if(x.length===d&&u&&!o&&!C){const t=setTimeout(()=>{u(x)},300);return()=>clearTimeout(t)}},[x,u,o,C]);const f=a.useCallback(t=>{E(t),setTimeout(()=>E(null),300)},[]),I=a.useCallback((t,s)=>{const r=s.replace(/\D/g,"").slice(-1);if(r){const v=[...m];v[t]=r;const S=v.join("").replace(/ /g,"");i(S),f(t),t<d-1&&setTimeout(()=>{g.current[t+1]?.focus(),l(t+1)},50)}},[m,i,f]),M=a.useCallback((t,s)=>{if(s.key==="Backspace"){s.preventDefault();const r=[...m];m[t]!==" "?(r[t]=" ",i(r.join("").replace(/ /g,""))):t>0&&(r[t-1]=" ",i(r.join("").replace(/ /g,"")),g.current[t-1]?.focus(),l(t-1))}s.key==="ArrowLeft"&&t>0&&(g.current[t-1]?.focus(),l(t-1)),s.key==="ArrowRight"&&t<d-1&&(g.current[t+1]?.focus(),l(t+1))},[m,i]),$=a.useCallback(t=>{t.preventDefault();const s=t.clipboardData.getData("text").replace(/\D/g,"").slice(0,d);if(s.length>0){i(s),s.split("").forEach((v,S)=>{setTimeout(()=>f(S),S*80)});const r=Math.min(s.length,d-1);setTimeout(()=>{g.current[r]?.focus(),l(r)},s.length*80+100)}},[i,f]),z=t=>{const s=Math.floor(t/60),r=t%60;return`${s}:${r.toString().padStart(2,"0")}`},A=x.length===d,c=x.length/d*100;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(n.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.5},className:"text-center space-y-3",children:[e.jsx(n.div,{animate:{scale:[1,1.05,1],rotate:[0,5,-5,0]},transition:{duration:2,repeat:1/0,repeatType:"reverse"},className:"inline-flex p-4 rounded-2xl bg-gradient-to-br from-green-400 to-green-600 shadow-lg shadow-green-500/30",children:e.jsx(X,{className:"h-8 w-8 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-xl",children:"Verificação WhatsApp"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Enviamos um código de 6 dígitos para"}),h&&e.jsxs(n.p,{initial:{opacity:0},animate:{opacity:1},className:"text-primary font-semibold flex items-center justify-center gap-1 mt-1",children:[e.jsx(J,{className:"h-4 w-4"}),h]})]})]}),e.jsx("div",{className:"relative h-1.5 bg-muted rounded-full overflow-hidden",children:e.jsx(n.div,{initial:{width:0},animate:{width:`${c}%`},transition:{duration:.3,ease:"easeOut"},className:F("absolute inset-y-0 left-0 rounded-full",A?"bg-gradient-to-r from-green-400 to-green-600":"bg-gradient-to-r from-primary to-primary/70")})}),e.jsx(n.div,{ref:b,animate:k?{x:[-12,12,-12,12,-6,6,0],transition:{duration:.5}}:{},className:"flex justify-center gap-2 sm:gap-3",children:m.map((t,s)=>{const r=t!==" ",v=L===s,S=O===s;return e.jsxs(n.div,{initial:{opacity:0,y:30,scale:.8},animate:{opacity:1,y:0,scale:S?1.1:1},transition:{delay:s*.08,duration:.3,scale:{duration:.15}},className:"relative",children:[v&&e.jsx(n.div,{layoutId:"otp-glow",className:"absolute -inset-1 rounded-2xl bg-primary/20 blur-sm",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0}}),e.jsx("input",{ref:D=>{g.current[s]=D},type:"text",inputMode:"numeric",pattern:"[0-9]*",autoComplete:"one-time-code",maxLength:1,value:t===" "?"":t,onChange:D=>I(s,D.target.value),onKeyDown:D=>M(s,D),onFocus:()=>l(s),onBlur:()=>l(null),onPaste:$,disabled:j,className:F("relative w-12 h-14 sm:w-14 sm:h-16 text-center text-2xl sm:text-3xl font-bold","rounded-xl sm:rounded-2xl border-2 outline-none","transition-all duration-200 ease-out","bg-background/50 backdrop-blur-sm",!r&&!v&&!o&&"border-border hover:border-muted-foreground/50",v&&!o&&"border-primary shadow-lg shadow-primary/20",r&&!o&&"border-green-400 bg-green-50/50 dark:bg-green-950/30 text-green-700 dark:text-green-300",o&&"border-red-400 bg-red-50/50 dark:bg-red-950/30 text-red-600",j&&"opacity-50 cursor-not-allowed")}),e.jsx(B,{children:r&&!o&&e.jsx(n.div,{initial:{scale:0,opacity:0},animate:{scale:1,opacity:1},exit:{scale:0,opacity:0},className:"absolute -top-1 -right-1 w-5 h-5 rounded-full bg-green-500 flex items-center justify-center shadow-sm",children:e.jsx(Q,{className:"h-3 w-3 text-white"})})})]},s)})}),e.jsxs(B,{mode:"wait",children:[A&&!o&&e.jsx(n.div,{initial:{opacity:0,y:10,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:-10},className:"flex items-center justify-center gap-2 p-3 rounded-xl bg-green-50 dark:bg-green-950/30 border border-green-200 dark:border-green-800",children:C?e.jsxs(e.Fragment,{children:[e.jsx(K,{className:"h-5 w-5 text-green-600 dark:text-green-400 animate-spin"}),e.jsx("span",{className:"text-sm font-medium text-green-700 dark:text-green-300",children:"Verificando código..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(n.div,{animate:{rotate:[0,360]},transition:{duration:.5},children:e.jsx(U,{className:"h-5 w-5 text-green-600 dark:text-green-400"})}),e.jsx("span",{className:"text-sm font-medium text-green-700 dark:text-green-300",children:"Código completo!"}),e.jsx(Y,{className:"h-4 w-4 text-green-500 animate-pulse"})]})},"success"),o&&e.jsxs(n.div,{initial:{opacity:0,y:10,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:-10},className:"flex items-center justify-center gap-2 p-3 rounded-xl bg-red-50 dark:bg-red-950/30 border border-red-200 dark:border-red-800",children:[e.jsx(Z,{className:"h-5 w-5 text-red-500"}),e.jsx("span",{className:"text-sm font-medium text-red-600 dark:text-red-400",children:o})]},"error")]}),e.jsxs(n.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.5},className:"text-center space-y-3",children:[w>0?e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Não recebeu o código?"}),e.jsxs("div",{className:"inline-flex items-center gap-2 px-4 py-2 rounded-full bg-muted/50",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-primary animate-pulse"}),e.jsxs("span",{className:"text-sm font-medium",children:["Reenviar em ",e.jsx("span",{className:"font-mono text-primary",children:z(w)})]})]})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Não recebeu o código?"}),e.jsx(R,{variant:"outline",size:"sm",onClick:p,disabled:T||j,className:"rounded-full px-6 border-primary/50 hover:bg-primary/10",children:T?e.jsxs(e.Fragment,{children:[e.jsx(_,{className:"h-4 w-4 mr-2 animate-spin"}),"Enviando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(_,{className:"h-4 w-4 mr-2"}),"Reenviar código"]})})]}),e.jsx("p",{className:"text-xs text-muted-foreground/70",children:"Dica: Cole o código automaticamente quando receber"})]})]})}function ve(){const x=le(),[i,u]=a.useState("phone"),[p,o]=a.useState(""),[y,j]=a.useState(""),[T,C]=a.useState(null),[h,g]=a.useState(""),[b,L]=a.useState(""),[l,w]=a.useState(!1),[P,k]=a.useState(null),[N,O]=a.useState(!1),E=oe(V(p)),d=y.length===6,m=me.test(h),f=h===b,I=async(c=!1)=>{if(E){w(!0),k(null);try{const t=await G.forgotPassword({phone:V(p)}),s=new Date(Date.now()+t.expiresIn*1e3);C(s),c||u("otp"),c&&j("")}catch(t){k(H(t))}finally{w(!1)}}},M=async()=>{d&&u("password")},$=async()=>{if(!(!m||!f)){w(!0),k(null);try{await G.resetPassword({phone:V(p),code:y,password:h,confirmPassword:b}),u("done")}catch(c){k(H(c))}finally{w(!1)}}},z=async c=>{c.preventDefault(),i==="phone"?await I():i==="otp"?await M():i==="password"&&await $()},A={phone:e.jsxs(n.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},className:"space-y-6",children:[e.jsxs("div",{className:"text-center mb-4",children:[e.jsx("div",{className:"inline-flex p-4 rounded-2xl bg-primary/10 mb-4",children:e.jsx(re,{className:"h-8 w-8 text-primary"})}),e.jsx("h2",{className:"text-xl font-semibold",children:"Recuperar Senha"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Digite seu telefone para receber um código"})]}),e.jsx(de,{value:p,onChange:o,error:void 0,autoFocus:!0}),e.jsx(R,{type:"submit",size:"lg",disabled:!E||l,className:"w-full h-14 text-lg font-semibold rounded-2xl",children:l?e.jsx(K,{className:"h-5 w-5 animate-spin"}):e.jsxs(e.Fragment,{children:["Enviar Código",e.jsx(ne,{className:"h-5 w-5 ml-2"})]})})]},"phone"),otp:e.jsx(n.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},className:"space-y-6",children:e.jsx(ue,{value:y,onChange:j,onComplete:c=>{j(c),u("password")},onResend:()=>I(!0),expiresAt:T||void 0,error:P||void 0,isResending:l,isVerifying:!1,phone:`(${p.slice(0,2)}) ${p.slice(2,7)}-${p.slice(7)}`})},"otp"),password:e.jsxs(n.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},className:"space-y-6",children:[e.jsxs("div",{className:"text-center mb-4",children:[e.jsx("div",{className:"inline-flex p-4 rounded-2xl bg-primary/10 mb-4",children:e.jsx(te,{className:"h-8 w-8 text-primary"})}),e.jsx("h2",{className:"text-xl font-semibold",children:"Nova Senha"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Digite sua nova senha"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{children:"Nova Senha"}),e.jsxs("div",{className:"relative",children:[e.jsx(W,{type:N?"text":"password",value:h,onChange:c=>g(c.target.value),className:F("h-12 text-base pr-10",h.length>0&&!m&&"border-amber-400"),placeholder:"Mínimo 8 caracteres",autoComplete:"new-password"}),e.jsx("button",{type:"button",onClick:()=>O(!N),className:"absolute right-3 top-3 text-muted-foreground hover:text-foreground",children:N?e.jsx(se,{className:"h-5 w-5"}):e.jsx(ae,{className:"h-5 w-5"})})]}),h.length>0&&!m&&e.jsx("p",{className:"text-xs text-amber-600 dark:text-amber-400",children:"Mínimo 8 caracteres"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{children:"Confirmar Senha"}),e.jsx(W,{type:N?"text":"password",value:b,onChange:c=>L(c.target.value),className:F("h-12 text-base",b.length>0&&!f&&"border-red-400"),placeholder:"Repita a senha",autoComplete:"new-password"}),b.length>0&&!f&&e.jsx("p",{className:"text-xs text-red-600 dark:text-red-400",children:"As senhas não conferem"})]})]}),e.jsx(R,{type:"submit",size:"lg",disabled:!m||!f||l,className:"w-full h-14 text-lg font-semibold rounded-2xl",children:l?e.jsx(K,{className:"h-5 w-5 animate-spin"}):"Redefinir Senha"})]},"password"),done:e.jsxs(n.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"text-center py-8",children:[e.jsx("div",{className:"inline-flex p-6 rounded-full bg-green-100 dark:bg-green-900/30 mb-6",children:e.jsx(ee,{className:"h-12 w-12 text-green-600 dark:text-green-400"})}),e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Sucesso!"}),e.jsx("p",{className:"text-muted-foreground mb-8",children:"Sua senha foi redefinida com sucesso."}),e.jsx(R,{size:"lg",onClick:()=>x("/login"),className:"w-full h-14 text-lg font-semibold rounded-2xl bg-green-600 hover:bg-green-700",children:"Fazer Login"})]},"done")};return e.jsxs("div",{className:"min-h-screen flex flex-col bg-gradient-to-br from-primary/5 via-background to-primary/10",children:[e.jsx("div",{className:"p-4",children:i!=="done"&&e.jsx(R,{variant:"ghost",size:"icon",onClick:()=>{i==="phone"?x("/login"):i==="otp"?u("phone"):i==="password"&&u("otp")},className:"rounded-xl",children:e.jsx(ie,{className:"h-5 w-5"})})}),e.jsx("div",{className:"flex-1 px-6 flex items-center justify-center pb-20",children:e.jsxs(ce,{className:"w-full max-w-md p-6 shadow-xl border-0 bg-background/80 backdrop-blur-xl",children:[e.jsx("form",{onSubmit:z,children:e.jsx(B,{mode:"wait",children:A[i]})}),P&&e.jsx(n.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"mt-4 p-3 rounded-xl bg-red-50 dark:bg-red-950/30 border border-red-200 dark:border-red-800",children:e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400 text-center",children:P})})]})})]})}export{ve as default};
