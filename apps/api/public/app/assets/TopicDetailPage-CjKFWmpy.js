import{r as g,j as e,a as se}from"./vendor-radix-CUH4rfwv.js";import{a as M,X as ae,f as K,e as re,d as oe,u as D,L as ne}from"./index-CX3wU6j3.js";import{B as F}from"./button-QhNUS_-_.js";import{B as ie}from"./badge-UjiMSVBq.js";import{S as c}from"./skeleton-wTlRtZxe.js";import{u as O,b as E,c as q}from"./vendor-query-BEEFX5y8.js";import{Q as p}from"./client-w4Cmw8pS.js";import{t as w,f as le,a as ce}from"./useUploadImage-C1-nDfAC.js";import{u as me}from"./useAuthStore-zZ7TxdTJ.js";import{b as de}from"./bairros-Cf5Z_oCw.js";import{C as ue,a as pe}from"./CommentComposer-DFci66st.js";import{m as u,A as I}from"./vendor-motion-BFiVL1R0.js";import{Z as xe}from"./zoom-in-ijzMSIFq.js";import{C as he}from"./chevron-left-CzlE3P6O.js";import{C as fe}from"./chevron-right-DGbzTk2W.js";import{D as ge,a as be,b as je,c as N,d as ye}from"./dropdown-menu-DPrqYwYI.js";import{B as ve}from"./bookmark-BXHyJcuY.js";import{E as Ne}from"./eye-DdZ7imuU.js";import{A as we}from"./arrow-left-BOJGD26_.js";import{S as ke}from"./share-2-DGzwiWqB.js";import{M as Ce}from"./map-pin-DtsWrykT.js";import{L as Te}from"./loader-circle-CdH1GV76.js";import{H as Se}from"./heart-D_8m88Fb.js";import{M as Ae}from"./message-circle-BcX_ygnV.js";import{E as Le}from"./ellipsis-uoobpDw3.js";import{L as V}from"./log-in-BFD9ZsbO.js";import"./vendor-utils-DF9nhviX.js";import"./useHaptics-9RCaLgIn.js";import"./localDatabase-DOGBufY4.js";import"./middleware-WYGlAF-S.js";import"./chevron-up-Dys09m9V.js";import"./chevron-down-DQn_GxLJ.js";import"./image-UoX08U6e.js";import"./send-B69-jjzX.js";import"./textarea-C5yNyTT-.js";import"./check-Bd91heco.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pe=M("Ban",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m4.9 4.9 14.2 14.2",key:"1m5liu"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Me=M("Flag",[["path",{d:"M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z",key:"i9b6wo"}],["line",{x1:"4",x2:"4",y1:"22",y2:"15",key:"1cm3nv"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const De=M("Link2",[["path",{d:"M9 17H7A5 5 0 0 1 7 7h2",key:"8i5ue5"}],["path",{d:"M15 7h2a5 5 0 1 1 0 10h-2",key:"1b9ql8"}],["line",{x1:"8",x2:"16",y1:"12",y2:"12",key:"1jonct"}]]);function Fe(t){return O({queryKey:p.topics.detail(t),queryFn:()=>w.getById(t),enabled:!!t,retry:(a,o)=>o?.status===404?!1:a<3})}function Ee(t){return O({queryKey:p.topics.comments(t),queryFn:()=>w.getComments(t),enabled:!!t})}function qe(){const t=E();return q({mutationFn:async({id:a})=>w.toggleLike(a),onSuccess:(a,{id:o})=>{t.invalidateQueries({queryKey:p.topics.all}),t.invalidateQueries({queryKey:p.topics.detail(o)})}})}function Qe(t){const a=E();return q({mutationFn:o=>w.addComment(t,o),onSuccess:()=>{a.invalidateQueries({queryKey:p.topics.comments(t)}),a.invalidateQueries({queryKey:p.topics.detail(t)})}})}function $e(t){const a=E();return q({onMutate:async({commentId:o,liked:r})=>{await a.cancelQueries({queryKey:p.topics.comments(t)});const i=a.getQueryData(p.topics.comments(t));return a.setQueryData(p.topics.comments(t),s=>s&&{...s,data:H(s.data,o,!r)}),{previousComments:i}},mutationFn:async({commentId:o})=>w.toggleCommentLike(o),onError:(o,r,i)=>{i?.previousComments&&a.setQueryData(p.topics.comments(t),i.previousComments)},onSettled:()=>{setTimeout(()=>{a.invalidateQueries({queryKey:p.topics.comments(t)})},500)}})}function H(t,a,o){return t.map(r=>r.id===a?{...r,liked:o,likesCount:o?(r.likesCount??0)+1:Math.max(0,(r.likesCount??0)-1)}:r.replies&&r.replies.length>0?{...r,replies:H(r.replies,a,o)}:r)}function Be({images:t,alt:a=""}){const[o,r]=g.useState(null),[i,s]=g.useState(0);if(t.length===0)return null;const h=n=>{r(n),s(n),document.body.style.overflow="hidden"},x=()=>{r(null),document.body.style.overflow=""},b=()=>{s(n=>(n+1)%t.length)},m=()=>{s(n=>(n-1+t.length)%t.length)};return e.jsxs(e.Fragment,{children:[t.length===1?e.jsxs(u.button,{whileTap:{scale:.98},onClick:()=>h(0),className:"relative w-full aspect-video rounded-xl overflow-hidden bg-muted group",children:[e.jsx("img",{src:t[0],alt:a,loading:"lazy",className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute inset-0 bg-black/0 group-hover:bg-black/10 transition-colors flex items-center justify-center",children:e.jsx(xe,{className:"w-8 h-8 text-white opacity-0 group-hover:opacity-80 transition-opacity drop-shadow-lg"})})]}):e.jsx("div",{className:"flex gap-2 overflow-x-auto scrollbar-hide -mx-4 px-4",children:t.map((n,l)=>e.jsxs(u.button,{whileTap:{scale:.95},onClick:()=>h(l),className:"relative flex-shrink-0 w-32 h-32 rounded-xl overflow-hidden bg-muted group",children:[e.jsx("img",{src:n,alt:`${a} ${l+1}`,loading:"lazy",className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute inset-0 bg-black/0 group-hover:bg-black/10 transition-colors"})]},l))}),o!==null&&se.createPortal(e.jsx(I,{children:e.jsxs(u.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-50 bg-black flex flex-col",onClick:x,children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 safe-top",children:[e.jsxs("span",{className:"text-white/70 text-sm",children:[i+1," / ",t.length]}),e.jsx("button",{onClick:x,className:"p-2 rounded-full bg-white/10 hover:bg-white/20 transition-colors min-h-[44px] min-w-[44px] flex items-center justify-center","aria-label":"Fechar",children:e.jsx(ae,{className:"w-6 h-6 text-white"})})]}),e.jsx("div",{className:"flex-1 flex items-center justify-center px-4",onClick:n=>n.stopPropagation(),children:e.jsx(u.img,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},src:t[i],alt:`${a} ${i+1}`,className:"max-w-full max-h-full object-contain rounded-lg",draggable:!1},i)}),t.length>1&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:n=>{n.stopPropagation(),m()},className:"absolute left-2 top-1/2 -translate-y-1/2 p-3 rounded-full bg-white/10 hover:bg-white/20 transition-colors min-h-[44px] min-w-[44px] flex items-center justify-center","aria-label":"Imagem anterior",children:e.jsx(he,{className:"w-6 h-6 text-white"})}),e.jsx("button",{onClick:n=>{n.stopPropagation(),b()},className:"absolute right-2 top-1/2 -translate-y-1/2 p-3 rounded-full bg-white/10 hover:bg-white/20 transition-colors min-h-[44px] min-w-[44px] flex items-center justify-center","aria-label":"Pr√≥xima imagem",children:e.jsx(fe,{className:"w-6 h-6 text-white"})})]}),t.length>1&&e.jsx("div",{className:"flex justify-center gap-2 py-4 safe-bottom",children:t.map((n,l)=>e.jsx("button",{onClick:j=>{j.stopPropagation(),s(l)},className:`w-2 h-2 rounded-full transition-colors ${l===i?"bg-white":"bg-white/30"}`,"aria-label":`Ir para imagem ${l+1}`},l))})]})}),document.body)]})}function Re({topicId:t,isAnonymous:a,children:o,onSave:r,onHide:i,onReport:s,onBlock:h}){const{toast:x}=K(),[b,m]=g.useState(!1),n=async()=>{const L=`${window.location.origin}/topico/${t}`;await navigator.clipboard.writeText(L),x({title:"Link copiado!",description:"O link foi copiado para a √°rea de transfer√™ncia."}),m(!1)},l=()=>{r?.(),x({title:"T√≥pico salvo",description:"Voc√™ pode encontr√°-lo nos salvos."}),m(!1)},j=()=>{i?.(),x({title:"T√≥pico oculto",description:"Voc√™ n√£o ver√° mais este t√≥pico."}),m(!1)},S=()=>{s?.(),x({title:"Den√∫ncia enviada",description:"Obrigado por ajudar a manter a comunidade segura."}),m(!1)},A=()=>{h?.(),x({title:"Usu√°rio bloqueado",description:"Voc√™ n√£o ver√° mais publica√ß√µes desta pessoa."}),m(!1)};return e.jsxs(ge,{open:b,onOpenChange:m,children:[e.jsx(be,{asChild:!0,children:o}),e.jsxs(je,{align:"end",className:"w-56 rounded-xl",children:[e.jsxs(N,{onClick:l,className:"flex items-center gap-3 py-3 cursor-pointer",children:[e.jsx(ve,{className:"w-4 h-4"}),e.jsx("span",{children:"Salvar"})]}),e.jsxs(N,{onClick:n,className:"flex items-center gap-3 py-3 cursor-pointer",children:[e.jsx(De,{className:"w-4 h-4"}),e.jsx("span",{children:"Copiar link"})]}),e.jsx(ye,{}),e.jsxs(N,{onClick:j,className:"flex items-center gap-3 py-3 cursor-pointer",children:[e.jsx(Ne,{className:"w-4 h-4"}),e.jsx("span",{children:"Ocultar este assunto"})]}),e.jsxs(N,{onClick:S,className:"flex items-center gap-3 py-3 cursor-pointer text-orange-600",children:[e.jsx(Me,{className:"w-4 h-4"}),e.jsx("span",{children:"Denunciar"})]}),!a&&e.jsxs(N,{onClick:A,className:"flex items-center gap-3 py-3 cursor-pointer text-red-600",children:[e.jsx(Pe,{className:"w-4 h-4"}),e.jsx("span",{children:"Bloquear usu√°rio"})]})]})]})}const U={reclamacao:{label:"Reclama√ß√£o",color:"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400"},sugestao:{label:"Sugest√£o",color:"bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400"},duvida:{label:"D√∫vida",color:"bg-purple-100 text-purple-700 dark:bg-purple-900/30 dark:text-purple-400"},alerta:{label:"Alerta",color:"bg-orange-100 text-orange-700 dark:bg-orange-900/30 dark:text-orange-400"},elogio:{label:"Elogio",color:"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400"},outros:{label:"Outros",color:"bg-gray-100 text-gray-700 dark:bg-gray-800 dark:text-gray-400"}};function ze(){return e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx("header",{className:"sticky top-0 z-20 bg-background/95 backdrop-blur-md border-b border-border safe-top",children:e.jsxs("div",{className:"flex items-center justify-between px-4 py-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(c,{className:"w-10 h-10 rounded-full"}),e.jsx(c,{className:"w-24 h-6"})]}),e.jsx(c,{className:"w-10 h-10 rounded-full"})]})}),e.jsxs("article",{className:"px-4 py-4 space-y-4",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(c,{className:"w-24 h-6 rounded-full"}),e.jsx(c,{className:"w-20 h-6 rounded-full"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(c,{className:"w-10 h-10 rounded-full"}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(c,{className:"w-32 h-4"}),e.jsx(c,{className:"w-16 h-3"})]})]}),e.jsx(c,{className:"w-full h-8"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{className:"w-full h-4"}),e.jsx(c,{className:"w-full h-4"}),e.jsx(c,{className:"w-3/4 h-4"})]})]})]})}function Ue(){const t=D();return e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center p-4",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("div",{className:"w-20 h-20 mx-auto rounded-full bg-muted flex items-center justify-center",children:e.jsx("span",{className:"text-3xl",children:"üîç"})}),e.jsx("h2",{className:"text-xl font-semibold",children:"T√≥pico n√£o encontrado"}),e.jsx("p",{className:"text-muted-foreground max-w-sm",children:"Este t√≥pico pode ter sido removido ou o link est√° incorreto."}),e.jsx(F,{onClick:()=>t(-1),variant:"outline",children:"Voltar"})]})})}function Ke({action:t}){const a=D(),o=window.location.pathname;return e.jsx(u.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"fixed bottom-0 left-0 right-0 bg-gradient-to-r from-primary to-primary/80 p-4 safe-bottom z-40",children:e.jsxs("div",{className:"flex items-center justify-between gap-3 max-w-lg mx-auto",children:[e.jsxs("div",{className:"flex items-center gap-3 text-primary-foreground",children:[e.jsx(V,{className:"w-5 h-5 flex-shrink-0"}),e.jsxs("p",{className:"text-sm font-medium",children:["Fa√ßa login para ",t]})]}),e.jsx(F,{onClick:()=>a(`/login?redirect=${encodeURIComponent(o)}`),variant:"secondary",size:"sm",className:"flex-shrink-0",children:"Entrar"})]})})}function Ct(){const{id:t}=re(),[a]=oe(),o=D(),{toast:r}=K(),{isAuthenticated:i}=me(),{data:s,isLoading:h,isError:x}=Fe(t||""),{data:b}=Ee(t||""),m=b?.data||[],n=qe(),l=Qe(t||""),j=$e(t||""),[S,A]=g.useState(),[L,y]=g.useState(!1),[_,v]=g.useState("interagir"),Y=a.get("comment")==="true";if(h)return e.jsx(ze,{});if(x||!s)return e.jsx(Ue,{});const Q=U[s.categoria]||U.outros,Z=s.bairro?.nome||de.find(d=>d.id===s.bairroId)?.nome||"Tijucas",P=s.autor?.nome||(s.isAnon?"An√¥nimo":"Usu√°rio"),G=async()=>{const d={title:s.titulo,text:s.texto,url:window.location.href};if(navigator.share)try{await navigator.share(d)}catch{}else await navigator.clipboard.writeText(d.url),r({title:"Link copiado!",description:"O link foi copiado para a √°rea de transfer√™ncia."})},X=()=>{if(!i){v("curtir"),y(!0);return}navigator.vibrate&&navigator.vibrate(10),n.mutate({id:s.id,liked:s.liked||!1})},J=async(d,f,k)=>{if(!i){v("comentar"),y(!0);return}try{await l.mutateAsync({texto:d,isAnon:f,imageUrl:k}),r({title:"Coment√°rio enviado!",description:"Seu coment√°rio foi publicado."}),A(void 0)}catch{r({title:"Erro ao enviar coment√°rio",description:"Tente novamente.",variant:"destructive"})}},W=async(d,f,k,C)=>{if(!i){v("responder"),y(!0);return}try{await l.mutateAsync({texto:f,parentId:d,isAnon:k,imageUrl:C}),r({title:"Resposta enviada!"})}catch{r({title:"Erro ao enviar resposta",description:"Tente novamente.",variant:"destructive"})}},ee=d=>{if(!i){v("curtir"),y(!0);return}const f=(B,R)=>{for(const T of B){if(T.id===R)return T;if(T.replies){const z=f(T.replies,R);if(z)return z}}},C=f(m,d)?.liked??!1;navigator.vibrate&&navigator.vibrate(10),j.mutate({commentId:d,liked:C})},te=()=>{i||(v("comentar"),y(!0))},$=s.fotoUrl?[s.fotoUrl]:[];return e.jsxs("div",{className:"min-h-screen bg-background pb-32",children:[e.jsx("header",{className:"sticky top-0 z-20 bg-background/95 backdrop-blur-md border-b border-border safe-top",children:e.jsxs("div",{className:"flex items-center justify-between px-4 py-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(u.button,{whileTap:{scale:.9},onClick:()=>o(-1),className:"p-2 -ml-2 rounded-full hover:bg-muted transition-colors min-h-[44px] min-w-[44px] flex items-center justify-center","aria-label":"Voltar",children:e.jsx(we,{className:"w-5 h-5"})}),e.jsx("h1",{className:"text-lg font-semibold",children:"T√≥pico"})]}),e.jsx(u.button,{whileTap:{scale:.9},onClick:G,className:"p-2 rounded-full hover:bg-muted transition-colors min-h-[44px] min-w-[44px] flex items-center justify-center","aria-label":"Compartilhar",children:e.jsx(ke,{className:"w-5 h-5"})})]})}),e.jsxs("article",{className:"px-4 py-4",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2 mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx(ie,{className:`${Q.color} border-0`,children:Q.label}),e.jsxs("span",{className:"text-sm text-muted-foreground flex items-center gap-1",children:[e.jsx(Ce,{className:"w-3 h-3"}),Z]})]}),e.jsx("time",{dateTime:new Date(s.createdAt).toISOString(),title:ce(s.createdAt),className:"text-sm text-muted-foreground",children:le(s.createdAt)})]}),e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-muted flex items-center justify-center text-sm font-medium text-muted-foreground overflow-hidden",children:s.autor?.avatarUrl?e.jsx("img",{src:s.autor.avatarUrl,alt:P,className:"w-full h-full object-cover"}):s.isAnon?"?":P[0]?.toUpperCase()}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-foreground",children:P}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Autor"})]})]}),e.jsx("h2",{className:"text-xl font-bold text-foreground leading-tight mb-3",children:s.titulo}),e.jsx("p",{className:"text-base text-foreground leading-relaxed whitespace-pre-wrap mb-4",children:s.texto}),$.length>0&&e.jsx("div",{className:"mb-4",children:e.jsx(Be,{images:$,alt:s.titulo})}),e.jsxs("div",{className:"flex items-center justify-between pt-4 border-t border-border/50",children:[e.jsxs(u.button,{whileTap:{scale:.9},onClick:X,disabled:n.isPending,className:"flex items-center gap-2 py-2 px-4 rounded-full hover:bg-muted/50 transition-colors min-h-[44px] disabled:opacity-50",children:[e.jsx(u.div,{animate:s.liked?{scale:[1,1.3,1]}:{},transition:{duration:.3},children:n.isPending?e.jsx(Te,{className:"w-6 h-6 animate-spin text-muted-foreground"}):e.jsx(Se,{className:`w-6 h-6 ${s.liked?"fill-red-500 text-red-500":"text-muted-foreground"}`})}),e.jsxs("span",{className:`font-medium ${s.liked?"text-red-500":"text-muted-foreground"}`,children:[s.likesCount," Curtidas"]})]}),e.jsxs("div",{className:"flex items-center gap-1 text-muted-foreground",children:[e.jsx(Ae,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm font-medium",children:s.commentsCount})]}),e.jsx(Re,{topicId:s.id,isAnonymous:s.isAnon,children:e.jsx(u.button,{whileTap:{scale:.9},className:"p-2 rounded-full hover:bg-muted/50 transition-colors min-h-[44px] min-w-[44px] flex items-center justify-center",children:e.jsx(Le,{className:"w-5 h-5 text-muted-foreground"})})})]})]}),e.jsx("section",{className:"border-t border-border pb-24",children:e.jsx(ue,{comments:m,onLike:ee,onReply:W})}),e.jsx(I,{mode:"wait",children:L?e.jsx(Ke,{action:_}):i?e.jsx(pe,{onSubmit:J,autoFocus:Y,replyTo:S,isSubmitting:l.isPending}):e.jsx(u.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"fixed bottom-0 left-0 right-0 bg-background border-t border-border p-4 safe-bottom z-40",children:e.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-xl bg-muted cursor-pointer hover:bg-muted/80 transition-colors",onClick:te,children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-primary/10 flex items-center justify-center",children:e.jsx(V,{className:"w-4 h-4 text-primary"})}),e.jsx("p",{className:"text-muted-foreground text-sm flex-1",children:"Fa√ßa login para comentar..."}),e.jsx(F,{size:"sm",asChild:!0,children:e.jsx(ne,{to:`/login?redirect=${encodeURIComponent(window.location.pathname)}`,children:"Entrar"})})]})})})]})}export{Ct as default};
