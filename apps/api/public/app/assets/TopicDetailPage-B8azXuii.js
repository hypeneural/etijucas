import{r as v,j as e,a as J}from"./vendor-radix-CUH4rfwv.js";import{a as D,X as W,f as U,e as ee,d as te,u as z,L as se}from"./index-CgIEr2SX.js";import{B as M}from"./button-BPOj2vZO.js";import{B as ae}from"./badge-ByXJa94Q.js";import{S as d}from"./skeleton-05R-eRdW.js";import{u as K,b as q,c as E}from"./vendor-query-BEEFX5y8.js";import{Q as u}from"./client-w4Cmw8pS.js";import{t as w,f as re,a as oe}from"./useUploadImage-B5swaG5X.js";import{u as ne}from"./useAuthStore-zZ7TxdTJ.js";import{b as ie}from"./bairros-Cf5Z_oCw.js";import{C as le,a as ce}from"./CommentComposer-DOACrltP.js";import{m as x,A as O}from"./vendor-motion-BIvcbjca.js";import{Z as de}from"./zoom-in-B6dJJPEe.js";import{C as me}from"./chevron-left-DwFEPaAL.js";import{C as ue}from"./chevron-right-BbiRn16O.js";import{D as pe,a as xe,b as he,c as y,d as fe}from"./dropdown-menu-DnKzoBAW.js";import{B as ge}from"./bookmark-D6tVzVcG.js";import{E as be}from"./eye-t9rVXHbC.js";import{A as je}from"./arrow-left-D5pI0JmQ.js";import{S as ye}from"./share-2-ChH71Ji3.js";import{M as ve}from"./map-pin-DyDvCghf.js";import{L as we}from"./loader-circle-DN17jMVN.js";import{H as Ne}from"./heart-HKzCOC74.js";import{M as ke}from"./message-circle-CaZDrqrE.js";import{E as Ce}from"./ellipsis-yI9G5yGy.js";import{L as Te}from"./log-in-Sc8uMnDg.js";import"./vendor-utils-DF9nhviX.js";import"./useHaptics-9RCaLgIn.js";import"./localDatabase-CCmmxoKA.js";import"./middleware-WYGlAF-S.js";import"./chevron-up-CPAWE08b.js";import"./chevron-down-B7YOLDQD.js";import"./image-BK3NZ6tn.js";import"./send-DjG-9Yfw.js";import"./textarea-B-0jae-b.js";import"./check-BaOVx1Uu.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Se=D("Ban",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m4.9 4.9 14.2 14.2",key:"1m5liu"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ae=D("Flag",[["path",{d:"M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z",key:"i9b6wo"}],["line",{x1:"4",x2:"4",y1:"22",y2:"15",key:"1cm3nv"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Le=D("Link2",[["path",{d:"M9 17H7A5 5 0 0 1 7 7h2",key:"8i5ue5"}],["path",{d:"M15 7h2a5 5 0 1 1 0 10h-2",key:"1b9ql8"}],["line",{x1:"8",x2:"16",y1:"12",y2:"12",key:"1jonct"}]]);function Me(t){return K({queryKey:u.topics.detail(t),queryFn:()=>w.getById(t),enabled:!!t,retry:(r,o)=>o?.status===404?!1:r<3})}function De(t){return K({queryKey:u.topics.comments(t),queryFn:()=>w.getComments(t),enabled:!!t})}function qe(){const t=q();return E({mutationFn:async({id:r})=>w.toggleLike(r),onSuccess:(r,{id:o})=>{t.invalidateQueries({queryKey:u.topics.all}),t.invalidateQueries({queryKey:u.topics.detail(o)})}})}function Ee(t){const r=q();return E({mutationFn:o=>w.addComment(t,o),onSuccess:()=>{r.invalidateQueries({queryKey:u.topics.comments(t)}),r.invalidateQueries({queryKey:u.topics.detail(t)})}})}function Fe(t){const r=q();return E({onMutate:async({commentId:o,liked:a})=>{await r.cancelQueries({queryKey:u.topics.comments(t)});const i=r.getQueryData(u.topics.comments(t));return r.setQueryData(u.topics.comments(t),s=>s&&{...s,data:I(s.data,o,!a)}),{previousComments:i}},mutationFn:async({commentId:o})=>w.toggleCommentLike(o),onError:(o,a,i)=>{i?.previousComments&&r.setQueryData(u.topics.comments(t),i.previousComments)},onSettled:()=>{setTimeout(()=>{r.invalidateQueries({queryKey:u.topics.comments(t)})},500)}})}function I(t,r,o){return t.map(a=>a.id===r?{...a,liked:o,likesCount:o?(a.likesCount??0)+1:Math.max(0,(a.likesCount??0)-1)}:a.replies&&a.replies.length>0?{...a,replies:I(a.replies,r,o)}:a)}function Pe({images:t,alt:r=""}){const[o,a]=v.useState(null),[i,s]=v.useState(0);if(t.length===0)return null;const h=n=>{a(n),s(n),document.body.style.overflow="hidden"},p=()=>{a(null),document.body.style.overflow=""},g=()=>{s(n=>(n+1)%t.length)},m=()=>{s(n=>(n-1+t.length)%t.length)};return e.jsxs(e.Fragment,{children:[t.length===1?e.jsxs(x.button,{whileTap:{scale:.98},onClick:()=>h(0),className:"relative w-full aspect-video rounded-xl overflow-hidden bg-muted group",children:[e.jsx("img",{src:t[0],alt:r,loading:"lazy",className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute inset-0 bg-black/0 group-hover:bg-black/10 transition-colors flex items-center justify-center",children:e.jsx(de,{className:"w-8 h-8 text-white opacity-0 group-hover:opacity-80 transition-opacity drop-shadow-lg"})})]}):e.jsx("div",{className:"flex gap-2 overflow-x-auto scrollbar-hide -mx-4 px-4",children:t.map((n,l)=>e.jsxs(x.button,{whileTap:{scale:.95},onClick:()=>h(l),className:"relative flex-shrink-0 w-32 h-32 rounded-xl overflow-hidden bg-muted group",children:[e.jsx("img",{src:n,alt:`${r} ${l+1}`,loading:"lazy",className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute inset-0 bg-black/0 group-hover:bg-black/10 transition-colors"})]},l))}),o!==null&&J.createPortal(e.jsx(O,{children:e.jsxs(x.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-50 bg-black flex flex-col",onClick:p,children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 safe-top",children:[e.jsxs("span",{className:"text-white/70 text-sm",children:[i+1," / ",t.length]}),e.jsx("button",{onClick:p,className:"p-2 rounded-full bg-white/10 hover:bg-white/20 transition-colors min-h-[44px] min-w-[44px] flex items-center justify-center","aria-label":"Fechar",children:e.jsx(W,{className:"w-6 h-6 text-white"})})]}),e.jsx("div",{className:"flex-1 flex items-center justify-center px-4",onClick:n=>n.stopPropagation(),children:e.jsx(x.img,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},src:t[i],alt:`${r} ${i+1}`,className:"max-w-full max-h-full object-contain rounded-lg",draggable:!1},i)}),t.length>1&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:n=>{n.stopPropagation(),m()},className:"absolute left-2 top-1/2 -translate-y-1/2 p-3 rounded-full bg-white/10 hover:bg-white/20 transition-colors min-h-[44px] min-w-[44px] flex items-center justify-center","aria-label":"Imagem anterior",children:e.jsx(me,{className:"w-6 h-6 text-white"})}),e.jsx("button",{onClick:n=>{n.stopPropagation(),g()},className:"absolute right-2 top-1/2 -translate-y-1/2 p-3 rounded-full bg-white/10 hover:bg-white/20 transition-colors min-h-[44px] min-w-[44px] flex items-center justify-center","aria-label":"Pr√≥xima imagem",children:e.jsx(ue,{className:"w-6 h-6 text-white"})})]}),t.length>1&&e.jsx("div",{className:"flex justify-center gap-2 py-4 safe-bottom",children:t.map((n,l)=>e.jsx("button",{onClick:b=>{b.stopPropagation(),s(l)},className:`w-2 h-2 rounded-full transition-colors ${l===i?"bg-white":"bg-white/30"}`,"aria-label":`Ir para imagem ${l+1}`},l))})]})}),document.body)]})}function $e({topicId:t,isAnonymous:r,children:o,onSave:a,onHide:i,onReport:s,onBlock:h}){const{toast:p}=U(),[g,m]=v.useState(!1),n=async()=>{const A=`${window.location.origin}/topico/${t}`;await navigator.clipboard.writeText(A),p({title:"Link copiado!",description:"O link foi copiado para a √°rea de transfer√™ncia."}),m(!1)},l=()=>{a?.(),p({title:"T√≥pico salvo",description:"Voc√™ pode encontr√°-lo nos salvos."}),m(!1)},b=()=>{i?.(),p({title:"T√≥pico oculto",description:"Voc√™ n√£o ver√° mais este t√≥pico."}),m(!1)},T=()=>{s?.(),p({title:"Den√∫ncia enviada",description:"Obrigado por ajudar a manter a comunidade segura."}),m(!1)},S=()=>{h?.(),p({title:"Usu√°rio bloqueado",description:"Voc√™ n√£o ver√° mais publica√ß√µes desta pessoa."}),m(!1)};return e.jsxs(pe,{open:g,onOpenChange:m,children:[e.jsx(xe,{asChild:!0,children:o}),e.jsxs(he,{align:"end",className:"w-56 rounded-xl",children:[e.jsxs(y,{onClick:l,className:"flex items-center gap-3 py-3 cursor-pointer",children:[e.jsx(ge,{className:"w-4 h-4"}),e.jsx("span",{children:"Salvar"})]}),e.jsxs(y,{onClick:n,className:"flex items-center gap-3 py-3 cursor-pointer",children:[e.jsx(Le,{className:"w-4 h-4"}),e.jsx("span",{children:"Copiar link"})]}),e.jsx(fe,{}),e.jsxs(y,{onClick:b,className:"flex items-center gap-3 py-3 cursor-pointer",children:[e.jsx(be,{className:"w-4 h-4"}),e.jsx("span",{children:"Ocultar este assunto"})]}),e.jsxs(y,{onClick:T,className:"flex items-center gap-3 py-3 cursor-pointer text-orange-600",children:[e.jsx(Ae,{className:"w-4 h-4"}),e.jsx("span",{children:"Denunciar"})]}),!r&&e.jsxs(y,{onClick:S,className:"flex items-center gap-3 py-3 cursor-pointer text-red-600",children:[e.jsx(Se,{className:"w-4 h-4"}),e.jsx("span",{children:"Bloquear usu√°rio"})]})]})]})}const R={reclamacao:{label:"Reclama√ß√£o",color:"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400"},sugestao:{label:"Sugest√£o",color:"bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400"},duvida:{label:"D√∫vida",color:"bg-purple-100 text-purple-700 dark:bg-purple-900/30 dark:text-purple-400"},alerta:{label:"Alerta",color:"bg-orange-100 text-orange-700 dark:bg-orange-900/30 dark:text-orange-400"},elogio:{label:"Elogio",color:"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400"},outros:{label:"Outros",color:"bg-gray-100 text-gray-700 dark:bg-gray-800 dark:text-gray-400"}};function Qe(){return e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx("header",{className:"sticky top-0 z-20 bg-background/95 backdrop-blur-md border-b border-border safe-top",children:e.jsxs("div",{className:"flex items-center justify-between px-4 py-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(d,{className:"w-10 h-10 rounded-full"}),e.jsx(d,{className:"w-24 h-6"})]}),e.jsx(d,{className:"w-10 h-10 rounded-full"})]})}),e.jsxs("article",{className:"px-4 py-4 space-y-4",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(d,{className:"w-24 h-6 rounded-full"}),e.jsx(d,{className:"w-20 h-6 rounded-full"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(d,{className:"w-10 h-10 rounded-full"}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(d,{className:"w-32 h-4"}),e.jsx(d,{className:"w-16 h-3"})]})]}),e.jsx(d,{className:"w-full h-8"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{className:"w-full h-4"}),e.jsx(d,{className:"w-full h-4"}),e.jsx(d,{className:"w-3/4 h-4"})]})]})]})}function Be(){const t=z();return e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center p-4",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("div",{className:"w-20 h-20 mx-auto rounded-full bg-muted flex items-center justify-center",children:e.jsx("span",{className:"text-3xl",children:"üîç"})}),e.jsx("h2",{className:"text-xl font-semibold",children:"T√≥pico n√£o encontrado"}),e.jsx("p",{className:"text-muted-foreground max-w-sm",children:"Este t√≥pico pode ter sido removido ou o link est√° incorreto."}),e.jsx(M,{onClick:()=>t(-1),variant:"outline",children:"Voltar"})]})})}function vt(){const{id:t}=ee(),[r]=te(),o=z(),{toast:a}=U(),{isAuthenticated:i}=ne(),{data:s,isLoading:h,isError:p}=Me(t||""),{data:g}=De(t||""),m=g?.data||[],n=qe(),l=Ee(t||""),b=Fe(t||""),[T,S]=v.useState(),A=r.get("comment")==="true",j=v.useCallback(c=>i?!0:(a({title:"Login necess√°rio",description:`Para ${c}, voc√™ precisa estar logado.`,action:e.jsx(M,{variant:"outline",size:"sm",onClick:()=>o(`/login?redirect=${encodeURIComponent(window.location.pathname)}`),children:"Entrar"})}),!1),[i,a,o]);if(h)return e.jsx(Qe,{});if(p||!s)return e.jsx(Be,{});const F=R[s.categoria]||R.outros,V=s.bairro?.nome||ie.find(c=>c.id===s.bairroId)?.nome||"Tijucas",L=s.autor?.nome||(s.isAnon?"An√¥nimo":"Usu√°rio"),H=async()=>{const c={title:s.titulo,text:s.texto,url:window.location.href};if(navigator.share)try{await navigator.share(c)}catch{}else await navigator.clipboard.writeText(c.url),a({title:"Link copiado!",description:"O link foi copiado para a √°rea de transfer√™ncia."})},_=()=>{j("curtir")&&(navigator.vibrate&&navigator.vibrate(10),n.mutate({id:s.id,liked:s.liked||!1}))},Y=async(c,f,N)=>{if(j("comentar"))try{await l.mutateAsync({texto:c,isAnon:f,imageUrl:N}),a({title:"Coment√°rio enviado!",description:"Seu coment√°rio foi publicado."}),S(void 0)}catch{a({title:"Erro ao enviar coment√°rio",description:"Tente novamente.",variant:"destructive"})}},Z=async(c,f,N,k)=>{if(j("responder"))try{await l.mutateAsync({texto:f,parentId:c,isAnon:N,imageUrl:k}),a({title:"Resposta enviada!"})}catch{a({title:"Erro ao enviar resposta",description:"Tente novamente.",variant:"destructive"})}},G=c=>{if(!j("curtir"))return;const f=($,Q)=>{for(const C of $){if(C.id===Q)return C;if(C.replies){const B=f(C.replies,Q);if(B)return B}}},k=f(m,c)?.liked??!1;navigator.vibrate&&navigator.vibrate(10),b.mutate({commentId:c,liked:k})},X=()=>{i||j("comentar")},P=s.fotoUrl?[s.fotoUrl]:[];return e.jsxs("div",{className:"min-h-screen bg-background pb-32",children:[e.jsx("header",{className:"sticky top-0 z-20 bg-background/95 backdrop-blur-md border-b border-border safe-top",children:e.jsxs("div",{className:"flex items-center justify-between px-4 py-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(x.button,{whileTap:{scale:.9},onClick:()=>o(-1),className:"p-2 -ml-2 rounded-full hover:bg-muted transition-colors min-h-[44px] min-w-[44px] flex items-center justify-center","aria-label":"Voltar",children:e.jsx(je,{className:"w-5 h-5"})}),e.jsx("h1",{className:"text-lg font-semibold",children:"T√≥pico"})]}),e.jsx(x.button,{whileTap:{scale:.9},onClick:H,className:"p-2 rounded-full hover:bg-muted transition-colors min-h-[44px] min-w-[44px] flex items-center justify-center","aria-label":"Compartilhar",children:e.jsx(ye,{className:"w-5 h-5"})})]})}),e.jsxs("article",{className:"px-4 py-4",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2 mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx(ae,{className:`${F.color} border-0`,children:F.label}),e.jsxs("span",{className:"text-sm text-muted-foreground flex items-center gap-1",children:[e.jsx(ve,{className:"w-3 h-3"}),V]})]}),e.jsx("time",{dateTime:new Date(s.createdAt).toISOString(),title:oe(s.createdAt),className:"text-sm text-muted-foreground",children:re(s.createdAt)})]}),e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-muted flex items-center justify-center text-sm font-medium text-muted-foreground overflow-hidden",children:s.autor?.avatarUrl?e.jsx("img",{src:s.autor.avatarUrl,alt:L,className:"w-full h-full object-cover"}):s.isAnon?"?":L[0]?.toUpperCase()}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-foreground",children:L}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Autor"})]})]}),e.jsx("h2",{className:"text-xl font-bold text-foreground leading-tight mb-3",children:s.titulo}),e.jsx("p",{className:"text-base text-foreground leading-relaxed whitespace-pre-wrap mb-4",children:s.texto}),P.length>0&&e.jsx("div",{className:"mb-4",children:e.jsx(Pe,{images:P,alt:s.titulo})}),e.jsxs("div",{className:"flex items-center justify-between pt-4 border-t border-border/50",children:[e.jsxs(x.button,{whileTap:{scale:.9},onClick:_,disabled:n.isPending,className:"flex items-center gap-2 py-2 px-4 rounded-full hover:bg-muted/50 transition-colors min-h-[44px] disabled:opacity-50",children:[e.jsx(x.div,{animate:s.liked?{scale:[1,1.3,1]}:{},transition:{duration:.3},children:n.isPending?e.jsx(we,{className:"w-6 h-6 animate-spin text-muted-foreground"}):e.jsx(Ne,{className:`w-6 h-6 ${s.liked?"fill-red-500 text-red-500":"text-muted-foreground"}`})}),e.jsxs("span",{className:`font-medium ${s.liked?"text-red-500":"text-muted-foreground"}`,children:[s.likesCount," Curtidas"]})]}),e.jsxs("div",{className:"flex items-center gap-1 text-muted-foreground",children:[e.jsx(ke,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm font-medium",children:s.commentsCount})]}),e.jsx($e,{topicId:s.id,isAnonymous:s.isAnon,children:e.jsx(x.button,{whileTap:{scale:.9},className:"p-2 rounded-full hover:bg-muted/50 transition-colors min-h-[44px] min-w-[44px] flex items-center justify-center",children:e.jsx(Ce,{className:"w-5 h-5 text-muted-foreground"})})})]})]}),e.jsx("section",{className:"border-t border-border pb-24",children:e.jsx(le,{comments:m,onLike:G,onReply:Z})}),e.jsx(O,{mode:"wait",children:i?e.jsx(ce,{onSubmit:Y,autoFocus:A,replyTo:T,isSubmitting:l.isPending}):e.jsx(x.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"fixed bottom-0 left-0 right-0 bg-background border-t border-border p-4 safe-bottom z-40",children:e.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-xl bg-muted cursor-pointer hover:bg-muted/80 transition-colors",onClick:X,children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-primary/10 flex items-center justify-center",children:e.jsx(Te,{className:"w-4 h-4 text-primary"})}),e.jsx("p",{className:"text-muted-foreground text-sm flex-1",children:"Fa√ßa login para comentar..."}),e.jsx(M,{size:"sm",asChild:!0,children:e.jsx(se,{to:`/login?redirect=${encodeURIComponent(window.location.pathname)}`,children:"Entrar"})})]})})})]})}export{vt as default};
