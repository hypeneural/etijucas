import{r as t}from"./vendor-app-DpJht6ER.js";const o={DISMISSED_UNTIL:"install_prompt_dismissed_until",NEVER_SHOW:"install_prompt_never",FIRST_VISIT:"install_prompt_first_visit",VISIT_COUNT:"install_prompt_visit_count"},I={INITIAL_SHOW:3e4,REMIND_7_DAYS:7*24*60*60*1e3,REMIND_24_HOURS:24*60*60*1e3};let a=null;typeof window<"u"&&(window.addEventListener("beforeinstallprompt",e=>{e.preventDefault(),a=e,console.log("[useInstallPrompt] Global capture: beforeinstallprompt event stored")}),window.addEventListener("appinstalled",()=>{a=null,console.log("[useInstallPrompt] App installed")}));function w(){return typeof window>"u"?!1:window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone===!0||document.referrer.includes("android-app://")}function P(){if(typeof navigator>"u")return"other";const e=navigator.userAgent;return/Android/i.test(e)?"android":/iPhone|iPad|iPod/.test(e)?"ios":/Windows|Mac|Linux/.test(e)&&!/Mobile/.test(e)?"desktop":"other"}function M(){if(typeof navigator>"u")return!1;const e=navigator.userAgent,s=navigator.vendor,r=/iPhone|iPad|iPod/.test(e),i=s==="Apple Computer, Inc.",c=!/CriOS|FxiOS|OPiOS|EdgiOS/.test(e);return r&&i&&c}function V(){if(typeof localStorage>"u")return!1;if(localStorage.getItem(o.NEVER_SHOW)==="true")return!0;const e=localStorage.getItem(o.DISMISSED_UNTIL);if(e){const s=parseInt(e,10);if(Date.now()<s)return!0;localStorage.removeItem(o.DISMISSED_UNTIL)}return!1}function R(){if(typeof localStorage>"u")return 1;const e=localStorage.getItem(o.VISIT_COUNT)||"0",s=parseInt(e,10)+1;return localStorage.setItem(o.VISIT_COUNT,s.toString()),localStorage.getItem(o.FIRST_VISIT)||localStorage.setItem(o.FIRST_VISIT,Date.now().toString()),s}function U(){const[e,s]=t.useState(a),[r,i]=t.useState(w),[c,d]=t.useState(V),[f,v]=t.useState(!1),[D,p]=t.useState(!1),[m,g]=t.useState(!1),S=t.useMemo(P,[]),u=t.useMemo(M,[]);t.useEffect(()=>{a&&!e&&(console.log("[useInstallPrompt] Found global prompt, syncing to state"),s(a))},[e]),t.useEffect(()=>{R()},[]),t.useEffect(()=>{const n=setTimeout(()=>{v(!0)},I.INITIAL_SHOW);return()=>clearTimeout(n)},[]),t.useEffect(()=>{const n=()=>i(w());n();const l=window.matchMedia("(display-mode: standalone)");return l.addEventListener("change",n),()=>l.removeEventListener("change",n)},[]),t.useEffect(()=>{const n=_=>{_.preventDefault();const E=_;a=E,s(E),console.log("[useInstallPrompt] beforeinstallprompt captured in useEffect")},l=()=>{a=null,s(null),i(!0),localStorage.removeItem(o.DISMISSED_UNTIL),localStorage.removeItem(o.NEVER_SHOW),console.log("[useInstallPrompt] App installed event received")};return window.addEventListener("beforeinstallprompt",n),window.addEventListener("appinstalled",l),()=>{window.removeEventListener("beforeinstallprompt",n),window.removeEventListener("appinstalled",l)}},[]);const h=t.useCallback(async()=>{if(!e)return!1;try{await e.prompt();const{outcome:n}=await e.userChoice;return n==="accepted"?(s(null),!0):!1}catch(n){return console.error("Error showing install prompt:",n),!1}},[e]),T=t.useCallback(n=>{switch(d(!0),g(!1),n){case"later_24h":localStorage.setItem(o.DISMISSED_UNTIL,(Date.now()+I.REMIND_24_HOURS).toString());break;case"later_7d":localStorage.setItem(o.DISMISSED_UNTIL,(Date.now()+I.REMIND_7_DAYS).toString());break;case"never":localStorage.setItem(o.NEVER_SHOW,"true");break}},[]),O=t.useCallback(()=>{p(!0)},[]),N=t.useCallback(()=>{p(!1)},[]),b=t.useCallback(()=>{localStorage.removeItem(o.DISMISSED_UNTIL),localStorage.removeItem(o.NEVER_SHOW),d(!1)},[]),L=t.useCallback(()=>{g(!0),d(!1)},[]);return{shouldShowBanner:t.useMemo(()=>r?!1:m?!0:c||!f||S==="android"&&!e&&!u?!1:u||!!e,[r,c,f,e,u,S,m]),canInstallNative:!!e&&!r,isInstalled:r,isIOSSafari:u&&!r,platform:S,promptInstall:h,dismiss:T,showIOSTutorial:O,hideIOSTutorial:N,isIOSTutorialVisible:D,resetDismissals:b,forceShowBanner:L}}export{U as u};
