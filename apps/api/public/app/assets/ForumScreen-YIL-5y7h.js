import{r as o,j as e,l as Se,m as Te,n as ie,o as Ie,p as Ae,q as ne,s as Le,t as ce,u as Re,w as Fe,S as de,x as me,L as ue,y as xe}from"./vendor-radix-i3jPA7eY.js";import{b as pe,X as U,c as T,E as $e,W as Be,R as he,T as De,i as Ee,d as Oe,h as Me,f as Pe,j as _e}from"./index-Cy-CyOCQ.js";import{B as V}from"./button-wIJM4i_h.js";import{V as ze,P as Ue}from"./VirtualList-DTI5RPBk.js";import{u as Ve}from"./useAuthStore-CmxHpAzW.js";import{T as qe,u as He,a as Qe,b as We}from"./useOfflineTopics-CogLYT5q.js";import{f as Xe,a as Ge,c as re}from"./formatTimeAgo-DAjiwQKG.js";import{I as fe}from"./input-B-htjwxp.js";import{m as d,A as J}from"./vendor-motion-CFwwOuCD.js";import{S as ge}from"./search-EkQWccna.js";import{C as Ke}from"./clock-CTqjJOKi.js";import{M as D}from"./map-pin-vXQQrsKK.js";import{C as te}from"./chevron-down-1g4gXw7k.js";import{C as be}from"./check-CNvOUOOV.js";import{C as Je}from"./dropdown-menu-HrUR1mSF.js";import{b as ae}from"./bairros-Cf5Z_oCw.js";import{I as Y}from"./image-DI-ZI6HI.js";import{B as Ye}from"./badge-DtIQMMSY.js";import{H as Ze}from"./heart-C1awAFuo.js";import{M as et}from"./message-circle-D4dNMhTN.js";import{S as tt}from"./share-2-DryTJTEV.js";import{C as F}from"./circle-alert--Y8iaoFV.js";import{S as at,a as st,b as rt,c as ot}from"./sheet-RnGrVSyl.js";import{T as lt,S as it}from"./textarea-nCJd9v77.js";import{S as nt}from"./switch-CuD9q5Kw.js";import{u as ct}from"./useUploadImage-DqSFzmck.js";import{C as dt}from"./camera-DqPydSty.js";import{E as mt,a as ut}from"./eye-BGEGevS6.js";import{L as xt}from"./loader-circle-Dijui0-r.js";import{L as pt}from"./lightbulb-BNxMlZFM.js";import{C as ht}from"./circle-help-Dlwx3-rK.js";import{B as ft}from"./bell-Buw1xo4U.js";import{T as gt}from"./thumbs-up-RxBTmahT.js";import"./vendor-utils-DycLLelI.js";import"./vendor-query-1wfeA5IL.js";import"./localDatabase-CqHbkdPn.js";import"./client-IB6zYSiJ.js";import"./chevron-right-DuV5YxOm.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bt=pe("MessageSquarePlus",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}],["path",{d:"M12 7v6",key:"lw1j43"}],["path",{d:"M9 10h6",key:"9gxzsh"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jt=pe("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]);function vt({onSearch:a,onSearchFocus:t}){const[r,c]=o.useState(""),[m,u]=o.useState(!1),x=l=>{c(l),a?.(l)},p=()=>{c(""),a?.("")},j=()=>{u(!0),t?.()};return e.jsxs("div",{className:"sticky top-0 z-20 bg-background/95 backdrop-blur-md safe-top",children:[e.jsxs(d.div,{className:"px-4 pt-4 pb-3",initial:{opacity:0,y:-10},animate:{opacity:1,y:0},transition:{duration:.3},children:[e.jsx("h1",{className:"text-2xl font-bold text-foreground tracking-tight",children:"Boca no Trombone"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-0.5",children:"A voz da comunidade"})]}),e.jsx("div",{className:"px-4 pb-3",children:e.jsxs(d.div,{className:"relative",animate:{scale:m?1.01:1},transition:{duration:.2},children:[e.jsx(ge,{className:`absolute left-3.5 top-1/2 -translate-y-1/2 w-5 h-5 transition-colors ${m?"text-primary":"text-muted-foreground"}`}),e.jsx(fe,{value:r,onChange:l=>x(l.target.value),onFocus:j,onBlur:()=>u(!1),placeholder:"Buscar assunto, rua, bairro‚Ä¶",className:`pl-11 pr-10 h-12 rounded-2xl border-2 text-base transition-all ${m?"border-primary bg-background shadow-lg":"border-transparent bg-muted/50"}`}),r&&e.jsx(d.button,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.8},onClick:p,className:"absolute right-3 top-1/2 -translate-y-1/2 p-1 rounded-full bg-muted hover:bg-muted-foreground/20 transition-colors","aria-label":"Limpar busca",children:e.jsx(U,{className:"w-4 h-4 text-muted-foreground"})})]})})]})}const G=[{id:"curtidos",label:"Mais curtidos",icon:qe},{id:"recentes",label:"Recentes",icon:Ke},{id:"perto",label:"Perto de mim",icon:D}];function Nt({value:a,onChange:t}){return e.jsx("div",{className:"px-4 pb-3",children:e.jsxs("div",{className:"relative flex bg-muted/60 rounded-xl p-1",children:[e.jsx(d.div,{className:"absolute inset-y-1 bg-background rounded-lg shadow-sm",initial:!1,animate:{x:`${G.findIndex(r=>r.id===a)*100}%`,width:`${100/G.length}%`},transition:{type:"spring",stiffness:400,damping:30},style:{left:"4px",right:"4px"}}),G.map(r=>{const c=r.icon,m=a===r.id;return e.jsxs(d.button,{onClick:()=>t(r.id),whileTap:{scale:.97},className:`relative flex-1 flex items-center justify-center gap-1.5 py-2.5 px-2 rounded-lg text-sm font-medium transition-colors z-10 min-h-[44px] ${m?"text-foreground":"text-muted-foreground"}`,"aria-pressed":m,"aria-label":r.label,children:[e.jsx(c,{className:`w-4 h-4 ${m?"text-primary":""}`}),e.jsx("span",{className:"hidden xs:inline",children:r.label}),e.jsx("span",{className:"xs:hidden",children:r.label.split(" ")[0]})]},r.id)})]})})}const Z=Se,ee=Te,q=o.forwardRef(({className:a,children:t,...r},c)=>e.jsxs(ie,{ref:c,className:T("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",a),...r,children:[t,e.jsx(Ie,{asChild:!0,children:e.jsx(te,{className:"h-4 w-4 opacity-50"})})]}));q.displayName=ie.displayName;const je=o.forwardRef(({className:a,...t},r)=>e.jsx(de,{ref:r,className:T("flex cursor-default items-center justify-center py-1",a),...t,children:e.jsx(Je,{className:"h-4 w-4"})}));je.displayName=de.displayName;const ve=o.forwardRef(({className:a,...t},r)=>e.jsx(me,{ref:r,className:T("flex cursor-default items-center justify-center py-1",a),...t,children:e.jsx(te,{className:"h-4 w-4"})}));ve.displayName=me.displayName;const H=o.forwardRef(({className:a,children:t,position:r="popper",...c},m)=>e.jsx(Ae,{children:e.jsxs(ne,{ref:m,className:T("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",r==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",a),position:r,...c,children:[e.jsx(je,{}),e.jsx(Le,{className:T("p-1",r==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:t}),e.jsx(ve,{})]})}));H.displayName=ne.displayName;const yt=o.forwardRef(({className:a,...t},r)=>e.jsx(ue,{ref:r,className:T("py-1.5 pl-8 pr-2 text-sm font-semibold",a),...t}));yt.displayName=ue.displayName;const $=o.forwardRef(({className:a,children:t,...r},c)=>e.jsxs(ce,{ref:c,className:T("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 focus:bg-accent focus:text-accent-foreground",a),...r,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(Re,{children:e.jsx(be,{className:"h-4 w-4"})})}),e.jsx(Fe,{children:t})]}));$.displayName=ce.displayName;const wt=o.forwardRef(({className:a,...t},r)=>e.jsx(xe,{ref:r,className:T("-mx-1 my-1 h-px bg-muted",a),...t}));wt.displayName=xe.displayName;const oe=[{value:"reclamacao",label:"Reclama√ß√£o",color:"bg-red-100 text-red-700 border-red-200"},{value:"sugestao",label:"Sugest√£o",color:"bg-blue-100 text-blue-700 border-blue-200"},{value:"duvida",label:"D√∫vida",color:"bg-purple-100 text-purple-700 border-purple-200"},{value:"alerta",label:"Alerta",color:"bg-orange-100 text-orange-700 border-orange-200"},{value:"elogio",label:"Elogio",color:"bg-green-100 text-green-700 border-green-200"},{value:"outros",label:"Outros",color:"bg-gray-100 text-gray-700 border-gray-200"}],kt=[{value:"hoje",label:"Hoje"},{value:"7dias",label:"7 dias"},{value:"30dias",label:"30 dias"},{value:"todos",label:"Todos"}];function Ct({filters:a,onChange:t,userBairroId:r}){const[c,m]=o.useState(!1),u=Object.values(a).filter(Boolean).length,x=(l,v)=>{t({...a,[l]:v})},p=l=>{const v={...a};delete v[l],t(v)},j=()=>{t({})};return e.jsxs("div",{className:"px-4 pb-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsxs(d.button,{onClick:()=>m(!c),whileTap:{scale:.95},className:`flex items-center gap-1.5 px-3 py-2 rounded-full text-sm font-medium transition-colors min-h-[44px] ${c||u>0?"bg-primary/10 text-primary":"bg-muted text-muted-foreground"}`,children:[e.jsx("span",{children:"Filtros"}),u>0&&e.jsx("span",{className:"bg-primary text-primary-foreground w-5 h-5 rounded-full text-xs flex items-center justify-center",children:u}),e.jsx(d.div,{animate:{rotate:c?180:0},transition:{duration:.2},children:e.jsx(te,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"flex-1 overflow-x-auto scrollbar-hide",children:e.jsxs("div",{className:"flex gap-1.5",children:[a.categoria&&e.jsx(K,{label:oe.find(l=>l.value===a.categoria)?.label||"",onRemove:()=>p("categoria")}),a.comFoto&&e.jsx(K,{label:"Com foto",icon:e.jsx(Y,{className:"w-3 h-3"}),onRemove:()=>p("comFoto")}),a.meuBairro&&e.jsx(K,{label:"Meu bairro",icon:e.jsx(D,{className:"w-3 h-3"}),onRemove:()=>p("meuBairro")})]})}),u>0&&e.jsx("button",{onClick:j,className:"text-xs text-muted-foreground hover:text-foreground transition-colors whitespace-nowrap",children:"Limpar"})]}),e.jsx(J,{children:c&&e.jsx(d.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.2},className:"overflow-hidden",children:e.jsxs("div",{className:"space-y-3 py-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-muted-foreground mb-1.5 block",children:"Categoria"}),e.jsx("div",{className:"flex flex-wrap gap-1.5",children:oe.map(l=>e.jsx(d.button,{whileTap:{scale:.95},onClick:()=>x("categoria",a.categoria===l.value?void 0:l.value),className:`px-3 py-1.5 rounded-full text-sm font-medium border transition-all min-h-[36px] ${a.categoria===l.value?`${l.color} border-current`:"bg-background border-border text-muted-foreground hover:border-foreground/30"}`,children:l.label},l.value))})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"text-xs font-medium text-muted-foreground mb-1.5 block",children:"Bairro"}),e.jsxs(Z,{value:a.bairroId||"__all__",onValueChange:l=>x("bairroId",l==="__all__"?void 0:l),children:[e.jsx(q,{className:"h-11 rounded-xl",children:e.jsx(ee,{placeholder:"Todos"})}),e.jsxs(H,{children:[e.jsx($,{value:"__all__",children:"Todos"}),ae.map(l=>e.jsx($,{value:l.id,children:l.nome},l.id))]})]})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"text-xs font-medium text-muted-foreground mb-1.5 block",children:"Per√≠odo"}),e.jsxs(Z,{value:a.periodo||"__all__",onValueChange:l=>x("periodo",l==="__all__"?void 0:l),children:[e.jsx(q,{className:"h-11 rounded-xl",children:e.jsx(ee,{placeholder:"Todos"})}),e.jsxs(H,{children:[e.jsx($,{value:"__all__",children:"Todos"}),kt.map(l=>e.jsx($,{value:l.value,children:l.label},l.value))]})]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(le,{label:"S√≥ com foto",icon:e.jsx(Y,{className:"w-4 h-4"}),active:!!a.comFoto,onClick:()=>x("comFoto",!a.comFoto)}),r&&e.jsx(le,{label:"Meu bairro",icon:e.jsx(D,{className:"w-4 h-4"}),active:!!a.meuBairro,onClick:()=>x("meuBairro",!a.meuBairro)})]})]})})})]})}function K({label:a,icon:t,onRemove:r}){return e.jsxs(d.span,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.8},className:"inline-flex items-center gap-1 px-2 py-1 rounded-full bg-primary/10 text-primary text-xs font-medium",children:[t,a,e.jsx("button",{onClick:r,className:"ml-0.5 p-0.5 rounded-full hover:bg-primary/20 transition-colors","aria-label":`Remover filtro ${a}`,children:e.jsx(U,{className:"w-3 h-3"})})]})}function le({label:a,icon:t,active:r,onClick:c}){return e.jsxs(d.button,{whileTap:{scale:.95},onClick:c,className:`flex items-center gap-2 px-3 py-2 rounded-full text-sm font-medium transition-all min-h-[44px] ${r?"bg-primary text-primary-foreground":"bg-muted text-muted-foreground hover:bg-muted-foreground/10"}`,children:[t,a]})}const St={reclamacao:{label:"Reclama√ß√£o",color:"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400"},sugestao:{label:"Sugest√£o",color:"bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400"},duvida:{label:"D√∫vida",color:"bg-purple-100 text-purple-700 dark:bg-purple-900/30 dark:text-purple-400"},alerta:{label:"Alerta",color:"bg-orange-100 text-orange-700 dark:bg-orange-900/30 dark:text-orange-400"},elogio:{label:"Elogio",color:"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400"},outros:{label:"Outros",color:"bg-gray-100 text-gray-700 dark:bg-gray-800 dark:text-gray-400"}},Tt=o.memo(function({topic:t,onPress:r,onLike:c,onComment:m,onShare:u,onMore:x}){const p=St[t.categoria],j=ae.find(g=>g.id===t.bairroId)?.nome||"Tijucas",l=Xe(t.createdAt),v=Ge(t.createdAt),I=g=>{g.stopPropagation(),navigator.vibrate&&navigator.vibrate(10),c?.()},k=g=>{g.stopPropagation(),m?.()},L=g=>{g.stopPropagation(),u?.()},w=g=>{g.stopPropagation(),x?.()};return e.jsxs(d.article,{layout:!0,initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,scale:.95},whileTap:{scale:.99},onClick:r,className:"bg-card rounded-2xl p-4 shadow-sm border border-border/50 cursor-pointer active:bg-muted/50 transition-colors",role:"article","aria-label":`${t.titulo} - ${p.label} em ${j}`,children:[e.jsxs("div",{className:"flex items-center justify-between gap-2 mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap min-w-0",children:[e.jsx(Ye,{variant:"secondary",className:`${p.color} border-0 font-medium text-xs px-2 py-0.5`,children:p.label}),e.jsxs("span",{className:"text-xs text-muted-foreground flex items-center gap-1 truncate",children:[e.jsx(D,{className:"w-3 h-3 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:j})]})]}),e.jsx("time",{dateTime:new Date(t.createdAt).toISOString(),title:v,className:"text-xs text-muted-foreground whitespace-nowrap",children:l})]}),e.jsx("h3",{className:"font-semibold text-foreground text-base leading-snug line-clamp-2 mb-1",children:t.titulo}),e.jsx("p",{className:"text-sm text-muted-foreground leading-relaxed line-clamp-2 mb-3",children:t.texto}),t.fotoUrl&&e.jsxs("div",{className:"relative mb-3 rounded-xl overflow-hidden bg-muted aspect-video",children:[e.jsx("img",{src:t.fotoUrl,alt:"",loading:"lazy",className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/20 to-transparent"})]}),e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("div",{className:"w-6 h-6 rounded-full bg-muted flex items-center justify-center text-xs font-medium text-muted-foreground",children:t.isAnon?"?":t.autorNome?.[0]||"U"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:t.isAnon?"An√¥nimo":t.autorNome})]}),e.jsxs("div",{className:"flex items-center justify-between pt-2 border-t border-border/50",children:[e.jsxs(d.button,{whileTap:{scale:.9},onClick:I,className:"flex items-center gap-1.5 py-2 px-3 -ml-3 rounded-lg hover:bg-muted/50 transition-colors min-h-[44px]","aria-label":t.liked?"Remover curtida":"Curtir","aria-pressed":t.liked,children:[e.jsx(d.div,{animate:t.liked?{scale:[1,1.3,1]}:{},transition:{duration:.3},children:e.jsx(Ze,{className:`w-5 h-5 ${t.liked?"fill-red-500 text-red-500":"text-muted-foreground"}`})}),e.jsx("span",{className:`text-sm font-medium ${t.liked?"text-red-500":"text-muted-foreground"}`,children:t.likesCount>0?t.likesCount:"Curtir"})]}),e.jsxs(d.button,{whileTap:{scale:.9},onClick:k,className:"flex items-center gap-1.5 py-2 px-3 rounded-lg hover:bg-muted/50 transition-colors min-h-[44px]","aria-label":`${t.commentsCount} coment√°rios`,children:[e.jsx(et,{className:"w-5 h-5 text-muted-foreground"}),e.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:t.commentsCount>0?t.commentsCount:"Comentar"})]}),e.jsx(d.button,{whileTap:{scale:.9},onClick:L,className:"flex items-center gap-1.5 py-2 px-3 rounded-lg hover:bg-muted/50 transition-colors min-h-[44px]","aria-label":"Compartilhar",children:e.jsx(tt,{className:"w-5 h-5 text-muted-foreground"})}),e.jsx(d.button,{whileTap:{scale:.9},onClick:w,className:"flex items-center justify-center p-2 rounded-lg hover:bg-muted/50 transition-colors min-h-[44px] min-w-[44px]","aria-label":"Mais op√ß√µes",children:e.jsx($e,{className:"w-5 h-5 text-muted-foreground"})})]})]})});function It(){return e.jsxs(d.div,{initial:{opacity:0},animate:{opacity:1},className:"bg-card rounded-2xl p-4 shadow-sm border border-border/50",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2 mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-5 w-20 bg-muted rounded-full animate-pulse"}),e.jsx("div",{className:"h-4 w-24 bg-muted rounded animate-pulse"})]}),e.jsx("div",{className:"h-4 w-12 bg-muted rounded animate-pulse"})]}),e.jsx("div",{className:"h-5 w-3/4 bg-muted rounded animate-pulse mb-2"}),e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsx("div",{className:"h-4 w-full bg-muted rounded animate-pulse"}),e.jsx("div",{className:"h-4 w-2/3 bg-muted rounded animate-pulse"})]}),e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("div",{className:"w-6 h-6 rounded-full bg-muted animate-pulse"}),e.jsx("div",{className:"h-3 w-16 bg-muted rounded animate-pulse"})]}),e.jsxs("div",{className:"flex items-center gap-6 pt-3 border-t border-border/50",children:[e.jsx("div",{className:"h-5 w-14 bg-muted rounded animate-pulse"}),e.jsx("div",{className:"h-5 w-14 bg-muted rounded animate-pulse"}),e.jsx("div",{className:"h-5 w-8 bg-muted rounded animate-pulse"})]})]})}function At({count:a=3}){return e.jsx("div",{className:"space-y-3",children:Array.from({length:a}).map((t,r)=>e.jsx(It,{},r))})}const Lt={empty:{icon:bt,title:"Nenhum t√≥pico ainda",description:"Seja o primeiro a abrir um assunto na comunidade!",actionLabel:"Criar t√≥pico",iconColor:"text-primary"},"no-results":{icon:ge,title:"Sem resultados",description:"Tente outro termo ou remova alguns filtros.",actionLabel:"Limpar filtros",iconColor:"text-muted-foreground"},offline:{icon:Be,title:"Voc√™ est√° offline",description:"Mostrando t√≥picos salvos. Conecte-se para ver novidades.",actionLabel:"Tentar novamente",iconColor:"text-orange-500"},error:{icon:F,title:"Algo deu errado",description:"N√£o foi poss√≠vel carregar os t√≥picos. Tente novamente.",actionLabel:"Tentar novamente",iconColor:"text-red-500"}};function Rt({type:a,onAction:t,onClearFilters:r}){const c=Lt[a],m=c.icon,u=()=>{a==="no-results"&&r?r():t?.()};return e.jsxs(d.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"flex flex-col items-center justify-center py-16 px-6 text-center",children:[e.jsx(d.div,{initial:{scale:.8},animate:{scale:1},transition:{delay:.1,type:"spring",stiffness:200},className:`w-16 h-16 rounded-full bg-muted flex items-center justify-center mb-4 ${c.iconColor}`,children:e.jsx(m,{className:"w-8 h-8"})}),e.jsx("h3",{className:"text-lg font-semibold text-foreground mb-2",children:c.title}),e.jsx("p",{className:"text-sm text-muted-foreground mb-6 max-w-[260px]",children:c.description}),t&&e.jsxs(V,{onClick:u,variant:a==="empty"?"default":"outline",className:"min-h-[44px] px-6 rounded-full",children:[a==="error"||a==="offline"?e.jsx(he,{className:"w-4 h-4 mr-2"}):null,c.actionLabel]})]})}const Ft=[{value:"reclamacao",label:"Reclama√ß√£o",icon:e.jsx(De,{className:"w-4 h-4"}),color:"bg-red-100 text-red-700 border-red-200"},{value:"sugestao",label:"Sugest√£o",icon:e.jsx(pt,{className:"w-4 h-4"}),color:"bg-blue-100 text-blue-700 border-blue-200"},{value:"duvida",label:"D√∫vida",icon:e.jsx(ht,{className:"w-4 h-4"}),color:"bg-purple-100 text-purple-700 border-purple-200"},{value:"alerta",label:"Alerta",icon:e.jsx(ft,{className:"w-4 h-4"}),color:"bg-orange-100 text-orange-700 border-orange-200"},{value:"elogio",label:"Elogio",icon:e.jsx(gt,{className:"w-4 h-4"}),color:"bg-green-100 text-green-700 border-green-200"},{value:"outros",label:"Outros",icon:e.jsx(jt,{className:"w-4 h-4"}),color:"bg-gray-100 text-gray-700 border-gray-200"}];function $t({open:a,onOpenChange:t,onSubmit:r,defaultBairroId:c}){const[m,u]=o.useState(null),[x,p]=o.useState(""),[j,l]=o.useState(""),[v,I]=o.useState(c||""),[k,L]=o.useState(!1),[w,g]=o.useState(null),[h,R]=o.useState(null),[E,S]=o.useState(!1),[O,B]=o.useState("idle"),[N,C]=o.useState({}),y=o.useRef(null),{uploadAsync:M}=ct(),P=()=>{const n={};return m||(n.categoria="Escolha um tipo: Reclama√ß√£o, Sugest√£o‚Ä¶"),x.trim()?x.length<5&&(n.titulo="O t√≠tulo precisa ter pelo menos 5 caracteres"):n.titulo="D√™ um t√≠tulo curto pro pessoal entender r√°pido",j.trim()||(n.texto="Conte mais detalhes sobre o assunto"),v||(n.bairroId="Selecione o bairro"),C(n),Object.keys(n).length===0},_=async()=>{if(!(!P()||!m)){S(!0),B("idle");try{let n;if(h)try{n=(await M(h)).url}catch(f){const A=f instanceof Error?f.message:"Erro no upload";Ee.error(`Falha no upload da imagem: ${A}`),S(!1);return}await r({titulo:x.trim(),texto:j.trim(),categoria:m,bairroId:v,isAnon:k,fotoUrl:n}),navigator.vibrate&&navigator.vibrate([30,50,30]),B("success"),setTimeout(()=>{Q(),t(!1)},800)}catch{B("error")}finally{S(!1)}}},Q=()=>{u(null),p(""),l(""),I(c||""),L(!1),g(null),R(null),C({}),B("idle")},W=n=>{const f=n.target.files?.[0];if(f){R(f);const A=new FileReader;A.onload=()=>{g(A.result)},A.readAsDataURL(f)}},z=()=>{g(null),R(null),y.current&&(y.current.value="")};return e.jsx(at,{open:a,onOpenChange:t,children:e.jsxs(st,{side:"bottom",className:"rounded-t-3xl h-[85vh] flex flex-col p-0 overflow-hidden",children:[e.jsx(rt,{className:"px-4 py-4 border-b flex-shrink-0",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(ot,{className:"text-lg font-semibold",children:"Novo t√≥pico"}),e.jsx("button",{onClick:()=>t(!1),className:"p-2 -mr-2 rounded-full hover:bg-muted transition-colors min-h-[44px] min-w-[44px] flex items-center justify-center","aria-label":"Fechar",children:e.jsx(U,{className:"w-5 h-5"})})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto px-4 py-4 space-y-5",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-foreground mb-2 block",children:"O que voc√™ quer compartilhar?"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:Ft.map(n=>e.jsxs(d.button,{whileTap:{scale:.95},onClick:()=>{u(n.value),C(f=>({...f,categoria:""}))},className:`flex items-center gap-1.5 px-4 py-2.5 rounded-full text-sm font-medium border transition-all min-h-[44px] ${m===n.value?`${n.color} border-current shadow-sm`:"bg-background border-border text-muted-foreground hover:border-foreground/30"}`,children:[n.icon,e.jsx("span",{children:n.label})]},n.value))}),N.categoria&&e.jsxs("p",{className:"text-xs text-red-500 mt-2 flex items-center gap-1",children:[e.jsx(F,{className:"w-3 h-3"}),N.categoria]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-foreground mb-2 block",children:"T√≠tulo"}),e.jsx(fe,{value:x,onChange:n=>{p(n.target.value),C(f=>({...f,titulo:""}))},placeholder:"Ex: Buraco na Rua X perto do mercado",className:`h-12 rounded-xl text-base ${N.titulo?"border-red-500":""}`,maxLength:100}),N.titulo&&e.jsxs("p",{className:"text-xs text-red-500 mt-1.5 flex items-center gap-1",children:[e.jsx(F,{className:"w-3 h-3"}),N.titulo]}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1 text-right",children:[x.length,"/100"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-foreground mb-2 block",children:"Conte mais detalhes"}),e.jsx(lt,{value:j,onChange:n=>{l(n.target.value),C(f=>({...f,texto:""}))},placeholder:"Diga onde √© e o que est√° acontecendo‚Ä¶",className:`min-h-[120px] rounded-xl resize-none text-base ${N.texto?"border-red-500":""}`,maxLength:500}),N.texto&&e.jsxs("p",{className:"text-xs text-red-500 mt-1.5 flex items-center gap-1",children:[e.jsx(F,{className:"w-3 h-3"}),N.texto]}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1 text-right",children:[j.length,"/500"]})]}),e.jsx(J,{children:w&&e.jsxs(d.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"relative",children:[e.jsx("img",{src:w,alt:"Preview",className:"w-full h-40 object-cover rounded-xl"}),e.jsx("button",{onClick:z,className:"absolute top-2 right-2 p-2 bg-black/50 rounded-full text-white hover:bg-black/70 transition-colors","aria-label":"Remover imagem",children:e.jsx(U,{className:"w-4 h-4"})})]})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(d.button,{whileTap:{scale:.95},onClick:()=>{y.current&&(y.current.accept="image/*",y.current.capture="environment",y.current.click())},className:"flex items-center gap-2 px-4 py-2.5 rounded-xl bg-muted text-muted-foreground hover:bg-muted-foreground/10 transition-colors min-h-[44px]",children:[e.jsx(dt,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm font-medium",children:"C√¢mera"})]}),e.jsxs(d.button,{whileTap:{scale:.95},onClick:()=>{y.current&&(y.current.accept="image/*",y.current.removeAttribute("capture"),y.current.click())},className:"flex items-center gap-2 px-4 py-2.5 rounded-xl bg-muted text-muted-foreground hover:bg-muted-foreground/10 transition-colors min-h-[44px]",children:[e.jsx(Y,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm font-medium",children:"Galeria"})]}),e.jsx("input",{ref:y,type:"file",accept:"image/*",onChange:W,className:"hidden"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-sm font-medium text-foreground mb-2 block",children:[e.jsx(D,{className:"w-4 h-4 inline mr-1"}),"Bairro"]}),e.jsxs(Z,{value:v,onValueChange:n=>{I(n),C(f=>({...f,bairroId:""}))},children:[e.jsx(q,{className:`h-12 rounded-xl ${N.bairroId?"border-red-500":""}`,children:e.jsx(ee,{placeholder:"Selecione o bairro"})}),e.jsx(H,{children:ae.map(n=>e.jsx($,{value:n.id,children:n.nome},n.id))})]}),N.bairroId&&e.jsxs("p",{className:"text-xs text-red-500 mt-1.5 flex items-center gap-1",children:[e.jsx(F,{className:"w-3 h-3"}),N.bairroId]})]}),e.jsxs("div",{className:"flex items-center justify-between py-3 px-4 bg-muted/50 rounded-xl",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[k?e.jsx(mt,{className:"w-5 h-5 text-muted-foreground"}):e.jsx(ut,{className:"w-5 h-5 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-foreground",children:"Postar anonimamente"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Seu nome n√£o aparecer√° no post"})]})]}),e.jsx(nt,{checked:k,onCheckedChange:L})]})]}),e.jsx("div",{className:"px-4 py-4 border-t bg-background safe-bottom flex-shrink-0",children:e.jsx(V,{onClick:_,disabled:E,className:"w-full h-14 rounded-2xl text-base font-semibold",children:e.jsx(J,{mode:"wait",children:E?e.jsxs(d.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"flex items-center gap-2",children:[e.jsx(xt,{className:"w-5 h-5 animate-spin"}),e.jsx("span",{children:"Publicando..."})]},"loading"):O==="success"?e.jsxs(d.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},className:"flex items-center gap-2 text-green-500",children:[e.jsx(be,{className:"w-5 h-5"}),e.jsx("span",{children:"Publicado!"})]},"success"):O==="error"?e.jsxs(d.div,{initial:{opacity:0},animate:{opacity:1},className:"flex items-center gap-2",children:[e.jsx(F,{className:"w-5 h-5"}),e.jsx("span",{children:"Tentar novamente"})]},"error"):e.jsxs(d.div,{initial:{opacity:0},animate:{opacity:1},className:"flex items-center gap-2",children:[e.jsx(it,{className:"w-5 h-5"}),e.jsx("span",{children:"Publicar"})]},"idle")})})})]})})}function ja({scrollRef:a}){const{selectedBairro:t}=Oe(),{isAuthenticated:r}=Ve(),{isOnline:c}=Me(),{toast:m}=Pe(),[u,x]=_e(),{data:p=[],isLoading:j,refetch:l}=He(),v=Qe(),I=We(),[k,L]=o.useState("curtidos"),[w,g]=o.useState(""),[h,R]=o.useState({}),[E,S]=o.useState(!1),[O,B]=o.useState(!1),[N,C]=o.useState(!1);o.useEffect(()=>{u.get("novo")==="true"&&(S(!0),u.delete("novo"),x(u,{replace:!0}))},[u,x]);const[y,M]=o.useState(10),[P,_]=o.useState(!1),Q=o.useRef(null),W=o.useRef(null);o.useEffect(()=>{const s=Q.current;if(!s)return;const i=new IntersectionObserver(b=>{b[0].isIntersecting&&!P&&(_(!0),setTimeout(()=>{M(X=>X+10),_(!1)},300))},{rootMargin:"200px"});return i.observe(s),()=>i.disconnect()},[P]),o.useEffect(()=>{M(10)},[w,h,k]);const z=o.useMemo(()=>{let s=[...p];if(w.trim()){const i=w.toLowerCase();s=s.filter(b=>b.titulo.toLowerCase().includes(i)||b.texto.toLowerCase().includes(i))}if(h.categoria&&(s=s.filter(i=>i.categoria===h.categoria)),h.bairroId&&(s=s.filter(i=>i.bairroId===h.bairroId)),h.meuBairro&&t&&(s=s.filter(i=>i.bairroId===t.id)),h.comFoto&&(s=s.filter(i=>i.fotoUrl)),h.periodo){const i=new Date;switch(h.periodo){case"hoje":i.setHours(0,0,0,0);break;case"7dias":i.setDate(i.getDate()-7);break;case"30dias":i.setDate(i.getDate()-30);break}h.periodo!=="todos"&&(s=s.filter(b=>new Date(b.createdAt)>=i))}switch(k){case"curtidos":s.sort((i,b)=>{const X=re(i.likesCount,i.commentsCount,i.createdAt);return re(b.likesCount,b.commentsCount,b.createdAt)-X});break;case"recentes":s.sort((i,b)=>new Date(b.createdAt).getTime()-new Date(i.createdAt).getTime());break;case"perto":s=s.filter(i=>i.bairroId===t?.id).sort((i,b)=>new Date(b.createdAt).getTime()-new Date(i.createdAt).getTime());break}return s},[p,w,h,k,t]),n=o.useCallback(s=>r?!0:(m({title:"Login necess√°rio",description:`Para ${s}, voc√™ precisa estar logado.`,action:e.jsx(V,{variant:"outline",size:"sm",onClick:()=>window.location.href="/login",children:"Entrar"})}),!1),[r,m]),f=o.useCallback(s=>{if(!n("curtir"))return;const i=p.find(b=>b.id===s);i&&v.mutate({id:s,currentlyLiked:i.liked??!1})},[p,v,n]),A=o.useCallback(async s=>{const i={title:s.titulo,text:s.texto,url:`${window.location.origin}/topico/${s.id}`};if(navigator.share)try{await navigator.share(i)}catch{}else await navigator.clipboard.writeText(i.url),m({title:"Link copiado!",description:"O link foi copiado para a √°rea de transfer√™ncia."})},[m]),Ne=o.useCallback(s=>{window.location.href=`/topico/${s}`},[]),ye=o.useCallback(s=>{n("comentar")&&(window.location.href=`/topico/${s}?comment=true`)},[n]),we=o.useCallback(async s=>{try{await I.mutateAsync({categoria:s.categoria,titulo:s.titulo,texto:s.texto,isAnon:s.isAnon,bairroId:s.bairroId,fotoUrl:s.fotoUrl}),m({title:"T√≥pico publicado! üéâ",description:c?"Seu t√≥pico foi publicado na comunidade.":"Seu t√≥pico ser√° publicado quando voltar online."})}catch{m({title:"Erro ao publicar",description:"Tente novamente.",variant:"destructive"})}},[I,m,c]);o.useCallback(async()=>{C(!0),await l(),C(!1),m({title:"Atualizado!",description:"O feed foi atualizado."})},[l,m]);const se=o.useCallback(()=>{R({}),g("")},[]),ke=()=>!c&&p.length===0?"offline":w||Object.keys(h).length>0?"no-results":"empty",Ce=w||Object.keys(h).length>0;return e.jsxs("div",{ref:s=>{a?.(s),W.current=s},className:"h-full overflow-y-auto bg-background",children:[e.jsx(vt,{onSearch:g,onSearchFocus:()=>{}}),e.jsx(Nt,{value:k,onChange:L}),e.jsx(Ct,{filters:h,onChange:R,userBairroId:t?.id}),!c&&e.jsxs(d.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"mx-4 mb-3 px-4 py-2 bg-orange-100 dark:bg-orange-900/30 rounded-xl flex items-center gap-2 text-sm text-orange-700 dark:text-orange-400",children:[e.jsx("span",{children:"üì°"}),e.jsx("span",{children:"Voc√™ est√° offline. Mostrando t√≥picos salvos."})]}),N&&e.jsx(d.div,{initial:{opacity:0},animate:{opacity:1},className:"flex justify-center py-2",children:e.jsx(he,{className:"w-5 h-5 animate-spin text-primary"})}),e.jsx("div",{className:"flex-1 px-4 pb-32",children:O||j?e.jsx(At,{count:3}):z.length>0?e.jsx(ze,{items:z,estimatedItemSize:180,overscan:3,gap:12,className:"h-full",getItemKey:s=>s.id,renderItem:s=>e.jsx(Tt,{topic:s,onPress:()=>Ne(s.id),onLike:()=>f(s.id),onComment:()=>ye(s.id),onShare:()=>A(s)})}):e.jsx(Rt,{type:ke(),onAction:Ce?se:()=>S(!0),onClearFilters:se})}),e.jsx(d.div,{initial:{scale:0,opacity:0},animate:{scale:1,opacity:1},transition:{type:"spring",stiffness:400,damping:15,delay:.3},className:"fixed bottom-24 right-4 z-30",children:e.jsx(d.div,{whileHover:{scale:1.05},whileTap:{scale:.95},children:e.jsx(V,{onClick:()=>{n("criar um t√≥pico")&&S(!0)},size:"lg",className:"w-14 h-14 rounded-full shadow-lg bg-primary text-primary-foreground hover:bg-primary/90","aria-label":"Criar novo t√≥pico",children:e.jsx(Ue,{className:"w-6 h-6"})})})}),e.jsx($t,{open:E,onOpenChange:S,onSubmit:we,defaultBairroId:t?.id})]})}export{ja as default};
