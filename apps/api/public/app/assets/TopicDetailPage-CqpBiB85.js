import{r as c,j as e,a as me}from"./vendor-radix-DVNDhy8K.js";import{b as V,f as te,h as ue,W as xe,X as O,i as pe,e as he,j as fe,u as H,E as ge,L as je}from"./index-BGIoWgN1.js";import{B as Q}from"./button-BBqitwfd.js";import{B as be}from"./badge-DkAZrx5m.js";import{S as b}from"./skeleton-Bd_tMIq_.js";import{u as se,b as _,c as W}from"./vendor-query-BBHVyEFd.js";import{Q as w}from"./client-BTgelhMB.js";import{f as ae,t as q,a as ye}from"./formatTimeAgo-CcIDXi3O.js";import{u as ve}from"./useAuthStore-CjL_pX82.js";import{b as Ne}from"./bairros-Cf5Z_oCw.js";import{M as Y}from"./message-circle-Dwu60VPW.js";import{A,m}from"./vendor-motion-BUrkef5A.js";import{H as re}from"./heart-BymIATZa.js";import{D as we,a as ke,b as Ce,c as $,d as Se,C as Ae}from"./dropdown-menu-BVucV6NQ.js";import{C as Te}from"./chevron-down-CrGqOEG1.js";import{I as ie}from"./image-B6LTRNxD.js";import{L as Z}from"./loader-circle-kXvkAKhT.js";import{T as Le,S as ne}from"./textarea-TEz6nVWD.js";import{u as Re}from"./useUploadImage-B1Zruo75.js";import{E as oe,a as De}from"./eye-DSsH5HvT.js";import{Z as Pe}from"./zoom-in-DJdsicqT.js";import{C as Ie}from"./chevron-left-l3jqQcaW.js";import{C as Fe}from"./chevron-right-vD06ucnu.js";import{B as Ee}from"./bookmark-DCO1R1Jh.js";import{A as Ue}from"./arrow-left-CI-y_GUw.js";import{S as Me}from"./share-2-oW597d4Q.js";import{M as $e}from"./map-pin-CM7hdqqe.js";import{L as le}from"./log-in-B_KOo25F.js";import"./vendor-utils-Lf-MeoKe.js";import"./localDatabase-Di2bCpeG.js";import"./check-tA5Hx5Yt.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qe=V("Ban",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m4.9 4.9 14.2 14.2",key:"1m5liu"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ze=V("Flag",[["path",{d:"M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z",key:"i9b6wo"}],["line",{x1:"4",x2:"4",y1:"22",y2:"15",key:"1cm3nv"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Be=V("Link2",[["path",{d:"M9 17H7A5 5 0 0 1 7 7h2",key:"8i5ue5"}],["path",{d:"M15 7h2a5 5 0 1 1 0 10h-2",key:"1b9ql8"}],["line",{x1:"8",x2:"16",y1:"12",y2:"12",key:"1jonct"}]]);function Ke({topicId:t,isAnonymous:i,children:r,onSave:a,onHide:n,onReport:s,onBlock:u}){const{toast:d}=te(),[T,p]=c.useState(!1),o=async()=>{const R=`${window.location.origin}/topico/${t}`;await navigator.clipboard.writeText(R),d({title:"Link copiado!",description:"O link foi copiado para a √°rea de transfer√™ncia."}),p(!1)},x=()=>{a?.(),d({title:"T√≥pico salvo",description:"Voc√™ pode encontr√°-lo nos salvos."}),p(!1)},y=()=>{n?.(),d({title:"T√≥pico oculto",description:"Voc√™ n√£o ver√° mais este t√≥pico."}),p(!1)},v=()=>{s?.(),d({title:"Den√∫ncia enviada",description:"Obrigado por ajudar a manter a comunidade segura."}),p(!1)},k=()=>{u?.(),d({title:"Usu√°rio bloqueado",description:"Voc√™ n√£o ver√° mais publica√ß√µes desta pessoa."}),p(!1)};return e.jsxs(we,{open:T,onOpenChange:p,children:[e.jsx(ke,{asChild:!0,children:r}),e.jsxs(Ce,{align:"end",className:"w-56 rounded-xl",children:[e.jsxs($,{onClick:x,className:"flex items-center gap-3 py-3 cursor-pointer",children:[e.jsx(Ee,{className:"w-4 h-4"}),e.jsx("span",{children:"Salvar"})]}),e.jsxs($,{onClick:o,className:"flex items-center gap-3 py-3 cursor-pointer",children:[e.jsx(Be,{className:"w-4 h-4"}),e.jsx("span",{children:"Copiar link"})]}),e.jsx(Se,{}),e.jsxs($,{onClick:y,className:"flex items-center gap-3 py-3 cursor-pointer",children:[e.jsx(oe,{className:"w-4 h-4"}),e.jsx("span",{children:"Ocultar este assunto"})]}),e.jsxs($,{onClick:v,className:"flex items-center gap-3 py-3 cursor-pointer text-orange-600",children:[e.jsx(ze,{className:"w-4 h-4"}),e.jsx("span",{children:"Denunciar"})]}),!i&&e.jsxs($,{onClick:k,className:"flex items-center gap-3 py-3 cursor-pointer text-red-600",children:[e.jsx(qe,{className:"w-4 h-4"}),e.jsx("span",{children:"Bloquear usu√°rio"})]})]})]})}function Oe({onSubmit:t,autoFocus:i=!1,placeholder:r="Escreva um coment√°rio‚Ä¶",replyTo:a,isSubmitting:n=!1}){const[s,u]=c.useState(""),[d,T]=c.useState(!1),[p,o]=c.useState(!1),[x,y]=c.useState(!1),[v,k]=c.useState(null),[R,C]=c.useState(null),{isOnline:D}=ue(),g=c.useRef(null),L=c.useRef(null),{uploadAsync:P,isUploading:U}=Re(),N=p||n||U;c.useEffect(()=>{i&&g.current&&g.current.focus()},[i]);const I=async()=>{if(!(!s.trim()||N)){o(!0);try{let f;if(R)try{f=(await P(R)).url}catch(j){const l=j instanceof Error?j.message:"Erro no upload";pe.error(`Falha no upload: ${l}`),o(!1);return}await t(s.trim(),d,f),u(""),k(null),C(null),navigator.vibrate&&navigator.vibrate(10)}finally{o(!1)}}},F=f=>{f.key==="Enter"&&!f.shiftKey&&(f.preventDefault(),I())},M=f=>{const j=f.target.files?.[0];if(j){C(j);const l=new FileReader;l.onload=()=>{k(l.result)},l.readAsDataURL(j)}},E=()=>{k(null),C(null),L.current&&(L.current.value="")};return e.jsxs("div",{className:"fixed bottom-0 left-0 right-0 bg-background border-t border-border safe-bottom z-40",children:[e.jsx(A,{children:!D&&e.jsxs(m.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"px-4 py-2 bg-orange-100 dark:bg-orange-900/30 text-orange-700 dark:text-orange-400 text-xs flex items-center gap-2",children:[e.jsx(xe,{className:"w-3 h-3"}),e.jsx("span",{children:"Sem conex√£o. Coment√°rio ser√° enviado quando voltar."})]})}),e.jsx(A,{children:a&&e.jsxs(m.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"px-4 py-2 bg-muted text-sm text-muted-foreground border-l-4 border-primary",children:["Respondendo a ",e.jsx("strong",{children:a})]})}),e.jsx(A,{children:v&&e.jsx(m.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"px-4 pt-2",children:e.jsxs("div",{className:"relative inline-block",children:[e.jsx("img",{src:v,alt:"Preview",className:"h-20 rounded-lg object-cover"}),e.jsx("button",{onClick:E,className:"absolute -top-1 -right-1 p-1 bg-destructive text-destructive-foreground rounded-full shadow-sm","aria-label":"Remover imagem",children:e.jsx(O,{className:"w-3 h-3"})})]})})}),e.jsxs("div",{className:"px-4 py-3",children:[e.jsxs("div",{className:"flex items-end gap-2",children:[e.jsx(m.button,{whileTap:{scale:.9},onClick:()=>T(!d),className:`flex-shrink-0 w-10 h-10 rounded-full flex items-center justify-center transition-colors ${d?"bg-primary text-primary-foreground":"bg-muted text-muted-foreground"}`,"aria-label":d?"Postar com nome":"Postar an√¥nimo","aria-pressed":d,children:d?e.jsx(oe,{className:"w-4 h-4"}):e.jsx(De,{className:"w-4 h-4"})}),e.jsx(m.button,{whileTap:{scale:.9},onClick:()=>L.current?.click(),className:"flex-shrink-0 w-10 h-10 rounded-full flex items-center justify-center bg-muted text-muted-foreground transition-colors hover:bg-muted-foreground/10","aria-label":"Anexar imagem",children:e.jsx(ie,{className:"w-4 h-4"})}),e.jsx("input",{ref:L,type:"file",accept:"image/*",onChange:M,className:"hidden"}),e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(Le,{ref:g,value:s,onChange:f=>u(f.target.value),onFocus:()=>y(!0),onBlur:()=>y(!1),onKeyDown:F,placeholder:r,className:`min-h-[44px] max-h-[120px] py-3 pr-12 rounded-2xl resize-none text-base transition-all ${x?"ring-2 ring-primary":""}`,rows:1,maxLength:500}),s.length>400&&e.jsxs("span",{className:"absolute right-12 bottom-2 text-xs text-muted-foreground",children:[s.length,"/500"]})]}),e.jsx(m.div,{whileTap:{scale:.9},children:e.jsx(Q,{onClick:I,disabled:!s.trim()||N,size:"icon",className:"w-10 h-10 rounded-full flex-shrink-0","aria-label":"Enviar coment√°rio",children:N?e.jsx(Z,{className:"w-4 h-4 animate-spin"}):e.jsx(ne,{className:"w-4 h-4"})})})]}),e.jsx(A,{children:d&&e.jsx(m.p,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"text-xs text-muted-foreground mt-2 pl-12",children:"Seu nome n√£o aparecer√° no coment√°rio"})})]})]})}function Qe(t,i){return t.filter(a=>!a.parentId).sort((a,n)=>{if(i==="recentes")return new Date(n.createdAt).getTime()-new Date(a.createdAt).getTime();const s=(n.likesCount??0)-(a.likesCount??0);return s!==0?s:new Date(n.createdAt).getTime()-new Date(a.createdAt).getTime()})}function Ve({comments:t,onLike:i,onReply:r}){const[a,n]=c.useState("relevantes"),s=c.useMemo(()=>{console.log("[CommentList] Processing comments:",t.length,"total");const u=Qe(t,a);return console.log("[CommentList] Root comments:",u.length,"with replies:",u.map(d=>d.replies?.length??0)),u},[t,a]);return t.length===0?e.jsxs("div",{className:"py-12 text-center",children:[e.jsx(Y,{className:"w-10 h-10 mx-auto text-muted-foreground/50 mb-3"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Nenhum coment√°rio ainda."}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Seja o primeiro a comentar!"})]}):e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-2 border-b border-border/50",children:[e.jsxs("span",{className:"text-sm font-medium text-foreground",children:[t.length," ",t.length===1?"coment√°rio":"coment√°rios"]}),e.jsx("div",{className:"flex gap-1",children:["relevantes","recentes"].map(u=>e.jsx("button",{onClick:()=>n(u),className:`px-3 py-1.5 text-xs font-medium rounded-full transition-colors ${a===u?"bg-primary/10 text-primary":"text-muted-foreground hover:bg-muted"}`,children:u==="relevantes"?"Relevantes":"Recentes"},u))})]}),e.jsx("div",{className:"divide-y divide-border/50",children:e.jsx(A,{children:s.map((u,d)=>e.jsx(ce,{comment:u,index:d,depth:0,onLike:i,onReply:r},u.id))})})]})}function ce({comment:t,index:i,depth:r,onLike:a,onReply:n}){const[s,u]=c.useState(t.liked??!1),[d,T]=c.useState(t.likesCount??0),[p,o]=c.useState(r<2),[x,y]=c.useState(!1),[v,k]=c.useState(""),[R,C]=c.useState(!1),[D,g]=c.useState(null),[L,P]=c.useState(!1),[U,N]=c.useState(!1),I=t.replies&&t.replies.length>0,F=3,M=()=>{u(!s),T(l=>s?Math.max(0,l-1):l+1),navigator.vibrate&&navigator.vibrate(10),a?.(t.id)},E=()=>t.isAnon?"An√¥nimo":t.autor?.nome?t.autor.nome:t.autorNome?t.autorNome:"Usu√°rio",f=()=>t.isAnon?"?":(t.autor?.nome||t.autorNome||"U")[0]?.toUpperCase()||"U",j=async()=>{if(!(!v.trim()||!n)){P(!0);try{await n(t.id,v.trim(),R,D||void 0),k(""),g(null),y(!1)}finally{P(!1)}}};return e.jsxs(m.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:i*.03},className:r>0?"border-l-2 border-muted":"",style:{marginLeft:r>0?`${Math.min(r,F)*16}px`:0},children:[e.jsx("div",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:`${r>0?"w-6 h-6 text-[10px]":"w-8 h-8 text-xs"} rounded-full bg-muted flex items-center justify-center font-medium text-muted-foreground flex-shrink-0`,children:t.autor?.avatarUrl?e.jsx("img",{src:t.autor.avatarUrl,alt:E(),className:"w-full h-full rounded-full object-cover"}):f()}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-baseline gap-2",children:[e.jsx("span",{className:`${r>0?"text-xs":"text-sm"} font-medium text-foreground`,children:E()}),e.jsx("span",{className:"text-xs text-muted-foreground",children:ae(t.createdAt)})]}),e.jsx("p",{className:`${r>0?"text-xs":"text-sm"} text-foreground mt-1 leading-relaxed whitespace-pre-wrap`,children:t.texto}),t.imageUrl&&e.jsxs(e.Fragment,{children:[e.jsx("img",{src:t.imageUrl,alt:"Imagem do coment√°rio",className:"mt-2 rounded-lg max-h-48 object-cover cursor-pointer hover:opacity-90 transition-opacity",onClick:()=>N(!0)}),e.jsx(A,{children:U&&e.jsxs(m.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-50 bg-black/90 flex items-center justify-center p-4",onClick:()=>N(!1),children:[e.jsx("button",{className:"absolute top-4 right-4 p-2 text-white/80 hover:text-white bg-black/50 rounded-full",onClick:()=>N(!1),children:e.jsx(O,{className:"w-6 h-6"})}),e.jsx(m.img,{initial:{scale:.9},animate:{scale:1},exit:{scale:.9},src:t.imageUrl,alt:"Imagem em tela cheia",className:"max-w-full max-h-full object-contain rounded-lg",onClick:l=>l.stopPropagation()})]})})]}),e.jsxs("div",{className:"flex items-center gap-4 mt-2",children:[e.jsxs(m.button,{whileTap:{scale:.9},onClick:M,className:"flex items-center gap-1 text-xs text-muted-foreground hover:text-foreground transition-colors min-h-[32px]",children:[e.jsx(re,{className:`w-4 h-4 transition-all ${s?"fill-red-500 text-red-500 scale-110":""}`}),e.jsx("span",{className:s?"text-red-500 font-medium":"",children:d>0?d:"Curtir"})]}),r<F&&e.jsxs("button",{onClick:()=>y(!x),className:"flex items-center gap-1 text-xs text-muted-foreground hover:text-foreground transition-colors min-h-[32px]",children:[e.jsx(Y,{className:"w-4 h-4"}),e.jsx("span",{children:"Responder"})]}),I&&e.jsx("button",{onClick:()=>o(!p),className:"flex items-center gap-1 text-xs text-primary font-medium min-h-[32px]",children:p?e.jsxs(e.Fragment,{children:[e.jsx(Ae,{className:"w-4 h-4"}),e.jsxs("span",{children:["Ocultar ",t.replies.length," ",t.replies.length===1?"resposta":"respostas"]})]}):e.jsxs(e.Fragment,{children:[e.jsx(Te,{className:"w-4 h-4"}),e.jsxs("span",{children:["Ver ",t.replies.length," ",t.replies.length===1?"resposta":"respostas"]})]})})]}),e.jsx(A,{children:x&&e.jsx(m.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"mt-3 overflow-hidden",children:e.jsxs("div",{className:"flex flex-col gap-2 p-3 bg-muted/50 rounded-xl",children:[D&&e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:D,alt:"Preview",className:"h-24 rounded-lg object-cover"}),e.jsx("button",{onClick:()=>g(null),className:"absolute top-1 right-1 p-1 bg-black/50 rounded-full text-white",children:e.jsx(O,{className:"w-3 h-3"})})]}),e.jsxs("div",{className:"flex items-end gap-2",children:[e.jsx("div",{className:"flex-1",children:e.jsx("input",{type:"text",value:v,onChange:l=>k(l.target.value),placeholder:`Responder ${t.isAnon?"An√¥nimo":t.autorNome}...`,className:"w-full px-3 py-2 text-sm rounded-lg bg-background border border-border focus:outline-none focus:ring-2 focus:ring-primary",onKeyDown:l=>{l.key==="Enter"&&!l.shiftKey&&(l.preventDefault(),j())}})}),e.jsxs("label",{className:"p-2 rounded-lg hover:bg-muted cursor-pointer",children:[e.jsx(ie,{className:"w-5 h-5 text-muted-foreground"}),e.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:l=>{const h=l.target.files?.[0];if(h){const S=new FileReader;S.onload=()=>g(S.result),S.readAsDataURL(h)}}})]}),e.jsx("button",{onClick:j,disabled:!v.trim()||L,className:"p-2 rounded-lg bg-primary text-primary-foreground disabled:opacity-50",children:L?e.jsx(Z,{className:"w-5 h-5 animate-spin"}):e.jsx(ne,{className:"w-5 h-5"})})]})]})})})]})]})}),e.jsx(A,{children:I&&p&&e.jsx(m.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},children:t.replies.map((l,h)=>e.jsx(ce,{comment:{...l,replies:l.replies||[]},index:h,depth:r+1,onLike:a,onReply:n},l.id))})})]})}function He({images:t,alt:i=""}){const[r,a]=c.useState(null),[n,s]=c.useState(0);if(t.length===0)return null;const u=o=>{a(o),s(o),document.body.style.overflow="hidden"},d=()=>{a(null),document.body.style.overflow=""},T=()=>{s(o=>(o+1)%t.length)},p=()=>{s(o=>(o-1+t.length)%t.length)};return e.jsxs(e.Fragment,{children:[t.length===1?e.jsxs(m.button,{whileTap:{scale:.98},onClick:()=>u(0),className:"relative w-full aspect-video rounded-xl overflow-hidden bg-muted group",children:[e.jsx("img",{src:t[0],alt:i,loading:"lazy",className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute inset-0 bg-black/0 group-hover:bg-black/10 transition-colors flex items-center justify-center",children:e.jsx(Pe,{className:"w-8 h-8 text-white opacity-0 group-hover:opacity-80 transition-opacity drop-shadow-lg"})})]}):e.jsx("div",{className:"flex gap-2 overflow-x-auto scrollbar-hide -mx-4 px-4",children:t.map((o,x)=>e.jsxs(m.button,{whileTap:{scale:.95},onClick:()=>u(x),className:"relative flex-shrink-0 w-32 h-32 rounded-xl overflow-hidden bg-muted group",children:[e.jsx("img",{src:o,alt:`${i} ${x+1}`,loading:"lazy",className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute inset-0 bg-black/0 group-hover:bg-black/10 transition-colors"})]},x))}),r!==null&&me.createPortal(e.jsx(A,{children:e.jsxs(m.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-50 bg-black flex flex-col",onClick:d,children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 safe-top",children:[e.jsxs("span",{className:"text-white/70 text-sm",children:[n+1," / ",t.length]}),e.jsx("button",{onClick:d,className:"p-2 rounded-full bg-white/10 hover:bg-white/20 transition-colors min-h-[44px] min-w-[44px] flex items-center justify-center","aria-label":"Fechar",children:e.jsx(O,{className:"w-6 h-6 text-white"})})]}),e.jsx("div",{className:"flex-1 flex items-center justify-center px-4",onClick:o=>o.stopPropagation(),children:e.jsx(m.img,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},src:t[n],alt:`${i} ${n+1}`,className:"max-w-full max-h-full object-contain rounded-lg",draggable:!1},n)}),t.length>1&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:o=>{o.stopPropagation(),p()},className:"absolute left-2 top-1/2 -translate-y-1/2 p-3 rounded-full bg-white/10 hover:bg-white/20 transition-colors min-h-[44px] min-w-[44px] flex items-center justify-center","aria-label":"Imagem anterior",children:e.jsx(Ie,{className:"w-6 h-6 text-white"})}),e.jsx("button",{onClick:o=>{o.stopPropagation(),T()},className:"absolute right-2 top-1/2 -translate-y-1/2 p-3 rounded-full bg-white/10 hover:bg-white/20 transition-colors min-h-[44px] min-w-[44px] flex items-center justify-center","aria-label":"Pr√≥xima imagem",children:e.jsx(Fe,{className:"w-6 h-6 text-white"})})]}),t.length>1&&e.jsx("div",{className:"flex justify-center gap-2 py-4 safe-bottom",children:t.map((o,x)=>e.jsx("button",{onClick:y=>{y.stopPropagation(),s(x)},className:`w-2 h-2 rounded-full transition-colors ${x===n?"bg-white":"bg-white/30"}`,"aria-label":`Ir para imagem ${x+1}`},x))})]})}),document.body)]})}function _e(t){return se({queryKey:w.topics.detail(t),queryFn:()=>q.getById(t),enabled:!!t,retry:(i,r)=>r?.status===404?!1:i<3})}function We(t){return se({queryKey:w.topics.comments(t),queryFn:()=>q.getComments(t),enabled:!!t})}function Ye(){const t=_();return W({mutationFn:async({id:i})=>q.toggleLike(i),onSuccess:(i,{id:r})=>{t.invalidateQueries({queryKey:w.topics.all}),t.invalidateQueries({queryKey:w.topics.detail(r)})}})}function Ze(t){const i=_();return W({mutationFn:r=>q.addComment(t,r),onSuccess:()=>{i.invalidateQueries({queryKey:w.topics.comments(t)}),i.invalidateQueries({queryKey:w.topics.detail(t)})}})}function Ge(t){const i=_();return W({onMutate:async({commentId:r,liked:a})=>{await i.cancelQueries({queryKey:w.topics.comments(t)});const n=i.getQueryData(w.topics.comments(t));return i.setQueryData(w.topics.comments(t),s=>s&&{...s,data:de(s.data,r,!a)}),{previousComments:n}},mutationFn:async({commentId:r})=>q.toggleCommentLike(r),onError:(r,a,n)=>{n?.previousComments&&i.setQueryData(w.topics.comments(t),n.previousComments)},onSettled:()=>{setTimeout(()=>{i.invalidateQueries({queryKey:w.topics.comments(t)})},500)}})}function de(t,i,r){return t.map(a=>a.id===i?{...a,liked:r,likesCount:r?(a.likesCount??0)+1:Math.max(0,(a.likesCount??0)-1)}:a.replies&&a.replies.length>0?{...a,replies:de(a.replies,i,r)}:a)}const ee={reclamacao:{label:"Reclama√ß√£o",color:"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400"},sugestao:{label:"Sugest√£o",color:"bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400"},duvida:{label:"D√∫vida",color:"bg-purple-100 text-purple-700 dark:bg-purple-900/30 dark:text-purple-400"},alerta:{label:"Alerta",color:"bg-orange-100 text-orange-700 dark:bg-orange-900/30 dark:text-orange-400"},elogio:{label:"Elogio",color:"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400"},outros:{label:"Outros",color:"bg-gray-100 text-gray-700 dark:bg-gray-800 dark:text-gray-400"}};function Xe(){return e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx("header",{className:"sticky top-0 z-20 bg-background/95 backdrop-blur-md border-b border-border safe-top",children:e.jsxs("div",{className:"flex items-center justify-between px-4 py-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(b,{className:"w-10 h-10 rounded-full"}),e.jsx(b,{className:"w-24 h-6"})]}),e.jsx(b,{className:"w-10 h-10 rounded-full"})]})}),e.jsxs("article",{className:"px-4 py-4 space-y-4",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(b,{className:"w-24 h-6 rounded-full"}),e.jsx(b,{className:"w-20 h-6 rounded-full"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(b,{className:"w-10 h-10 rounded-full"}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(b,{className:"w-32 h-4"}),e.jsx(b,{className:"w-16 h-3"})]})]}),e.jsx(b,{className:"w-full h-8"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{className:"w-full h-4"}),e.jsx(b,{className:"w-full h-4"}),e.jsx(b,{className:"w-3/4 h-4"})]})]})]})}function Je(){const t=H();return e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center p-4",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("div",{className:"w-20 h-20 mx-auto rounded-full bg-muted flex items-center justify-center",children:e.jsx("span",{className:"text-3xl",children:"üîç"})}),e.jsx("h2",{className:"text-xl font-semibold",children:"T√≥pico n√£o encontrado"}),e.jsx("p",{className:"text-muted-foreground max-w-sm",children:"Este t√≥pico pode ter sido removido ou o link est√° incorreto."}),e.jsx(Q,{onClick:()=>t(-1),variant:"outline",children:"Voltar"})]})})}function et({action:t}){const i=H(),r=window.location.pathname;return e.jsx(m.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"fixed bottom-0 left-0 right-0 bg-gradient-to-r from-primary to-primary/80 p-4 safe-bottom z-40",children:e.jsxs("div",{className:"flex items-center justify-between gap-3 max-w-lg mx-auto",children:[e.jsxs("div",{className:"flex items-center gap-3 text-primary-foreground",children:[e.jsx(le,{className:"w-5 h-5 flex-shrink-0"}),e.jsxs("p",{className:"text-sm font-medium",children:["Fa√ßa login para ",t]})]}),e.jsx(Q,{onClick:()=>i(`/login?redirect=${encodeURIComponent(r)}`),variant:"secondary",size:"sm",className:"flex-shrink-0",children:"Entrar"})]})})}function Pt(){const{id:t}=he(),[i]=fe(),r=H(),{toast:a}=te(),{isAuthenticated:n}=ve(),{data:s,isLoading:u,isError:d}=_e(t||""),{data:T}=We(t||""),p=T?.data||[],o=Ye(),x=Ze(t||""),y=Ge(t||""),[v,k]=c.useState(),[R,C]=c.useState(!1),[D,g]=c.useState("interagir"),L=i.get("comment")==="true";if(u)return e.jsx(Xe,{});if(d||!s)return e.jsx(Je,{});const P=ee[s.categoria]||ee.outros,U=s.bairro?.nome||Ne.find(h=>h.id===s.bairroId)?.nome||"Tijucas",N=s.autor?.nome||(s.isAnon?"An√¥nimo":"Usu√°rio"),I=async()=>{const h={title:s.titulo,text:s.texto,url:window.location.href};if(navigator.share)try{await navigator.share(h)}catch{}else await navigator.clipboard.writeText(h.url),a({title:"Link copiado!",description:"O link foi copiado para a √°rea de transfer√™ncia."})},F=()=>{if(!n){g("curtir"),C(!0);return}navigator.vibrate&&navigator.vibrate(10),o.mutate({id:s.id,liked:s.liked||!1})},M=async(h,S,z)=>{if(!n){g("comentar"),C(!0);return}try{await x.mutateAsync({texto:h,isAnon:S,imageUrl:z}),a({title:"Coment√°rio enviado!",description:"Seu coment√°rio foi publicado."}),k(void 0)}catch{a({title:"Erro ao enviar coment√°rio",description:"Tente novamente.",variant:"destructive"})}},E=async(h,S,z,B)=>{if(!n){g("responder"),C(!0);return}try{await x.mutateAsync({texto:S,parentId:h,isAnon:z,imageUrl:B}),a({title:"Resposta enviada!"})}catch{a({title:"Erro ao enviar resposta",description:"Tente novamente.",variant:"destructive"})}},f=h=>{if(!n){g("curtir"),C(!0);return}const S=(G,X)=>{for(const K of G){if(K.id===X)return K;if(K.replies){const J=S(K.replies,X);if(J)return J}}},B=S(p,h)?.liked??!1;navigator.vibrate&&navigator.vibrate(10),y.mutate({commentId:h,liked:B})},j=()=>{n||(g("comentar"),C(!0))},l=s.fotoUrl?[s.fotoUrl]:[];return e.jsxs("div",{className:"min-h-screen bg-background pb-32",children:[e.jsx("header",{className:"sticky top-0 z-20 bg-background/95 backdrop-blur-md border-b border-border safe-top",children:e.jsxs("div",{className:"flex items-center justify-between px-4 py-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(m.button,{whileTap:{scale:.9},onClick:()=>r(-1),className:"p-2 -ml-2 rounded-full hover:bg-muted transition-colors min-h-[44px] min-w-[44px] flex items-center justify-center","aria-label":"Voltar",children:e.jsx(Ue,{className:"w-5 h-5"})}),e.jsx("h1",{className:"text-lg font-semibold",children:"T√≥pico"})]}),e.jsx(m.button,{whileTap:{scale:.9},onClick:I,className:"p-2 rounded-full hover:bg-muted transition-colors min-h-[44px] min-w-[44px] flex items-center justify-center","aria-label":"Compartilhar",children:e.jsx(Me,{className:"w-5 h-5"})})]})}),e.jsxs("article",{className:"px-4 py-4",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2 mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx(be,{className:`${P.color} border-0`,children:P.label}),e.jsxs("span",{className:"text-sm text-muted-foreground flex items-center gap-1",children:[e.jsx($e,{className:"w-3 h-3"}),U]})]}),e.jsx("time",{dateTime:new Date(s.createdAt).toISOString(),title:ye(s.createdAt),className:"text-sm text-muted-foreground",children:ae(s.createdAt)})]}),e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-muted flex items-center justify-center text-sm font-medium text-muted-foreground overflow-hidden",children:s.autor?.avatarUrl?e.jsx("img",{src:s.autor.avatarUrl,alt:N,className:"w-full h-full object-cover"}):s.isAnon?"?":N[0]?.toUpperCase()}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-foreground",children:N}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Autor"})]})]}),e.jsx("h2",{className:"text-xl font-bold text-foreground leading-tight mb-3",children:s.titulo}),e.jsx("p",{className:"text-base text-foreground leading-relaxed whitespace-pre-wrap mb-4",children:s.texto}),l.length>0&&e.jsx("div",{className:"mb-4",children:e.jsx(He,{images:l,alt:s.titulo})}),e.jsxs("div",{className:"flex items-center justify-between pt-4 border-t border-border/50",children:[e.jsxs(m.button,{whileTap:{scale:.9},onClick:F,disabled:o.isPending,className:"flex items-center gap-2 py-2 px-4 rounded-full hover:bg-muted/50 transition-colors min-h-[44px] disabled:opacity-50",children:[e.jsx(m.div,{animate:s.liked?{scale:[1,1.3,1]}:{},transition:{duration:.3},children:o.isPending?e.jsx(Z,{className:"w-6 h-6 animate-spin text-muted-foreground"}):e.jsx(re,{className:`w-6 h-6 ${s.liked?"fill-red-500 text-red-500":"text-muted-foreground"}`})}),e.jsxs("span",{className:`font-medium ${s.liked?"text-red-500":"text-muted-foreground"}`,children:[s.likesCount," Curtidas"]})]}),e.jsxs("div",{className:"flex items-center gap-1 text-muted-foreground",children:[e.jsx(Y,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm font-medium",children:s.commentsCount})]}),e.jsx(Ke,{topicId:s.id,isAnonymous:s.isAnon,children:e.jsx(m.button,{whileTap:{scale:.9},className:"p-2 rounded-full hover:bg-muted/50 transition-colors min-h-[44px] min-w-[44px] flex items-center justify-center",children:e.jsx(ge,{className:"w-5 h-5 text-muted-foreground"})})})]})]}),e.jsx("section",{className:"border-t border-border pb-24",children:e.jsx(Ve,{comments:p,onLike:f,onReply:E})}),e.jsx(A,{mode:"wait",children:R?e.jsx(et,{action:D}):n?e.jsx(Oe,{onSubmit:M,autoFocus:L,replyTo:v,isSubmitting:x.isPending}):e.jsx(m.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"fixed bottom-0 left-0 right-0 bg-background border-t border-border p-4 safe-bottom z-40",children:e.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-xl bg-muted cursor-pointer hover:bg-muted/80 transition-colors",onClick:j,children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-primary/10 flex items-center justify-center",children:e.jsx(le,{className:"w-4 h-4 text-primary"})}),e.jsx("p",{className:"text-muted-foreground text-sm flex-1",children:"Fa√ßa login para comentar..."}),e.jsx(Q,{size:"sm",asChild:!0,children:e.jsx(je,{to:`/login?redirect=${encodeURIComponent(window.location.pathname)}`,children:"Entrar"})})]})})})]})}export{Pt as default};
