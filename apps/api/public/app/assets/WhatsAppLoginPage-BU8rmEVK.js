import{r as s,j as e}from"./vendor-radix-DVNDhy8K.js";import{f as z,u as U,g as X,a as H,v as K,c as G,e as I,b as J,R as Q,d as D,C as Y}from"./index-BZiUcmb2.js";import{B as Z}from"./button-_vNdHQ1a.js";import{C as ee}from"./card-DdCF2qWG.js";import{P as te}from"./PhoneInput-DbtlRgrK.js";import"./input-C7vfXRs1.js";import"./label-07rcZxYt.js";import"./slider-BOaBfc9i.js";import{m as i,A as ae}from"./vendor-motion-BUrkef5A.js";import{M as T}from"./message-circle-VxxLNZJ8.js";import{U as se}from"./users-DMqX24Zx.js";import{S as re}from"./sparkles-EZLwO9cy.js";import"./vendor-utils-Lf-MeoKe.js";import"./vendor-query-BBHVyEFd.js";import"./phone-C0r4y2fg.js";import"./circle-alert-BpVchDHk.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ie=z("Clipboard",[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}]]);function ne(x){const d=x.match(/\b(\d{6})\b/);return d?d[1]:null}function oe(){const[x,d]=s.useState(null),[w,r]=s.useState(!1),c=typeof navigator<"u"&&"clipboard"in navigator&&typeof navigator.clipboard.readText=="function",p=s.useCallback(async()=>{if(!c)return null;try{const l=await navigator.clipboard.readText(),h=ne(l);if(h)return d(h),r(!1),h}catch(l){console.debug("Clipboard read failed:",l)}return null},[c]),k=s.useCallback(()=>{d(null),r(!1)},[]);return s.useEffect(()=>{if(!c)return;const l=()=>{document.visibilityState==="visible"&&(r(!0),setTimeout(()=>{r(!1)},1e4))};return document.addEventListener("visibilitychange",l),()=>{document.removeEventListener("visibilitychange",l)}},[c]),{detectedCode:x,showPasteChip:w,readClipboard:p,clearDetectedCode:k,isSupported:c}}function we(){const x=U(),[d]=X(),w=H(t=>t.setAuth),[r,c]=s.useState("phone"),[p,k]=s.useState(""),[l,h]=s.useState(null),[R,O]=s.useState(null),[f,b]=s.useState(""),[S,P]=s.useState(300),[m,y]=s.useState(0),[E,g]=s.useState(!1),[v,o]=s.useState(null),j=s.useRef([]),{detectedCode:N,showPasteChip:M,readClipboard:V,clearDetectedCode:W}=oe(),A=K(G(p));s.useEffect(()=>{const t=d.get("sid");t&&$(t)},[d]),s.useEffect(()=>{N&&r==="otp"&&(b(N),setTimeout(()=>{C(N)},300))},[N]),s.useEffect(()=>{if(m<=0)return;const t=setInterval(()=>{y(a=>Math.max(0,a-1))},1e3);return()=>clearInterval(t)},[m]),s.useEffect(()=>{if(r!=="otp"||S<=0)return;const t=setInterval(()=>{P(a=>a<=1?(o("Código expirado. Solicite novo código."),0):a-1)},1e3);return()=>clearInterval(t)},[r,S]);const $=async t=>{g(!0),o(null);try{const a=await I.getOtpSession(t);h(t),O(a.maskedPhone),P(a.expiresIn),y(a.cooldown),c("otp")}catch(a){a.status===410?o("Link expirado. Digite seu telefone para receber novo código."):o("Link inválido.")}finally{g(!1)}},L=async t=>{if(t?.preventDefault(),!!A){g(!0),o(null);try{const a=await I.requestOtpLogin(p);h(a.sid),P(a.expiresIn),y(a.cooldown),c("otp")}catch(a){a.data?.code==="RATE_LIMITED"?(o(`Aguarde ${a.data.retryAfter}s para solicitar novo código.`),y(a.data.retryAfter)):o(a.message||"Erro ao enviar código")}finally{g(!1)}}},C=async t=>{const a=t||f;if(!(a.length!==6||!l)){g(!0),o(null);try{const n=await I.verifyOtpLogin(l,a);"vibrate"in navigator&&navigator.vibrate([50,50,100]),w(n.user,n.token,n.refreshToken),c("success"),W(),setTimeout(()=>{n.next_step==="onboarding"?x("/",{replace:!0}):x("/",{replace:!0})},1500)}catch(n){const u=n.data?.code;u==="OTP_INVALID"?(o("Código incorreto. Tente novamente."),b(""),j.current[0]?.focus()):u==="OTP_EXPIRED"||u==="SID_EXPIRED"?(o("Código expirado. Solicite novo código."),c("phone")):o(n.message||"Erro ao verificar código")}finally{g(!1)}}},q=(t,a)=>{if(!/^\d*$/.test(a))return;const n=f.split("");n[t]=a.slice(-1);const u=n.join("").slice(0,6);b(u),a&&t<5&&j.current[t+1]?.focus(),u.length===6&&C(u)},F=t=>{t.preventDefault();const a=t.clipboardData.getData("text").replace(/\D/g,"").slice(0,6);a.length===6&&(b(a),C(a))},_=async()=>{const t=await V();t&&(b(t),C(t))},B=t=>{const a=Math.floor(t/60),n=t%60;return`${a}:${n.toString().padStart(2,"0")}`};return e.jsxs("div",{className:"min-h-screen flex flex-col bg-gradient-to-br from-green-500/5 via-background to-green-600/10",children:[e.jsxs(i.div,{initial:{opacity:0,y:-30},animate:{opacity:1,y:0},transition:{duration:.6},className:"pt-12 pb-8 px-6 text-center",children:[e.jsx(i.div,{initial:{scale:.8},animate:{scale:1},transition:{type:"spring",bounce:.5,delay:.2},className:"inline-flex p-4 rounded-3xl bg-gradient-to-br from-green-500 to-green-600 shadow-xl shadow-green-500/30 mb-4",children:e.jsx(T,{className:"h-12 w-12 text-white"})}),e.jsx(i.h1,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.3},className:"text-3xl font-bold bg-gradient-to-r from-green-600 to-green-500 bg-clip-text text-transparent",children:"eTijucas"}),e.jsxs(i.p,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.4},className:"text-muted-foreground mt-1",children:[r==="phone"&&"Login rápido via WhatsApp",r==="otp"&&"Digite o código recebido",r==="success"&&"Bem-vindo!"]})]}),e.jsx(i.div,{initial:{opacity:0,y:30},animate:{opacity:1,y:0},transition:{duration:.5,delay:.3},className:"flex-1 px-6",children:e.jsx(ee,{className:"p-6 shadow-xl border-0 bg-background/80 backdrop-blur-xl",children:e.jsxs(ae,{mode:"wait",children:[r==="phone"&&e.jsxs(i.form,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},onSubmit:L,className:"space-y-6",children:[e.jsxs("div",{className:"text-center mb-4",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Seu número WhatsApp"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Enviaremos um código de 6 dígitos"})]}),e.jsx(te,{value:p,onChange:k,error:void 0,autoFocus:!0}),v&&e.jsx(i.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"p-3 rounded-xl bg-red-50 dark:bg-red-950/30 border border-red-200 dark:border-red-800",children:e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400 text-center",children:v})}),e.jsx(Z,{type:"submit",size:"lg",disabled:!A||E||m>0,className:D("w-full h-14 text-lg font-semibold rounded-2xl","bg-gradient-to-r from-green-500 to-green-600","shadow-lg shadow-green-500/30",A&&"hover:shadow-xl hover:shadow-green-500/40"),children:E?e.jsxs(e.Fragment,{children:[e.jsx(J,{className:"h-5 w-5 mr-2 animate-spin"}),"Enviando..."]}):m>0?e.jsxs(e.Fragment,{children:[e.jsx(Q,{className:"h-5 w-5 mr-2"}),"Aguarde ",m,"s"]}):e.jsxs(e.Fragment,{children:[e.jsx(T,{className:"h-5 w-5 mr-2"}),"Receber código via WhatsApp"]})})]},"phone"),r==="otp"&&e.jsxs(i.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},className:"space-y-6",children:[e.jsxs("div",{className:"text-center mb-4",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Verifique seu WhatsApp"}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:["Código enviado para ",R||`(${p.slice(0,2)}) *****-${p.slice(-4)}`]}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-2",children:["Expira em ",B(S)]})]}),M&&e.jsxs(i.button,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},onClick:_,className:"w-full flex items-center justify-center gap-2 py-3 rounded-xl bg-green-500/10 border border-green-500/30 text-green-600 hover:bg-green-500/20 transition-all",children:[e.jsx(ie,{className:"h-4 w-4"}),e.jsx("span",{className:"font-medium",children:"Colar código do WhatsApp"})]}),e.jsx("div",{className:"flex justify-center gap-3",onPaste:F,children:[0,1,2,3,4,5].map(t=>e.jsx("input",{ref:a=>j.current[t]=a,type:"text",inputMode:"numeric",maxLength:1,value:f[t]||"",onChange:a=>q(t,a.target.value),onKeyDown:a=>{a.key==="Backspace"&&!f[t]&&t>0&&j.current[t-1]?.focus()},className:D("w-12 h-14 text-center text-2xl font-bold rounded-xl border-2 transition-all","focus:border-green-500 focus:ring-2 focus:ring-green-500/20",f[t]?"border-green-500 bg-green-50 dark:bg-green-950/30":"border-border bg-muted/50")},t))}),e.jsxs("div",{className:"text-center space-y-2",children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["1. Vá ao WhatsApp e toque em ",e.jsx("span",{className:"font-medium text-green-600",children:'"Copiar código"'})]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["2. Volte aqui e toque em ",e.jsx("span",{className:"font-medium text-green-600",children:'"Colar código"'})]})]}),v&&e.jsx(i.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"p-3 rounded-xl bg-red-50 dark:bg-red-950/30 border border-red-200 dark:border-red-800",children:e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400 text-center",children:v})}),e.jsx("div",{className:"text-center",children:e.jsx("button",{onClick:()=>L(),disabled:m>0||E,className:"text-sm text-primary hover:underline disabled:text-muted-foreground disabled:no-underline",children:m>0?`Reenviar em ${m}s`:"Reenviar código"})})]},"otp"),r==="success"&&e.jsxs(i.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"py-8 text-center",children:[e.jsx(i.div,{initial:{scale:0},animate:{scale:1},transition:{type:"spring",bounce:.5},className:"inline-flex p-6 rounded-full bg-green-500 mb-6",children:e.jsx(Y,{className:"h-12 w-12 text-white"})}),e.jsx("h2",{className:"text-2xl font-bold text-green-600",children:"Login realizado!"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Redirecionando..."})]},"success")]})})}),e.jsx(i.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.8},className:"py-8 px-6",children:e.jsxs("div",{className:"flex items-center justify-center gap-6 text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(se,{className:"h-5 w-5 text-green-500"}),e.jsx("span",{className:"text-sm font-medium",children:"1.234 moradores"})]}),e.jsx("div",{className:"w-px h-4 bg-border"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(re,{className:"h-5 w-5 text-amber-500"}),e.jsx("span",{className:"text-sm font-medium",children:"App oficial"})]})]})})]})}export{we as default};
