import{r,j as e,l as L,m as p,X as R,a0 as B,M as F,E as W,aw as G,Z as H,ap as U,ak as $,K as D,aR as I,dm as M}from"./vendor-app-L90565EI.js";import{b as z}from"./bairro.service-D2iYenKu.js";import{u as Q}from"./index-Df2jNpcx.js";import{B as q}from"./BottomTabBar-DPpPLToD.js";import{u as K}from"./useAppStore-DIyb1zqK.js";import{u as P}from"./useAuthStore-DShg7od0.js";import{a as V}from"./auth.service-BW-PeZUX.js";import{u as _,a as X}from"./useCityName-CQpT0qaj.js";import"./client-BdVdTjkU.js";import"./localDatabase-BylSjGkg.js";import"./bairros-Cf5Z_oCw.js";import"./uuid-BwYzP5ph.js";const Z=100;function J({isOpen:u,onClose:i,children:m,title:g,snapPoints:n=[.5,.9],initialSnap:y=0,className:a=""}){const[o,l]=r.useState(y),x=r.useRef(null);r.useRef(0);const b=`${n[o]*100}vh`,c=r.useCallback((h,t)=>{const{velocity:j,offset:N}=t;if(j.y>500||N.y>Z){i();return}if(j.y<-500){l(n.length-1);return}const w=window.innerHeight,d=((x.current?.offsetHeight||0)-N.y)/w;let f=0,v=Math.abs(n[0]-d);n.forEach((A,E)=>{const C=Math.abs(A-d);C<v&&(v=C,f=E)}),l(f)},[i,n]);return e.jsx(L,{children:u&&e.jsxs(e.Fragment,{children:[e.jsx(p.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:i,className:"fixed inset-0 bg-black/50 z-40"}),e.jsxs(p.div,{ref:x,initial:{y:"100%"},animate:{y:0,height:b},exit:{y:"100%"},transition:{type:"spring",damping:30,stiffness:300},drag:"y",dragConstraints:{top:0,bottom:0},dragElastic:.2,onDragEnd:c,className:`fixed bottom-0 left-0 right-0 bg-background rounded-t-3xl z-50 overflow-hidden shadow-elevated ${a}`,children:[e.jsx("div",{className:"flex justify-center pt-3 pb-2 cursor-grab active:cursor-grabbing",children:e.jsx("div",{className:"w-10 h-1 rounded-full bg-muted-foreground/30"})}),g&&e.jsxs("div",{className:"flex items-center justify-between px-4 pb-3 border-b border-border",children:[e.jsx("h3",{className:"text-lg font-semibold",children:g}),e.jsx("button",{onClick:i,className:"p-2 rounded-full hover:bg-muted transition-colors",children:e.jsx(R,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"overflow-y-auto h-full pb-safe",children:m})]})]})})}function Y({isOpen:u,onComplete:i,bairros:m}){const{updateUser:g}=P(),n=_(),{name:y}=X(),[a,o]=r.useState("name"),[l,x]=r.useState(""),[b,c]=r.useState(),[h,t]=r.useState(!1),[j,N]=r.useState(!1),[w,S]=r.useState(!1),[k,d]=r.useState(null),f=l.trim().length>=2,v=a==="name"?f:a==="bairro"?!0:h,A=async()=>{if(!navigator.geolocation){d("GPS não suportado neste dispositivo");return}S(!0),d(null),navigator.geolocation.getCurrentPosition(async s=>{console.log("GPS:",s.coords.latitude,s.coords.longitude),m.length>0&&c(m[0].id),S(!1)},s=>{console.error("GPS error:",s),d("Não foi possível obter sua localização"),S(!1)},{enableHighAccuracy:!0,timeout:1e4})},E=async()=>{if(!(!f||!h)){N(!0),d(null);try{const s=await V.completeProfile({nome:l.trim(),bairroId:b,termsAccepted:!0});g(s.user),"vibrate"in navigator&&navigator.vibrate(50),i()}catch(s){d(s.message||"Erro ao salvar perfil")}finally{N(!1)}}},C=()=>{a==="name"&&f?o("bairro"):a==="bairro"?o("terms"):a==="terms"&&h&&E()};r.useEffect(()=>{u||(o("name"),x(""),c(void 0),t(!1),d(null))},[u]);const T={initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20}};return e.jsx(J,{isOpen:u,onClose:()=>{},title:`Bem-vindo ao ${n}!`,snapPoints:[.6,.9],initialSnap:0,children:e.jsxs("div",{className:"px-6 py-4",children:[e.jsx("div",{className:"flex gap-2 mb-6",children:["name","bairro","terms"].map((s,O)=>e.jsx("div",{className:`h-1 flex-1 rounded-full transition-colors ${s===a?"bg-primary":O<["name","bairro","terms"].indexOf(a)?"bg-primary/50":"bg-muted"}`},s))}),e.jsxs(L,{mode:"wait",children:[a==="name"&&e.jsxs(p.div,{variants:T,initial:"initial",animate:"animate",exit:"exit",className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-primary/10 flex items-center justify-center",children:e.jsx(B,{className:"w-6 h-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-semibold",children:"Como podemos te chamar?"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Seu nome será exibido nas suas publicações"})]})]}),e.jsx("input",{type:"text",value:l,onChange:s=>x(s.target.value),placeholder:"Seu nome",autoFocus:!0,className:"w-full px-4 py-3 rounded-xl border border-border bg-muted/50 focus:border-primary focus:ring-2 focus:ring-primary/20 transition-all text-lg"}),l.length>0&&!f&&e.jsx("p",{className:"text-sm text-destructive",children:"Nome deve ter pelo menos 2 caracteres"})]},"name"),a==="bairro"&&e.jsxs(p.div,{variants:T,initial:"initial",animate:"animate",exit:"exit",className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-primary/10 flex items-center justify-center",children:e.jsx(F,{className:"w-6 h-6 text-primary"})}),e.jsxs("div",{children:[e.jsxs("h4",{className:"text-lg font-semibold",children:["Qual seu bairro em ",y,"? (opcional)"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Para mostrar notícias e eventos perto de você"})]})]}),e.jsxs("button",{onClick:A,disabled:w,className:"w-full flex items-center gap-3 px-4 py-3 rounded-xl border border-primary/30 bg-primary/5 hover:bg-primary/10 transition-all text-primary",children:[w?e.jsx(W,{className:"w-5 h-5 animate-spin"}):e.jsx(G,{className:"w-5 h-5"}),e.jsx("span",{className:"font-medium",children:"Usar minha localização"})]}),e.jsx("div",{className:"max-h-48 overflow-y-auto space-y-1",children:m.map(s=>e.jsxs("button",{onClick:()=>c(s.id),className:`w-full flex items-center justify-between px-4 py-3 rounded-lg transition-all ${b===s.id?"bg-primary text-primary-foreground":"hover:bg-muted"}`,children:[e.jsx("span",{children:s.nome}),b===s.id&&e.jsx(H,{className:"w-5 h-5"})]},s.id))})]},"bairro"),a==="terms"&&e.jsxs(p.div,{variants:T,initial:"initial",animate:"animate",exit:"exit",className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-primary/10 flex items-center justify-center",children:e.jsx(U,{className:"w-6 h-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-semibold",children:"Termos de Uso"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Quase pronto! Aceite os termos para continuar"})]})]}),e.jsx("div",{className:"p-4 rounded-xl bg-muted/50 border border-border",children:e.jsxs("p",{className:"text-sm text-muted-foreground leading-relaxed",children:["Ao usar o ",n,", você concorda em respeitar outros usuários, não publicar conteúdo ofensivo e usar o app de forma responsável. Seus dados são protegidos conforme nossa política de privacidade."]})}),e.jsxs("label",{className:"flex items-center gap-3 cursor-pointer p-4 rounded-xl border border-border hover:border-primary/50 transition-colors",children:[e.jsx("input",{type:"checkbox",checked:h,onChange:s=>t(s.target.checked),className:"w-5 h-5 rounded border-border text-primary focus:ring-primary"}),e.jsxs("span",{className:"text-sm",children:["Li e aceito os ",e.jsx("span",{className:"text-primary font-medium",children:"Termos de Uso"})," e a"," ",e.jsx("span",{className:"text-primary font-medium",children:"Política de Privacidade"})]})]})]},"terms")]}),k&&e.jsx(p.p,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"text-sm text-destructive mt-4 text-center",children:k}),e.jsx(p.button,{onClick:C,disabled:!v||j,className:`w-full mt-6 py-4 rounded-2xl font-semibold text-lg flex items-center justify-center gap-2 transition-all ${v?"bg-primary text-primary-foreground hover:bg-primary/90":"bg-muted text-muted-foreground cursor-not-allowed"}`,whileTap:v?{scale:.98}:void 0,children:j?e.jsxs(e.Fragment,{children:[e.jsx(W,{className:"w-5 h-5 animate-spin"}),"Salvando..."]}):a==="terms"?e.jsxs(e.Fragment,{children:[e.jsx(H,{className:"w-5 h-5"}),"Concluir"]}):e.jsxs(e.Fragment,{children:["Continuar",e.jsx($,{className:"w-5 h-5"})]})}),a==="bairro"&&e.jsx("button",{onClick:()=>o("terms"),className:"w-full mt-3 py-2 text-sm text-muted-foreground hover:text-foreground transition-colors",children:"Pular por agora"})]})})}function ue(){const u=D(),i=Q(),{setActiveTab:m}=K(),{isAuthenticated:g,user:n,needsOnboarding:y}=P(),[a,o]=r.useState(!1),{data:l=[]}=I({queryKey:["bairros"],queryFn:z.getAll,staleTime:1e3*60*60});r.useEffect(()=>{y()&&o(!0)},[g,n]);const x=()=>{o(!1)},c=(t=>t==="/"?"home":t.startsWith("/denuncia")||t.startsWith("/minhas-denuncias")?"reportar":t.startsWith("/forum")||t.startsWith("/topico")?"forum":t.startsWith("/agenda")||t.startsWith("/evento")?"agenda":t.startsWith("/telefones")||t.startsWith("/coleta-lixo")||t.startsWith("/pontos-turisticos")||t.startsWith("/ponto-turistico")||t.startsWith("/missas")||t.startsWith("/votacoes")||t.startsWith("/vereadores")||t.startsWith("/perfil")?"mais":"home")(u.pathname);r.useEffect(()=>{m(c)},[c,m]);const h=t=>{switch(t){case"home":i("/");break;case"reportar":i("/denuncias");break;case"forum":i("/forum");break;case"agenda":i("/agenda");break;case"mais":i("/mais");break}};return e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-muted/50",children:e.jsxs("div",{className:"relative w-full max-w-[420px] h-full bg-background overflow-hidden shadow-elevated",children:[e.jsx("div",{className:"absolute inset-0 overflow-y-auto scrollbar-hide pb-20",children:e.jsx(M,{})}),e.jsx(q,{activeTab:c,onTabChange:h}),e.jsx(Y,{isOpen:a,onComplete:x,bairros:l})]})})}export{ue as default};
