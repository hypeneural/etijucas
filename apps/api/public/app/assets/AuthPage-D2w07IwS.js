import{r as s,u as J,bB as Q,j as e,m as r,e as O,h as Y,b as Z,br as ee,dp as te,p as ae,U as se,S as re}from"./vendor-app-CFsuVmH9.js";import{v as R,c as ne,a as I}from"./auth.service-BZPOLBHX.js";import{u as ie,a as oe,B as ce,c as _}from"./index-DeilxgjZ.js";import{C as le}from"./card-DCECeHj3.js";import{P as de}from"./PhoneInput-cq6Z3dHS.js";import"./input-ClxaPzc5.js";import"./label-DFaz3-aU.js";import"./slider-CN-_Dayh.js";function ue(x){const m=x.match(/\b(\d{6})\b/);return m?m[1]:null}function me(){const[x,m]=s.useState(null),[v,h]=s.useState(!1),l=typeof navigator<"u"&&"clipboard"in navigator&&typeof navigator.clipboard.readText=="function",o=s.useCallback(async()=>{if(!l)return null;try{const n=await navigator.clipboard.readText(),f=ue(n);if(f)return m(f),h(!1),f}catch(n){console.debug("Clipboard read failed:",n)}return null},[l]),g=s.useCallback(()=>{m(null),h(!1)},[]);return s.useEffect(()=>{if(!l)return;const n=()=>{document.visibilityState==="visible"&&(h(!0),setTimeout(()=>{h(!1)},1e4))};return document.addEventListener("visibilitychange",n),()=>{document.removeEventListener("visibilitychange",n)}},[l]),{detectedCode:x,showPasteChip:v,readClipboard:o,clearDetectedCode:g,isSupported:l}}function M(){const x=ie(),m=J(),[v]=Q(),h=oe(t=>t.setAuth),l=m.state?.phone,[o,g]=s.useState("phone"),[n,f]=s.useState(l||""),[P,D]=s.useState(null),[W,q]=s.useState(null),[b,y]=s.useState(""),[k,E]=s.useState(300),[u,j]=s.useState(0),[$,V]=s.useState(!1),[A,d]=s.useState(!1),[N,c]=s.useState(null),C=s.useRef([]),{detectedCode:w,showPasteChip:B,readClipboard:F,clearDetectedCode:z}=me(),L=R(ne(n));s.useEffect(()=>{const t=v.get("sid");t&&U(t)},[v]),s.useEffect(()=>{l&&R(l)&&!$&&!P&&(V(!0),T())},[l]),s.useEffect(()=>{w&&o==="otp"&&(y(w),d(!0),setTimeout(()=>{S(w)},300))},[w]),s.useEffect(()=>{if(u<=0)return;const t=setInterval(()=>{j(a=>Math.max(0,a-1))},1e3);return()=>clearInterval(t)},[u]),s.useEffect(()=>{if(o!=="otp"||k<=0)return;const t=setInterval(()=>{E(a=>a<=1?(c("Código expirado. Solicite novo código."),0):a-1)},1e3);return()=>clearInterval(t)},[o,k]);const U=async t=>{d(!0),c(null);try{const a=await I.getOtpSession(t);D(t),q(a.maskedPhone),E(a.expiresIn),j(a.cooldown),g("otp")}catch(a){a.status===410?c("Link expirado. Digite seu telefone para receber novo código."):c("Link inválido.")}finally{d(!1)}},T=async t=>{if(t?.preventDefault(),!!L){d(!0),c(null);try{const a=await I.requestOtpLogin(n);D(a.sid),E(a.expiresIn),j(a.cooldown),g("otp")}catch(a){a.data?.code==="RATE_LIMITED"?(c(`Aguarde ${a.data.retryAfter}s para solicitar novo código.`),j(a.data.retryAfter)):c(a.message||"Erro ao enviar código")}finally{d(!1)}}},S=async t=>{const a=t||b;if(!(a.length!==6||!P)){d(!0),c(null);try{const i=await I.verifyOtpLogin(P,a);"vibrate"in navigator&&navigator.vibrate([50,50,100]),h(i.user,i.token,i.refreshToken),g("success"),z(),setTimeout(()=>{i.next_step==="onboarding"?x("/",{replace:!0}):x("/",{replace:!0})},1500)}catch(i){const p=i.data?.code;p==="OTP_INVALID"?(c("Código incorreto. Tente novamente."),y(""),C.current[0]?.focus()):p==="OTP_EXPIRED"||p==="SID_EXPIRED"?(c("Código expirado. Solicite novo código."),g("phone")):c(i.message||"Erro ao verificar código")}finally{d(!1)}}},X=(t,a)=>{if(!/^\d*$/.test(a))return;const i=b.split("");i[t]=a.slice(-1);const p=i.join("").slice(0,6);y(p),a&&t<5&&C.current[t+1]?.focus(),p.length===6&&(d(!0),S(p))},K=t=>{t.preventDefault();const a=t.clipboardData.getData("text").replace(/\D/g,"").slice(0,6);a.length===6&&(y(a),d(!0),S(a))},G=async()=>{const t=await F();t&&(y(t),S(t))},H=t=>{const a=Math.floor(t/60),i=t%60;return`${a}:${i.toString().padStart(2,"0")}`};return e.jsxs("div",{className:"min-h-screen flex flex-col bg-gradient-to-br from-green-500/5 via-background to-green-600/10",children:[e.jsxs(r.div,{initial:{opacity:0,y:-30},animate:{opacity:1,y:0},transition:{duration:.6},className:"pt-12 pb-8 px-6 text-center",children:[e.jsx(r.div,{initial:{scale:.8},animate:{scale:1},transition:{type:"spring",bounce:.5,delay:.2},className:"inline-flex p-4 rounded-3xl bg-gradient-to-br from-green-500 to-green-600 shadow-xl shadow-green-500/30 mb-4",children:e.jsx(O,{className:"h-12 w-12 text-white"})}),e.jsx(r.h1,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.3},className:"text-3xl font-bold bg-gradient-to-r from-green-600 to-green-500 bg-clip-text text-transparent",children:"eTijucas"}),e.jsxs(r.p,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.4},className:"text-muted-foreground mt-1",children:[o==="phone"&&"Login rápido via WhatsApp",o==="otp"&&"Digite o código recebido",o==="success"&&"Bem-vindo!"]})]}),e.jsx(r.div,{initial:{opacity:0,y:30},animate:{opacity:1,y:0},transition:{duration:.5,delay:.3},className:"flex-1 px-6",children:e.jsx(le,{className:"p-6 shadow-xl border-0 bg-background/80 backdrop-blur-xl",children:e.jsxs(Y,{mode:"wait",children:[o==="phone"&&e.jsxs(r.form,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},onSubmit:T,className:"space-y-6",children:[e.jsxs("div",{className:"text-center mb-4",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Seu número WhatsApp"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Enviaremos um código de 6 dígitos"})]}),e.jsx(de,{value:n,onChange:f,error:void 0,autoFocus:!0}),N&&e.jsx(r.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"p-3 rounded-xl bg-red-50 dark:bg-red-950/30 border border-red-200 dark:border-red-800",children:e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400 text-center",children:N})}),e.jsx(ce,{type:"submit",size:"lg",disabled:!L||A||u>0,className:_("w-full h-14 text-lg font-semibold rounded-2xl","bg-gradient-to-r from-green-500 to-green-600","shadow-lg shadow-green-500/30",L&&"hover:shadow-xl hover:shadow-green-500/40"),children:A?e.jsxs(e.Fragment,{children:[e.jsx(Z,{className:"h-5 w-5 mr-2 animate-spin"}),"Enviando..."]}):u>0?e.jsxs(e.Fragment,{children:[e.jsx(ee,{className:"h-5 w-5 mr-2"}),"Aguarde ",u,"s"]}):e.jsxs(e.Fragment,{children:[e.jsx(O,{className:"h-5 w-5 mr-2"}),"Receber código via WhatsApp"]})})]},"phone"),o==="otp"&&e.jsxs(r.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},className:"space-y-6",children:[e.jsxs("div",{className:"text-center mb-4",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Verifique seu WhatsApp"}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:["Código enviado para ",W||`(${n.slice(0,2)}) *****-${n.slice(-4)}`]}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-2",children:["Expira em ",H(k)]})]}),B&&e.jsxs(r.button,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},onClick:G,className:"w-full flex items-center justify-center gap-2 py-3 rounded-xl bg-green-500/10 border border-green-500/30 text-green-600 hover:bg-green-500/20 transition-all",children:[e.jsx(te,{className:"h-4 w-4"}),e.jsx("span",{className:"font-medium",children:"Colar código do WhatsApp"})]}),e.jsx("div",{className:"flex justify-center gap-3",onPaste:K,children:[0,1,2,3,4,5].map(t=>e.jsx("input",{ref:a=>C.current[t]=a,type:"text",inputMode:"numeric",maxLength:1,value:b[t]||"",onChange:a=>X(t,a.target.value),onKeyDown:a=>{a.key==="Backspace"&&!b[t]&&t>0&&C.current[t-1]?.focus()},className:_("w-12 h-14 text-center text-2xl font-bold rounded-xl border-2 transition-all","focus:border-green-500 focus:ring-2 focus:ring-green-500/20",b[t]?"border-green-500 bg-green-50 dark:bg-green-950/30":"border-border bg-muted/50")},t))}),e.jsxs("div",{className:"text-center space-y-2",children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["1. Vá ao WhatsApp e toque em ",e.jsx("span",{className:"font-medium text-green-600",children:'"Copiar código"'})]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["2. Volte aqui e toque em ",e.jsx("span",{className:"font-medium text-green-600",children:'"Colar código"'})]})]}),N&&e.jsx(r.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"p-3 rounded-xl bg-red-50 dark:bg-red-950/30 border border-red-200 dark:border-red-800",children:e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400 text-center",children:N})}),e.jsx("div",{className:"text-center",children:e.jsx("button",{onClick:()=>T(),disabled:u>0||A,className:"text-sm text-primary hover:underline disabled:text-muted-foreground disabled:no-underline",children:u>0?`Reenviar em ${u}s`:"Reenviar código"})})]},"otp"),o==="success"&&e.jsxs(r.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"py-8 text-center",children:[e.jsx(r.div,{initial:{scale:0},animate:{scale:1},transition:{type:"spring",bounce:.5},className:"inline-flex p-6 rounded-full bg-green-500 mb-6",children:e.jsx(ae,{className:"h-12 w-12 text-white"})}),e.jsx("h2",{className:"text-2xl font-bold text-green-600",children:"Login realizado!"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Redirecionando..."})]},"success")]})})}),e.jsx(r.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.8},className:"py-8 px-6",children:e.jsxs("div",{className:"flex items-center justify-center gap-6 text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(se,{className:"h-5 w-5 text-green-500"}),e.jsx("span",{className:"text-sm font-medium",children:"1.234 moradores"})]}),e.jsx("div",{className:"w-px h-4 bg-border"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(re,{className:"h-5 w-5 text-amber-500"}),e.jsx("span",{className:"text-sm font-medium",children:"App oficial"})]})]})})]})}const je=Object.freeze(Object.defineProperty({__proto__:null,default:M},Symbol.toStringTag,{value:"Module"})),Ne=Object.freeze(Object.defineProperty({__proto__:null,default:M},Symbol.toStringTag,{value:"Module"}));export{Ne as A,je as W};
