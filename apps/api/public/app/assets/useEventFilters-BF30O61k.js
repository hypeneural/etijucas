import{a9 as F,r as s,j as f,aa as L,ab as B,ac as D,ad as S}from"./vendor-radix-E4gGnxjO.js";import{d as b}from"./index-BSTgcX-N.js";import{C as H}from"./chevron-down-DFgiFmiE.js";import{u as J,a as K}from"./useEventsApi-DD3V3-5x.js";import{u as k,v as V,f as l,w as W,i as $,p as y,s as q,x as G}from"./vendor-utils-zfZBtJeF.js";import{p as R}from"./pt-BR-G2JzEZM7.js";const le=e=>{const a=l(e,"EEE, dd",{locale:R});return a.charAt(0).toUpperCase()+a.slice(1)},pe=e=>l(e,"dd 'de' MMMM",{locale:R}),ye=e=>l(e,"dd MMM",{locale:R}),E=e=>l(e,"HH:mm"),he=(e,a)=>`${E(e)}â€“${E(a)}`,U=e=>k(e,new Date),Y=e=>k(e,W(new Date,1)),z=e=>V(e),P=e=>l(e,"yyyy-MM-dd"),Q=(e,a=new Date)=>e.filter(t=>t.end>=a).sort((t,c)=>t.start.getTime()-c.start.getTime())[0]??null,X=e=>{const a=e.getHours();return a<12?"morning":a<18?"afternoon":"night"},we=F,Z=s.forwardRef(({className:e,...a},n)=>f.jsx(L,{ref:n,className:b("border-b",e),...a}));Z.displayName="AccordionItem";const ee=s.forwardRef(({className:e,children:a,...n},t)=>f.jsx(B,{className:"flex",children:f.jsxs(D,{ref:t,className:b("flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180",e),...n,children:[a,f.jsx(H,{className:"h-4 w-4 shrink-0 transition-transform duration-200"})]})}));ee.displayName=D.displayName;const ae=s.forwardRef(({className:e,children:a,...n},t)=>f.jsx(S,{ref:t,className:"overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down",...n,children:f.jsx("div",{className:b("pb-4 pt-0",e),children:a})}));ae.displayName=S.displayName;const M="etijucas_event_filters",T="etijucas_event_favorites",p={search:"",datePreset:"all",dateRange:{start:null,end:null},categories:[],neighborhoods:[],venues:[],price:"all",priceRange:[0,150],timeOfDay:[],accessibility:!1,parking:!1,kids:!1,outdoor:!1,sortBy:"upcoming"},te=e=>e.map(a=>({...a,start:y(a.startDateTime),end:y(a.endDateTime)})),re=()=>{if(typeof window>"u")return p;try{const e=window.localStorage.getItem(M);if(!e)return p;const a=JSON.parse(e);return{...p,...a}}catch{return p}},oe=()=>{if(typeof window>"u")return[];try{const e=window.localStorage.getItem(T);return e?JSON.parse(e):[]}catch{return[]}},se=e=>{const a={perPage:100};return e.search&&(a.search=e.search),e.categories.length>0&&(a.category=e.categories[0]),e.neighborhoods.length>0&&(a.bairroId=e.neighborhoods[0]),e.venues.length>0&&(a.venueId=e.venues[0]),e.datePreset==="today"?a.datePreset="today":e.datePreset==="tomorrow"?a.datePreset="tomorrow":e.datePreset==="weekend"?a.datePreset="weekend":e.datePreset==="this_week"?a.datePreset="this_week":e.datePreset==="this_month"?a.datePreset="this_month":e.datePreset==="range"&&e.dateRange.start&&e.dateRange.end&&(a.fromDate=e.dateRange.start,a.toDate=e.dateRange.end),e.price==="free"?a.price="free":e.price==="paid"&&(a.price="paid",e.priceRange[0]>0&&(a.priceMin=e.priceRange[0]),e.priceRange[1]<150&&(a.priceMax=e.priceRange[1])),e.timeOfDay.length>0&&(a.timeOfDay=e.timeOfDay[0]),e.accessibility&&(a.accessibility=!0),e.parking&&(a.parking=!0),e.outdoor&&(a.outdoor=!0),e.kids&&(a.kids=!0),e.sortBy==="popular"?(a.orderBy="popularityScore",a.order="desc"):(a.orderBy="startDateTime",a.order="asc"),a},ne=(e,a)=>{const n=a.search.trim().toLowerCase();return e.filter(t=>{if(n){const c=t.title.toLowerCase().includes(n),d=t.venue?.name?.toLowerCase().includes(n)??!1,g=t.venue?.bairro?.nome?.toLowerCase().includes(n)??!1,h=t.tags.some(m=>(typeof m=="string"?m:m.name).toLowerCase().includes(n));if(!c&&!d&&!g&&!h)return!1}if(a.categories.length>0&&t.category){const c=typeof t.category=="string"?t.category:t.category.slug;if(!a.categories.includes(c))return!1}if(a.neighborhoods.length>0&&t.venue?.bairro&&!a.neighborhoods.includes(t.venue.bairro.nome)&&!a.neighborhoods.includes(t.venue.bairro.id)||a.venues.length>0&&t.venue&&!a.venues.includes(t.venue.name)&&!a.venues.includes(t.venue.id)||a.price==="free"&&t.ticket?.type!=="free"||a.price==="paid"&&t.ticket?.type!=="paid")return!1;if(a.price==="paid"&&t.ticket?.type==="paid"){const[c,d]=a.priceRange,g=t.ticket?.minPrice??0;if(g<c||g>d)return!1}if(a.datePreset==="today"&&!U(t.start)||a.datePreset==="tomorrow"&&!Y(t.start)||a.datePreset==="weekend"&&!z(t.start))return!1;if(a.datePreset==="range"&&a.dateRange.start&&a.dateRange.end){const c={start:q(y(a.dateRange.start)),end:$(y(a.dateRange.end))};if(!G(t.start,c))return!1}if(a.timeOfDay.length>0){const c=X(t.start);if(!a.timeOfDay.includes(c))return!1}return!(a.accessibility&&!t.flags?.accessibility||a.parking&&!t.flags?.parking||a.outdoor&&!t.flags?.outdoor)})},be=()=>{const[e,a]=s.useState(re),[n,t]=s.useState(oe),c=s.useMemo(()=>se(e),[e]),{data:d,isLoading:g,error:h}=J(c),{data:m}=K();s.useEffect(()=>{typeof window>"u"||window.localStorage.setItem(M,JSON.stringify(e))},[e]),s.useEffect(()=>{typeof window>"u"||window.localStorage.setItem(T,JSON.stringify(n))},[n]);const i=s.useMemo(()=>d?.data?te(d.data):[],[d?.data]),w=s.useMemo(()=>{const o=ne(i,e);return e.sortBy==="popular"?[...o].sort((r,u)=>u.popularityScore-r.popularityScore):[...o].sort((r,u)=>r.start.getTime()-u.start.getTime())},[i,e]),x=s.useMemo(()=>{const o={};return w.forEach(r=>{const u=P(r.start);o[u]||(o[u]=[]),o[u].push(r)}),o},[w]),v=s.useMemo(()=>{const o={};return i.forEach(r=>{const u=P(r.start);o[u]||(o[u]=[]),o[u].push(r)}),o},[i]),N=s.useMemo(()=>{const o=new Set(i.filter(r=>r.venue?.bairro?.nome).map(r=>r.venue.bairro.nome));return Array.from(o).sort()},[i]),O=s.useMemo(()=>{const o=new Set(i.filter(r=>r.venue?.name).map(r=>r.venue.name));return Array.from(o).sort()},[i]),A=s.useMemo(()=>{if(m?.data)return m.data;const o=new Map;return i.forEach(r=>{r.category&&typeof r.category=="object"&&o.set(r.category.slug,r.category)}),Array.from(o.values())},[m?.data,i]),C=s.useCallback(o=>{t(r=>r.includes(o)?r.filter(I=>I!==o):[...r,o])},[]),j=s.useCallback(o=>n.includes(o),[n]),_=s.useMemo(()=>Q(i),[i]);return{meta:s.useMemo(()=>({page:d?.meta?.page??1,perPage:d?.meta?.perPage??100,lastPage:d?.meta?.lastPage??1,total:d?.meta?.total??0}),[d?.meta]),allEvents:i,filteredEvents:w,groupedEvents:x,eventsByDate:v,filters:e,setFilters:a,availableNeighborhoods:N,availableVenues:O,availableCategories:A,favorites:n,toggleFavorite:C,isFavorite:j,nextEvent:_,isLoading:g,error:h}};export{we as A,he as a,Z as b,ee as c,ae as d,ne as e,pe as f,z as g,P as h,U as i,le as j,Y as k,ye as l,be as u};
