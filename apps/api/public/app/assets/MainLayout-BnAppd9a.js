import{r,j as e,l as E,m as p,X as P,Z as O,M as G,z as A,av as B,K as W,ao as F,aj as R,G as U,x as z,aQ as D,dm as I}from"./vendor-app-DpJht6ER.js";import{B as M}from"./BottomTabBar-BHjG1o7r.js";import{u as $}from"./useAppStore-B_Wuv9n8.js";import{u as H}from"./useAuthStore-CWKHWY38.js";import{a as Q}from"./auth.service-C13Y6aDh.js";import{b as q}from"./bairro.service-DvrNk6Mo.js";import"./index-B3oIcd_k.js";import"./bairros-Cf5Z_oCw.js";import"./uuid-BwYzP5ph.js";import"./client-BdVdTjkU.js";import"./localDatabase-uoVlTZ_Q.js";const K=100;function V({isOpen:u,onClose:i,children:n,title:g,snapPoints:a=[.5,.9],initialSnap:o=0,className:l=""}){const[x,c]=r.useState(o),d=r.useRef(null);r.useRef(0);const h=`${a[x]*100}vh`,m=r.useCallback((j,s)=>{const{velocity:y,offset:b}=s;if(y.y>500||b.y>K){i();return}if(y.y<-500){c(a.length-1);return}const S=window.innerHeight,v=((d.current?.offsetHeight||0)-b.y)/S;let C=0,k=Math.abs(a[0]-v);a.forEach((T,w)=>{const t=Math.abs(T-v);t<k&&(k=t,C=w)}),c(C)},[i,a]);return e.jsx(E,{children:u&&e.jsxs(e.Fragment,{children:[e.jsx(p.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:i,className:"fixed inset-0 bg-black/50 z-40"}),e.jsxs(p.div,{ref:d,initial:{y:"100%"},animate:{y:0,height:h},exit:{y:"100%"},transition:{type:"spring",damping:30,stiffness:300},drag:"y",dragConstraints:{top:0,bottom:0},dragElastic:.2,onDragEnd:m,className:`fixed bottom-0 left-0 right-0 bg-background rounded-t-3xl z-50 overflow-hidden shadow-elevated ${l}`,children:[e.jsx("div",{className:"flex justify-center pt-3 pb-2 cursor-grab active:cursor-grabbing",children:e.jsx("div",{className:"w-10 h-1 rounded-full bg-muted-foreground/30"})}),g&&e.jsxs("div",{className:"flex items-center justify-between px-4 pb-3 border-b border-border",children:[e.jsx("h3",{className:"text-lg font-semibold",children:g}),e.jsx("button",{onClick:i,className:"p-2 rounded-full hover:bg-muted transition-colors",children:e.jsx(P,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"overflow-y-auto h-full pb-safe",children:n})]})]})})}function _({isOpen:u,onComplete:i,bairros:n}){const{updateUser:g}=H(),[a,o]=r.useState("name"),[l,x]=r.useState(""),[c,d]=r.useState(),[h,m]=r.useState(!1),[j,s]=r.useState(!1),[y,b]=r.useState(!1),[S,f]=r.useState(null),N=l.trim().length>=2,v=a==="name"?N:a==="bairro"?!0:h,C=async()=>{if(!navigator.geolocation){f("GPS não suportado neste dispositivo");return}b(!0),f(null),navigator.geolocation.getCurrentPosition(async t=>{console.log("GPS:",t.coords.latitude,t.coords.longitude),n.length>0&&d(n[0].id),b(!1)},t=>{console.error("GPS error:",t),f("Não foi possível obter sua localização"),b(!1)},{enableHighAccuracy:!0,timeout:1e4})},k=async()=>{if(!(!N||!h)){s(!0),f(null);try{const t=await Q.completeProfile({nome:l.trim(),bairroId:c,termsAccepted:!0});g(t.user),"vibrate"in navigator&&navigator.vibrate(50),i()}catch(t){f(t.message||"Erro ao salvar perfil")}finally{s(!1)}}},T=()=>{a==="name"&&N?o("bairro"):a==="bairro"?o("terms"):a==="terms"&&h&&k()};r.useEffect(()=>{u||(o("name"),x(""),d(void 0),m(!1),f(null))},[u]);const w={initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20}};return e.jsx(V,{isOpen:u,onClose:()=>{},title:"Bem-vindo ao eTijucas!",snapPoints:[.6,.9],initialSnap:0,children:e.jsxs("div",{className:"px-6 py-4",children:[e.jsx("div",{className:"flex gap-2 mb-6",children:["name","bairro","terms"].map((t,L)=>e.jsx("div",{className:`h-1 flex-1 rounded-full transition-colors ${t===a?"bg-primary":L<["name","bairro","terms"].indexOf(a)?"bg-primary/50":"bg-muted"}`},t))}),e.jsxs(E,{mode:"wait",children:[a==="name"&&e.jsxs(p.div,{variants:w,initial:"initial",animate:"animate",exit:"exit",className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-primary/10 flex items-center justify-center",children:e.jsx(O,{className:"w-6 h-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-semibold",children:"Como podemos te chamar?"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Seu nome será exibido nas suas publicações"})]})]}),e.jsx("input",{type:"text",value:l,onChange:t=>x(t.target.value),placeholder:"Seu nome",autoFocus:!0,className:"w-full px-4 py-3 rounded-xl border border-border bg-muted/50 focus:border-primary focus:ring-2 focus:ring-primary/20 transition-all text-lg"}),l.length>0&&!N&&e.jsx("p",{className:"text-sm text-destructive",children:"Nome deve ter pelo menos 2 caracteres"})]},"name"),a==="bairro"&&e.jsxs(p.div,{variants:w,initial:"initial",animate:"animate",exit:"exit",className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-primary/10 flex items-center justify-center",children:e.jsx(G,{className:"w-6 h-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-semibold",children:"Qual seu bairro? (opcional)"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Para mostrar notícias e eventos perto de você"})]})]}),e.jsxs("button",{onClick:C,disabled:y,className:"w-full flex items-center gap-3 px-4 py-3 rounded-xl border border-primary/30 bg-primary/5 hover:bg-primary/10 transition-all text-primary",children:[y?e.jsx(A,{className:"w-5 h-5 animate-spin"}):e.jsx(B,{className:"w-5 h-5"}),e.jsx("span",{className:"font-medium",children:"Usar minha localização"})]}),e.jsx("div",{className:"max-h-48 overflow-y-auto space-y-1",children:n.map(t=>e.jsxs("button",{onClick:()=>d(t.id),className:`w-full flex items-center justify-between px-4 py-3 rounded-lg transition-all ${c===t.id?"bg-primary text-primary-foreground":"hover:bg-muted"}`,children:[e.jsx("span",{children:t.nome}),c===t.id&&e.jsx(W,{className:"w-5 h-5"})]},t.id))})]},"bairro"),a==="terms"&&e.jsxs(p.div,{variants:w,initial:"initial",animate:"animate",exit:"exit",className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-primary/10 flex items-center justify-center",children:e.jsx(F,{className:"w-6 h-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-semibold",children:"Termos de Uso"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Quase pronto! Aceite os termos para continuar"})]})]}),e.jsx("div",{className:"p-4 rounded-xl bg-muted/50 border border-border",children:e.jsx("p",{className:"text-sm text-muted-foreground leading-relaxed",children:"Ao usar o eTijucas, você concorda em respeitar outros usuários, não publicar conteúdo ofensivo e usar o app de forma responsável. Seus dados são protegidos conforme nossa política de privacidade."})}),e.jsxs("label",{className:"flex items-center gap-3 cursor-pointer p-4 rounded-xl border border-border hover:border-primary/50 transition-colors",children:[e.jsx("input",{type:"checkbox",checked:h,onChange:t=>m(t.target.checked),className:"w-5 h-5 rounded border-border text-primary focus:ring-primary"}),e.jsxs("span",{className:"text-sm",children:["Li e aceito os ",e.jsx("span",{className:"text-primary font-medium",children:"Termos de Uso"})," e a"," ",e.jsx("span",{className:"text-primary font-medium",children:"Política de Privacidade"})]})]})]},"terms")]}),S&&e.jsx(p.p,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"text-sm text-destructive mt-4 text-center",children:S}),e.jsx(p.button,{onClick:T,disabled:!v||j,className:`w-full mt-6 py-4 rounded-2xl font-semibold text-lg flex items-center justify-center gap-2 transition-all ${v?"bg-primary text-primary-foreground hover:bg-primary/90":"bg-muted text-muted-foreground cursor-not-allowed"}`,whileTap:v?{scale:.98}:void 0,children:j?e.jsxs(e.Fragment,{children:[e.jsx(A,{className:"w-5 h-5 animate-spin"}),"Salvando..."]}):a==="terms"?e.jsxs(e.Fragment,{children:[e.jsx(W,{className:"w-5 h-5"}),"Concluir"]}):e.jsxs(e.Fragment,{children:["Continuar",e.jsx(R,{className:"w-5 h-5"})]})}),a==="bairro"&&e.jsx("button",{onClick:()=>o("terms"),className:"w-full mt-3 py-2 text-sm text-muted-foreground hover:text-foreground transition-colors",children:"Pular por agora"})]})})}function oe(){const u=U(),i=z(),{setActiveTab:n}=$(),{isAuthenticated:g,user:a,needsOnboarding:o}=H(),[l,x]=r.useState(!1),{data:c=[]}=D({queryKey:["bairros"],queryFn:q.getAll,staleTime:1e3*60*60});r.useEffect(()=>{o()&&x(!0)},[g,a]);const d=()=>{x(!1)},m=(s=>s==="/"?"home":s.startsWith("/denuncia")||s.startsWith("/minhas-denuncias")?"reportar":s.startsWith("/forum")||s.startsWith("/topico")?"forum":s.startsWith("/agenda")||s.startsWith("/evento")?"agenda":s.startsWith("/telefones")||s.startsWith("/coleta-lixo")||s.startsWith("/pontos-turisticos")||s.startsWith("/ponto-turistico")||s.startsWith("/missas")||s.startsWith("/votacoes")||s.startsWith("/vereadores")||s.startsWith("/perfil")?"mais":"home")(u.pathname);r.useEffect(()=>{n(m)},[m,n]);const j=s=>{switch(s){case"home":i("/");break;case"reportar":i("/denuncias");break;case"forum":i("/forum");break;case"agenda":i("/agenda");break;case"mais":i("/mais");break}};return e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-muted/50",children:e.jsxs("div",{className:"relative w-full max-w-[420px] h-full bg-background overflow-hidden shadow-elevated",children:[e.jsx("div",{className:"absolute inset-0 overflow-y-auto scrollbar-hide pb-20",children:e.jsx(I,{})}),e.jsx(M,{activeTab:m,onTabChange:j}),e.jsx(_,{isOpen:l,onComplete:d,bairros:c})]})})}export{oe as default};
