import{r as n,j as e}from"./vendor-radix-CZ2RePwe.js";import{f as G,u as $,a as Z,p as L,d as f,i as J,m as W,r as ee,h as se,l as ae,X as V,B as te,Q as F}from"./index-BKTFz27l.js";import{B as N}from"./button-D2wuDMkr.js";import{I as re}from"./input-Dnb3YKlu.js";import{B as E}from"./badge-C6gq_Km6.js";import{T as le,a as ie,b as P}from"./tabs-C8NI3tAi.js";import{S as I,a as B,b as _,c as q,d as j}from"./select-Dlu-qym8.js";import{u as z}from"./vendor-query-CX3RJjg_.js";import"./sheet-Do4j_XGO.js";import{b as ne}from"./votes--jqTh9CK.js";import{v as M}from"./votes.service-BhxVJFkn.js";import{L as oe}from"./LoginPromptSheet-DLrUOjD5.js";import{m as h,A as Q}from"./vendor-motion-DKd-IkFU.js";import{C as K}from"./circle-x-DjRjilNE.js";import{H as ce}from"./heart-DY0xqdTN.js";import{M as de}from"./message-circle-ooHxRN8k.js";import{C as U}from"./clock-llOhz8mE.js";import"./textarea-Bd3g-uQA.js";import{A as me}from"./arrow-left-DtUytosD.js";import{S as Y}from"./search-04o261w-.js";import{U as H}from"./users-bgja7S3_.js";import{F as xe}from"./filter-F49yOQXQ.js";import"./vendor-utils-BtjSOnCr.js";import"./useHaptics-QdUZx3l_.js";import"./chevron-down-sBR43Dcq.js";import"./chevron-up-DDcm8tQG.js";import"./log-in-Ds58uFOd.js";import"./user-plus-CRC37I0v.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ue=G("ThumbsDown",[["path",{d:"M17 14V2",key:"8ymqnk"}],["path",{d:"M9 18.12 10 14H4.17a2 2 0 0 1-1.92-2.56l2.33-8A2 2 0 0 1 6.5 2H20a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2h-2.76a2 2 0 0 0-1.79 1.11L12 22a3.13 3.13 0 0 1-3-3.88Z",key:"m61m77"}]]);function he({counts:s}){const c=s.sim+s.nao+s.abstencao+s.naoVotou;if(c===0)return null;const b=s.sim/c*100,v=s.nao/c*100,x=(s.abstencao+s.naoVotou)/c*100;return e.jsxs("div",{className:"h-1.5 w-full rounded-full overflow-hidden bg-muted flex",children:[e.jsx(h.div,{initial:{width:0},animate:{width:`${b}%`},transition:{duration:.6,delay:.2},className:"h-full bg-green-500"}),e.jsx(h.div,{initial:{width:0},animate:{width:`${v}%`},transition:{duration:.6,delay:.3},className:"h-full bg-red-500"}),x>0&&e.jsx(h.div,{initial:{width:0},animate:{width:`${x}%`},transition:{duration:.6,delay:.4},className:"h-full bg-gray-300 dark:bg-gray-600"})]})}function pe({status:s}){switch(s){case"APROVADO":return e.jsx(J,{className:"w-3.5 h-3.5"});case"REJEITADO":return e.jsx(K,{className:"w-3.5 h-3.5"});case"EM_ANDAMENTO":return e.jsx(U,{className:"w-3.5 h-3.5"});case"ARQUIVADO":return e.jsx(U,{className:"w-3.5 h-3.5 text-gray-400"})}}function fe({vote:s,index:c=0}){const b=$(),{isAuthenticated:v}=Z(),x=ne[s.status],[d,m]=n.useState(s.likesCount||0),[i,u]=n.useState(s.dislikesCount||0),[l,p]=n.useState(s.userReaction||null),[R,S]=n.useState(!1),[w,y]=n.useState(!1),[O,g]=n.useState("like"),k=r=>new Date(r).toLocaleDateString("pt-BR",{day:"2-digit",month:"short",year:"numeric"}),A=()=>{b(`/votacoes/${s.id}`)},C=async r=>{if(!v){g("like"),y(!0);return}if(R)return;const o=l,T=d,D=i;o===r?(p(null),r==="like"?m(t=>Math.max(0,t-1)):u(t=>Math.max(0,t-1))):(p(r),r==="like"?(m(t=>t+1),o==="dislike"&&u(t=>Math.max(0,t-1))):(u(t=>t+1),o==="like"&&m(t=>Math.max(0,t-1)))),S(!0);try{const t=await M.toggleReaction(s.id,r);m(t.likes_count),u(t.dislikes_count),p(t.user_reaction)}catch{p(o),m(T),u(D),ee.error("Erro ao registrar reação")}finally{S(!1)}};return e.jsxs(e.Fragment,{children:[e.jsxs(h.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:c*.05},whileTap:{scale:.99},onClick:A,className:f("bg-card rounded-2xl p-4 border shadow-card","cursor-pointer transition-all duration-200","hover:shadow-md hover:border-border/80","active:shadow-sm"),children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-xs text-muted-foreground",children:[e.jsx(L,{className:"w-3.5 h-3.5"}),e.jsx("span",{children:k(s.date)})]}),e.jsxs(E,{className:f("gap-1 px-2 py-0.5 text-[10px] font-bold uppercase tracking-wider border",x.bgColor,x.textColor,x.borderColor),children:[e.jsx(pe,{status:s.status}),x.label]})]}),e.jsx("h3",{className:"text-lg font-bold text-foreground leading-tight mb-1.5 line-clamp-2",children:s.title}),e.jsx("p",{className:"text-sm text-muted-foreground leading-relaxed line-clamp-2 mb-4",children:s.summary}),e.jsxs("div",{className:"flex items-center gap-4 mb-3",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"flex items-center justify-center w-6 h-6 rounded-full bg-green-100 dark:bg-green-900/30",children:e.jsx(J,{className:"w-3 h-3 text-green-600 dark:text-green-400"})}),e.jsx("span",{className:"text-sm font-bold text-green-600 dark:text-green-400",children:s.counts.sim})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"flex items-center justify-center w-6 h-6 rounded-full bg-red-100 dark:bg-red-900/30",children:e.jsx(K,{className:"w-3 h-3 text-red-600 dark:text-red-400"})}),e.jsx("span",{className:"text-sm font-bold text-red-600 dark:text-red-400",children:s.counts.nao})]}),(s.counts.abstencao>0||s.counts.naoVotou>0)&&e.jsxs("span",{className:"text-xs text-muted-foreground",children:["+",s.counts.abstencao+s.counts.naoVotou," outros"]}),e.jsx("div",{className:"flex-1"}),e.jsxs("div",{className:"flex items-center gap-1 text-sm font-bold text-foreground",children:[e.jsx("span",{className:"text-green-600",children:s.counts.sim}),e.jsx("span",{className:"text-muted-foreground",children:"×"}),e.jsx("span",{className:"text-red-600",children:s.counts.nao})]})]}),e.jsx(he,{counts:s.counts}),e.jsxs("div",{className:"flex items-center justify-between mt-4 pt-3 border-t border-border/50",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(h.button,{whileTap:{scale:.9},onClick:r=>{r.stopPropagation(),C("like")},className:f("flex items-center gap-1.5 text-xs font-medium transition-colors",l==="like"?"text-primary":"text-muted-foreground hover:text-foreground"),children:[e.jsx(ce,{className:f("w-4 h-4",l==="like"&&"fill-current")}),e.jsx("span",{children:d})]}),e.jsxs(h.button,{whileTap:{scale:.9},onClick:r=>{r.stopPropagation(),C("dislike")},className:f("flex items-center gap-1.5 text-xs font-medium transition-colors",l==="dislike"?"text-red-500":"text-muted-foreground hover:text-foreground"),children:[e.jsx(ue,{className:f("w-4 h-4",l==="dislike"&&"fill-current")}),e.jsx("span",{children:i})]}),e.jsxs("div",{className:"flex items-center gap-1.5 text-xs font-medium text-muted-foreground ml-1",children:[e.jsx(de,{className:"w-4 h-4"}),e.jsx("span",{children:s.commentsCount||0})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("div",{className:"hidden sm:flex gap-1.5",children:s.tags.slice(0,1).map(r=>e.jsx("span",{className:"px-2 py-0.5 rounded-md bg-muted text-[10px] font-medium text-muted-foreground",children:r},r))}),e.jsxs(N,{variant:"ghost",size:"sm",className:"text-primary font-semibold gap-1 text-xs px-2 h-7",onClick:r=>{r.stopPropagation(),A()},children:["Ver detalhes",e.jsx(W,{className:"w-3.5 h-3.5"})]})]})]})]}),e.jsx(oe,{open:w,onClose:()=>y(!1),action:O})]})}function ge(){return e.jsx("div",{className:"space-y-4 animate-pulse",children:[...Array(4)].map((s,c)=>e.jsxs("div",{className:"bg-card rounded-2xl p-4 border",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"h-4 w-20 bg-muted rounded"}),e.jsx("div",{className:"h-5 w-16 bg-muted rounded-full"})]}),e.jsx("div",{className:"h-6 w-3/4 bg-muted rounded mb-2"}),e.jsx("div",{className:"h-4 w-full bg-muted rounded mb-1"}),e.jsx("div",{className:"h-4 w-2/3 bg-muted rounded mb-4"}),e.jsxs("div",{className:"flex gap-4 mb-3",children:[e.jsx("div",{className:"h-6 w-12 bg-muted rounded"}),e.jsx("div",{className:"h-6 w-12 bg-muted rounded"})]}),e.jsx("div",{className:"h-1.5 w-full bg-muted rounded-full"})]},c))})}function He(){const s=$();se();const{activeTab:c,setActiveTab:b}=ae(),[v,x]=n.useState("votacoes"),[d,m]=n.useState(""),[i,u]=n.useState("all"),[l,p]=n.useState("all"),[R,S]=n.useState("all"),[w,y]=n.useState(!1),{data:O,isLoading:g,error:k}=z({queryKey:F.votes.votacoes({status:i!=="all"?i:void 0,ano:l!=="all"?l:void 0,search:d||void 0}),queryFn:()=>M.getAll({status:i!=="all"?i:void 0,ano:l!=="all"?l:void 0,search:d||void 0,perPage:50}),staleTime:5*60*1e3}),{data:A}=z({queryKey:F.votes.anos,queryFn:()=>M.getAnos(),staleTime:60*60*1e3}),C=O?.data||[],r=A||[2026,2025],o=n.useMemo(()=>C.map(a=>({id:a.id,status:a.status,date:a.data,title:a.titulo,summary:a.subtitulo||"",counts:a.counts,tags:a.tags})),[C]),T=()=>{m(""),u("all"),p("all"),S("all"),y(!1)},D=a=>{b(a),s("/")},t=d||i!=="all"||l!=="all"||R!=="all";return e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-muted/50",children:e.jsxs("div",{className:"relative w-full max-w-[420px] h-full bg-background overflow-hidden shadow-elevated",children:[e.jsxs("div",{className:"h-full overflow-y-auto pb-24",children:[e.jsxs("header",{className:"sticky top-0 z-40 bg-background/95 backdrop-blur-xl border-b",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 safe-top",children:[e.jsx(N,{variant:"ghost",size:"icon",onClick:()=>s(-1),children:e.jsx(me,{className:"h-5 w-5"})}),e.jsx("h1",{className:"text-lg font-bold",children:"Câmara Municipal"}),e.jsx(N,{variant:"ghost",size:"icon",onClick:()=>y(!w),className:f(w&&"bg-primary/10 text-primary"),children:e.jsx(Y,{className:"h-5 w-5"})})]}),e.jsx("div",{className:"px-4 pb-3",children:e.jsx(le,{value:v,onValueChange:a=>{a==="vereadores"?s("/vereadores"):x(a)},children:e.jsxs(ie,{className:"w-full grid grid-cols-2",children:[e.jsxs(P,{value:"votacoes",className:"gap-2",children:[e.jsx(L,{className:"h-4 w-4"}),"Votações"]}),e.jsxs(P,{value:"vereadores",className:"gap-2",children:[e.jsx(H,{className:"h-4 w-4"}),"Vereadores"]})]})})})]}),e.jsxs("div",{className:"sticky top-28 z-30 bg-background/95 backdrop-blur-xl border-b px-4 py-3 space-y-3",children:[e.jsx(Q,{children:w&&e.jsx(h.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"overflow-hidden",children:e.jsxs("div",{className:"relative",children:[e.jsx(Y,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(re,{placeholder:"Buscar votação...",value:d,onChange:a=>m(a.target.value),className:"pl-10 pr-10",autoFocus:!0}),d&&e.jsx("button",{onClick:()=>m(""),className:"absolute right-3 top-1/2 -translate-y-1/2",children:e.jsx(V,{className:"h-4 w-4 text-muted-foreground hover:text-foreground"})})]})})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(xe,{className:"h-4 w-4 text-muted-foreground flex-shrink-0"}),e.jsxs(I,{value:i,onValueChange:a=>u(a),children:[e.jsx(B,{className:"flex-1 h-9 text-xs",children:e.jsx(_,{placeholder:"Status"})}),e.jsxs(q,{children:[e.jsx(j,{value:"all",children:"Todos"}),e.jsx(j,{value:"APROVADO",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-green-500"}),"Aprovados"]})}),e.jsx(j,{value:"REJEITADO",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-red-500"}),"Rejeitados"]})}),e.jsx(j,{value:"EM_ANDAMENTO",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-blue-500"}),"Em Andamento"]})})]})]}),e.jsxs(I,{value:l.toString(),onValueChange:a=>p(a==="all"?"all":parseInt(a)),children:[e.jsx(B,{className:"w-24 h-9 text-xs",children:e.jsx(_,{placeholder:"Ano"})}),e.jsxs(q,{children:[e.jsx(j,{value:"all",children:"Todos"}),r.map(a=>e.jsx(j,{value:a.toString(),children:a},a))]})]})]}),t&&e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[i!=="all"&&e.jsxs(E,{variant:"secondary",className:"gap-1 text-xs",children:[i==="APROVADO"&&"Aprovados",i==="REJEITADO"&&"Rejeitados",i==="EM_ANDAMENTO"&&"Em Andamento",e.jsx(V,{className:"h-3 w-3 cursor-pointer",onClick:()=>u("all")})]}),l!=="all"&&e.jsxs(E,{variant:"secondary",className:"gap-1 text-xs",children:[l,e.jsx(V,{className:"h-3 w-3 cursor-pointer",onClick:()=>p("all")})]}),d&&e.jsxs(E,{variant:"secondary",className:"gap-1 text-xs",children:['"',d,'"',e.jsx(V,{className:"h-3 w-3 cursor-pointer",onClick:()=>m("")})]}),e.jsx("button",{onClick:T,className:"text-xs text-primary font-medium ml-auto",children:"Limpar tudo"})]})]}),e.jsxs("main",{className:"px-4 py-5",children:[!g&&o.length>0&&e.jsx(h.div,{initial:{opacity:0},animate:{opacity:1},className:"flex items-center justify-between mb-4",children:e.jsxs("span",{className:"text-sm text-muted-foreground",children:[o.length," ",o.length===1?"votação":"votações"]})}),g&&e.jsx(ge,{}),k&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx("p",{className:"text-muted-foreground",children:"Erro ao carregar votações"}),e.jsx(N,{variant:"outline",size:"sm",className:"mt-4",onClick:()=>window.location.reload(),children:"Tentar novamente"})]}),!g&&!k&&o.length===0&&e.jsxs("div",{className:"flex flex-col items-center justify-center py-16 text-center",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-muted flex items-center justify-center mb-4",children:e.jsx(L,{className:"h-8 w-8 text-muted-foreground"})}),e.jsx("p",{className:"font-medium text-foreground mb-1",children:"Nenhuma votação encontrada"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:t?"Tente ajustar os filtros de busca":"As votações aparecerão aqui quando forem registradas"}),t&&e.jsx(N,{variant:"outline",size:"sm",onClick:T,children:"Limpar filtros"}),e.jsx("div",{className:"mt-6 pt-6 border-t w-full",children:e.jsxs(N,{variant:"default",className:"w-full gap-2",onClick:()=>s("/vereadores"),children:[e.jsx(H,{className:"h-4 w-4"}),"Ver Vereadores"]})})]}),!g&&!k&&o.length>0&&e.jsx(Q,{mode:"popLayout",children:e.jsx(h.div,{layout:!0,className:"space-y-4 pb-8",children:o.map((a,X)=>e.jsx(fe,{vote:a,index:X},a.id))})})]})]}),e.jsx(te,{activeTab:c,onTabChange:D})]})})}export{He as default};
