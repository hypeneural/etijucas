import{r as n,j as e}from"./vendor-radix-BJ0nhWns.js";import{M as K,T as Q,a as N,L as z,b as S,u as J}from"./TileLayer-D_ciiP12.js";import{B as c}from"./button-CPNhRLs3.js";import{B as H}from"./badge-zsPUXta5.js";import{D as X,a as Y,b as ee,c as ae,e as se}from"./drawer-CZmHbC1F.js";import{u as te}from"./vendor-query-B7pQ-O4A.js";import{b as re,u as ie,i as h,c as y,R as oe,B as ne}from"./index-2hiNaDXu.js";import{C as le}from"./CategoryIcon-Df0izeKD.js";import{A as ce}from"./arrow-left-DYSEMYmm.js";import{L as V}from"./loader-circle-Bk0nGNmh.js";import{m as p,A as de}from"./vendor-motion-Clpc6Aj5.js";import{P as me}from"./plus-DLm4vneQ.js";import{M as ue}from"./map-pin-DqsHNiCV.js";import{C as xe}from"./clock-B-qgP-WO.js";import{I as he}from"./image-CWrf5HbP.js";import{F as pe}from"./file-text-DcLCGPB_.js";import{C as fe}from"./chevron-right-DmGxfkeM.js";import{N as ge}from"./navigation-kDmML2NC.js";import{S as be}from"./share-2-oHLqC0sp.js";import{f as je,h as we}from"./vendor-utils-BJCrkUEm.js";import{p as L}from"./pt-BR-PvI1CkN7.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ye=re("Crosshair",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"22",x2:"18",y1:"12",y2:"12",key:"l9bcsi"}],["line",{x1:"6",x2:"2",y1:"12",y2:"12",key:"13hhkx"}],["line",{x1:"12",x2:"12",y1:"6",y2:"2",key:"10w3f3"}],["line",{x1:"12",x2:"12",y1:"22",y2:"18",key:"15g9kq"}]]),k={recebido:{label:"Recebido",color:"#3b82f6",bgClass:"bg-blue-100 text-blue-700 dark:bg-blue-900/50 dark:text-blue-300"},em_analise:{label:"Em Análise",color:"#f59e0b",bgClass:"bg-amber-100 text-amber-700 dark:bg-amber-900/50 dark:text-amber-300"},resolvido:{label:"Resolvido",color:"#10b981",bgClass:"bg-green-100 text-green-700 dark:bg-green-900/50 dark:text-green-300"},rejeitado:{label:"Rejeitado",color:"#ef4444",bgClass:"bg-red-100 text-red-700 dark:bg-red-900/50 dark:text-red-300"}},M={"mdi:road-variant":"M7 4V2H17V4H19V6H17V8H22V11.3L20.3 20H3.7L2 11.3V8H7V6H5V4H7M9 7V4H15V7L12 11L9 7M4.6 10L6 17H18L19.4 10H4.6Z","mdi:lightbulb-on-outline":"M12 6C8.69 6 6 8.69 6 12C6 14.22 7.21 16.15 9 17.19V19C9 19.55 9.45 20 10 20H14C14.55 20 15 19.55 15 19V17.19C16.79 16.15 18 14.22 18 12C18 8.69 15.31 6 12 6M14.5 15H9.5V14L12 12L14.5 14V15M12 8C14.21 8 16 9.79 16 12C16 13.5 15.2 14.77 14 15.46V16H10V15.46C8.8 14.77 8 13.5 8 12C8 9.79 9.79 8 12 8Z","mdi:trash-can-outline":"M9 3V4H4V6H5V19C5 20.1 5.9 21 7 21H17C18.1 21 19 20.1 19 19V6H20V4H15V3H9M7 6H17V19H7V6M9 8V17H11V8H9M13 8V17H15V8H13Z","mdi:walk":"M14.12 10H19V8.2H15.38L13.38 4.87C13.08 4.37 12.54 4 11.92 4C11.74 4 11.58 4.04 11.42 4.08L6 5.8V11H7.8V7.33L9.91 6.67L6 22H7.8L10.67 13.89L13 17V22H14.8V15.59L12.31 11.05L13.04 8.18L14.12 10M14 3.8C15 3.8 15.8 3 15.8 2C15.8 1 15 .2 14 .2C13 .2 12.2 1 12.2 2C12.2 3 13 3.8 14 3.8Z","mdi:tree":"M11 21V15H6L11 3H13L18 15H13V21H11Z","mdi:pipe":"M22 14V16H20V14H16V16H14V14H10V16H8V14H4V16H2V14C2 12.9 2.9 12 4 12H8V10C8 8.9 8.9 8 10 8H14C15.1 8 16 8.9 16 10V12H20C21.1 12 22 12.9 22 14Z","mdi:parking":"M13 3H6V21H9V14H13C16.31 14 19 11.31 19 8S16.31 3 13 3M13 11H9V6H13C14.65 6 16 7.35 16 9S14.65 11 13 11Z","mdi:volume-high":"M14 3.23V5.29C16.89 6.15 19 8.83 19 12C19 15.17 16.89 17.84 14 18.7V20.77C18 19.86 21 16.28 21 12C21 7.72 18 4.14 14 3.23M16.5 12C16.5 10.23 15.5 8.71 14 7.97V16C15.5 15.29 16.5 13.76 16.5 12M3 9V15H7L12 20V4L7 9H3Z","mdi:dots-horizontal":"M16 12C16 10.9 16.9 10 18 10S20 10.9 20 12 19.1 14 18 14 16 13.1 16 12M10 12C10 10.9 10.9 10 12 10S14 10.9 14 12 13.1 14 12 14 10 13.1 10 12M4 12C4 10.9 4.9 10 6 10S8 10.9 8 12 7.1 14 6 14 4 13.1 4 12Z"};function ke(i){return M[i]||M["mdi:dots-horizontal"]}function Ce(i,r,o=!1){const t=o?56:48,f=ke(i),s=`
        <div class="marker-pin ${o?"marker-selected":""}" style="
            width: ${t}px;
            height: ${t}px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: ${r};
            border-radius: 50%;
            border: 3px solid white;
            box-shadow: 0 4px 16px rgba(0,0,0,0.35);
            transform: ${o?"scale(1.15)":"scale(1)"};
            transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        ">
            <svg viewBox="0 0 24 24" width="${t*.5}" height="${t*.5}" fill="white">
                <path d="${f}" />
            </svg>
        </div>
    `;return z.divIcon({html:s,className:"custom-marker-wrapper",iconSize:[t,t],iconAnchor:[t/2,t/2]})}function ve({onBoundsChange:i,onZoomChange:r}){const o=S();return n.useEffect(()=>{const t=o.getBounds();i({minLat:t.getSouth(),minLon:t.getWest(),maxLat:t.getNorth(),maxLon:t.getEast()}),r(o.getZoom())},[o,i,r]),J({moveend:()=>{const t=o.getBounds();i({minLat:t.getSouth(),minLon:t.getWest(),maxLat:t.getNorth(),maxLon:t.getEast()}),r(o.getZoom())},zoomend:()=>{r(o.getZoom())}}),null}function Ne({lat:i,lon:r}){const o=S();return n.useEffect(()=>{i&&r&&o.flyTo([i,r],16,{duration:1.2})},[i,r,o]),null}function Ge(){const i=ie(),[r,o]=n.useState(null),[t,f]=n.useState(14),[s,$]=n.useState(null),[D,C]=n.useState(!1),[g,R]=n.useState(null),[b,T]=n.useState(null),[v,j]=n.useState(!1),[m,B]=n.useState([]),I=[-27.2381,-48.6356],x=r?`${r.minLat},${r.minLon},${r.maxLat},${r.maxLon}`:null,Z=n.useCallback(a=>{o(a)},[]),A=n.useCallback(a=>{f(a)},[]),{data:P,isLoading:E,refetch:F,isFetching:w}=te({queryKey:["reports","map",x,t,m],queryFn:async()=>{const a=new URLSearchParams;x&&a.set("bbox",x),a.set("zoom",String(t)),a.set("limit","300"),m.length&&a.set("status",m.join(","));const l=await fetch(`/api/v1/reports/map?${a.toString()}`);if(!l.ok)throw new Error("Failed to fetch");return l.json()},enabled:!!x,staleTime:30*1e3,refetchOnWindowFocus:!1}),u=P?.reports||[],O=n.useCallback(()=>{if(!navigator.geolocation){h.error("Geolocalização não suportada");return}j(!0),navigator.geolocation.getCurrentPosition(a=>{const{latitude:l,longitude:d}=a.coords;T({lat:l,lon:d}),R({lat:l,lon:d}),j(!1),h.success("Localização encontrada!")},()=>{j(!1),h.error("Não foi possível obter sua localização")},{enableHighAccuracy:!0,timeout:1e4})},[]),U=n.useCallback(a=>{$(a),C(!0)},[]),q=()=>{s&&i(`/denuncia/${s.id}`)},W=async()=>{if(!s)return;const a=`${window.location.origin}/denuncia/${s.id}`;if(navigator.share)try{await navigator.share({title:s.title,url:a})}catch{}else await navigator.clipboard.writeText(a),h.success("Link copiado!")},G=()=>{if(!s)return;const a=`https://www.google.com/maps/dir/?api=1&destination=${s.lat},${s.lon}`;window.open(a,"_blank")};return e.jsxs("div",{className:"fixed inset-0 flex flex-col bg-background",children:[e.jsx("header",{className:"safe-top bg-white/95 dark:bg-slate-900/95 backdrop-blur-md border-b z-50 shrink-0",children:e.jsxs("div",{className:"flex items-center justify-between px-3 py-2.5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(c,{variant:"ghost",size:"icon",onClick:()=>i(-1),className:"shrink-0 -ml-1",children:e.jsx(ce,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"font-bold text-lg leading-tight",children:"Mapa de Denúncias"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:w?"Atualizando...":`${u.length} denúncia${u.length!==1?"s":""} visível${u.length!==1?"eis":""}`})]})]}),e.jsx("div",{className:"flex items-center gap-1",children:e.jsx(c,{variant:"ghost",size:"icon",onClick:O,disabled:v,className:"relative",children:v?e.jsx(V,{className:"w-5 h-5 animate-spin"}):e.jsx(ye,{className:"w-5 h-5"})})})]})}),e.jsxs("div",{className:"flex-1 relative",children:[e.jsxs(K,{center:I,zoom:14,className:"w-full h-full z-0",zoomControl:!1,children:[e.jsx(Q,{attribution:'© <a href="https://www.openstreetmap.org/copyright">OSM</a>',url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),e.jsx(ve,{onBoundsChange:Z,onZoomChange:A}),g&&e.jsx(Ne,{lat:g.lat,lon:g.lon}),u.map(a=>e.jsx(N,{position:[a.lat,a.lon],icon:Ce(a.category?.icon||"mdi:dots-horizontal",a.category?.color||"#64748b",s?.id===a.id),eventHandlers:{click:()=>U(a)}},a.id)),b&&e.jsx(N,{position:[b.lat,b.lon],icon:z.divIcon({html:`
                                    <div class="user-location-marker">
                                        <div class="pulse-ring"></div>
                                        <div class="center-dot"></div>
                                    </div>
                                `,className:"user-marker-wrapper",iconSize:[24,24],iconAnchor:[12,12]})})]}),e.jsx(p.button,{initial:{scale:0,opacity:0},animate:{scale:1,opacity:1},transition:{delay:.3,type:"spring",stiffness:200},whileTap:{scale:.9},onClick:()=>i("/denuncia/nova"),className:"absolute bottom-24 right-4 z-20 w-14 h-14 rounded-full bg-primary text-primary-foreground shadow-xl flex items-center justify-center",children:e.jsx(me,{className:"w-7 h-7"})}),e.jsx(de,{children:E&&!u.length&&e.jsx(p.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"absolute inset-0 bg-background/60 backdrop-blur-sm flex items-center justify-center z-10",children:e.jsxs("div",{className:"flex flex-col items-center gap-3 p-6 bg-card rounded-2xl shadow-lg",children:[e.jsx(V,{className:"w-10 h-10 animate-spin text-primary"}),e.jsx("span",{className:"text-sm font-medium",children:"Carregando denúncias..."})]})})})]}),e.jsxs("div",{className:"shrink-0 bg-white/95 dark:bg-slate-900/95 backdrop-blur-md border-t px-3 py-2.5 flex gap-2 overflow-x-auto z-10",children:[Object.entries(k).map(([a,l])=>e.jsx(c,{variant:m.includes(a)?"default":"outline",size:"sm",className:y("shrink-0 rounded-full font-medium transition-all",m.includes(a)&&"shadow-md"),onClick:()=>{B(d=>d.includes(a)?d.filter(_=>_!==a):[...d,a])},children:l.label},a)),e.jsx(c,{variant:"outline",size:"sm",className:"shrink-0 rounded-full ml-auto",onClick:()=>F(),disabled:w,children:e.jsx(oe,{className:y("w-4 h-4",w&&"animate-spin")})})]}),e.jsx(ne,{}),e.jsx(X,{open:D,onOpenChange:C,children:e.jsxs(Y,{className:"max-h-[85vh]",children:[e.jsxs(ee,{className:"pb-2",children:[e.jsx(ae,{className:"sr-only",children:"Detalhes da Denúncia"}),e.jsx(se,{className:"sr-only",children:"Preview da denúncia selecionada no mapa"})]}),s&&e.jsxs("div",{className:"px-4 pb-6 space-y-4 overflow-y-auto",children:[e.jsxs("div",{className:"flex gap-4",children:[s.thumbUrl?e.jsx(p.img,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},src:s.thumbUrl,alt:"",className:"w-24 h-24 rounded-2xl object-cover bg-muted shrink-0 shadow-md"}):e.jsx(p.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"w-24 h-24 rounded-2xl shrink-0 flex items-center justify-center shadow-md",style:{backgroundColor:`${s.category?.color||"#64748b"}20`},children:e.jsx(le,{icon:s.category?.icon||"mdi:dots-horizontal",color:s.category?.color||"#64748b",size:"xl"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-bold text-xl leading-tight line-clamp-2",children:s.title}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 mt-2",children:[e.jsx(H,{className:y(k[s.status]?.bgClass,"font-medium"),children:k[s.status]?.label}),e.jsx(H,{variant:"outline",className:"font-medium",children:s.category?.name||"Outros"})]})]})]}),e.jsxs("div",{className:"bg-muted/50 rounded-2xl p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-9 h-9 rounded-full bg-primary/10 flex items-center justify-center shrink-0",children:e.jsx(ue,{className:"w-4 h-4 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground uppercase font-medium",children:"Localização"}),e.jsx("p",{className:"text-sm font-medium",children:s.addressShort||"Tijucas, SC"})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-9 h-9 rounded-full bg-primary/10 flex items-center justify-center shrink-0",children:e.jsx(xe,{className:"w-4 h-4 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground uppercase font-medium",children:"Data"}),e.jsxs("p",{className:"text-sm font-medium",children:[je(new Date(s.createdAt),"d 'de' MMMM 'de' yyyy",{locale:L}),e.jsx("span",{className:"text-muted-foreground",children:" • "}),we(new Date(s.createdAt),{addSuffix:!0,locale:L})]})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-9 h-9 rounded-full bg-primary/10 flex items-center justify-center shrink-0",children:e.jsx(he,{className:"w-4 h-4 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground uppercase font-medium",children:"Mídia"}),e.jsx("p",{className:"text-sm font-medium",children:s.thumbUrl?"Com foto anexada":"Sem foto"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(c,{onClick:q,className:"w-full h-12 text-base font-semibold shadow-md",size:"lg",children:[e.jsx(pe,{className:"w-5 h-5 mr-2"}),"Ver Detalhes Completos",e.jsx(fe,{className:"w-5 h-5 ml-auto"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs(c,{variant:"outline",onClick:G,className:"h-11",children:[e.jsx(ge,{className:"w-4 h-4 mr-2"}),"Rotas"]}),e.jsxs(c,{variant:"outline",onClick:W,className:"h-11",children:[e.jsx(be,{className:"w-4 h-4 mr-2"}),"Compartilhar"]})]})]})]})]})}),e.jsx("style",{children:`
                .custom-marker-wrapper {
                    background: transparent !important;
                    border: none !important;
                }
                .marker-pin {
                    animation: marker-pop-in 0.4s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
                }
                @keyframes marker-pop-in {
                    0% { transform: scale(0); opacity: 0; }
                    100% { transform: scale(1); opacity: 1; }
                }
                .marker-selected {
                    animation: marker-pulse 1.5s infinite;
                }
                @keyframes marker-pulse {
                    0%, 100% { box-shadow: 0 4px 16px rgba(0,0,0,0.35); }
                    50% { box-shadow: 0 4px 24px rgba(0,0,0,0.5), 0 0 0 8px rgba(0,0,0,0.1); }
                }
                .user-marker-wrapper {
                    background: transparent !important;
                    border: none !important;
                }
                .user-location-marker {
                    position: relative;
                    width: 24px;
                    height: 24px;
                }
                .user-location-marker .center-dot {
                    position: absolute;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    width: 14px;
                    height: 14px;
                    background: #3b82f6;
                    border: 3px solid white;
                    border-radius: 50%;
                    box-shadow: 0 2px 8px rgba(0,0,0,0.3);
                }
                .user-location-marker .pulse-ring {
                    position: absolute;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    width: 40px;
                    height: 40px;
                    background: rgba(59, 130, 246, 0.25);
                    border-radius: 50%;
                    animation: pulse-ring 2s infinite;
                }
                @keyframes pulse-ring {
                    0% { transform: translate(-50%, -50%) scale(0.5); opacity: 1; }
                    100% { transform: translate(-50%, -50%) scale(1.5); opacity: 0; }
                }
                .leaflet-container {
                    font-family: inherit;
                }
            `})]})}export{Ge as default};
