import{aR as le,aQ as Ae,r as m,aS as we,a as ze,j as e,m as p,y as Ne,X as U,bI as Fe,aJ as Le,M as P,b0 as De,ah as te,l as se,ax as Re,O as _e,ay as $e,aY as Be,a6 as $,W as Pe,bJ as qe,o as Ce,ak as We,a8 as Ve,a9 as He,x as Qe,$ as Ue,b4 as Ke,ar as Ye,bf as Je,bK as Xe,ao as Ge,bz as Ze,bL as me,aI as et,K as tt,bv as st}from"./vendor-app-D_TKIhWN.js";import{h as K,z as D,C as ae,g as Q,c as G,B,a as at,f as it,u as rt}from"./index-VRsxssQE.js";import{u as nt}from"./useAppStore-6ZfJQqLI.js";import{t as ce,f as ot,a as lt,u as ct,c as he}from"./useUploadImage-Dgc_3b-C.js";import{I as ke}from"./input-ugHGt1PF.js";import{S as ie,a as re,b as ne,c as oe,d as R}from"./select-DuHwkYqJ.js";import{u as Se,a as dt}from"./useBairros-CJzxzXug.js";import{B as ut}from"./badge-EKTSM7S_.js";import{S as mt,a as ht,b as ft,c as xt}from"./sheet-B3cPoRbN.js";import{T as gt}from"./textarea-DR9tNPpy.js";import{S as pt}from"./switch-BoZYw0lk.js";import"./dropdown-menu-DCPwlUqr.js";import"./bairros-Cf5Z_oCw.js";import"./bairro.service-B8kD42uh.js";const F=["offline","topics"];function bt(i){const{isOnline:o}=K(),t=le(),a=Ae({queryKey:[...F,i],queryFn:async()=>{let s=await D.getAll();if(o)try{const r=await ce.getAll({categoria:i?.categoria!=="all"?i?.categoria:void 0,search:i?.search});r.data&&r.data.length>0&&(await D.saveMany(r.data),s=r.data)}catch(r){console.warn("[useOfflineTopics] API failed, using cache:",r)}if(i?.categoria&&i.categoria!=="all"&&(s=s.filter(r=>r.categoria===i.categoria)),i?.search){const r=i.search.toLowerCase();s=s.filter(n=>n.titulo.toLowerCase().includes(r)||n.texto.toLowerCase().includes(r))}return s.sort((r,n)=>new Date(n.createdAt).getTime()-new Date(r.createdAt).getTime())},staleTime:1e3*60*2,gcTime:1e3*60*60*24});return m.useEffect(()=>{o&&t.invalidateQueries({queryKey:F})},[o,t]),a}function vt(){const i=le(),{isOnline:o}=K();return we({mutationFn:async t=>{if(console.log("[useCreateOfflineTopic] Creating topic, online:",o,"bairroId:",t.bairroId),!o){const a={id:`temp-${Date.now()}-${Math.random().toString(36).slice(2)}`,titulo:t.titulo,texto:t.texto,categoria:t.categoria,bairroId:t.bairroId,fotoUrl:t.fotoUrl,isAnon:t.isAnon??!1,autorNome:t.isAnon?"An√¥nimo":"Voc√™",likesCount:0,commentsCount:0,liked:!1,createdAt:new Date};return await D.save(a),await ae.add({type:"topic",data:t,idempotencyKey:`topic-${a.id}`}),Q.info("üì¥ T√≥pico salvo offline. Ser√° enviado quando voltar online."),a}try{const a=await ce.create(t);return Q.success("‚úÖ T√≥pico publicado com sucesso!"),a}catch(a){const s=a instanceof Error?a.message:"Erro desconhecido";throw console.error("[useCreateOfflineTopic] Failed:",s),Q.error(`‚ùå Falha ao publicar: ${s}`),a}},onSuccess:()=>{i.invalidateQueries({queryKey:F})}})}function yt(){const i=le(),{isOnline:o}=K();return we({onMutate:async({id:t,currentlyLiked:a})=>{await i.cancelQueries({queryKey:F});const s=i.getQueryData(F);i.setQueryData(F,n=>n&&n.map(l=>l.id===t?{...l,liked:!a,likesCount:a?Math.max(0,l.likesCount-1):l.likesCount+1}:l));const r=await D.getById(t);if(r){const n={...r,liked:!a,likesCount:a?Math.max(0,r.likesCount-1):r.likesCount+1};await D.save(n)}return{previousTopics:s,topicId:t}},mutationFn:async({id:t,currentlyLiked:a})=>{if(o)try{const s=await ce.toggleLike(t),r=await D.getById(t);return r&&await D.save({...r,liked:s.liked,likesCount:s.likesCount}),{id:t,newLiked:s.liked,likesCount:s.likesCount}}catch(s){console.error("[useLikeOfflineTopic] API failed:",s),await ae.add({type:"like",data:{topicId:t},idempotencyKey:`like-${t}-${Date.now()}`})}else await ae.add({type:"like",data:{topicId:t},idempotencyKey:`like-${t}-${Date.now()}`});return{id:t,newLiked:!a}},onError:(t,a,s)=>{s?.previousTopics&&i.setQueryData(F,s.previousTopics)},onSettled:()=>{setTimeout(()=>{i.invalidateQueries({queryKey:F})},500)}})}function _(i,o,t){let a=t.initialDeps??[],s,r=!0;function n(){var l,d,x;let c;t.key&&((l=t.debug)!=null&&l.call(t))&&(c=Date.now());const v=i();if(!(v.length!==a.length||v.some((N,g)=>a[g]!==N)))return s;a=v;let j;if(t.key&&((d=t.debug)!=null&&d.call(t))&&(j=Date.now()),s=o(...v),t.key&&((x=t.debug)!=null&&x.call(t))){const N=Math.round((Date.now()-c)*100)/100,g=Math.round((Date.now()-j)*100)/100,w=g/16,y=(C,O)=>{for(C=String(C);C.length<O;)C=" "+C;return C};console.info(`%c‚è± ${y(g,5)} /${y(N,5)} ms`,`
            font-size: .6rem;
            font-weight: bold;
            color: hsl(${Math.max(0,Math.min(120-120*w,120))}deg 100% 31%);`,t?.key)}return t?.onChange&&!(r&&t.skipInitialOnChange)&&t.onChange(s),r=!1,s}return n.updateDeps=l=>{a=l},n}function fe(i,o){if(i===void 0)throw new Error("Unexpected undefined");return i}const jt=(i,o)=>Math.abs(i-o)<1.01,wt=(i,o,t)=>{let a;return function(...s){i.clearTimeout(a),a=i.setTimeout(()=>o.apply(this,s),t)}},xe=i=>{const{offsetWidth:o,offsetHeight:t}=i;return{width:o,height:t}},Nt=i=>i,Ct=i=>{const o=Math.max(i.startIndex-i.overscan,0),t=Math.min(i.endIndex+i.overscan,i.count-1),a=[];for(let s=o;s<=t;s++)a.push(s);return a},kt=(i,o)=>{const t=i.scrollElement;if(!t)return;const a=i.targetWindow;if(!a)return;const s=n=>{const{width:l,height:d}=n;o({width:Math.round(l),height:Math.round(d)})};if(s(xe(t)),!a.ResizeObserver)return()=>{};const r=new a.ResizeObserver(n=>{const l=()=>{const d=n[0];if(d?.borderBoxSize){const x=d.borderBoxSize[0];if(x){s({width:x.inlineSize,height:x.blockSize});return}}s(xe(t))};i.options.useAnimationFrameWithResizeObserver?requestAnimationFrame(l):l()});return r.observe(t,{box:"border-box"}),()=>{r.unobserve(t)}},ge={passive:!0},pe=typeof window>"u"?!0:"onscrollend"in window,St=(i,o)=>{const t=i.scrollElement;if(!t)return;const a=i.targetWindow;if(!a)return;let s=0;const r=i.options.useScrollendEvent&&pe?()=>{}:wt(a,()=>{o(s,!1)},i.options.isScrollingResetDelay),n=c=>()=>{const{horizontal:v,isRtl:h}=i.options;s=v?t.scrollLeft*(h&&-1||1):t.scrollTop,r(),o(s,c)},l=n(!0),d=n(!1);t.addEventListener("scroll",l,ge);const x=i.options.useScrollendEvent&&pe;return x&&t.addEventListener("scrollend",d,ge),()=>{t.removeEventListener("scroll",l),x&&t.removeEventListener("scrollend",d)}},Et=(i,o,t)=>{if(o?.borderBoxSize){const a=o.borderBoxSize[0];if(a)return Math.round(a[t.options.horizontal?"inlineSize":"blockSize"])}return i[t.options.horizontal?"offsetWidth":"offsetHeight"]},It=(i,{adjustments:o=0,behavior:t},a)=>{var s,r;const n=i+o;(r=(s=a.scrollElement)==null?void 0:s.scrollTo)==null||r.call(s,{[a.options.horizontal?"left":"top"]:n,behavior:t})};class Tt{constructor(o){this.unsubs=[],this.scrollElement=null,this.targetWindow=null,this.isScrolling=!1,this.currentScrollToIndex=null,this.measurementsCache=[],this.itemSizeCache=new Map,this.laneAssignments=new Map,this.pendingMeasuredCacheIndexes=[],this.prevLanes=void 0,this.lanesChangedFlag=!1,this.lanesSettling=!1,this.scrollRect=null,this.scrollOffset=null,this.scrollDirection=null,this.scrollAdjustments=0,this.elementsCache=new Map,this.observer=(()=>{let t=null;const a=()=>t||(!this.targetWindow||!this.targetWindow.ResizeObserver?null:t=new this.targetWindow.ResizeObserver(s=>{s.forEach(r=>{const n=()=>{this._measureElement(r.target,r)};this.options.useAnimationFrameWithResizeObserver?requestAnimationFrame(n):n()})}));return{disconnect:()=>{var s;(s=a())==null||s.disconnect(),t=null},observe:s=>{var r;return(r=a())==null?void 0:r.observe(s,{box:"border-box"})},unobserve:s=>{var r;return(r=a())==null?void 0:r.unobserve(s)}}})(),this.range=null,this.setOptions=t=>{Object.entries(t).forEach(([a,s])=>{typeof s>"u"&&delete t[a]}),this.options={debug:!1,initialOffset:0,overscan:1,paddingStart:0,paddingEnd:0,scrollPaddingStart:0,scrollPaddingEnd:0,horizontal:!1,getItemKey:Nt,rangeExtractor:Ct,onChange:()=>{},measureElement:Et,initialRect:{width:0,height:0},scrollMargin:0,gap:0,indexAttribute:"data-index",initialMeasurementsCache:[],lanes:1,isScrollingResetDelay:150,enabled:!0,isRtl:!1,useScrollendEvent:!1,useAnimationFrameWithResizeObserver:!1,...t}},this.notify=t=>{var a,s;(s=(a=this.options).onChange)==null||s.call(a,this,t)},this.maybeNotify=_(()=>(this.calculateRange(),[this.isScrolling,this.range?this.range.startIndex:null,this.range?this.range.endIndex:null]),t=>{this.notify(t)},{key:!1,debug:()=>this.options.debug,initialDeps:[this.isScrolling,this.range?this.range.startIndex:null,this.range?this.range.endIndex:null]}),this.cleanup=()=>{this.unsubs.filter(Boolean).forEach(t=>t()),this.unsubs=[],this.observer.disconnect(),this.scrollElement=null,this.targetWindow=null},this._didMount=()=>()=>{this.cleanup()},this._willUpdate=()=>{var t;const a=this.options.enabled?this.options.getScrollElement():null;if(this.scrollElement!==a){if(this.cleanup(),!a){this.maybeNotify();return}this.scrollElement=a,this.scrollElement&&"ownerDocument"in this.scrollElement?this.targetWindow=this.scrollElement.ownerDocument.defaultView:this.targetWindow=((t=this.scrollElement)==null?void 0:t.window)??null,this.elementsCache.forEach(s=>{this.observer.observe(s)}),this.unsubs.push(this.options.observeElementRect(this,s=>{this.scrollRect=s,this.maybeNotify()})),this.unsubs.push(this.options.observeElementOffset(this,(s,r)=>{this.scrollAdjustments=0,this.scrollDirection=r?this.getScrollOffset()<s?"forward":"backward":null,this.scrollOffset=s,this.isScrolling=r,this.maybeNotify()})),this._scrollToOffset(this.getScrollOffset(),{adjustments:void 0,behavior:void 0})}},this.getSize=()=>this.options.enabled?(this.scrollRect=this.scrollRect??this.options.initialRect,this.scrollRect[this.options.horizontal?"width":"height"]):(this.scrollRect=null,0),this.getScrollOffset=()=>this.options.enabled?(this.scrollOffset=this.scrollOffset??(typeof this.options.initialOffset=="function"?this.options.initialOffset():this.options.initialOffset),this.scrollOffset):(this.scrollOffset=null,0),this.getFurthestMeasurement=(t,a)=>{const s=new Map,r=new Map;for(let n=a-1;n>=0;n--){const l=t[n];if(s.has(l.lane))continue;const d=r.get(l.lane);if(d==null||l.end>d.end?r.set(l.lane,l):l.end<d.end&&s.set(l.lane,!0),s.size===this.options.lanes)break}return r.size===this.options.lanes?Array.from(r.values()).sort((n,l)=>n.end===l.end?n.index-l.index:n.end-l.end)[0]:void 0},this.getMeasurementOptions=_(()=>[this.options.count,this.options.paddingStart,this.options.scrollMargin,this.options.getItemKey,this.options.enabled,this.options.lanes],(t,a,s,r,n,l)=>(this.prevLanes!==void 0&&this.prevLanes!==l&&(this.lanesChangedFlag=!0),this.prevLanes=l,this.pendingMeasuredCacheIndexes=[],{count:t,paddingStart:a,scrollMargin:s,getItemKey:r,enabled:n,lanes:l}),{key:!1}),this.getMeasurements=_(()=>[this.getMeasurementOptions(),this.itemSizeCache],({count:t,paddingStart:a,scrollMargin:s,getItemKey:r,enabled:n,lanes:l},d)=>{if(!n)return this.measurementsCache=[],this.itemSizeCache.clear(),this.laneAssignments.clear(),[];if(this.laneAssignments.size>t)for(const h of this.laneAssignments.keys())h>=t&&this.laneAssignments.delete(h);this.lanesChangedFlag&&(this.lanesChangedFlag=!1,this.lanesSettling=!0,this.measurementsCache=[],this.itemSizeCache.clear(),this.laneAssignments.clear(),this.pendingMeasuredCacheIndexes=[]),this.measurementsCache.length===0&&!this.lanesSettling&&(this.measurementsCache=this.options.initialMeasurementsCache,this.measurementsCache.forEach(h=>{this.itemSizeCache.set(h.key,h.size)}));const x=this.lanesSettling?0:this.pendingMeasuredCacheIndexes.length>0?Math.min(...this.pendingMeasuredCacheIndexes):0;this.pendingMeasuredCacheIndexes=[],this.lanesSettling&&this.measurementsCache.length===t&&(this.lanesSettling=!1);const c=this.measurementsCache.slice(0,x),v=new Array(l).fill(void 0);for(let h=0;h<x;h++){const j=c[h];j&&(v[j.lane]=h)}for(let h=x;h<t;h++){const j=r(h),N=this.laneAssignments.get(h);let g,w;if(N!==void 0&&this.options.lanes>1){g=N;const E=v[g],M=E!==void 0?c[E]:void 0;w=M?M.end+this.options.gap:a+s}else{const E=this.options.lanes===1?c[h-1]:this.getFurthestMeasurement(c,h);w=E?E.end+this.options.gap:a+s,g=E?E.lane:h%this.options.lanes,this.options.lanes>1&&this.laneAssignments.set(h,g)}const y=d.get(j),C=typeof y=="number"?y:this.options.estimateSize(h),O=w+C;c[h]={index:h,start:w,size:C,end:O,key:j,lane:g},v[g]=h}return this.measurementsCache=c,c},{key:!1,debug:()=>this.options.debug}),this.calculateRange=_(()=>[this.getMeasurements(),this.getSize(),this.getScrollOffset(),this.options.lanes],(t,a,s,r)=>this.range=t.length>0&&a>0?Ot({measurements:t,outerSize:a,scrollOffset:s,lanes:r}):null,{key:!1,debug:()=>this.options.debug}),this.getVirtualIndexes=_(()=>{let t=null,a=null;const s=this.calculateRange();return s&&(t=s.startIndex,a=s.endIndex),this.maybeNotify.updateDeps([this.isScrolling,t,a]),[this.options.rangeExtractor,this.options.overscan,this.options.count,t,a]},(t,a,s,r,n)=>r===null||n===null?[]:t({startIndex:r,endIndex:n,overscan:a,count:s}),{key:!1,debug:()=>this.options.debug}),this.indexFromElement=t=>{const a=this.options.indexAttribute,s=t.getAttribute(a);return s?parseInt(s,10):(console.warn(`Missing attribute name '${a}={index}' on measured element.`),-1)},this._measureElement=(t,a)=>{const s=this.indexFromElement(t),r=this.measurementsCache[s];if(!r)return;const n=r.key,l=this.elementsCache.get(n);l!==t&&(l&&this.observer.unobserve(l),this.observer.observe(t),this.elementsCache.set(n,t)),t.isConnected&&this.resizeItem(s,this.options.measureElement(t,a,this))},this.resizeItem=(t,a)=>{const s=this.measurementsCache[t];if(!s)return;const r=this.itemSizeCache.get(s.key)??s.size,n=a-r;n!==0&&((this.shouldAdjustScrollPositionOnItemSizeChange!==void 0?this.shouldAdjustScrollPositionOnItemSizeChange(s,n,this):s.start<this.getScrollOffset()+this.scrollAdjustments)&&this._scrollToOffset(this.getScrollOffset(),{adjustments:this.scrollAdjustments+=n,behavior:void 0}),this.pendingMeasuredCacheIndexes.push(s.index),this.itemSizeCache=new Map(this.itemSizeCache.set(s.key,a)),this.notify(!1))},this.measureElement=t=>{if(!t){this.elementsCache.forEach((a,s)=>{a.isConnected||(this.observer.unobserve(a),this.elementsCache.delete(s))});return}this._measureElement(t,void 0)},this.getVirtualItems=_(()=>[this.getVirtualIndexes(),this.getMeasurements()],(t,a)=>{const s=[];for(let r=0,n=t.length;r<n;r++){const l=t[r],d=a[l];s.push(d)}return s},{key:!1,debug:()=>this.options.debug}),this.getVirtualItemForOffset=t=>{const a=this.getMeasurements();if(a.length!==0)return fe(a[Ee(0,a.length-1,s=>fe(a[s]).start,t)])},this.getMaxScrollOffset=()=>{if(!this.scrollElement)return 0;if("scrollHeight"in this.scrollElement)return this.options.horizontal?this.scrollElement.scrollWidth-this.scrollElement.clientWidth:this.scrollElement.scrollHeight-this.scrollElement.clientHeight;{const t=this.scrollElement.document.documentElement;return this.options.horizontal?t.scrollWidth-this.scrollElement.innerWidth:t.scrollHeight-this.scrollElement.innerHeight}},this.getOffsetForAlignment=(t,a,s=0)=>{if(!this.scrollElement)return 0;const r=this.getSize(),n=this.getScrollOffset();a==="auto"&&(a=t>=n+r?"end":"start"),a==="center"?t+=(s-r)/2:a==="end"&&(t-=r);const l=this.getMaxScrollOffset();return Math.max(Math.min(l,t),0)},this.getOffsetForIndex=(t,a="auto")=>{t=Math.max(0,Math.min(t,this.options.count-1));const s=this.measurementsCache[t];if(!s)return;const r=this.getSize(),n=this.getScrollOffset();if(a==="auto")if(s.end>=n+r-this.options.scrollPaddingEnd)a="end";else if(s.start<=n+this.options.scrollPaddingStart)a="start";else return[n,a];if(a==="end"&&t===this.options.count-1)return[this.getMaxScrollOffset(),a];const l=a==="end"?s.end+this.options.scrollPaddingEnd:s.start-this.options.scrollPaddingStart;return[this.getOffsetForAlignment(l,a,s.size),a]},this.isDynamicMode=()=>this.elementsCache.size>0,this.scrollToOffset=(t,{align:a="start",behavior:s}={})=>{s==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),this._scrollToOffset(this.getOffsetForAlignment(t,a),{adjustments:void 0,behavior:s})},this.scrollToIndex=(t,{align:a="auto",behavior:s}={})=>{s==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),t=Math.max(0,Math.min(t,this.options.count-1)),this.currentScrollToIndex=t;let r=0;const n=10,l=x=>{if(!this.targetWindow)return;const c=this.getOffsetForIndex(t,x);if(!c){console.warn("Failed to get offset for index:",t);return}const[v,h]=c;this._scrollToOffset(v,{adjustments:void 0,behavior:s}),this.targetWindow.requestAnimationFrame(()=>{const j=()=>{if(this.currentScrollToIndex!==t)return;const N=this.getScrollOffset(),g=this.getOffsetForIndex(t,h);if(!g){console.warn("Failed to get offset for index:",t);return}jt(g[0],N)||d(h)};this.isDynamicMode()?this.targetWindow.requestAnimationFrame(j):j()})},d=x=>{this.targetWindow&&this.currentScrollToIndex===t&&(r++,r<n?this.targetWindow.requestAnimationFrame(()=>l(x)):console.warn(`Failed to scroll to index ${t} after ${n} attempts.`))};l(a)},this.scrollBy=(t,{behavior:a}={})=>{a==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),this._scrollToOffset(this.getScrollOffset()+t,{adjustments:void 0,behavior:a})},this.getTotalSize=()=>{var t;const a=this.getMeasurements();let s;if(a.length===0)s=this.options.paddingStart;else if(this.options.lanes===1)s=((t=a[a.length-1])==null?void 0:t.end)??0;else{const r=Array(this.options.lanes).fill(null);let n=a.length-1;for(;n>=0&&r.some(l=>l===null);){const l=a[n];r[l.lane]===null&&(r[l.lane]=l.end),n--}s=Math.max(...r.filter(l=>l!==null))}return Math.max(s-this.options.scrollMargin+this.options.paddingEnd,0)},this._scrollToOffset=(t,{adjustments:a,behavior:s})=>{this.options.scrollToFn(t,{behavior:s,adjustments:a},this)},this.measure=()=>{this.itemSizeCache=new Map,this.laneAssignments=new Map,this.notify(!1)},this.setOptions(o)}}const Ee=(i,o,t,a)=>{for(;i<=o;){const s=(i+o)/2|0,r=t(s);if(r<a)i=s+1;else if(r>a)o=s-1;else return s}return i>0?i-1:0};function Ot({measurements:i,outerSize:o,scrollOffset:t,lanes:a}){const s=i.length-1,r=d=>i[d].start;if(i.length<=a)return{startIndex:0,endIndex:s};let n=Ee(0,s,r,t),l=n;if(a===1)for(;l<s&&i[l].end<t+o;)l++;else if(a>1){const d=Array(a).fill(0);for(;l<s&&d.some(c=>c<t+o);){const c=i[l];d[c.lane]=c.end,l++}const x=Array(a).fill(t+o);for(;n>=0&&x.some(c=>c>=t);){const c=i[n];x[c.lane]=c.start,n--}n=Math.max(0,n-n%a),l=Math.min(s,l+(a-1-l%a))}return{startIndex:n,endIndex:l}}const be=typeof document<"u"?m.useLayoutEffect:m.useEffect;function Mt({useFlushSync:i=!0,...o}){const t=m.useReducer(()=>({}),{})[1],a={...o,onChange:(r,n)=>{var l;i&&n?ze.flushSync(t):t(),(l=o.onChange)==null||l.call(o,r,n)}},[s]=m.useState(()=>new Tt(a));return s.setOptions(a),be(()=>s._didMount(),[]),be(()=>s._willUpdate()),s}function At(i){return Mt({observeElementRect:kt,observeElementOffset:St,scrollToFn:It,...i})}function zt({items:i,estimatedItemSize:o=100,overscan:t=5,height:a,className:s,gap:r=0,renderItem:n,getItemKey:l,emptyState:d,isLoading:x,loadingComponent:c,scrollRef:v}){const h=m.useRef(null),j=At({count:i.length,getScrollElement:()=>h.current,estimateSize:()=>o,overscan:t,gap:r}),N=j.getVirtualItems(),g=m.useCallback(w=>{h.current=w,v&&v(w)},[v]);return x?e.jsx("div",{className:G("flex items-center justify-center",s),style:{height:a},children:c||e.jsx("div",{className:"animate-pulse text-muted-foreground",children:"Carregando..."})}):i.length===0?e.jsx("div",{className:G("flex items-center justify-center",s),style:{height:a},children:d||e.jsx("div",{className:"text-muted-foreground",children:"Nenhum item encontrado"})}):e.jsx("div",{ref:g,className:G("overflow-auto",s),style:{height:a},children:e.jsx("div",{style:{height:`${j.getTotalSize()}px`,width:"100%",position:"relative"},children:N.map(w=>{const y=i[w.index],C=l?l(y,w.index):w.index;return e.jsx("div",{"data-index":w.index,ref:j.measureElement,style:{position:"absolute",top:0,left:0,width:"100%",transform:`translateY(${w.start}px)`},children:n(y,w.index)},C)})})})}function Ft({onSearch:i,onSearchFocus:o}){const[t,a]=m.useState(""),[s,r]=m.useState(!1),n=x=>{a(x),i?.(x)},l=()=>{a(""),i?.("")},d=()=>{r(!0),o?.()};return e.jsxs("div",{className:"sticky top-0 z-20 bg-background/95 backdrop-blur-md safe-top",children:[e.jsxs(p.div,{className:"px-4 pt-4 pb-3",initial:{opacity:0,y:-10},animate:{opacity:1,y:0},transition:{duration:.3},children:[e.jsx("h1",{className:"text-2xl font-bold text-foreground tracking-tight",children:"Boca no Trombone"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-0.5",children:"A voz da comunidade"})]}),e.jsx("div",{className:"px-4 pb-3",children:e.jsxs(p.div,{className:"relative",animate:{scale:s?1.01:1},transition:{duration:.2},children:[e.jsx(Ne,{className:`absolute left-3.5 top-1/2 -translate-y-1/2 w-5 h-5 transition-colors ${s?"text-primary":"text-muted-foreground"}`}),e.jsx(ke,{value:t,onChange:x=>n(x.target.value),onFocus:d,onBlur:()=>r(!1),placeholder:"Buscar assunto, rua, bairro‚Ä¶",className:`pl-11 pr-10 h-12 rounded-2xl border-2 text-base transition-all ${s?"border-primary bg-background shadow-lg":"border-transparent bg-muted/50"}`}),t&&e.jsx(p.button,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.8},onClick:l,className:"absolute right-3 top-1/2 -translate-y-1/2 p-1 rounded-full bg-muted hover:bg-muted-foreground/20 transition-colors","aria-label":"Limpar busca",children:e.jsx(U,{className:"w-4 h-4 text-muted-foreground"})})]})})]})}const Z=[{id:"curtidos",label:"Mais curtidos",icon:Fe},{id:"recentes",label:"Recentes",icon:Le},{id:"perto",label:"Perto de mim",icon:P}];function Lt({value:i,onChange:o}){return e.jsx("div",{className:"px-4 pb-3",children:e.jsxs("div",{className:"relative flex bg-muted/60 rounded-xl p-1",children:[e.jsx(p.div,{className:"absolute inset-y-1 bg-background rounded-lg shadow-sm",initial:!1,animate:{x:`${Z.findIndex(t=>t.id===i)*100}%`,width:`${100/Z.length}%`},transition:{type:"spring",stiffness:400,damping:30},style:{left:"4px",right:"4px"}}),Z.map(t=>{const a=t.icon,s=i===t.id;return e.jsxs(p.button,{onClick:()=>o(t.id),whileTap:{scale:.97},className:`relative flex-1 flex items-center justify-center gap-1.5 py-2.5 px-2 rounded-lg text-sm font-medium transition-colors z-10 min-h-[44px] ${s?"text-foreground":"text-muted-foreground"}`,"aria-pressed":s,"aria-label":t.label,children:[e.jsx(a,{className:`w-4 h-4 ${s?"text-primary":""}`}),e.jsx("span",{className:"hidden xs:inline",children:t.label}),e.jsx("span",{className:"xs:hidden",children:t.label.split(" ")[0]})]},t.id)})]})})}const ve=[{value:"reclamacao",label:"Reclama√ß√£o",color:"bg-red-100 text-red-700 border-red-200"},{value:"sugestao",label:"Sugest√£o",color:"bg-blue-100 text-blue-700 border-blue-200"},{value:"duvida",label:"D√∫vida",color:"bg-purple-100 text-purple-700 border-purple-200"},{value:"alerta",label:"Alerta",color:"bg-orange-100 text-orange-700 border-orange-200"},{value:"elogio",label:"Elogio",color:"bg-green-100 text-green-700 border-green-200"},{value:"comercio",label:"Com√©rcio",color:"bg-emerald-100 text-emerald-700 border-emerald-200"},{value:"eventos",label:"Eventos",color:"bg-pink-100 text-pink-700 border-pink-200"},{value:"outros",label:"Outros",color:"bg-gray-100 text-gray-700 border-gray-200"}],Dt=[{value:"hoje",label:"Hoje"},{value:"7dias",label:"7 dias"},{value:"30dias",label:"30 dias"},{value:"todos",label:"Todos"}];function Rt({filters:i,onChange:o,userBairroId:t}){const[a,s]=m.useState(!1),{data:r=[]}=Se(),n=Object.values(i).filter(Boolean).length,l=(c,v)=>{o({...i,[c]:v})},d=c=>{const v={...i};delete v[c],o(v)},x=()=>{o({})};return e.jsxs("div",{className:"px-4 pb-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsxs(p.button,{onClick:()=>s(!a),whileTap:{scale:.95},className:`flex items-center gap-1.5 px-3 py-2 rounded-full text-sm font-medium transition-colors min-h-[44px] ${a||n>0?"bg-primary/10 text-primary":"bg-muted text-muted-foreground"}`,children:[e.jsx("span",{children:"Filtros"}),n>0&&e.jsx("span",{className:"bg-primary text-primary-foreground w-5 h-5 rounded-full text-xs flex items-center justify-center",children:n}),e.jsx(p.div,{animate:{rotate:a?180:0},transition:{duration:.2},children:e.jsx(De,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"flex-1 overflow-x-auto scrollbar-hide",children:e.jsxs("div",{className:"flex gap-1.5",children:[i.categoria&&e.jsx(ee,{label:ve.find(c=>c.value===i.categoria)?.label||"",onRemove:()=>d("categoria")}),i.comFoto&&e.jsx(ee,{label:"Com foto",icon:e.jsx(te,{className:"w-3 h-3"}),onRemove:()=>d("comFoto")}),i.meuBairro&&e.jsx(ee,{label:"Meu bairro",icon:e.jsx(P,{className:"w-3 h-3"}),onRemove:()=>d("meuBairro")})]})}),n>0&&e.jsx("button",{onClick:x,className:"text-xs text-muted-foreground hover:text-foreground transition-colors whitespace-nowrap",children:"Limpar"})]}),e.jsx(se,{children:a&&e.jsx(p.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.2},className:"overflow-hidden",children:e.jsxs("div",{className:"space-y-3 py-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-muted-foreground mb-1.5 block",children:"Categoria"}),e.jsx("div",{className:"flex flex-wrap gap-1.5",children:ve.map(c=>e.jsx(p.button,{whileTap:{scale:.95},onClick:()=>l("categoria",i.categoria===c.value?void 0:c.value),className:`px-3 py-1.5 rounded-full text-sm font-medium border transition-all min-h-[36px] ${i.categoria===c.value?`${c.color} border-current`:"bg-background border-border text-muted-foreground hover:border-foreground/30"}`,children:c.label},c.value))})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"text-xs font-medium text-muted-foreground mb-1.5 block",children:"Bairro"}),e.jsxs(ie,{value:i.bairroId||"__all__",onValueChange:c=>l("bairroId",c==="__all__"?void 0:c),children:[e.jsx(re,{className:"h-11 rounded-xl",children:e.jsx(ne,{placeholder:"Todos"})}),e.jsxs(oe,{children:[e.jsx(R,{value:"__all__",children:"Todos"}),r.map(c=>e.jsx(R,{value:c.id,children:c.nome},c.id))]})]})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"text-xs font-medium text-muted-foreground mb-1.5 block",children:"Per√≠odo"}),e.jsxs(ie,{value:i.periodo||"__all__",onValueChange:c=>l("periodo",c==="__all__"?void 0:c),children:[e.jsx(re,{className:"h-11 rounded-xl",children:e.jsx(ne,{placeholder:"Todos"})}),e.jsxs(oe,{children:[e.jsx(R,{value:"__all__",children:"Todos"}),Dt.map(c=>e.jsx(R,{value:c.value,children:c.label},c.value))]})]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(ye,{label:"S√≥ com foto",icon:e.jsx(te,{className:"w-4 h-4"}),active:!!i.comFoto,onClick:()=>l("comFoto",!i.comFoto)}),t&&e.jsx(ye,{label:"Meu bairro",icon:e.jsx(P,{className:"w-4 h-4"}),active:!!i.meuBairro,onClick:()=>l("meuBairro",!i.meuBairro)})]})]})})})]})}function ee({label:i,icon:o,onRemove:t}){return e.jsxs(p.span,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.8},className:"inline-flex items-center gap-1 px-2 py-1 rounded-full bg-primary/10 text-primary text-xs font-medium",children:[o,i,e.jsx("button",{onClick:t,className:"ml-0.5 p-0.5 rounded-full hover:bg-primary/20 transition-colors","aria-label":`Remover filtro ${i}`,children:e.jsx(U,{className:"w-3 h-3"})})]})}function ye({label:i,icon:o,active:t,onClick:a}){return e.jsxs(p.button,{whileTap:{scale:.95},onClick:a,className:`flex items-center gap-2 px-3 py-2 rounded-full text-sm font-medium transition-all min-h-[44px] ${t?"bg-primary text-primary-foreground":"bg-muted text-muted-foreground hover:bg-muted-foreground/10"}`,children:[o,i]})}const je={reclamacao:{label:"Reclama√ß√£o",color:"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400"},reclamacoes:{label:"Reclama√ß√£o",color:"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400"},sugestao:{label:"Sugest√£o",color:"bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400"},duvida:{label:"D√∫vida",color:"bg-purple-100 text-purple-700 dark:bg-purple-900/30 dark:text-purple-400"},alerta:{label:"Alerta",color:"bg-orange-100 text-orange-700 dark:bg-orange-900/30 dark:text-orange-400"},elogio:{label:"Elogio",color:"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400"},comercio:{label:"Com√©rcio",color:"bg-emerald-100 text-emerald-700 dark:bg-emerald-900/30 dark:text-emerald-400"},eventos:{label:"Eventos",color:"bg-pink-100 text-pink-700 dark:bg-pink-900/30 dark:text-pink-400"},outros:{label:"Outros",color:"bg-gray-100 text-gray-700 dark:bg-gray-800 dark:text-gray-400"}},_t=m.memo(function({topic:o,onPress:t,onLike:a,onComment:s,onShare:r,onMore:n}){const l=je[o.categoria]||je.outros,d=dt(o.bairroId),x=ot(o.createdAt),c=lt(o.createdAt),v=g=>{g.stopPropagation(),navigator.vibrate&&navigator.vibrate(10),a?.()},h=g=>{g.stopPropagation(),s?.()},j=g=>{g.stopPropagation(),r?.()},N=g=>{g.stopPropagation(),n?.()};return e.jsxs(p.article,{layout:!0,initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,scale:.95},whileTap:{scale:.99},onClick:t,className:"bg-card rounded-2xl p-4 shadow-sm border border-border/50 cursor-pointer active:bg-muted/50 transition-colors",role:"article","aria-label":`${o.titulo} - ${l.label} em ${d}`,children:[e.jsxs("div",{className:"flex items-center justify-between gap-2 mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap min-w-0",children:[e.jsx(ut,{variant:"secondary",className:`${l.color} border-0 font-medium text-xs px-2 py-0.5`,children:l.label}),e.jsxs("span",{className:"text-xs text-muted-foreground flex items-center gap-1 truncate",children:[e.jsx(P,{className:"w-3 h-3 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:d})]})]}),e.jsx("time",{dateTime:new Date(o.createdAt).toISOString(),title:c,className:"text-xs text-muted-foreground whitespace-nowrap",children:x})]}),e.jsx("h3",{className:"font-semibold text-foreground text-base leading-snug line-clamp-2 mb-1",children:o.titulo}),e.jsx("p",{className:"text-sm text-muted-foreground leading-relaxed line-clamp-2 mb-3",children:o.texto}),o.fotoUrl&&e.jsxs("div",{className:"relative mb-3 rounded-xl overflow-hidden bg-muted aspect-video",children:[e.jsx("img",{src:o.fotoUrl,alt:"",loading:"lazy",className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/20 to-transparent"})]}),e.jsxs("div",{className:"flex items-center justify-between pt-2 border-t border-border/50",children:[e.jsxs(p.button,{whileTap:{scale:.9},onClick:v,className:"flex items-center gap-1.5 py-2 px-3 -ml-3 rounded-lg hover:bg-muted/50 transition-colors min-h-[44px]","aria-label":o.liked?"Remover curtida":"Curtir","aria-pressed":o.liked,children:[e.jsx(p.div,{animate:o.liked?{scale:[1,1.3,1]}:{},transition:{duration:.3},children:e.jsx(Re,{className:`w-5 h-5 ${o.liked?"fill-red-500 text-red-500":"text-muted-foreground"}`})}),e.jsx("span",{className:`text-sm font-medium ${o.liked?"text-red-500":"text-muted-foreground"}`,children:o.likesCount>0?o.likesCount:"Curtir"})]}),e.jsxs(p.button,{whileTap:{scale:.9},onClick:h,className:"flex items-center gap-1.5 py-2 px-3 rounded-lg hover:bg-muted/50 transition-colors min-h-[44px]","aria-label":`${o.commentsCount} coment√°rios`,children:[e.jsx(_e,{className:"w-5 h-5 text-muted-foreground"}),e.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:o.commentsCount>0?o.commentsCount:"Comentar"})]}),e.jsx(p.button,{whileTap:{scale:.9},onClick:j,className:"flex items-center gap-1.5 py-2 px-3 rounded-lg hover:bg-muted/50 transition-colors min-h-[44px]","aria-label":"Compartilhar",children:e.jsx($e,{className:"w-5 h-5 text-muted-foreground"})}),e.jsx(p.button,{whileTap:{scale:.9},onClick:N,className:"flex items-center justify-center p-2 rounded-lg hover:bg-muted/50 transition-colors min-h-[44px] min-w-[44px]","aria-label":"Mais op√ß√µes",children:e.jsx(Be,{className:"w-5 h-5 text-muted-foreground"})})]})]})});function $t(){return e.jsxs(p.div,{initial:{opacity:0},animate:{opacity:1},className:"bg-card rounded-2xl p-4 shadow-sm border border-border/50",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2 mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-5 w-20 bg-muted rounded-full animate-pulse"}),e.jsx("div",{className:"h-4 w-24 bg-muted rounded animate-pulse"})]}),e.jsx("div",{className:"h-4 w-12 bg-muted rounded animate-pulse"})]}),e.jsx("div",{className:"h-5 w-3/4 bg-muted rounded animate-pulse mb-2"}),e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsx("div",{className:"h-4 w-full bg-muted rounded animate-pulse"}),e.jsx("div",{className:"h-4 w-2/3 bg-muted rounded animate-pulse"})]}),e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("div",{className:"w-6 h-6 rounded-full bg-muted animate-pulse"}),e.jsx("div",{className:"h-3 w-16 bg-muted rounded animate-pulse"})]}),e.jsxs("div",{className:"flex items-center gap-6 pt-3 border-t border-border/50",children:[e.jsx("div",{className:"h-5 w-14 bg-muted rounded animate-pulse"}),e.jsx("div",{className:"h-5 w-14 bg-muted rounded animate-pulse"}),e.jsx("div",{className:"h-5 w-8 bg-muted rounded animate-pulse"})]})]})}function Bt({count:i=3}){return e.jsx("div",{className:"space-y-3",children:Array.from({length:i}).map((o,t)=>e.jsx($t,{},t))})}const Pt={empty:{icon:qe,title:"Nenhum t√≥pico ainda",description:"Seja o primeiro a abrir um assunto na comunidade!",actionLabel:"Criar t√≥pico",iconColor:"text-primary"},"no-results":{icon:Ne,title:"Sem resultados",description:"Tente outro termo ou remova alguns filtros.",actionLabel:"Limpar filtros",iconColor:"text-muted-foreground"},offline:{icon:Pe,title:"Voc√™ est√° offline",description:"Mostrando t√≥picos salvos. Conecte-se para ver novidades.",actionLabel:"Tentar novamente",iconColor:"text-orange-500"},error:{icon:$,title:"Algo deu errado",description:"N√£o foi poss√≠vel carregar os t√≥picos. Tente novamente.",actionLabel:"Tentar novamente",iconColor:"text-red-500"}};function qt({type:i,onAction:o,onClearFilters:t}){const a=Pt[i],s=a.icon,r=()=>{i==="no-results"&&t?t():o?.()};return e.jsxs(p.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"flex flex-col items-center justify-center py-16 px-6 text-center",children:[e.jsx(p.div,{initial:{scale:.8},animate:{scale:1},transition:{delay:.1,type:"spring",stiffness:200},className:`w-16 h-16 rounded-full bg-muted flex items-center justify-center mb-4 ${a.iconColor}`,children:e.jsx(s,{className:"w-8 h-8"})}),e.jsx("h3",{className:"text-lg font-semibold text-foreground mb-2",children:a.title}),e.jsx("p",{className:"text-sm text-muted-foreground mb-6 max-w-[260px]",children:a.description}),o&&e.jsxs(B,{onClick:r,variant:i==="empty"?"default":"outline",className:"min-h-[44px] px-6 rounded-full",children:[i==="error"||i==="offline"?e.jsx(Ce,{className:"w-4 h-4 mr-2"}):null,a.actionLabel]})]})}const Wt=[{value:"reclamacao",label:"Reclama√ß√£o",icon:e.jsx(Ye,{className:"w-4 h-4"}),color:"bg-red-100 text-red-700 border-red-200"},{value:"sugestao",label:"Sugest√£o",icon:e.jsx(Je,{className:"w-4 h-4"}),color:"bg-blue-100 text-blue-700 border-blue-200"},{value:"duvida",label:"D√∫vida",icon:e.jsx(Xe,{className:"w-4 h-4"}),color:"bg-purple-100 text-purple-700 border-purple-200"},{value:"alerta",label:"Alerta",icon:e.jsx(Ge,{className:"w-4 h-4"}),color:"bg-orange-100 text-orange-700 border-orange-200"},{value:"elogio",label:"Elogio",icon:e.jsx(Ze,{className:"w-4 h-4"}),color:"bg-green-100 text-green-700 border-green-200"},{value:"comercio",label:"Com√©rcio",icon:e.jsx(me,{className:"w-4 h-4"}),color:"bg-emerald-100 text-emerald-700 border-emerald-200"},{value:"eventos",label:"Eventos",icon:e.jsx(et,{className:"w-4 h-4"}),color:"bg-pink-100 text-pink-700 border-pink-200"},{value:"outros",label:"Outros",icon:e.jsx(me,{className:"w-4 h-4"}),color:"bg-gray-100 text-gray-700 border-gray-200"}];function Vt({open:i,onOpenChange:o,onSubmit:t,defaultBairroId:a}){const[s,r]=m.useState(null),[n,l]=m.useState(""),[d,x]=m.useState(""),[c,v]=m.useState(a||""),[h,j]=m.useState(!1),[N,g]=m.useState(null),[w,y]=m.useState(null),[C,O]=m.useState(!1),[E,M]=m.useState("idle"),[T,A]=m.useState({}),I=m.useRef(null),{uploadAsync:de}=ct(),{data:q=[],isLoading:W}=Se(),V=()=>{const b={};return s||(b.categoria="Escolha um tipo: Reclama√ß√£o, Sugest√£o‚Ä¶"),n.trim()?n.length<5&&(b.titulo="O t√≠tulo precisa ter pelo menos 5 caracteres"):b.titulo="D√™ um t√≠tulo curto pro pessoal entender r√°pido",d.trim()||(b.texto="Conte mais detalhes sobre o assunto"),A(b),Object.keys(b).length===0},Y=async()=>{if(!(!V()||!s)){O(!0),M("idle");try{let b;if(w)try{b=(await de(w)).url}catch(k){const L=k instanceof Error?k.message:"Erro no upload";Q.error(`Falha no upload da imagem: ${L}`),O(!1);return}await t({titulo:n.trim(),texto:d.trim(),categoria:s,bairroId:c&&c!=="none"?c:void 0,isAnon:h,fotoUrl:b}),navigator.vibrate&&navigator.vibrate([30,50,30]),M("success"),setTimeout(()=>{J(),o(!1)},800)}catch{M("error")}finally{O(!1)}}},J=()=>{r(null),l(""),x(""),v(a||""),j(!1),g(null),y(null),A({}),M("idle")},H=b=>{const k=b.target.files?.[0];if(k){y(k);const L=new FileReader;L.onload=()=>{g(L.result)},L.readAsDataURL(k)}},z=()=>{g(null),y(null),I.current&&(I.current.value="")};return e.jsx(mt,{open:i,onOpenChange:o,children:e.jsxs(ht,{side:"bottom",className:"rounded-t-3xl h-[85vh] flex flex-col p-0 overflow-hidden",children:[e.jsx(ft,{className:"px-4 py-4 border-b flex-shrink-0",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(xt,{className:"text-lg font-semibold",children:"Novo t√≥pico"}),e.jsx("button",{onClick:()=>o(!1),className:"p-2 -mr-2 rounded-full hover:bg-muted transition-colors min-h-[44px] min-w-[44px] flex items-center justify-center","aria-label":"Fechar",children:e.jsx(U,{className:"w-5 h-5"})})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto px-4 py-4 space-y-5",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-foreground mb-2 block",children:"O que voc√™ quer compartilhar?"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:Wt.map(b=>e.jsxs(p.button,{whileTap:{scale:.95},onClick:()=>{r(b.value),A(k=>({...k,categoria:""}))},className:`flex items-center gap-1.5 px-4 py-2.5 rounded-full text-sm font-medium border transition-all min-h-[44px] ${s===b.value?`${b.color} border-current shadow-sm`:"bg-background border-border text-muted-foreground hover:border-foreground/30"}`,children:[b.icon,e.jsx("span",{children:b.label})]},b.value))}),T.categoria&&e.jsxs("p",{className:"text-xs text-red-500 mt-2 flex items-center gap-1",children:[e.jsx($,{className:"w-3 h-3"}),T.categoria]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-foreground mb-2 block",children:"T√≠tulo"}),e.jsx(ke,{value:n,onChange:b=>{l(b.target.value),A(k=>({...k,titulo:""}))},placeholder:"Ex: Buraco na Rua X perto do mercado",className:`h-12 rounded-xl text-base ${T.titulo?"border-red-500":""}`,maxLength:100}),T.titulo&&e.jsxs("p",{className:"text-xs text-red-500 mt-1.5 flex items-center gap-1",children:[e.jsx($,{className:"w-3 h-3"}),T.titulo]}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1 text-right",children:[n.length,"/100"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-foreground mb-2 block",children:"Conte mais detalhes"}),e.jsx(gt,{value:d,onChange:b=>{x(b.target.value),A(k=>({...k,texto:""}))},placeholder:"Diga onde √© e o que est√° acontecendo‚Ä¶",className:`min-h-[120px] rounded-xl resize-none text-base ${T.texto?"border-red-500":""}`,maxLength:500}),T.texto&&e.jsxs("p",{className:"text-xs text-red-500 mt-1.5 flex items-center gap-1",children:[e.jsx($,{className:"w-3 h-3"}),T.texto]}),e.jsxs("div",{className:"flex justify-between mt-1",children:[e.jsx("p",{className:`text-xs ${d.length>0&&d.length<10?"text-amber-500":"text-muted-foreground"}`,children:d.length>0&&d.length<10?`M√≠nimo 10 caracteres (${10-d.length} restantes)`:""}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[d.length,"/500"]})]})]}),e.jsx(se,{children:N&&e.jsxs(p.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"relative",children:[e.jsx("img",{src:N,alt:"Preview",className:"w-full h-40 object-cover rounded-xl"}),e.jsx("button",{onClick:z,className:"absolute top-2 right-2 p-2 bg-black/50 rounded-full text-white hover:bg-black/70 transition-colors","aria-label":"Remover imagem",children:e.jsx(U,{className:"w-4 h-4"})})]})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(p.button,{whileTap:{scale:.95},onClick:()=>{I.current&&(I.current.accept="image/*",I.current.capture="environment",I.current.click())},className:"flex items-center gap-2 px-4 py-2.5 rounded-xl bg-muted text-muted-foreground hover:bg-muted-foreground/10 transition-colors min-h-[44px]",children:[e.jsx(We,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm font-medium",children:"C√¢mera"})]}),e.jsxs(p.button,{whileTap:{scale:.95},onClick:()=>{I.current&&(I.current.accept="image/*",I.current.removeAttribute("capture"),I.current.click())},className:"flex items-center gap-2 px-4 py-2.5 rounded-xl bg-muted text-muted-foreground hover:bg-muted-foreground/10 transition-colors min-h-[44px]",children:[e.jsx(te,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm font-medium",children:"Galeria"})]}),e.jsx("input",{ref:I,type:"file",accept:"image/*",onChange:H,className:"hidden"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-sm font-medium text-foreground mb-2 block",children:[e.jsx(P,{className:"w-4 h-4 inline mr-1"}),"Bairro"]}),e.jsxs(ie,{value:c,onValueChange:b=>{v(b),A(k=>({...k,bairroId:""}))},children:[e.jsx(re,{className:`h-12 rounded-xl ${T.bairroId?"border-red-500":""}`,children:e.jsx(ne,{placeholder:"Selecione o bairro"})}),e.jsxs(oe,{children:[e.jsx(R,{value:"none",className:"text-muted-foreground italic",children:"N√£o quero informar bairro"}),W?e.jsx(R,{value:"loading",disabled:!0,children:"Carregando..."}):q.map(b=>e.jsx(R,{value:b.id,children:b.nome},b.id))]})]}),T.bairroId&&e.jsxs("p",{className:"text-xs text-red-500 mt-1.5 flex items-center gap-1",children:[e.jsx($,{className:"w-3 h-3"}),T.bairroId]})]}),e.jsxs("div",{className:"flex items-center justify-between py-3 px-4 bg-muted/50 rounded-xl",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[h?e.jsx(Ve,{className:"w-5 h-5 text-muted-foreground"}):e.jsx(He,{className:"w-5 h-5 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-foreground",children:"Postar anonimamente"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Seu nome n√£o aparecer√° no post"})]})]}),e.jsx(pt,{checked:h,onCheckedChange:j})]})]}),e.jsx("div",{className:"px-4 py-4 border-t bg-background safe-bottom flex-shrink-0",children:e.jsx(B,{onClick:Y,disabled:C,className:"w-full h-14 rounded-2xl text-base font-semibold",children:e.jsx(se,{mode:"wait",children:C?e.jsxs(p.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"flex items-center gap-2",children:[e.jsx(Qe,{className:"w-5 h-5 animate-spin"}),e.jsx("span",{children:"Publicando..."})]},"loading"):E==="success"?e.jsxs(p.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},className:"flex items-center gap-2 text-green-500",children:[e.jsx(Ue,{className:"w-5 h-5"}),e.jsx("span",{children:"Publicado!"})]},"success"):E==="error"?e.jsxs(p.div,{initial:{opacity:0},animate:{opacity:1},className:"flex items-center gap-2",children:[e.jsx($,{className:"w-5 h-5"}),e.jsx("span",{children:"Tentar novamente"})]},"error"):e.jsxs(p.div,{initial:{opacity:0},animate:{opacity:1},className:"flex items-center gap-2",children:[e.jsx(Ke,{className:"w-5 h-5"}),e.jsx("span",{children:"Publicar"})]},"idle")})})})]})})}function ns({scrollRef:i}){const{selectedBairro:o}=nt(),{isAuthenticated:t}=at(),{isOnline:a}=K(),{toast:s}=it(),r=rt(),[n,l]=tt(),{data:d=[],isLoading:x,refetch:c}=bt(),v=yt(),h=vt(),[j,N]=m.useState("curtidos"),[g,w]=m.useState(""),[y,C]=m.useState({}),[O,E]=m.useState(!1),[M,T]=m.useState(!1),[A,I]=m.useState(!1);m.useEffect(()=>{n.get("novo")==="true"&&(n.delete("novo"),l(n,{replace:!0}),t?E(!0):s({title:"Login necess√°rio",description:"Para criar um t√≥pico, voc√™ precisa estar logado.",action:e.jsx(B,{variant:"outline",size:"sm",onClick:()=>window.location.href="/login",children:"Entrar"})}))},[n,l,t,s]);const[de,q]=m.useState(10),[W,V]=m.useState(!1),Y=m.useRef(null),J=m.useRef(null);m.useEffect(()=>{const u=Y.current;if(!u)return;const f=new IntersectionObserver(S=>{S[0].isIntersecting&&!W&&(V(!0),setTimeout(()=>{q(X=>X+10),V(!1)},300))},{rootMargin:"200px"});return f.observe(u),()=>f.disconnect()},[W]),m.useEffect(()=>{q(10)},[g,y,j]);const H=m.useMemo(()=>{let u=[...d];if(g.trim()){const f=g.toLowerCase();u=u.filter(S=>S.titulo.toLowerCase().includes(f)||S.texto.toLowerCase().includes(f))}if(y.categoria&&(u=u.filter(f=>f.categoria===y.categoria)),y.bairroId&&(u=u.filter(f=>f.bairroId===y.bairroId)),y.meuBairro&&o&&(u=u.filter(f=>f.bairroId===o.id)),y.comFoto&&(u=u.filter(f=>f.fotoUrl)),y.periodo){const f=new Date;switch(y.periodo){case"hoje":f.setHours(0,0,0,0);break;case"7dias":f.setDate(f.getDate()-7);break;case"30dias":f.setDate(f.getDate()-30);break}y.periodo!=="todos"&&(u=u.filter(S=>new Date(S.createdAt)>=f))}switch(j){case"curtidos":u.sort((f,S)=>{const X=he(f.likesCount,f.commentsCount,f.createdAt);return he(S.likesCount,S.commentsCount,S.createdAt)-X});break;case"recentes":u.sort((f,S)=>new Date(S.createdAt).getTime()-new Date(f.createdAt).getTime());break;case"perto":u=u.filter(f=>f.bairroId===o?.id).sort((f,S)=>new Date(S.createdAt).getTime()-new Date(f.createdAt).getTime());break}return u},[d,g,y,j,o]),z=m.useCallback(u=>t?!0:(s({title:"Login necess√°rio",description:`Para ${u}, voc√™ precisa estar logado.`,action:e.jsx(B,{variant:"outline",size:"sm",onClick:()=>window.location.href="/login",children:"Entrar"})}),!1),[t,s]),b=m.useCallback(u=>{if(!z("curtir"))return;const f=d.find(S=>S.id===u);f&&v.mutate({id:u,currentlyLiked:f.liked??!1})},[d,v,z]),k=m.useCallback(async u=>{const f={title:u.titulo,text:u.texto,url:`${window.location.origin}/topico/${u.id}`};if(navigator.share)try{await navigator.share(f)}catch{}else await navigator.clipboard.writeText(f.url),s({title:"Link copiado!",description:"O link foi copiado para a √°rea de transfer√™ncia."})},[s]),L=m.useCallback(u=>{r(`/topico/${u}`)},[r]),Ie=m.useCallback(u=>{z("comentar")&&r(`/topico/${u}?comment=true`)},[z,r]),Te=m.useCallback(async u=>{try{await h.mutateAsync({categoria:u.categoria,titulo:u.titulo,texto:u.texto,isAnon:u.isAnon,bairroId:u.bairroId,fotoUrl:u.fotoUrl}),s({title:"T√≥pico publicado! üéâ",description:a?"Seu t√≥pico foi publicado na comunidade.":"Seu t√≥pico ser√° publicado quando voltar online."})}catch{s({title:"Erro ao publicar",description:"Tente novamente.",variant:"destructive"})}},[h,s,a]);m.useCallback(async()=>{I(!0),await c(),I(!1),s({title:"Atualizado!",description:"O feed foi atualizado."})},[c,s]);const ue=m.useCallback(()=>{C({}),w("")},[]),Oe=()=>!a&&d.length===0?"offline":g||Object.keys(y).length>0?"no-results":"empty",Me=g||Object.keys(y).length>0;return e.jsxs("div",{ref:u=>{i?.(u),J.current=u},className:"h-full overflow-y-auto bg-background",children:[e.jsx(Ft,{onSearch:w,onSearchFocus:()=>{}}),e.jsx(Lt,{value:j,onChange:N}),e.jsx(Rt,{filters:y,onChange:C,userBairroId:o?.id}),!a&&e.jsxs(p.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"mx-4 mb-3 px-4 py-2 bg-orange-100 dark:bg-orange-900/30 rounded-xl flex items-center gap-2 text-sm text-orange-700 dark:text-orange-400",children:[e.jsx("span",{children:"üì°"}),e.jsx("span",{children:"Voc√™ est√° offline. Mostrando t√≥picos salvos."})]}),A&&e.jsx(p.div,{initial:{opacity:0},animate:{opacity:1},className:"flex justify-center py-2",children:e.jsx(Ce,{className:"w-5 h-5 animate-spin text-primary"})}),e.jsx("div",{className:"flex-1 px-4 pb-32",children:M||x?e.jsx(Bt,{count:3}):H.length>0?e.jsx(zt,{items:H,estimatedItemSize:180,overscan:3,gap:12,className:"h-full",getItemKey:u=>u.id,renderItem:u=>e.jsx(_t,{topic:u,onPress:()=>L(u.id),onLike:()=>b(u.id),onComment:()=>Ie(u.id),onShare:()=>k(u)})}):e.jsx(qt,{type:Oe(),onAction:Me?ue:()=>{z("criar um t√≥pico")&&E(!0)},onClearFilters:ue})}),e.jsx(p.div,{initial:{scale:0,opacity:0},animate:{scale:1,opacity:1},transition:{type:"spring",stiffness:400,damping:15,delay:.3},className:"fixed bottom-24 right-4 z-30",children:e.jsx(p.div,{whileHover:{scale:1.05},whileTap:{scale:.95},children:e.jsx(B,{onClick:()=>{z("criar um t√≥pico")&&E(!0)},size:"lg",className:"w-14 h-14 rounded-full shadow-lg bg-primary text-primary-foreground hover:bg-primary/90","aria-label":"Criar novo t√≥pico",children:e.jsx(st,{className:"w-6 h-6"})})})}),e.jsx(Vt,{open:O,onOpenChange:E,onSubmit:Te,defaultBairroId:o?.id})]})}export{ns as default};
