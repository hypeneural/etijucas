import{j as e,r as u}from"./vendor-radix-CQkmBfGK.js";import{B as w}from"./button-CWq3JRf3.js";import{B as ie}from"./badge-DqGV1AcN.js";import{C as le}from"./card-wSJlJYIf.js";import{f as z,C as V,X as O,d as n,U as W,m as ce,o as Q,u as H,g as de,a as me,r as $,k as P,b as K,n as xe,l as ue,i as pe,p as he,B as ge,Q as fe}from"./index-DaSWwAsO.js";import{b as be,u as G,c as R}from"./vendor-query-BnSlUk-m.js";import{m as h,A as je}from"./vendor-motion-3m9Rluu3.js";import{V as ye}from"./vote-DcydC0IV.js";import{S as X}from"./search-CqxXDsfG.js";import{C as ve}from"./chevron-down-Bq7K2J8s.js";import{V as D,a as q}from"./votes--jqTh9CK.js";import{S as Y,a as J,b as Z,c as ee,d as Ne}from"./sheet-QNNvmMJt.js";import{F as we}from"./file-text-ozNnu-11.js";import{S as te}from"./share-2-NCm-eLzU.js";import{E as ae}from"./external-link-9FxPrQlh.js";import{U as Ce}from"./users-BM8vBaPl.js";import{C as ke}from"./circle-alert-gC5NxA6S.js";import{C as Se,a as Ae}from"./CommentList-CNoCSzOx.js";import{L as I}from"./log-in-CMiYXC-R.js";import{U as Te}from"./user-plus-CyYFdpXX.js";import{H as Oe}from"./heart-DQyYi-fX.js";import{M}from"./message-circle-CnDKUkQR.js";import{v as Ve}from"./votes.service-DGlroDeu.js";import{A as De}from"./arrow-left--mZSoBCy.js";import{C as Ee}from"./circle-x-BaY48t4M.js";import"./vendor-utils-YRYEdvK0.js";import"./textarea-C6SSVS__.js";import"./useUploadImage-BAruwY7R.js";import"./formatTimeAgo-DgAHP5O3.js";import"./eye-Ctuy8_fh.js";import"./image-BiZJyeXD.js";import"./send-Dc_UqkOc.js";import"./chevron-up-WqmLYA9i.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const E=z("Minus",[["path",{d:"M5 12h14",key:"1ays0h"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const B=z("Pause",[["rect",{x:"14",y:"4",width:"4",height:"16",rx:"1",key:"zuxfzm"}],["rect",{x:"6",y:"4",width:"4",height:"16",rx:"1",key:"1okwgv"}]]),Be=[{key:"sim",label:"Sim",icon:V,bgColor:"bg-green-50 dark:bg-green-950/30",iconBg:"bg-green-500",textColor:"text-green-700 dark:text-green-400",borderColor:"border-green-200 dark:border-green-800/50"},{key:"nao",label:"Não",icon:O,bgColor:"bg-red-50 dark:bg-red-950/30",iconBg:"bg-red-500",textColor:"text-red-700 dark:text-red-400",borderColor:"border-red-200 dark:border-red-800/50"},{key:"abstencao",label:"Abstenção",icon:B,bgColor:"bg-amber-50 dark:bg-amber-950/30",iconBg:"bg-amber-500",textColor:"text-amber-700 dark:text-amber-400",borderColor:"border-amber-200 dark:border-amber-800/50"},{key:"naoVotou",label:"Ausente",icon:E,bgColor:"bg-gray-50 dark:bg-gray-800/30",iconBg:"bg-gray-400",textColor:"text-gray-600 dark:text-gray-400",borderColor:"border-gray-200 dark:border-gray-700"}];function Le({value:t,duration:s=1e3}){const[a,l]=u.useState(0);return u.useEffect(()=>{const i=Date.now(),r=0,d=()=>{const m=Date.now()-i,f=Math.min(m/s,1),c=1-Math.pow(1-f,3),p=Math.round(r+(t-r)*c);l(p),f<1&&requestAnimationFrame(d)};requestAnimationFrame(d)},[t,s]),e.jsx("span",{children:a})}function Ue({counts:t,className:s}){return e.jsx("div",{className:n("grid grid-cols-4 gap-2",s),children:Be.map((a,l)=>{const i=a.icon,r=t[a.key];return e.jsxs(h.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:l*.1},className:n("flex flex-col items-center gap-1.5 p-3 rounded-xl border",a.bgColor,a.borderColor),children:[e.jsx("div",{className:n("flex items-center justify-center w-8 h-8 rounded-full",a.iconBg),children:e.jsx(i,{className:"w-4 h-4 text-white",strokeWidth:2.5})}),e.jsx("span",{className:n("text-2xl font-bold tabular-nums",a.textColor),children:e.jsx(Le,{value:r,duration:800})}),e.jsx("span",{className:"text-[10px] font-medium text-muted-foreground uppercase tracking-wide",children:a.label})]},a.key)})})}function _({value:t,duration:s=1200}){const[a,l]=u.useState(0);return u.useEffect(()=>{const i=Date.now(),r=()=>{const d=Date.now()-i,m=Math.min(d/s,1),f=1-Math.pow(1-m,4),c=Math.round(t*f);l(c),m<1&&requestAnimationFrame(r)};requestAnimationFrame(r)},[t,s]),e.jsx("span",{children:a})}function Fe({counts:t,status:s,className:a}){const[l,i]=u.useState(0),r=u.useRef(null),d=t.sim+t.nao+t.abstencao+t.naoVotou,m=d>0?t.sim/d*100:0,f=d>0?t.nao/d*100:0;u.useEffect(()=>{const k=Date.now(),S=1500,y=()=>{const o=Date.now()-k,v=Math.min(o/S,1),N=1-Math.pow(1-v,3);i(N),v<1&&requestAnimationFrame(y)};requestAnimationFrame(y)},[]);const c=m*3.6*l,p=f*3.6*l,g=(100-m-f)*3.6*l,C=`conic-gradient(
    #22c55e 0deg ${c}deg,
    #ef4444 ${c}deg ${c+p}deg,
    #9ca3af ${c+p}deg ${c+p+g}deg,
    #e5e7eb ${c+p+g}deg 360deg
  )`;return e.jsxs(h.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:n("flex items-center justify-between gap-4",a),children:[e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"flex items-baseline gap-2",children:[e.jsx(h.span,{className:"text-5xl font-extrabold text-foreground tabular-nums tracking-tight",initial:{scale:.5,opacity:0},animate:{scale:1,opacity:1},transition:{type:"spring",stiffness:200,damping:15},children:e.jsx(_,{value:t.sim})}),e.jsx("span",{className:"text-2xl text-muted-foreground font-medium",children:"×"}),e.jsx(h.span,{className:"text-5xl font-extrabold text-foreground tabular-nums tracking-tight",initial:{scale:.5,opacity:0},animate:{scale:1,opacity:1},transition:{type:"spring",stiffness:200,damping:15,delay:.1},children:e.jsx(_,{value:t.nao})})]}),e.jsxs("div",{className:"flex flex-col gap-1.5",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("div",{className:"w-2.5 h-2.5 rounded-full bg-green-500"}),e.jsxs("span",{className:"text-green-600 dark:text-green-400 font-medium",children:[t.sim," ",t.sim===1?"voto":"votos"," Sim"]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("div",{className:"w-2.5 h-2.5 rounded-full bg-red-500"}),e.jsxs("span",{className:"text-red-600 dark:text-red-400 font-medium",children:[t.nao," ",t.nao===1?"voto":"votos"," Não"]})]}),(t.abstencao>0||t.naoVotou>0)&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("div",{className:"w-2.5 h-2.5 rounded-full bg-gray-400"}),e.jsxs("span",{className:"text-muted-foreground font-medium",children:[t.abstencao+t.naoVotou," outros"]})]})]})]}),e.jsx(h.div,{ref:r,initial:{scale:0,rotate:-90},animate:{scale:1,rotate:0},transition:{type:"spring",stiffness:100,damping:15,delay:.2},className:"relative w-28 h-28 shrink-0 rounded-full flex items-center justify-center",style:{background:C},children:e.jsx("div",{className:"w-20 h-20 rounded-full bg-card flex items-center justify-center shadow-inner",children:e.jsx(ye,{className:"w-7 h-7 text-muted-foreground"})})})]})}const Pe=[{value:"all",label:"Todos"},{value:"SIM",label:"Sim"},{value:"NAO",label:"Não"},{value:"ABSTENCAO",label:"Abstenção"},{value:"NAO_VOTOU",label:"Ausente"}];function Me({searchQuery:t,onSearchChange:s,selectedParty:a,onPartyChange:l,selectedVote:i,onVoteChange:r,sortBy:d,onSortChange:m,availableParties:f,className:c}){const[p,j]=u.useState(!1);return e.jsxs("div",{className:n("flex flex-col gap-3",c),children:[e.jsxs("div",{className:"relative",children:[e.jsx(X,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx("input",{type:"text",value:t,onChange:g=>s(g.target.value),placeholder:"Buscar vereador...",className:n("w-full h-11 pl-10 pr-10 rounded-xl border bg-card","text-sm placeholder:text-muted-foreground","focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary","transition-all duration-200")}),t&&e.jsx("button",{onClick:()=>s(""),className:"absolute right-3 top-1/2 -translate-y-1/2 p-1 rounded-full hover:bg-muted transition-colors",children:e.jsx(O,{className:"w-4 h-4 text-muted-foreground"})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsxs("button",{onClick:()=>j(!p),className:n("w-full h-10 px-3 rounded-lg border bg-card","flex items-center justify-between gap-2","text-sm font-medium transition-colors",a!=="all"&&"border-primary/30 bg-primary/5"),children:[e.jsx("span",{className:"truncate",children:a==="all"?"Todos os Partidos":a}),e.jsx(ve,{className:n("w-4 h-4 text-muted-foreground transition-transform",p&&"rotate-180")})]}),p&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-10",onClick:()=>j(!1)}),e.jsxs(h.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"absolute top-full left-0 right-0 mt-1 p-1 rounded-lg border bg-card shadow-lg z-20 max-h-48 overflow-auto",children:[e.jsx("button",{onClick:()=>{l("all"),j(!1)},className:n("w-full px-3 py-2 text-left text-sm rounded-md transition-colors",a==="all"?"bg-primary/10 text-primary":"hover:bg-muted"),children:"Todos os Partidos"}),f.map(g=>e.jsx("button",{onClick:()=>{l(g),j(!1)},className:n("w-full px-3 py-2 text-left text-sm rounded-md transition-colors",a===g?"bg-primary/10 text-primary":"hover:bg-muted"),children:g},g))]})]})]}),e.jsx("button",{onClick:()=>m(d==="relevance"?"alphabetical":"relevance"),className:n("h-10 px-3 rounded-lg border bg-card","text-xs font-medium transition-colors whitespace-nowrap","hover:bg-muted"),children:d==="relevance"?"A-Z":"⭐"})]}),e.jsx("div",{className:"flex p-1 bg-muted rounded-xl",children:Pe.map(g=>e.jsxs("button",{onClick:()=>r(g.value),className:n("relative flex-1 py-2 text-xs font-medium rounded-lg transition-all duration-200",i===g.value?"text-foreground":"text-muted-foreground hover:text-foreground/70"),children:[i===g.value&&e.jsx(h.div,{layoutId:"vote-tab-indicator",className:"absolute inset-0 bg-card rounded-lg shadow-sm",transition:{type:"spring",stiffness:400,damping:30}}),e.jsx("span",{className:"relative z-10",children:g.label})]},g.value))})]})}function $e({vote:t}){const s=D[t],a={SIM:V,NAO:O,ABSTENCAO:B,NAO_VOTOU:E}[t];return e.jsxs(h.div,{initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},transition:{type:"spring",stiffness:400,damping:25},className:"flex flex-col items-center gap-1",children:[e.jsx("div",{className:n("flex items-center justify-center w-12 h-12 rounded-full","shadow-lg transition-transform duration-200",s.bgColor),children:e.jsx(a,{className:"w-6 h-6 text-white",strokeWidth:2.5})}),e.jsx("span",{className:n("text-xs font-bold uppercase tracking-wide",s.color),children:s.label})]})}function Re({text:t,query:s}){if(!s||s.trim()==="")return e.jsx("span",{children:t});const a=new RegExp(`(${s.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")})`,"gi"),l=t.split(a);return e.jsx("span",{children:l.map((i,r)=>a.test(i)?e.jsx("mark",{className:"bg-primary/20 text-primary rounded px-0.5",children:i},r):e.jsx("span",{children:i},r))})}function qe({councilor:t,searchQuery:s,onClick:a,index:l=0}){const i=D[t.vote],r=t.vote==="NAO_VOTOU",d=t.party==="???"||!t.party?"—":t.party;return e.jsxs(h.button,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,scale:.95},transition:{delay:l*.04,type:"spring",stiffness:300,damping:25},whileTap:{scale:.97},whileHover:{y:-2},onClick:a,className:n("group relative w-full flex items-center gap-4 p-4 pl-5","bg-card rounded-2xl border transition-all duration-200","text-left shadow-card","hover:shadow-lg hover:border-primary/20","overflow-hidden",r&&"opacity-60"),children:[e.jsx(h.div,{initial:{height:0},animate:{height:"100%"},transition:{delay:l*.04+.1,duration:.3},className:n("absolute left-0 top-0 bottom-0 w-1.5 rounded-l-2xl",r?"bg-gray-300 dark:bg-gray-600":i.accentColor)}),e.jsxs("div",{className:"relative shrink-0",children:[e.jsxs(h.div,{initial:{scale:0},animate:{scale:1},transition:{delay:l*.04+.05,type:"spring",stiffness:400},className:n("w-14 h-14 rounded-full overflow-hidden","ring-2 ring-offset-2 ring-offset-card",r?"ring-gray-300 dark:ring-gray-600":i.borderColor.replace("border-","ring-")),children:[t.photoUrl?e.jsx("img",{src:t.photoUrl,alt:t.name,className:n("w-full h-full object-cover",r&&"grayscale opacity-60"),onError:m=>{m.currentTarget.style.display="none",m.currentTarget.nextElementSibling?.classList.remove("hidden")}}):null,e.jsx("div",{className:n("absolute inset-0 bg-muted flex items-center justify-center",t.photoUrl?"hidden":"",r&&"bg-gray-100 dark:bg-gray-800"),children:e.jsx(W,{className:n("w-7 h-7",r?"text-gray-400":"text-muted-foreground")})})]}),e.jsxs("div",{className:n("absolute -bottom-0.5 -right-0.5 w-5 h-5 rounded-full","flex items-center justify-center ring-2 ring-card",i.bgColor),children:[t.vote==="SIM"&&e.jsx(V,{className:"w-3 h-3 text-white",strokeWidth:3}),t.vote==="NAO"&&e.jsx(O,{className:"w-3 h-3 text-white",strokeWidth:3}),t.vote==="ABSTENCAO"&&e.jsx(B,{className:"w-3 h-3 text-white",strokeWidth:3}),t.vote==="NAO_VOTOU"&&e.jsx(E,{className:"w-3 h-3 text-white",strokeWidth:3})]})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:n("text-base font-bold leading-tight truncate",r?"text-muted-foreground":"text-foreground"),children:e.jsx(Re,{text:t.name,query:s})}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-0.5 flex items-center gap-2",children:[e.jsx("span",{className:"font-medium",children:d}),e.jsx("span",{className:"text-border",children:"•"}),e.jsx("span",{className:n("font-semibold",i.color),children:i.label})]})]}),e.jsx($e,{vote:t.vote}),e.jsx(ce,{className:"w-5 h-5 text-muted-foreground/50 group-hover:text-primary transition-colors"})]})}function Ie({vote:t}){const s=D[t],a={SIM:V,NAO:O,ABSTENCAO:B,NAO_VOTOU:E}[t];return e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx("div",{className:n("flex items-center justify-center w-16 h-16 rounded-full",s.bgColor),children:e.jsx(a,{className:"w-8 h-8 text-white",strokeWidth:2.5})}),e.jsx("span",{className:n("text-sm font-bold uppercase tracking-wide",s.color),children:s.label})]})}function _e({councilor:t,isOpen:s,onClose:a,voteTitle:l}){const{toast:i}=Q();if(!t)return null;const r=D[t.vote],d=t.vote==="NAO_VOTOU",m=t.party==="???"||!t.party?"—":t.party,f=async()=>{const c=`${t.name} (${m}) votou ${r.label} em "${l||"votação"}"`;if(navigator.share)try{await navigator.share({title:"Voto do Vereador",text:c,url:window.location.href})}catch{}else navigator.clipboard&&(await navigator.clipboard.writeText(`${c}
${window.location.href}`),i({title:"Copiado!",description:"Texto copiado para compartilhar."}))};return e.jsx(Y,{open:s,onOpenChange:c=>!c&&a(),children:e.jsxs(J,{side:"bottom",className:"rounded-t-3xl px-6 pb-8 pt-4 max-h-[80vh]",children:[e.jsx("div",{className:"w-12 h-1 bg-muted rounded-full mx-auto mb-4"}),e.jsxs(Z,{className:"text-center pb-4",children:[e.jsx("div",{className:"flex justify-center mb-3",children:e.jsxs("div",{className:n("relative w-20 h-20 rounded-full overflow-hidden","border-3",d?"border-gray-200 dark:border-gray-700":r.borderColor),children:[t.photoUrl?e.jsx("img",{src:t.photoUrl,alt:t.name,className:n("w-full h-full object-cover",d&&"grayscale opacity-70"),onError:c=>{c.currentTarget.style.display="none",c.currentTarget.nextElementSibling?.classList.remove("hidden")}}):null,e.jsx("div",{className:n("absolute inset-0 bg-muted flex items-center justify-center",t.photoUrl?"hidden":""),children:e.jsx(W,{className:"w-10 h-10 text-muted-foreground"})})]})}),e.jsx(ee,{className:"text-xl",children:t.name}),e.jsxs("p",{className:"text-muted-foreground font-medium",children:[m," • Vereador"]})]}),e.jsx("div",{className:"flex justify-center py-4 border-y border-border",children:e.jsx(Ie,{vote:t.vote})}),t.justification&&e.jsxs("div",{className:"mt-4 p-4 rounded-xl bg-muted/50 border",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-medium text-muted-foreground mb-2",children:[e.jsx(we,{className:"w-4 h-4"}),"Justificativa"]}),e.jsx("p",{className:"text-sm leading-relaxed",children:t.justification})]}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsxs(w,{onClick:f,className:"flex-1 h-12 gap-2",variant:"default",children:[e.jsx(te,{className:"w-4 h-4"}),"Compartilhar voto"]}),t.videoUrl&&e.jsxs(w,{onClick:()=>window.open(t.videoUrl,"_blank"),variant:"outline",className:"h-12 gap-2",children:[e.jsx(ae,{className:"w-4 h-4"}),"Vídeo"]})]}),e.jsx("p",{className:"text-center text-xs text-muted-foreground mt-4",children:"Dados sujeitos à fonte oficial da Câmara"})]})})}function ze({type:t="no-results",message:s,className:a}){const l=t==="no-results";return e.jsxs(h.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:n("flex flex-col items-center justify-center py-12 px-6 text-center",a),children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-muted flex items-center justify-center mb-4",children:l?e.jsx(X,{className:"w-7 h-7 text-muted-foreground"}):e.jsx(Ce,{className:"w-7 h-7 text-muted-foreground"})}),e.jsx("h3",{className:"text-lg font-semibold text-foreground mb-1",children:l?"Nenhum resultado":"Sem dados"}),e.jsx("p",{className:"text-sm text-muted-foreground max-w-[260px]",children:s||(l?"Nenhum vereador encontrado com os filtros selecionados.":"Não há dados de votação disponíveis no momento.")})]})}function We({source:t,className:s}){return e.jsxs("div",{className:n("flex flex-col items-center gap-2 pt-6 pb-4 text-center",s),children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-xs text-muted-foreground",children:[e.jsx(ke,{className:"w-3.5 h-3.5"}),e.jsx("span",{children:"Dados sujeitos à fonte oficial"})]}),e.jsxs("a",{href:t.url,target:"_blank",rel:"noopener noreferrer",className:n("inline-flex items-center gap-1.5 px-3 py-1.5","text-sm font-medium text-primary","rounded-full border border-primary/20 bg-primary/5","hover:bg-primary/10 transition-colors"),children:[e.jsx(ae,{className:"w-3.5 h-3.5"}),t.label]})]})}function Qe({open:t,onClose:s,action:a="general"}){const l=H(),i=de(),r=encodeURIComponent(i.pathname+i.search),d=()=>{switch(a){case"comment":return"Faça login para comentar";case"like":return"Faça login para curtir";default:return"Faça login para continuar"}},m=()=>{switch(a){case"comment":return"Crie uma conta ou faça login para participar da conversa e compartilhar sua opinião.";case"like":return"Crie uma conta ou faça login para curtir e interagir com os comentários.";default:return"Crie uma conta ou faça login para acessar todas as funcionalidades."}},f=()=>{switch(a){case"comment":return e.jsx(M,{className:"w-12 h-12 text-primary"});case"like":return e.jsx(Oe,{className:"w-12 h-12 text-red-500"});default:return e.jsx(I,{className:"w-12 h-12 text-primary"})}},c=()=>{s(),l(`/login?returnTo=${r}`)},p=()=>{s(),l(`/cadastro?returnTo=${r}`)};return e.jsx(Y,{open:t,onOpenChange:j=>!j&&s(),children:e.jsxs(J,{side:"bottom",className:"rounded-t-3xl",children:[e.jsxs(Z,{className:"text-center pb-4",children:[e.jsx(h.div,{initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},className:"mx-auto mb-4",children:f()}),e.jsx(ee,{className:"text-xl",children:d()}),e.jsx(Ne,{className:"text-sm",children:m()})]}),e.jsxs("div",{className:"flex flex-col gap-3 pt-4 pb-8",children:[e.jsxs(w,{onClick:c,size:"lg",className:"w-full gap-2 h-12 text-base",children:[e.jsx(I,{className:"w-5 h-5"}),"Entrar na minha conta"]}),e.jsxs(w,{onClick:p,variant:"outline",size:"lg",className:"w-full gap-2 h-12 text-base",children:[e.jsx(Te,{className:"w-5 h-5"}),"Criar conta gratuita"]}),e.jsx("button",{onClick:s,className:"text-sm text-muted-foreground hover:text-foreground mt-2",children:"Talvez depois"})]})]})})}function He({votacaoId:t}){const s=be(),{isAuthenticated:a}=me(),[l,i]=u.useState(!1),[r,d]=u.useState("comment"),{data:m,isLoading:f,error:c}=G({queryKey:["votacao-comments",t],queryFn:async()=>await P.get(`/votacoes/${t}/comments`)}),p=R({mutationFn:async o=>P.post(`/votacoes/${t}/comments`,o),onSuccess:()=>{s.invalidateQueries({queryKey:["votacao-comments",t]}),$.success("Comentário adicionado!")},onError:()=>{$.error("Erro ao adicionar comentário")}}),j=R({mutationFn:async o=>P.post(`/votacoes/${t}/comments/${o}/like`),onSuccess:()=>{s.invalidateQueries({queryKey:["votacao-comments",t]})}}),g=u.useCallback(o=>{if(!a){d("like"),i(!0);return}j.mutate(o)},[a,j]),C=u.useCallback(async(o,v,N,L)=>{if(!a){d("comment"),i(!0);return}await p.mutateAsync({texto:v,isAnon:N,imageUrl:L,parentId:o})},[a,p]),k=u.useCallback(async(o,v,N)=>{if(!a){d("comment"),i(!0);return}await p.mutateAsync({texto:o,isAnon:v,imageUrl:N})},[a,p]),S=m?.data??[],y=m?.meta?.total??0;return e.jsxs("div",{className:"bg-card rounded-2xl border shadow-card overflow-hidden",children:[e.jsxs("div",{className:"px-4 py-3 border-b border-border/50 flex items-center gap-2",children:[e.jsx(M,{className:"w-5 h-5 text-primary"}),e.jsx("h3",{className:"font-semibold text-foreground",children:"Comentários da População"}),y>0&&e.jsxs("span",{className:"text-sm text-muted-foreground",children:["(",y,")"]})]}),f?e.jsx("div",{className:"py-12 flex justify-center",children:e.jsx(K,{className:"w-6 h-6 animate-spin text-muted-foreground"})}):c?e.jsx("div",{className:"py-12 text-center",children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"Erro ao carregar comentários"})}):e.jsx(Se,{comments:S,onLike:g,onReply:C}),e.jsx("div",{className:"border-t border-border/50 bg-muted/30",children:a?e.jsx("div",{className:"relative",children:e.jsx(Ae,{onSubmit:k,placeholder:"Deixe seu comentário sobre esta votação...",isSubmitting:p.isPending})}):e.jsx(h.button,{whileTap:{scale:.98},onClick:()=>{d("comment"),i(!0)},className:"w-full px-4 py-4 text-left text-muted-foreground hover:bg-muted/50 transition-colors",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-muted flex items-center justify-center",children:e.jsx(M,{className:"w-4 h-4"})}),e.jsx("span",{className:"text-sm",children:"Faça login para comentar..."})]})})}),e.jsx(Qe,{open:l,onClose:()=>i(!1),action:r})]})}function Ke(t){return{id:t.vereador.id,name:t.vereador.nome,party:t.vereador.partido?.sigla||"???",vote:t.voto,photoUrl:t.vereador.fotoUrl||"",justification:t.justificativa,videoUrl:t.urlVideo}}function Tt(){const{id:t}=xe(),s=H(),{toast:a}=Q(),{activeTab:l,setActiveTab:i}=ue(),[r,d]=u.useState(""),[m,f]=u.useState("all"),[c,p]=u.useState("all"),[j,g]=u.useState("relevance"),[C,k]=u.useState(null),[S,y]=u.useState(!1),{data:o,isLoading:v,error:N}=G({queryKey:fe.votes.votacao(t||""),queryFn:()=>Ve.getById(t),enabled:!!t,staleTime:5*60*1e3}),L=u.useMemo(()=>{if(!o?.votos)return[];const x=new Set(o.votos.map(b=>b.vereador.partido?.sigla).filter(b=>!!b&&b!=="???"));return Array.from(x).sort()},[o]),U=u.useMemo(()=>o?.votos?o.votos.map(Ke):[],[o]),A=o?o.counts.sim>o.counts.nao?"approved":"rejected":"approved",F=u.useMemo(()=>{let x=[...U];if(r.trim()){const b=r.toLowerCase();x=x.filter(T=>T.name.toLowerCase().includes(b))}return m!=="all"&&(x=x.filter(b=>b.party===m)),c!=="all"&&(x=x.filter(b=>b.vote===c)),j==="alphabetical"?x.sort((b,T)=>b.name.localeCompare(T.name,"pt-BR")):x.sort((b,T)=>q[b.vote]-q[T.vote]),x},[U,r,m,c,j]),se=async()=>{if(!o)return;const x={title:o.titulo,text:`${o.titulo} • ${o.subtitulo||""}`,url:window.location.href};if(navigator.share)try{await navigator.share(x)}catch{}else navigator.clipboard&&(await navigator.clipboard.writeText(x.url),a({title:"Link copiado!",description:"Cole onde quiser compartilhar."}))},re=x=>{k(x),y(!0)},oe=x=>{i(x),s("/")},ne=x=>new Date(x).toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric"});return v?e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-muted/50",children:e.jsx("div",{className:"relative w-full max-w-[420px] h-full bg-background flex items-center justify-center",children:e.jsx(K,{className:"h-8 w-8 animate-spin text-primary"})})}):N||!o?e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-muted/50",children:e.jsxs("div",{className:"relative w-full max-w-[420px] h-full bg-background flex flex-col items-center justify-center gap-4 p-6",children:[e.jsx("p",{className:"text-muted-foreground text-center",children:"Não foi possível carregar os detalhes da votação"}),e.jsx(w,{variant:"outline",onClick:()=>s(-1),children:"Voltar"})]})}):e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-muted/50",children:e.jsxs("div",{className:"relative w-full max-w-[420px] h-full bg-background overflow-hidden shadow-elevated",children:[e.jsxs("div",{className:"h-full overflow-y-auto pb-24",children:[e.jsx("header",{className:"sticky top-0 z-40 bg-background/95 backdrop-blur-xl border-b",children:e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 safe-top",children:[e.jsx(w,{variant:"ghost",size:"icon",onClick:()=>s(-1),children:e.jsx(De,{className:"h-5 w-5"})}),e.jsx("h1",{className:"text-lg font-bold",children:"Detalhes da Votação"}),e.jsx(w,{variant:"ghost",size:"icon",onClick:se,children:e.jsx(te,{className:"h-5 w-5"})})]})}),e.jsxs("main",{className:"px-4 py-5 space-y-6",children:[e.jsx(h.section,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:e.jsxs(le,{className:"rounded-2xl p-5 bg-gradient-to-br from-card to-muted/30 border shadow-card overflow-hidden relative",children:[e.jsx("div",{className:n("absolute top-0 left-0 right-0 h-1",A==="approved"?"bg-green-500":"bg-red-500")}),e.jsxs("div",{className:"flex items-center justify-between mb-4 pt-1",children:[e.jsxs(ie,{className:n("gap-1.5 px-3 py-1.5 text-xs font-bold uppercase tracking-wider",A==="approved"?"bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400 border-green-200 dark:border-green-800":"bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-400 border-red-200 dark:border-red-800"),children:[A==="approved"?e.jsx(pe,{className:"w-3.5 h-3.5"}):e.jsx(Ee,{className:"w-3.5 h-3.5"}),A==="approved"?"Aprovado":"Rejeitado"]}),e.jsxs("span",{className:"text-xs text-muted-foreground flex items-center gap-1",children:[e.jsx(he,{className:"w-3.5 h-3.5"}),ne(o.data)]})]}),e.jsx(h.h2,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},transition:{delay:.1},className:"text-2xl font-bold text-foreground leading-tight mb-2",children:o.titulo}),e.jsx(h.p,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.2},className:"text-sm text-muted-foreground leading-relaxed mb-5",children:o.descricao}),e.jsx("div",{className:"h-px w-full bg-border mb-5"}),e.jsx(Fe,{counts:o.counts,status:A})]})}),e.jsx(h.section,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},children:e.jsx(Ue,{counts:o.counts})}),e.jsx(h.section,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"sticky top-14 z-30 -mx-4 px-4 py-3 bg-background/95 backdrop-blur-xl border-y",children:e.jsx(Me,{searchQuery:r,onSearchChange:d,selectedParty:m,onPartyChange:f,selectedVote:c,onVoteChange:p,sortBy:j,onSortChange:g,availableParties:L})}),e.jsxs("section",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-base font-bold text-foreground",children:"Votos dos Vereadores"}),e.jsxs("span",{className:"text-sm text-muted-foreground font-medium",children:[F.length," de ",U.length]})]}),e.jsxs("div",{className:"flex flex-wrap gap-3 text-xs",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-green-500"}),e.jsx("span",{className:"text-muted-foreground",children:"Sim"})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-red-500"}),e.jsx("span",{className:"text-muted-foreground",children:"Não"})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-amber-500"}),e.jsx("span",{className:"text-muted-foreground",children:"Abstenção"})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-gray-400"}),e.jsx("span",{className:"text-muted-foreground",children:"Ausente"})]})]}),e.jsx(je,{mode:"popLayout",children:F.length===0?e.jsx(ze,{type:"no-results"}):e.jsx(h.div,{layout:!0,className:"space-y-3",children:F.map((x,b)=>e.jsx(qe,{councilor:x,searchQuery:r,onClick:()=>re(x),index:b},x.id))})})]}),e.jsx("section",{className:"px-4 py-4",children:e.jsx(He,{votacaoId:o.id})}),o.urlFonte&&e.jsx(We,{source:{label:"Fonte oficial",url:o.urlFonte}})]})]}),e.jsx(ge,{activeTab:l,onTabChange:oe}),e.jsx(_e,{councilor:C,isOpen:S,onClose:()=>y(!1),voteTitle:o.titulo})]})})}export{Tt as default};
