import{b as u,c as g,u as m}from"./vendor-query-1wfeA5IL.js";import{a as n,E as o}from"./client-BoGyDRku.js";import{r as c,s as i}from"./localDatabase-CDfLZ4Kb.js";async function f(){try{return(await n.get(o.reports.categories)).data}catch(e){throw console.error("[ReportService] Failed to fetch categories:",e),e}}async function S(e,t){const r=new FormData;r.append("categoryId",e.categoryId),r.append("title",e.title),r.append("description",e.description),e.addressText&&r.append("addressText",e.addressText),e.addressSource&&r.append("addressSource",e.addressSource),e.locationQuality&&r.append("locationQuality",e.locationQuality),e.latitude!==void 0&&r.append("latitude",String(e.latitude)),e.longitude!==void 0&&r.append("longitude",String(e.longitude)),e.locationAccuracyM!==void 0&&r.append("locationAccuracyM",String(e.locationAccuracyM)),e.bairroId&&r.append("bairroId",e.bairroId),e.images&&e.images.length>0&&e.images.forEach(a=>{r.append("images[]",a)});try{const a=await n.postFormData(o.reports.create,r,{headers:{"X-Idempotency-Key":t}});return a.data&&await c.save(a.data),a.data}catch(a){throw console.error("[ReportService] Failed to create report:",a),await i.exists(t)||await i.add({type:"report",data:{...e,images:[]},idempotencyKey:t}),a}}async function y(e){try{const t=new URLSearchParams;e?.status&&t.append("status",e.status),e?.categoryId&&t.append("categoryId",e.categoryId),e?.page&&t.append("page",String(e.page)),e?.perPage&&t.append("perPage",String(e.perPage));const r=t.toString(),a=r?`${o.reports.myReports}?${r}`:o.reports.myReports,s=await n.get(a);return s.data.length>0&&await c.saveMany(s.data),s}catch(t){console.error("[ReportService] Failed to fetch my reports:",t);const r=await c.getAll();return{data:r,meta:{current_page:1,last_page:1,per_page:10,total:r.length}}}}async function R(e){try{const t=await n.get(o.reports.get(e));return await c.save(t.data),t.data}catch(t){return console.error("[ReportService] Failed to fetch report:",t),await c.getById(e)}}async function h(e,t){const r=new FormData;return t.forEach(s=>{r.append("images[]",s)}),(await n.postFormData(o.reports.addMedia(e),r)).data}async function l(e,t){await n.delete(o.reports.removeMedia(e,t))}async function w(e,t,r){try{const a=new URLSearchParams({q:e});return t!==void 0&&a.append("lat",String(t)),r!==void 0&&a.append("lon",String(r)),(await n.get(`${o.geocode.autocomplete}?${a.toString()}`)).data}catch(a){return console.error("[ReportService] Geocode autocomplete failed:",a),[]}}async function v(e,t){try{const r=new URLSearchParams({lat:String(e),lon:String(t)});return(await n.get(`${o.geocode.reverse}?${r.toString()}`)).data}catch(r){return console.error("[ReportService] Geocode reverse failed:",r),null}}const p={getCategories:f,createReport:S,getMyReports:y,getReportById:R,addReportMedia:h,removeReportMedia:l,geocodeAutocomplete:w,geocodeReverse:v},d={myReports:["reports","mine"]};function D(e){const t=m({queryKey:[...d.myReports,e],queryFn:()=>p.getMyReports(e),staleTime:12e4});return{reports:t.data?.data??[],meta:t.data?.meta,isLoading:t.isLoading,error:t.error,refetch:t.refetch}}function P(){const e=u(),t=g({mutationFn:({payload:r,idempotencyKey:a})=>p.createReport(r,a),onSuccess:()=>{e.invalidateQueries({queryKey:d.myReports})}});return{createReport:t.mutateAsync,isCreating:t.isPending,error:t.error,reset:t.reset}}export{P as a,p as r,D as u};
