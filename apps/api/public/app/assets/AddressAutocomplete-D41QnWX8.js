import{r,j as e,M as V,h as S,m as i,b as q,p as $,s as P,H as z,bj as G}from"./vendor-app-CFsuVmH9.js";import{I as l}from"./input-ClxaPzc5.js";import{L as o}from"./label-DFaz3-aU.js";import{c as A}from"./index-DeilxgjZ.js";const R="/api/v1";function D(s){const t=s.replace(/\D/g,"");return/^\d{8}$/.test(t)}function J(s){const t=s.replace(/\D/g,"");return t.length<=5?t:`${t.slice(0,5)}-${t.slice(5,8)}`}function I(s){return s.replace(/\D/g,"")}const B={async lookup(s){const t=I(s);if(!D(t))return{success:!1,error:"CEP inválido",message:"O CEP deve ter 8 dígitos."};try{return await(await fetch(`${R}/cep/${t}`)).json()}catch{return{success:!1,error:"Erro de conexão",message:"Não foi possível consultar o CEP. Tente novamente."}}},async getBairros(){try{return(await(await fetch(`${R}/bairros`)).json()).data||[]}catch{return[]}}};function Y({value:s,onChange:t,error:v,disabled:n=!1}){const[C,M]=r.useState(s.cep||""),[x,h]=r.useState(!1),[g,f]=r.useState(null),[_,j]=r.useState(!1),[F,m]=r.useState(!1),[L,E]=r.useState([]),[d,p]=r.useState(!1),k=r.useRef(null),H=r.useCallback(a=>{const b=a.target.value,c=I(b);c.length<=8&&(M(J(c)),f(null),j(!1),m(!1),p(!1),t({...s,cep:c,bairroId:void 0}))},[t,s]);r.useEffect(()=>{const a=I(C);a.length===8&&D(a)&&(async()=>{h(!0),f(null),j(!1);const c=await B.lookup(a);if(!c.success||!c.data){f(c.message||"Erro ao buscar CEP"),t({cep:a}),h(!1);return}const{address:N,match:u,ui_hints:w,available_bairros:O}=c.data;if(!u.city_ok){f(`Somente moradores de Tijucas podem se cadastrar. Este CEP é de ${N.city_name||"outra cidade"}.`),t({cep:a}),h(!1);return}const T={cep:a,logradouro:N.logradouro||"",bairro:N.bairro_text||"",localidade:"Tijucas",uf:"SC",complemento:N.complemento||void 0};u.bairro_ok&&u.bairro_id?(T.bairroId=u.bairro_id,p(!0),j(!0)):(E(O||[]),m(!0),p(!1)),t(T),w.toast&&console.info(w.toast),w.focus_next==="numero"&&u.bairro_ok&&setTimeout(()=>k.current?.focus(),100),h(!1)})()},[C]);const y=r.useCallback((a,b)=>{t({...s,[a]:b})},[t,s]),U=r.useCallback(a=>{t({...s,bairro:a.nome,bairroId:a.id}),m(!1),p(!0),j(!0),setTimeout(()=>k.current?.focus(),100)},[t,s]);return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(o,{className:"flex items-center gap-2",children:[e.jsx(V,{className:"h-4 w-4"}),"CEP"]}),e.jsxs("div",{className:"relative",children:[e.jsx(l,{type:"text",inputMode:"numeric",placeholder:"00000-000",value:C,onChange:H,disabled:n||x,className:A("h-12 text-base pr-12",g&&"border-red-400",_&&"border-green-400")}),e.jsx("div",{className:"absolute right-3 top-1/2 -translate-y-1/2",children:e.jsxs(S,{mode:"wait",children:[x&&e.jsx(i.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.8},children:e.jsx(q,{className:"h-5 w-5 animate-spin text-primary"})},"loading"),_&&!x&&e.jsx(i.div,{initial:{opacity:0,scale:0},animate:{opacity:1,scale:1},className:"p-1 rounded-full bg-green-100 dark:bg-green-900/30",children:e.jsx($,{className:"h-4 w-4 text-green-600 dark:text-green-400"})},"success"),g&&!x&&e.jsx(i.div,{initial:{opacity:0,scale:0},animate:{opacity:1,scale:1},className:"p-1 rounded-full bg-red-100 dark:bg-red-900/30",children:e.jsx(P,{className:"h-4 w-4 text-red-600 dark:text-red-400"})},"error")]})})]}),g&&e.jsx(i.p,{initial:{opacity:0,y:-5},animate:{opacity:1,y:0},className:"text-sm text-red-500",children:g}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Digite o CEP para preencher automaticamente"}),!s.logradouro&&e.jsx("button",{type:"button",onClick:()=>{B.getBairros().then(E),m(!0),t({...s,logradouro:" ",bairro:"",localidade:"Tijucas",uf:"SC"})},className:"text-xs text-primary hover:underline",children:"Não sei o CEP"})]})]}),e.jsx(S,{children:F&&L.length>0&&!d&&e.jsxs(i.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"space-y-2",children:[e.jsxs(o,{className:"flex items-center gap-2 text-amber-600 dark:text-amber-400",children:[e.jsx(P,{className:"h-4 w-4"}),"Selecione seu bairro"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Não conseguimos identificar seu bairro automaticamente. Selecione abaixo:"}),e.jsx("div",{className:"grid grid-cols-2 gap-2 max-h-48 overflow-y-auto p-1",children:L.map(a=>e.jsx(i.button,{type:"button",whileTap:{scale:.95},onClick:()=>U(a),className:A("p-3 rounded-xl text-left text-sm font-medium transition-colors","bg-muted hover:bg-primary hover:text-primary-foreground",s.bairroId===a.id&&"bg-primary text-primary-foreground"),children:a.nome},a.id))})]})}),e.jsx(S,{children:s.logradouro&&e.jsxs(i.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(o,{className:"flex items-center gap-2",children:[e.jsx(z,{className:"h-4 w-4"}),"Rua"]}),e.jsx(l,{type:"text",value:s.logradouro||"",onChange:a=>y("logradouro",a.target.value),disabled:n,className:"h-12 bg-muted/30"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{children:"Número"}),e.jsx(l,{ref:k,type:"text",placeholder:"123",value:s.numero||"",onChange:a=>y("numero",a.target.value),disabled:n,className:"h-12"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{children:"Complemento"}),e.jsx(l,{type:"text",placeholder:"Apto, Bloco...",value:s.complemento||"",onChange:a=>y("complemento",a.target.value),disabled:n,className:"h-12"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(o,{className:"flex items-center gap-2",children:["Bairro",d&&s.bairroId&&e.jsxs("span",{className:"text-xs text-green-600 dark:text-green-400 flex items-center gap-1",children:[e.jsx($,{className:"h-3 w-3"})," Verificado"]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(l,{type:"text",value:s.bairro||"",onChange:a=>{d||y("bairro",a.target.value)},disabled:n||d,className:A("h-12 bg-muted/30",d&&"bg-green-50 dark:bg-green-900/20 border-green-200 dark:border-green-800")}),d&&e.jsx("button",{type:"button",onClick:()=>{p(!1),m(!0),B.getBairros().then(E)},className:"absolute right-3 top-1/2 -translate-y-1/2 text-xs text-primary hover:underline",children:"Alterar"})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("div",{className:"col-span-2 space-y-2",children:[e.jsxs(o,{className:"flex items-center gap-2",children:[e.jsx(G,{className:"h-4 w-4"}),"Cidade"]}),e.jsx(l,{type:"text",value:s.localidade||"Tijucas",disabled:!0,className:"h-12 bg-muted/30"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{children:"UF"}),e.jsx(l,{type:"text",value:s.uf||"SC",disabled:!0,maxLength:2,className:"h-12 bg-muted/30 text-center uppercase"})]})]})]})}),v&&e.jsxs(i.p,{initial:{opacity:0},animate:{opacity:1},className:"text-sm text-red-500 flex items-center gap-1",children:[e.jsx(P,{className:"h-4 w-4"}),v]})]})}export{Y as A};
