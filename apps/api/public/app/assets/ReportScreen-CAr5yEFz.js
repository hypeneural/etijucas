import{r as h,j as e}from"./vendor-radix-i3jPA7eY.js";import{h as y,B}from"./button-DNNbzV2i.js";import{B as S}from"./badge-C80JWLHh.js";import{C as P}from"./card--lNjvRYB.js";import{V}from"./VirtualList-Bj3kZnqU.js";import{b as j,h as T,d as K,f as F,M as H,E as D,T as _,R as Q}from"./index-BA7GKMAo.js";import{b as E,c as $,u as Y}from"./vendor-query-1wfeA5IL.js";import{r as C}from"./localDatabase-D5_Pm7f1.js";import{r as M}from"./useMyReports-CCoI74Jk.js";import{b as U}from"./bairros-Cf5Z_oCw.js";import{c as W,a as b,m as p}from"./vendor-motion-CFwwOuCD.js";import{T as I}from"./trash-2-B-gi1gz4.js";import X from"./ReportWizardPage-CPdAsGY_.js";import{C as q}from"./clock-LMeI9zCy.js";import{P as G}from"./plus-DIBUkMuk.js";import{F as R}from"./file-text-DfcMreJW.js";import{C as O}from"./circle-alert-BjXcL1t5.js";import{L as J}from"./loader-circle-C1rUrOSZ.js";import{C as Z}from"./circle-check-Wy_JAKLB.js";import{H as ee}from"./heart-Dk6zroez.js";import{L as te}from"./lightbulb-F96wWO5a.js";import"./vendor-utils-DycLLelI.js";import"./log-in-DrY9mpHx.js";import"./client-BoGyDRku.js";import"./useAuthStore-CH38A1GO.js";import"./map-pin-B8fQVxr2.js";import"./camera-CLQQrfmh.js";import"./check-Bw0WLNwm.js";import"./info-DXheXPky.js";import"./chevron-right-DM8ITj9v.js";import"./circle-help-Dy8dIeWf.js";import"./input-ETBtDeqL.js";import"./search-DIeTNKN0.js";import"./pen-line-D4sW0nlR.js";import"./navigation-C12sd10x.js";import"./checkbox-BZOCzjin.js";import"./textarea-1wV7-k5t.js";import"./confetti.module-aL7Yzqgu.js";import"./sparkles-BnhxyWW5.js";import"./copy-D8HtNwBo.js";import"./share-2-Caw5XSt6.js";import"./arrow-left-Cbla27C7.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ae=j("Archive",[["rect",{width:"20",height:"5",x:"2",y:"3",rx:"1",key:"1wp1u1"}],["path",{d:"M4 8v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8",key:"1s80jp"}],["path",{d:"M10 12h4",key:"a56b0p"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const re=j("Car",[["path",{d:"M19 17h2c.6 0 1-.4 1-1v-3c0-.9-.7-1.7-1.5-1.9C18.7 10.6 16 10 16 10s-1.3-1.4-2.2-2.3c-.5-.4-1.1-.7-1.8-.7H5c-.6 0-1.1.4-1.4.9l-1.4 2.9A3.7 3.7 0 0 0 2 12v4c0 .6.4 1 1 1h2",key:"5owen"}],["circle",{cx:"7",cy:"17",r:"2",key:"u2ysq9"}],["path",{d:"M9 17h6",key:"r8uit2"}],["circle",{cx:"17",cy:"17",r:"2",key:"axvx0g"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const se=j("Droplets",[["path",{d:"M7 16.3c2.2 0 4-1.83 4-4.05 0-1.16-.57-2.26-1.71-3.19S7.29 6.75 7 5.3c-.29 1.45-1.14 2.84-2.29 3.76S3 11.1 3 12.25c0 2.22 1.8 4.05 4 4.05z",key:"1ptgy4"}],["path",{d:"M12.56 6.6A10.97 10.97 0 0 0 14 3.02c.5 2.5 2 4.9 4 6.5s3 3.5 3 5.5a6.98 6.98 0 0 1-11.91 4.97",key:"1sl1rz"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ne=j("Volume2",[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["path",{d:"M16 9a5 5 0 0 1 0 6",key:"1q6k2b"}],["path",{d:"M19.364 18.364a9 9 0 0 0 0-12.728",key:"ijwkga"}]]),A=["offline","reports"],z=["offline","reports","mine"];function ie(r){const{isOnline:s}=T(),n=E(),f=Y({queryKey:r?.onlyMine?z:[...A,r],queryFn:async()=>{let o=await C.getAll();if(s)try{const a=r?.onlyMine?await M.getMyReports():await M.getAll({categoria:r?.categoria!=="all"?r?.categoria:void 0,status:r?.status!=="all"?r?.status:void 0}),i=Array.isArray(a)?a:a.data;i&&i.length>0&&(await C.saveMany(i),o=i)}catch(a){console.warn("[useOfflineReports] API failed, using cache:",a)}return r?.categoria&&r.categoria!=="all"&&(o=o.filter(a=>a.categoria===r.categoria)),r?.status&&r.status!=="all"&&(o=o.filter(a=>a.status===r.status)),o.sort((a,i)=>new Date(i.createdAt).getTime()-new Date(a.createdAt).getTime())},staleTime:1e3*60*2,gcTime:1e3*60*60*24});return h.useEffect(()=>{s&&n.invalidateQueries({queryKey:A})},[s,n]),f}function oe(){return ie({onlyMine:!0})}function le(){const r=E(),{isOnline:s}=T();return $({mutationFn:async n=>{if(await C.delete(n),n.startsWith("temp-"))return{id:n,deleted:!0};if(s)try{await M.delete(n)}catch{console.warn("[useDeleteOfflineReport] API failed")}return{id:n,deleted:!0}},onSuccess:()=>{r.invalidateQueries({queryKey:A}),r.invalidateQueries({queryKey:z})}})}const ce=80;function de({children:r,onDelete:s,onArchive:n,leftActions:f,rightActions:o,threshold:a=ce,className:i=""}){const c=W(0),k=h.useRef(null),u=h.useRef(!1),w=[...n?[{icon:e.jsx(ae,{className:"w-5 h-5"}),label:"Arquivar",color:"text-white",bgColor:"bg-amber-500",onAction:n}]:[],...s?[{icon:e.jsx(I,{className:"w-5 h-5"}),label:"Excluir",color:"text-white",bgColor:"bg-red-500",onAction:s}]:[]],l=o||w,t=b(c,[-a,-a/2,0],[1,.5,0]),d=b(c,[-a,-a/2,0],[1,.8,.5]),N=b(c,[-150,0],[0,a]),g=b(c,[-150,-a,0],[1,.8,0]),v=(m,x)=>{Math.abs(x.offset.x)>=a&&!u.current?(y("medium"),u.current=!0):Math.abs(x.offset.x)<a&&(u.current=!1)},L=(m,x)=>{u.current=!1,x.offset.x<=-a&&l.length>0&&(y("success"),l[l.length-1].onAction())};return l.length===0?e.jsx("div",{className:i,children:r}):e.jsxs("div",{ref:k,className:`relative overflow-hidden ${i}`,children:[e.jsx(p.div,{style:{opacity:g},className:"absolute inset-y-0 right-0 flex items-center justify-end",children:l.map((m,x)=>e.jsxs(p.button,{style:{opacity:t,scale:d,x:N},onClick:m.onAction,className:`flex flex-col items-center justify-center w-20 h-full ${m.bgColor} ${m.color}`,children:[m.icon,e.jsx("span",{className:"text-xs mt-1 font-medium",children:m.label})]},x))}),e.jsx(p.div,{style:{x:c},drag:"x",dragConstraints:{left:-150,right:0},dragElastic:.1,onDrag:v,onDragEnd:L,className:"relative z-10 bg-background",children:r})]})}const me={buraco:{label:"Buraco",icon:_,color:"bg-red-100 text-red-600 dark:bg-red-900/30 dark:text-red-400"},iluminacao:{label:"Iluminação",icon:te,color:"bg-yellow-100 text-yellow-600 dark:bg-yellow-900/30 dark:text-yellow-400"},lixo:{label:"Lixo",icon:I,color:"bg-green-100 text-green-600 dark:bg-green-900/30 dark:text-green-400"},transito:{label:"Trânsito",icon:re,color:"bg-blue-100 text-blue-600 dark:bg-blue-900/30 dark:text-blue-400"},barulho:{label:"Barulho",icon:ne,color:"bg-purple-100 text-purple-600 dark:bg-purple-900/30 dark:text-purple-400"},alagamento:{label:"Alagamento",icon:se,color:"bg-cyan-100 text-cyan-600 dark:bg-cyan-900/30 dark:text-cyan-400"},saude:{label:"Saúde",icon:ee,color:"bg-pink-100 text-pink-600 dark:bg-pink-900/30 dark:text-pink-400"},outros:{label:"Outros",icon:D,color:"bg-gray-100 text-gray-600 dark:bg-gray-900/30 dark:text-gray-400"}},ue={synced:{label:"Enviado",color:"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400",icon:Z},pending:{label:"Pendente",color:"bg-amber-100 text-amber-700 dark:bg-amber-900/30 dark:text-amber-400",icon:q},syncing:{label:"Sincronizando",color:"bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400",icon:J},error:{label:"Erro",color:"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400",icon:O}};function tt({scrollRef:r}){const{data:s=[],refetch:n}=oe(),f=le(),{retryReport:o}=K(),{toast:a}=F(),[i,c]=h.useState("list"),k=t=>U.find(d=>d.id===t)?.nome||"Tijucas",u=t=>{f.mutate(t),y("success"),a({title:"Denúncia removida",description:"Sua denúncia foi excluída."})},w=t=>{o(t),y("medium"),a({title:"Tentando novamente",description:"Sua denúncia será enviada quando online."})};if(i==="wizard")return e.jsx("div",{className:"h-full",children:e.jsx(X,{})});const l=s.filter(t=>t.syncStatus!=="synced").length;return e.jsxs("div",{ref:r,className:"h-full overflow-y-auto bg-background",children:[e.jsx("div",{className:"sticky top-0 z-20 bg-background/95 backdrop-blur-lg border-b safe-top",children:e.jsxs("div",{className:"px-4 py-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Denúncias"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Ajude a melhorar Tijucas"})]}),l>0&&e.jsxs(S,{variant:"secondary",className:"bg-amber-100 text-amber-700 dark:bg-amber-900/30 dark:text-amber-400",children:[e.jsx(q,{className:"h-3 w-3 mr-1"}),l," pendente",l>1?"s":""]})]}),e.jsxs(p.button,{whileTap:{scale:.98},onClick:()=>c("wizard"),className:"w-full p-4 rounded-2xl bg-gradient-to-r from-primary to-primary/80 text-primary-foreground flex items-center justify-between shadow-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-3 rounded-xl bg-white/20",children:e.jsx(G,{className:"h-6 w-6"})}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"font-semibold text-lg",children:"Enviar Denúncia"}),e.jsx("p",{className:"text-sm opacity-90",children:"Reportar um problema na cidade"})]})]}),e.jsx("div",{className:"p-2 rounded-full bg-white/20",children:e.jsx(H,{className:"h-6 w-6"})})]})]})}),e.jsxs("div",{className:"p-4 pb-24",children:[e.jsxs("h2",{className:"text-lg font-semibold mb-3 flex items-center gap-2",children:[e.jsx(R,{className:"h-5 w-5 text-muted-foreground"}),"Minhas Denúncias"]}),s.length===0?e.jsxs(p.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"text-center py-12",children:[e.jsx("div",{className:"p-4 rounded-full bg-muted inline-flex mb-4",children:e.jsx(R,{className:"w-8 h-8 text-muted-foreground"})}),e.jsx("p",{className:"text-muted-foreground mb-2",children:"Você ainda não fez nenhuma denúncia."}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Toque no botão acima para reportar um problema."})]}):e.jsx(V,{items:s,estimatedItemSize:200,overscan:3,gap:12,className:"h-full",getItemKey:t=>t.id||t.tempId||String(Math.random()),renderItem:t=>{const d=ue[t.syncStatus??"pending"],N=d.icon,g=me[t.categoria],v=g?.icon||D;return e.jsx(de,{onDelete:()=>u(t.id||t.tempId),className:"bg-card rounded-2xl shadow-card overflow-hidden",children:e.jsxs(P,{className:"p-4 border-0 shadow-none",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`p-2 rounded-lg ${g?.color||"bg-muted"}`,children:e.jsx(v,{className:"h-4 w-4"})}),e.jsx("span",{className:"font-medium",children:g?.label||"Denúncia"})]}),e.jsxs(S,{className:d.color,children:[e.jsx(N,{className:`w-3 h-3 mr-1 ${t.syncStatus==="syncing"?"animate-spin":""}`}),d.label]})]}),e.jsx("p",{className:"text-sm text-muted-foreground mb-3 line-clamp-2",children:t.texto||"Sem descrição"}),t.fotoUrl&&e.jsx("img",{src:t.fotoUrl,alt:"Denúncia",className:"w-full h-24 object-cover rounded-xl mb-3"}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground flex-wrap",children:[e.jsxs("span",{className:"font-mono bg-muted px-1.5 py-0.5 rounded",children:["#",t.protocolo]}),e.jsx("span",{children:"•"}),e.jsx("span",{children:k(t.bairroId)}),e.jsx("span",{children:"•"}),e.jsx("span",{children:new Date(t.createdAt).toLocaleDateString("pt-BR")})]}),t.syncStatus==="error"&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-border",children:[e.jsxs("div",{className:"flex items-start gap-2 text-sm text-destructive mb-2",children:[e.jsx(O,{className:"h-4 w-4 shrink-0 mt-0.5"}),e.jsx("span",{children:t.errorMessage||"Falha ao sincronizar"})]}),e.jsxs(B,{size:"sm",variant:"outline",onClick:()=>w(t.id||t.tempId),className:"w-full",children:[e.jsx(Q,{className:"w-4 h-4 mr-2"}),"Tentar Novamente"]})]})]})})}})]})]})}export{tt as default};
