import{r as v,j as e}from"./vendor-radix-i3jPA7eY.js";import{h as N,B as F}from"./button-BBHcJsEM.js";import{B as I}from"./badge-gtT6vji4.js";import{C as Q}from"./card-BzX4TsGx.js";import{P as _,V as H}from"./VirtualList-7X7DPZdV.js";import{b as D,h as z,d as Y,f as J,M as U,E as q,T as W,R as X}from"./index-Yv3F9Ddf.js";import{b as B,c as G,u as Z}from"./vendor-query-1wfeA5IL.js";import{r as c,s as T}from"./localDatabase-6Xl36euY.js";import{a as h,E as y}from"./client-CmUA6yYr.js";import{b as ee}from"./bairros-Cf5Z_oCw.js";import{c as te,a as w,m as b}from"./vendor-motion-CFwwOuCD.js";import{T as P}from"./trash-2-BDYTADTD.js";import{R as ae,V as re}from"./ReportWizardPage-BZV9l3BF.js";import{C as L}from"./clock-T-qNz0fp.js";import{F as E}from"./file-text-BDcIiBQU.js";import{C as $}from"./circle-alert-C0lrt3wy.js";import{L as se}from"./loader-circle-BTCeigwS.js";import{C as ne}from"./circle-check-DxdB8cqH.js";import{H as ie}from"./heart-jwSBGzX3.js";import{L as oe}from"./lightbulb-DZbwNF9O.js";import"./vendor-utils-DycLLelI.js";import"./map-pin-D2wbTFxp.js";import"./camera-zriDaB7M.js";import"./check-DIEat2Jt.js";import"./info-DlQgQcRw.js";import"./circle-help-C57LAlSb.js";import"./construction-CAAUJ386.js";import"./chevron-right-DmLcC8-D.js";import"./input-Du1174zE.js";import"./pen-line-CgoCiEHd.js";import"./navigation-zrWagAof.js";import"./checkbox-WNA04dcu.js";import"./textarea-DRmrlTpY.js";import"./confetti.module-sn8No5dO.js";import"./sparkles-DHgdQhXY.js";import"./copy-N6TZ3vPO.js";import"./share-2-Bchd4wED.js";import"./arrow-left-CqdCHqgb.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ce=D("Archive",[["rect",{width:"20",height:"5",x:"2",y:"3",rx:"1",key:"1wp1u1"}],["path",{d:"M4 8v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8",key:"1s80jp"}],["path",{d:"M10 12h4",key:"a56b0p"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=D("Car",[["path",{d:"M19 17h2c.6 0 1-.4 1-1v-3c0-.9-.7-1.7-1.5-1.9C18.7 10.6 16 10 16 10s-1.3-1.4-2.2-2.3c-.5-.4-1.1-.7-1.8-.7H5c-.6 0-1.1.4-1.4.9l-1.4 2.9A3.7 3.7 0 0 0 2 12v4c0 .6.4 1 1 1h2",key:"5owen"}],["circle",{cx:"7",cy:"17",r:"2",key:"u2ysq9"}],["path",{d:"M9 17h6",key:"r8uit2"}],["circle",{cx:"17",cy:"17",r:"2",key:"axvx0g"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const de=D("Droplets",[["path",{d:"M7 16.3c2.2 0 4-1.83 4-4.05 0-1.16-.57-2.26-1.71-3.19S7.29 6.75 7 5.3c-.29 1.45-1.14 2.84-2.29 3.76S3 11.1 3 12.25c0 2.22 1.8 4.05 4 4.05z",key:"1ptgy4"}],["path",{d:"M12.56 6.6A10.97 10.97 0 0 0 14 3.02c.5 2.5 2 4.9 4 6.5s3 3.5 3 5.5a6.98 6.98 0 0 1-11.91 4.97",key:"1sl1rz"}]]);let O=!1;async function j(){O||(O=!0,(await c.getAll()).length)}const R={async getAll(t){await j();try{const a=await h.get(y.reports.list,t);return a.data.length>0&&await c.saveMany(a.data),a}catch{let a=await c.getAll();t?.bairroId&&(a=a.filter(i=>i.bairroId===t.bairroId)),t?.categoria&&(a=a.filter(i=>i.categoria===t.categoria)),t?.status&&(a=a.filter(i=>i.status===t.status));const n=t?.page||1,l=t?.perPage||10,o=(n-1)*l,s=o+l;return{data:a.slice(o,s),meta:{total:a.length,page:n,perPage:l,lastPage:Math.ceil(a.length/l),from:o+1,to:Math.min(s,a.length)}}}},async getMyReports(){await j();try{const t=await h.get(y.reports.myReports);return t.data.length>0&&await c.saveMany(t.data),t.data}catch{return c.getAll()}},async getById(t){await j();try{const a=await h.get(y.reports.get(t));return await c.save(a.data),a.data}catch{return c.getById(t)}},async create(t){await j();const a=`report-${JSON.stringify(t)}-${Date.now()}`;try{const n=await h.post(y.reports.create,t);return await c.save(n.data),n.data}catch{const n={texto:t.texto,categoria:t.categoria,bairroId:t.bairroId,fotos:t.fotos||[],id:`report-local-${Date.now()}`,createdAt:new Date,likes:0,protocolo:`ETJ-${String(Date.now()).slice(-6)}`,status:"recebido"};return await c.save(n),await T.exists(a)||await T.add({type:"report",data:{...t,localId:n.id},idempotencyKey:a}),n}},async delete(t){await c.delete(t)}},S=["offline","reports"],K=["offline","reports","mine"];function me(t){const{isOnline:a}=z(),n=B(),l=Z({queryKey:t?.onlyMine?K:[...S,t],queryFn:async()=>{let o=await c.getAll();if(a)try{const s=t?.onlyMine?await R.getMyReports():await R.getAll({categoria:t?.categoria!=="all"?t?.categoria:void 0,status:t?.status!=="all"?t?.status:void 0}),i=Array.isArray(s)?s:s.data;i&&i.length>0&&(await c.saveMany(i),o=i)}catch(s){console.warn("[useOfflineReports] API failed, using cache:",s)}return t?.categoria&&t.categoria!=="all"&&(o=o.filter(s=>s.categoria===t.categoria)),t?.status&&t.status!=="all"&&(o=o.filter(s=>s.status===t.status)),o.sort((s,i)=>new Date(i.createdAt).getTime()-new Date(s.createdAt).getTime())},staleTime:1e3*60*2,gcTime:1e3*60*60*24});return v.useEffect(()=>{a&&n.invalidateQueries({queryKey:S})},[a,n]),l}function ue(){return me({onlyMine:!0})}function ge(){const t=B(),{isOnline:a}=z();return G({mutationFn:async n=>{if(await c.delete(n),n.startsWith("temp-"))return{id:n,deleted:!0};if(a)try{await R.delete(n)}catch{console.warn("[useDeleteOfflineReport] API failed")}return{id:n,deleted:!0}},onSuccess:()=>{t.invalidateQueries({queryKey:S}),t.invalidateQueries({queryKey:K})}})}const xe=80;function pe({children:t,onDelete:a,onArchive:n,leftActions:l,rightActions:o,threshold:s=xe,className:i=""}){const m=te(0),k=v.useRef(null),x=v.useRef(!1),C=[...n?[{icon:e.jsx(ce,{className:"w-5 h-5"}),label:"Arquivar",color:"text-white",bgColor:"bg-amber-500",onAction:n}]:[],...a?[{icon:e.jsx(P,{className:"w-5 h-5"}),label:"Excluir",color:"text-white",bgColor:"bg-red-500",onAction:a}]:[]],d=o||C,r=w(m,[-s,-s/2,0],[1,.5,0]),u=w(m,[-s,-s/2,0],[1,.8,.5]),A=w(m,[-150,0],[0,s]),f=w(m,[-150,-s,0],[1,.8,0]),M=(g,p)=>{Math.abs(p.offset.x)>=s&&!x.current?(N("medium"),x.current=!0):Math.abs(p.offset.x)<s&&(x.current=!1)},V=(g,p)=>{x.current=!1,p.offset.x<=-s&&d.length>0&&(N("success"),d[d.length-1].onAction())};return d.length===0?e.jsx("div",{className:i,children:t}):e.jsxs("div",{ref:k,className:`relative overflow-hidden ${i}`,children:[e.jsx(b.div,{style:{opacity:f},className:"absolute inset-y-0 right-0 flex items-center justify-end",children:d.map((g,p)=>e.jsxs(b.button,{style:{opacity:r,scale:u,x:A},onClick:g.onAction,className:`flex flex-col items-center justify-center w-20 h-full ${g.bgColor} ${g.color}`,children:[g.icon,e.jsx("span",{className:"text-xs mt-1 font-medium",children:g.label})]},p))}),e.jsx(b.div,{style:{x:m},drag:"x",dragConstraints:{left:-150,right:0},dragElastic:.1,onDrag:M,onDragEnd:V,className:"relative z-10 bg-background",children:t})]})}const fe={buraco:{label:"Buraco",icon:W,color:"bg-red-100 text-red-600 dark:bg-red-900/30 dark:text-red-400"},iluminacao:{label:"Iluminação",icon:oe,color:"bg-yellow-100 text-yellow-600 dark:bg-yellow-900/30 dark:text-yellow-400"},lixo:{label:"Lixo",icon:P,color:"bg-green-100 text-green-600 dark:bg-green-900/30 dark:text-green-400"},transito:{label:"Trânsito",icon:le,color:"bg-blue-100 text-blue-600 dark:bg-blue-900/30 dark:text-blue-400"},barulho:{label:"Barulho",icon:re,color:"bg-purple-100 text-purple-600 dark:bg-purple-900/30 dark:text-purple-400"},alagamento:{label:"Alagamento",icon:de,color:"bg-cyan-100 text-cyan-600 dark:bg-cyan-900/30 dark:text-cyan-400"},saude:{label:"Saúde",icon:ie,color:"bg-pink-100 text-pink-600 dark:bg-pink-900/30 dark:text-pink-400"},outros:{label:"Outros",icon:q,color:"bg-gray-100 text-gray-600 dark:bg-gray-900/30 dark:text-gray-400"}},be={synced:{label:"Enviado",color:"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400",icon:ne},pending:{label:"Pendente",color:"bg-amber-100 text-amber-700 dark:bg-amber-900/30 dark:text-amber-400",icon:L},syncing:{label:"Sincronizando",color:"bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400",icon:se},error:{label:"Erro",color:"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400",icon:$}};function at({scrollRef:t}){const{data:a=[],refetch:n}=ue(),l=ge(),{retryReport:o}=Y(),{toast:s}=J(),[i,m]=v.useState("list"),k=r=>ee.find(u=>u.id===r)?.nome||"Tijucas",x=r=>{l.mutate(r),N("success"),s({title:"Denúncia removida",description:"Sua denúncia foi excluída."})},C=r=>{o(r),N("medium"),s({title:"Tentando novamente",description:"Sua denúncia será enviada quando online."})};if(i==="wizard")return e.jsx("div",{className:"h-full",children:e.jsx(ae,{})});const d=a.filter(r=>r.syncStatus!=="synced").length;return e.jsxs("div",{ref:t,className:"h-full overflow-y-auto bg-background",children:[e.jsx("div",{className:"sticky top-0 z-20 bg-background/95 backdrop-blur-lg border-b safe-top",children:e.jsxs("div",{className:"px-4 py-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Denúncias"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Ajude a melhorar Tijucas"})]}),d>0&&e.jsxs(I,{variant:"secondary",className:"bg-amber-100 text-amber-700 dark:bg-amber-900/30 dark:text-amber-400",children:[e.jsx(L,{className:"h-3 w-3 mr-1"}),d," pendente",d>1?"s":""]})]}),e.jsxs(b.button,{whileTap:{scale:.98},onClick:()=>m("wizard"),className:"w-full p-4 rounded-2xl bg-gradient-to-r from-primary to-primary/80 text-primary-foreground flex items-center justify-between shadow-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-3 rounded-xl bg-white/20",children:e.jsx(_,{className:"h-6 w-6"})}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"font-semibold text-lg",children:"Enviar Denúncia"}),e.jsx("p",{className:"text-sm opacity-90",children:"Reportar um problema na cidade"})]})]}),e.jsx("div",{className:"p-2 rounded-full bg-white/20",children:e.jsx(U,{className:"h-6 w-6"})})]})]})}),e.jsxs("div",{className:"p-4 pb-24",children:[e.jsxs("h2",{className:"text-lg font-semibold mb-3 flex items-center gap-2",children:[e.jsx(E,{className:"h-5 w-5 text-muted-foreground"}),"Minhas Denúncias"]}),a.length===0?e.jsxs(b.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"text-center py-12",children:[e.jsx("div",{className:"p-4 rounded-full bg-muted inline-flex mb-4",children:e.jsx(E,{className:"w-8 h-8 text-muted-foreground"})}),e.jsx("p",{className:"text-muted-foreground mb-2",children:"Você ainda não fez nenhuma denúncia."}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Toque no botão acima para reportar um problema."})]}):e.jsx(H,{items:a,estimatedItemSize:200,overscan:3,gap:12,className:"h-full",getItemKey:r=>r.id||r.tempId||String(Math.random()),renderItem:r=>{const u=be[r.syncStatus??"pending"],A=u.icon,f=fe[r.categoria],M=f?.icon||q;return e.jsx(pe,{onDelete:()=>x(r.id||r.tempId),className:"bg-card rounded-2xl shadow-card overflow-hidden",children:e.jsxs(Q,{className:"p-4 border-0 shadow-none",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`p-2 rounded-lg ${f?.color||"bg-muted"}`,children:e.jsx(M,{className:"h-4 w-4"})}),e.jsx("span",{className:"font-medium",children:f?.label||"Denúncia"})]}),e.jsxs(I,{className:u.color,children:[e.jsx(A,{className:`w-3 h-3 mr-1 ${r.syncStatus==="syncing"?"animate-spin":""}`}),u.label]})]}),e.jsx("p",{className:"text-sm text-muted-foreground mb-3 line-clamp-2",children:r.texto||"Sem descrição"}),r.fotoUrl&&e.jsx("img",{src:r.fotoUrl,alt:"Denúncia",className:"w-full h-24 object-cover rounded-xl mb-3"}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground flex-wrap",children:[e.jsxs("span",{className:"font-mono bg-muted px-1.5 py-0.5 rounded",children:["#",r.protocolo]}),e.jsx("span",{children:"•"}),e.jsx("span",{children:k(r.bairroId)}),e.jsx("span",{children:"•"}),e.jsx("span",{children:new Date(r.createdAt).toLocaleDateString("pt-BR")})]}),r.syncStatus==="error"&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-border",children:[e.jsxs("div",{className:"flex items-start gap-2 text-sm text-destructive mb-2",children:[e.jsx($,{className:"h-4 w-4 shrink-0 mt-0.5"}),e.jsx("span",{children:r.errorMessage||"Falha ao sincronizar"})]}),e.jsxs(F,{size:"sm",variant:"outline",onClick:()=>C(r.id||r.tempId),className:"w-full",children:[e.jsx(X,{className:"w-4 h-4 mr-2"}),"Tentar Novamente"]})]})]})})}})]})]})}export{at as default};
