import{r as n,j as e,m as h,aI as L,n as K,b2 as $,ax as H,b5 as W,O as Z,z as ee,aJ as F,K as se,aQ as I,w as ae,y as M,a1 as B,l as _,X as V,aD as te}from"./vendor-app-D_TKIhWN.js";import{u as X,a as le,c as g,B as N,h as re,Q as z}from"./index-AdUPd3ED.js";import{I as ie}from"./input-BB9jSvg2.js";import{B as E}from"./badge-BhPD49rK.js";import{T as ne,a as oe,b as Q}from"./tabs-CgMRvZsu.js";import{S as q,a as U,b as Y,c as J,d as f}from"./select-39dahAtX.js";import{B as ce}from"./BottomTabBar-CQzxdfcW.js";import{u as de}from"./useAppStore-C43DhZKF.js";import"./sheet-CePQdH2L.js";import{b as me}from"./votes--jqTh9CK.js";import{v as P}from"./votes.service-DLtz9mVf.js";import{L as xe}from"./LoginPromptSheet-B8Pp0A58.js";import"./textarea-DeCYEUsx.js";import"./useCityName-rCiiR0dm.js";import"./bairros-Cf5Z_oCw.js";function ue({counts:s}){const c=s.sim+s.nao+s.abstencao+s.naoVotou;if(c===0)return null;const b=s.sim/c*100,v=s.nao/c*100,x=(s.abstencao+s.naoVotou)/c*100;return e.jsxs("div",{className:"h-1.5 w-full rounded-full overflow-hidden bg-muted flex",children:[e.jsx(h.div,{initial:{width:0},animate:{width:`${b}%`},transition:{duration:.6,delay:.2},className:"h-full bg-green-500"}),e.jsx(h.div,{initial:{width:0},animate:{width:`${v}%`},transition:{duration:.6,delay:.3},className:"h-full bg-red-500"}),x>0&&e.jsx(h.div,{initial:{width:0},animate:{width:`${x}%`},transition:{duration:.6,delay:.4},className:"h-full bg-gray-300 dark:bg-gray-600"})]})}function he({status:s}){switch(s){case"APROVADO":return e.jsx(K,{className:"w-3.5 h-3.5"});case"REJEITADO":return e.jsx($,{className:"w-3.5 h-3.5"});case"EM_ANDAMENTO":return e.jsx(F,{className:"w-3.5 h-3.5"});case"ARQUIVADO":return e.jsx(F,{className:"w-3.5 h-3.5 text-gray-400"})}}function pe({vote:s,index:c=0}){const b=X(),{isAuthenticated:v}=le(),x=me[s.status],[d,m]=n.useState(s.likesCount||0),[i,u]=n.useState(s.dislikesCount||0),[r,p]=n.useState(s.userReaction||null),[O,S]=n.useState(!1),[w,y]=n.useState(!1),[R,j]=n.useState("like"),k=l=>new Date(l).toLocaleDateString("pt-BR",{day:"2-digit",month:"short",year:"numeric"}),A=()=>{b(`/votacoes/${s.id}`)},C=async l=>{if(!v){j("like"),y(!0);return}if(O)return;const o=r,T=d,D=i;o===l?(p(null),l==="like"?m(t=>Math.max(0,t-1)):u(t=>Math.max(0,t-1))):(p(l),l==="like"?(m(t=>t+1),o==="dislike"&&u(t=>Math.max(0,t-1))):(u(t=>t+1),o==="like"&&m(t=>Math.max(0,t-1)))),S(!0);try{const t=await P.toggleReaction(s.id,l);m(t.likes_count),u(t.dislikes_count),p(t.user_reaction)}catch{p(o),m(T),u(D),re.error("Erro ao registrar reação")}finally{S(!1)}};return e.jsxs(e.Fragment,{children:[e.jsxs(h.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:c*.05},whileTap:{scale:.99},onClick:A,className:g("bg-card rounded-2xl p-4 border shadow-card","cursor-pointer transition-all duration-200","hover:shadow-md hover:border-border/80","active:shadow-sm"),children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-xs text-muted-foreground",children:[e.jsx(L,{className:"w-3.5 h-3.5"}),e.jsx("span",{children:k(s.date)})]}),e.jsxs(E,{className:g("gap-1 px-2 py-0.5 text-[10px] font-bold uppercase tracking-wider border",x.bgColor,x.textColor,x.borderColor),children:[e.jsx(he,{status:s.status}),x.label]})]}),e.jsx("h3",{className:"text-lg font-bold text-foreground leading-tight mb-1.5 line-clamp-2",children:s.title}),e.jsx("p",{className:"text-sm text-muted-foreground leading-relaxed line-clamp-2 mb-4",children:s.summary}),e.jsxs("div",{className:"flex items-center gap-4 mb-3",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"flex items-center justify-center w-6 h-6 rounded-full bg-green-100 dark:bg-green-900/30",children:e.jsx(K,{className:"w-3 h-3 text-green-600 dark:text-green-400"})}),e.jsx("span",{className:"text-sm font-bold text-green-600 dark:text-green-400",children:s.counts.sim})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"flex items-center justify-center w-6 h-6 rounded-full bg-red-100 dark:bg-red-900/30",children:e.jsx($,{className:"w-3 h-3 text-red-600 dark:text-red-400"})}),e.jsx("span",{className:"text-sm font-bold text-red-600 dark:text-red-400",children:s.counts.nao})]}),(s.counts.abstencao>0||s.counts.naoVotou>0)&&e.jsxs("span",{className:"text-xs text-muted-foreground",children:["+",s.counts.abstencao+s.counts.naoVotou," outros"]}),e.jsx("div",{className:"flex-1"}),e.jsxs("div",{className:"flex items-center gap-1 text-sm font-bold text-foreground",children:[e.jsx("span",{className:"text-green-600",children:s.counts.sim}),e.jsx("span",{className:"text-muted-foreground",children:"×"}),e.jsx("span",{className:"text-red-600",children:s.counts.nao})]})]}),e.jsx(ue,{counts:s.counts}),e.jsxs("div",{className:"flex items-center justify-between mt-4 pt-3 border-t border-border/50",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(h.button,{whileTap:{scale:.9},onClick:l=>{l.stopPropagation(),C("like")},className:g("flex items-center gap-1.5 text-xs font-medium transition-colors",r==="like"?"text-primary":"text-muted-foreground hover:text-foreground"),children:[e.jsx(H,{className:g("w-4 h-4",r==="like"&&"fill-current")}),e.jsx("span",{children:d})]}),e.jsxs(h.button,{whileTap:{scale:.9},onClick:l=>{l.stopPropagation(),C("dislike")},className:g("flex items-center gap-1.5 text-xs font-medium transition-colors",r==="dislike"?"text-red-500":"text-muted-foreground hover:text-foreground"),children:[e.jsx(W,{className:g("w-4 h-4",r==="dislike"&&"fill-current")}),e.jsx("span",{children:i})]}),e.jsxs("div",{className:"flex items-center gap-1.5 text-xs font-medium text-muted-foreground ml-1",children:[e.jsx(Z,{className:"w-4 h-4"}),e.jsx("span",{children:s.commentsCount||0})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("div",{className:"hidden sm:flex gap-1.5",children:s.tags.slice(0,1).map(l=>e.jsx("span",{className:"px-2 py-0.5 rounded-md bg-muted text-[10px] font-medium text-muted-foreground",children:l},l))}),e.jsxs(N,{variant:"ghost",size:"sm",className:"text-primary font-semibold gap-1 text-xs px-2 h-7",onClick:l=>{l.stopPropagation(),A()},children:["Ver detalhes",e.jsx(ee,{className:"w-3.5 h-3.5"})]})]})]})]}),e.jsx(xe,{open:w,onClose:()=>y(!1),action:R})]})}function ge(){return e.jsx("div",{className:"space-y-4 animate-pulse",children:[...Array(4)].map((s,c)=>e.jsxs("div",{className:"bg-card rounded-2xl p-4 border",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"h-4 w-20 bg-muted rounded"}),e.jsx("div",{className:"h-5 w-16 bg-muted rounded-full"})]}),e.jsx("div",{className:"h-6 w-3/4 bg-muted rounded mb-2"}),e.jsx("div",{className:"h-4 w-full bg-muted rounded mb-1"}),e.jsx("div",{className:"h-4 w-2/3 bg-muted rounded mb-4"}),e.jsxs("div",{className:"flex gap-4 mb-3",children:[e.jsx("div",{className:"h-6 w-12 bg-muted rounded"}),e.jsx("div",{className:"h-6 w-12 bg-muted rounded"})]}),e.jsx("div",{className:"h-1.5 w-full bg-muted rounded-full"})]},c))})}function Re(){const s=X();se();const{activeTab:c,setActiveTab:b}=de(),[v,x]=n.useState("votacoes"),[d,m]=n.useState(""),[i,u]=n.useState("all"),[r,p]=n.useState("all"),[O,S]=n.useState("all"),[w,y]=n.useState(!1),{data:R,isLoading:j,error:k}=I({queryKey:z.votes.votacoes({status:i!=="all"?i:void 0,ano:r!=="all"?r:void 0,search:d||void 0}),queryFn:()=>P.getAll({status:i!=="all"?i:void 0,ano:r!=="all"?r:void 0,search:d||void 0,perPage:50}),staleTime:5*60*1e3}),{data:A}=I({queryKey:z.votes.anos,queryFn:()=>P.getAnos(),staleTime:60*60*1e3}),C=R?.data||[],l=A||[2026,2025],o=n.useMemo(()=>C.map(a=>({id:a.id,status:a.status,date:a.data,title:a.titulo,summary:a.subtitulo||"",counts:a.counts,tags:a.tags})),[C]),T=()=>{m(""),u("all"),p("all"),S("all"),y(!1)},D=a=>{b(a),s("/")},t=d||i!=="all"||r!=="all"||O!=="all";return e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-muted/50",children:e.jsxs("div",{className:"relative w-full max-w-[420px] h-full bg-background overflow-hidden shadow-elevated",children:[e.jsxs("div",{className:"h-full overflow-y-auto pb-24",children:[e.jsxs("header",{className:"sticky top-0 z-40 bg-background/95 backdrop-blur-xl border-b",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 safe-top",children:[e.jsx(N,{variant:"ghost",size:"icon",onClick:()=>s(-1),children:e.jsx(ae,{className:"h-5 w-5"})}),e.jsx("h1",{className:"text-lg font-bold",children:"Câmara Municipal"}),e.jsx(N,{variant:"ghost",size:"icon",onClick:()=>y(!w),className:g(w&&"bg-primary/10 text-primary"),children:e.jsx(M,{className:"h-5 w-5"})})]}),e.jsx("div",{className:"px-4 pb-3",children:e.jsx(ne,{value:v,onValueChange:a=>{a==="vereadores"?s("/vereadores"):x(a)},children:e.jsxs(oe,{className:"w-full grid grid-cols-2",children:[e.jsxs(Q,{value:"votacoes",className:"gap-2",children:[e.jsx(L,{className:"h-4 w-4"}),"Votações"]}),e.jsxs(Q,{value:"vereadores",className:"gap-2",children:[e.jsx(B,{className:"h-4 w-4"}),"Vereadores"]})]})})})]}),e.jsxs("div",{className:"sticky top-28 z-30 bg-background/95 backdrop-blur-xl border-b px-4 py-3 space-y-3",children:[e.jsx(_,{children:w&&e.jsx(h.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"overflow-hidden",children:e.jsxs("div",{className:"relative",children:[e.jsx(M,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(ie,{placeholder:"Buscar votação...",value:d,onChange:a=>m(a.target.value),className:"pl-10 pr-10",autoFocus:!0}),d&&e.jsx("button",{onClick:()=>m(""),className:"absolute right-3 top-1/2 -translate-y-1/2",children:e.jsx(V,{className:"h-4 w-4 text-muted-foreground hover:text-foreground"})})]})})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(te,{className:"h-4 w-4 text-muted-foreground flex-shrink-0"}),e.jsxs(q,{value:i,onValueChange:a=>u(a),children:[e.jsx(U,{className:"flex-1 h-9 text-xs",children:e.jsx(Y,{placeholder:"Status"})}),e.jsxs(J,{children:[e.jsx(f,{value:"all",children:"Todos"}),e.jsx(f,{value:"APROVADO",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-green-500"}),"Aprovados"]})}),e.jsx(f,{value:"REJEITADO",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-red-500"}),"Rejeitados"]})}),e.jsx(f,{value:"EM_ANDAMENTO",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-blue-500"}),"Em Andamento"]})})]})]}),e.jsxs(q,{value:r.toString(),onValueChange:a=>p(a==="all"?"all":parseInt(a)),children:[e.jsx(U,{className:"w-24 h-9 text-xs",children:e.jsx(Y,{placeholder:"Ano"})}),e.jsxs(J,{children:[e.jsx(f,{value:"all",children:"Todos"}),l.map(a=>e.jsx(f,{value:a.toString(),children:a},a))]})]})]}),t&&e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[i!=="all"&&e.jsxs(E,{variant:"secondary",className:"gap-1 text-xs",children:[i==="APROVADO"&&"Aprovados",i==="REJEITADO"&&"Rejeitados",i==="EM_ANDAMENTO"&&"Em Andamento",e.jsx(V,{className:"h-3 w-3 cursor-pointer",onClick:()=>u("all")})]}),r!=="all"&&e.jsxs(E,{variant:"secondary",className:"gap-1 text-xs",children:[r,e.jsx(V,{className:"h-3 w-3 cursor-pointer",onClick:()=>p("all")})]}),d&&e.jsxs(E,{variant:"secondary",className:"gap-1 text-xs",children:['"',d,'"',e.jsx(V,{className:"h-3 w-3 cursor-pointer",onClick:()=>m("")})]}),e.jsx("button",{onClick:T,className:"text-xs text-primary font-medium ml-auto",children:"Limpar tudo"})]})]}),e.jsxs("main",{className:"px-4 py-5",children:[!j&&o.length>0&&e.jsx(h.div,{initial:{opacity:0},animate:{opacity:1},className:"flex items-center justify-between mb-4",children:e.jsxs("span",{className:"text-sm text-muted-foreground",children:[o.length," ",o.length===1?"votação":"votações"]})}),j&&e.jsx(ge,{}),k&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx("p",{className:"text-muted-foreground",children:"Erro ao carregar votações"}),e.jsx(N,{variant:"outline",size:"sm",className:"mt-4",onClick:()=>window.location.reload(),children:"Tentar novamente"})]}),!j&&!k&&o.length===0&&e.jsxs("div",{className:"flex flex-col items-center justify-center py-16 text-center",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-muted flex items-center justify-center mb-4",children:e.jsx(L,{className:"h-8 w-8 text-muted-foreground"})}),e.jsx("p",{className:"font-medium text-foreground mb-1",children:"Nenhuma votação encontrada"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:t?"Tente ajustar os filtros de busca":"As votações aparecerão aqui quando forem registradas"}),t&&e.jsx(N,{variant:"outline",size:"sm",onClick:T,children:"Limpar filtros"}),e.jsx("div",{className:"mt-6 pt-6 border-t w-full",children:e.jsxs(N,{variant:"default",className:"w-full gap-2",onClick:()=>s("/vereadores"),children:[e.jsx(B,{className:"h-4 w-4"}),"Ver Vereadores"]})})]}),!j&&!k&&o.length>0&&e.jsx(_,{mode:"popLayout",children:e.jsx(h.div,{layout:!0,className:"space-y-4 pb-8",children:o.map((a,G)=>e.jsx(pe,{vote:a,index:G},a.id))})})]})]}),e.jsx(ce,{activeTab:c,onTabChange:D})]})})}export{Re as default};
