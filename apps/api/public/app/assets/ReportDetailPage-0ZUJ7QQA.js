import{r as p,j as e}from"./vendor-radix-Dq3xRYQM.js";import{B as c}from"./button-CBVrI7SX.js";import{B as N}from"./badge-DWNosDOo.js";import{C as f}from"./card-DXh2ZFkN.js";import{S as i}from"./skeleton-BWo41sW9.js";import{A as b}from"./aspect-ratio-CqJLvMwm.js";import{u as R}from"./vendor-query-DJ0Mukyd.js";import{r as B}from"./report.service-CWzng92P.js";import{Q as D}from"./client-BTgelhMB.js";import{e as $,u as E,T as F,W as P,c as d,g as G,B as q,i as v,X as O}from"./index-wJGYTEZC.js";import{L as H}from"./LocationMap-B7YeAUja.js";import{F as Q}from"./file-text-xcztrAgC.js";import{C as k}from"./circle-check-Tiz2-bGm.js";import{C}from"./clock-C2LPT8JJ.js";import{A as w}from"./arrow-left-CfmyxvCZ.js";import{C as U}from"./copy-CHWnH3ZY.js";import{S as _}from"./share-2-BvUSefYU.js";import{M as y}from"./map-pin-BTlpYj1n.js";import{E as K}from"./external-link-B8lKHkxD.js";import{A as V,m as j}from"./vendor-motion-CBZKS1Mr.js";import{C as W}from"./camera-C4WzHc4B.js";import{h as Y,f as T}from"./vendor-utils-DHocNF0y.js";import{p as g}from"./pt-BR-9YxDs27S.js";import"./localDatabase-B_hkpFUy.js";import"./navigation-BQ-vinaB.js";const x={recebido:{label:"Recebido",color:"text-blue-600",bgColor:"bg-blue-100 dark:bg-blue-900/30",icon:Q},em_analise:{label:"Em Análise",color:"text-yellow-600",bgColor:"bg-yellow-100 dark:bg-yellow-900/30",icon:C},resolvido:{label:"Resolvido",color:"text-green-600",bgColor:"bg-green-100 dark:bg-green-900/30",icon:k},rejeitado:{label:"Rejeitado",color:"text-red-600",bgColor:"bg-red-100 dark:bg-red-900/30",icon:F}};function X({images:a,onImageClick:l}){return!a||a.length===0?e.jsx("div",{className:"flex items-center justify-center h-48 bg-muted/50 rounded-2xl",children:e.jsxs("div",{className:"text-center text-muted-foreground",children:[e.jsx(W,{className:"w-8 h-8 mx-auto mb-2 opacity-50"}),e.jsx("p",{className:"text-sm",children:"Sem fotos"})]})}):a.length===1?e.jsx(j.div,{whileTap:{scale:.98},onClick:()=>l(0),className:"cursor-pointer",children:e.jsx(b,{ratio:16/9,className:"overflow-hidden rounded-2xl",children:e.jsx("img",{src:a[0].thumbUrl||a[0].url,alt:"Foto da denúncia",className:"w-full h-full object-cover"})})}):e.jsx("div",{className:"grid grid-cols-2 gap-2",children:a.slice(0,4).map((r,t)=>e.jsxs(j.div,{whileTap:{scale:.95},onClick:()=>l(t),className:d("cursor-pointer overflow-hidden rounded-xl relative",t===0&&a.length>2&&"col-span-2"),children:[e.jsx(b,{ratio:t===0?16/9:1,children:e.jsx("img",{src:r.thumbUrl||r.url,alt:`Foto ${t+1}`,className:"w-full h-full object-cover"})}),t===3&&a.length>4&&e.jsx("div",{className:"absolute inset-0 bg-black/50 flex items-center justify-center",children:e.jsxs("span",{className:"text-white text-lg font-semibold",children:["+",a.length-4]})})]},r.id))})}function J({history:a}){if(!a||a.length===0)return null;const l=[...a].sort((r,t)=>new Date(t.at).getTime()-new Date(r.at).getTime());return e.jsx("div",{className:"space-y-0",children:l.map((r,t)=>{const o=x[r.status]||x.recebido,m=o.icon,s=t===0,h=t===l.length-1;return e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:d("w-8 h-8 rounded-full flex items-center justify-center shrink-0",s?o.bgColor:"bg-muted"),children:e.jsx(m,{className:d("w-4 h-4",s?o.color:"text-muted-foreground")})}),!h&&e.jsx("div",{className:"w-0.5 flex-1 bg-border min-h-[24px]"})]}),e.jsxs("div",{className:d("pb-4",h&&"pb-0"),children:[e.jsx("p",{className:d("font-medium",s?o.color:"text-muted-foreground"),children:o.label}),r.note&&e.jsx("p",{className:"text-sm text-muted-foreground mt-0.5",children:r.note}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[T(new Date(r.at),"d 'de' MMMM, HH:mm",{locale:g}),r.by&&` • ${r.by}`]})]})]},t)})})}function Z({images:a,initialIndex:l,onClose:r}){const[t,o]=p.useState(l);return e.jsxs(j.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-50 bg-black flex flex-col",children:[e.jsxs("div",{className:"safe-top flex items-center justify-between p-4",children:[e.jsx(c,{variant:"ghost",size:"icon",onClick:r,className:"text-white",children:e.jsx(O,{className:"w-6 h-6"})}),e.jsxs("span",{className:"text-white text-sm",children:[t+1," / ",a.length]}),e.jsx("div",{className:"w-10"})," "]}),e.jsx("div",{className:"flex-1 flex items-center justify-center p-4",children:e.jsx("img",{src:a[t].url,alt:`Foto ${t+1}`,className:"max-w-full max-h-full object-contain"})}),a.length>1&&e.jsx("div",{className:"safe-bottom flex gap-2 p-4 overflow-x-auto",children:a.map((m,s)=>e.jsx(j.button,{whileTap:{scale:.9},onClick:()=>o(s),className:d("w-16 h-16 rounded-lg overflow-hidden shrink-0 border-2",s===t?"border-white":"border-transparent opacity-50"),children:e.jsx("img",{src:m.url,alt:"",className:"w-full h-full object-cover"})},s))})]})}function ee(){return e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx("div",{className:"safe-top bg-background border-b",children:e.jsxs("div",{className:"flex items-center gap-3 px-4 py-3",children:[e.jsx(i,{className:"w-10 h-10 rounded-full"}),e.jsx(i,{className:"h-6 w-32"})]})}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsx(i,{className:"h-48 w-full rounded-2xl"}),e.jsx(i,{className:"h-6 w-3/4"}),e.jsx(i,{className:"h-4 w-full"}),e.jsx(i,{className:"h-4 w-2/3"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(i,{className:"h-8 w-24 rounded-full"}),e.jsx(i,{className:"h-8 w-24 rounded-full"})]})]})]})}function Se(){const{id:a}=$(),l=E(),[r,t]=p.useState(!1),[o,m]=p.useState(0),{data:s,isLoading:h,error:S}=R({queryKey:D.reports.detail(a||""),queryFn:()=>B.getReportById(a||""),enabled:!!a,staleTime:1e3*60*5}),u=p.useMemo(()=>s&&x[s.status]||x.recebido,[s]),A=()=>{s?.protocol&&(navigator.clipboard.writeText(s.protocol),v.success("Protocolo copiado!"))},M=async()=>{const n=`${window.location.origin}/denuncia/${a}`;if(navigator.share)try{await navigator.share({title:s?.title||"Denúncia",text:`Acompanhe esta denúncia em Tijucas: ${s?.title}`,url:n})}catch{}else navigator.clipboard.writeText(n),v.success("Link copiado!")},I=n=>{m(n),t(!0)},z=n=>{setActiveTab(n),l(`/?tab=${n}`)};if(h)return e.jsx(ee,{});if(S||!s)return e.jsxs("div",{className:"min-h-screen bg-background flex flex-col",children:[e.jsx("div",{className:"safe-top bg-background border-b",children:e.jsxs("div",{className:"flex items-center gap-3 px-4 py-3",children:[e.jsx(c,{variant:"ghost",size:"icon",onClick:()=>l(-1),children:e.jsx(w,{className:"w-5 h-5"})}),e.jsx("h1",{className:"font-semibold",children:"Denúncia"})]})}),e.jsx("div",{className:"flex-1 flex items-center justify-center p-8",children:e.jsxs("div",{className:"text-center",children:[e.jsx(P,{className:"w-12 h-12 mx-auto mb-4 text-muted-foreground"}),e.jsx("h2",{className:"text-lg font-semibold mb-2",children:"Não foi possível carregar"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Verifique sua conexão e tente novamente"}),e.jsx(c,{onClick:()=>l(-1),children:"Voltar"})]})})]});const L=u.icon;return e.jsxs("div",{className:"relative min-h-screen bg-slate-50 dark:bg-slate-950",children:[e.jsxs("div",{className:"pb-32",children:[e.jsx("div",{className:"safe-top bg-white dark:bg-slate-900 border-b sticky top-0 z-30",children:e.jsxs("div",{className:"flex items-center justify-between px-4 py-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(c,{variant:"ghost",size:"icon",onClick:()=>l(-1),className:"shrink-0",children:e.jsx(w,{className:"w-5 h-5"})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"text-xs text-muted-foreground truncate",children:"Protocolo"}),e.jsx("p",{className:"font-mono text-sm font-medium truncate",children:s.protocol})]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(c,{variant:"ghost",size:"icon",onClick:A,children:e.jsx(U,{className:"w-4 h-4"})}),e.jsx(c,{variant:"ghost",size:"icon",onClick:M,children:e.jsx(_,{className:"w-4 h-4"})})]})]})}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{className:d("inline-flex items-center gap-2 px-3 py-1.5 rounded-full text-sm font-medium",u.bgColor,u.color),children:[e.jsx(L,{className:"w-4 h-4"}),u.label]}),e.jsx(X,{images:s.media||[],onImageClick:I}),e.jsxs(f,{className:"p-4",children:[e.jsx("h1",{className:"text-xl font-bold mb-2",children:s.title}),e.jsx("p",{className:"text-muted-foreground",children:s.description})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[s.category&&e.jsxs(N,{variant:"secondary",className:"gap-1.5 pl-2",children:[e.jsx("span",{className:"text-lg leading-none",children:s.category.icon}),s.category.name]}),e.jsxs(N,{variant:"outline",className:"gap-1.5",children:[e.jsx(G,{className:"w-3 h-3"}),Y(new Date(s.createdAt),{addSuffix:!0,locale:g})]})]}),s.latitude&&s.longitude&&e.jsxs(f,{className:"overflow-hidden",children:[e.jsx("div",{className:"p-4 border-b",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-primary/10 text-primary shrink-0",children:e.jsx(y,{className:"w-5 h-5"})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"font-medium",children:"Localização"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.addressText||"Endereço aproximado"}),s.bairro?.nome&&e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:s.bairro.nome})]})]})}),e.jsx("div",{className:"relative z-0",children:e.jsx(H,{latitude:s.latitude,longitude:s.longitude,onLocationChange:()=>{},className:"h-48 w-full border-none rounded-none",readOnly:!0})}),e.jsx("div",{className:"p-3 bg-muted/30",children:e.jsx(c,{variant:"outline",className:"w-full gap-2",asChild:!0,children:e.jsxs("a",{href:`https://www.google.com/maps?q=${s.latitude},${s.longitude}`,target:"_blank",rel:"noopener noreferrer",children:[e.jsx(y,{className:"w-4 h-4 text-red-500"}),"Abrir no Google Maps",e.jsx(K,{className:"w-3 h-3 ml-auto opacity-50"})]})})})]}),s.history&&s.history.length>0&&e.jsxs(f,{className:"p-4",children:[e.jsxs("h2",{className:"font-semibold mb-4 flex items-center gap-2",children:[e.jsx(C,{className:"w-4 h-4 text-primary"}),"Histórico"]}),e.jsx(J,{history:s.history})]}),s.resolvedAt&&e.jsx(f,{className:"p-4 bg-green-50 dark:bg-green-950/20 border-green-200 dark:border-green-900",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(k,{className:"w-5 h-5 text-green-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-green-700 dark:text-green-400",children:"Resolvido"}),e.jsx("p",{className:"text-sm text-green-600/80 dark:text-green-400/80",children:T(new Date(s.resolvedAt),"d 'de' MMMM 'de' yyyy",{locale:g})})]})]})})]})]}),e.jsx("div",{className:"fixed bottom-0 left-0 right-0 z-50",children:e.jsx(q,{activeTab:"reportar",onTabChange:z})}),e.jsx(V,{children:r&&s.media&&e.jsx(Z,{images:s.media,initialIndex:o,onClose:()=>t(!1)})})]})}export{Se as default};
