import{aQ as U,aR as P,aS as q,r as v,j as e,m as p,aj as J,a as W,l as K,X as Z,aT as ee,y as te,aU as se,aV as ae,a8 as re,aW as ne,aX as oe,aE as ie,J as le,s as ce,ay as de,M as ue,w as me,ax as xe,K as pe,aY as he,a2 as fe,O as ge}from"./vendor-app-CSqspwsb.js";import{Q as m,d as O,u as B,a as be,B as L}from"./index-D8_N7e1R.js";import{b as je}from"./bairros-Cf5Z_oCw.js";import{t as w,f as ye,a as ve}from"./useUploadImage-_wUKWdNh.js";import{B as we}from"./badge-DRBw9e36.js";import{S as d}from"./skeleton-ChOgsobJ.js";import{C as Ne,a as ke}from"./CommentComposer-Bnq0spzc.js";import{D as Ce,a as Te,b as Se,c as y,d as Ae}from"./dropdown-menu-B2z3rh5a.js";import"./textarea-BCal8kxl.js";function De(t){return U({queryKey:m.topics.detail(t),queryFn:()=>w.getById(t),enabled:!!t,retry:(r,n)=>n?.status===404?!1:r<3})}function Le(t){return U({queryKey:m.topics.comments(t),queryFn:()=>w.getComments(t),enabled:!!t})}function Pe(){const t=P();return q({mutationFn:async({id:r})=>w.toggleLike(r),onSuccess:(r,{id:n})=>{t.invalidateQueries({queryKey:m.topics.all}),t.invalidateQueries({queryKey:m.topics.detail(n)})}})}function qe(t){const r=P();return q({mutationFn:n=>w.addComment(t,n),onSuccess:()=>{r.invalidateQueries({queryKey:m.topics.comments(t)}),r.invalidateQueries({queryKey:m.topics.detail(t)})}})}function Ee(t){const r=P();return q({onMutate:async({commentId:n,liked:a})=>{await r.cancelQueries({queryKey:m.topics.comments(t)});const i=r.getQueryData(m.topics.comments(t));return r.setQueryData(m.topics.comments(t),s=>s&&{...s,data:z(s.data,n,!a)}),{previousComments:i}},mutationFn:async({commentId:n})=>w.toggleCommentLike(n),onError:(n,a,i)=>{i?.previousComments&&r.setQueryData(m.topics.comments(t),i.previousComments)},onSettled:()=>{setTimeout(()=>{r.invalidateQueries({queryKey:m.topics.comments(t)})},500)}})}function z(t,r,n){return t.map(a=>a.id===r?{...a,liked:n,likesCount:n?(a.likesCount??0)+1:Math.max(0,(a.likesCount??0)-1)}:a.replies&&a.replies.length>0?{...a,replies:z(a.replies,r,n)}:a)}function Fe({images:t,alt:r=""}){const[n,a]=v.useState(null),[i,s]=v.useState(0);if(t.length===0)return null;const h=o=>{a(o),s(o),document.body.style.overflow="hidden"},x=()=>{a(null),document.body.style.overflow=""},g=()=>{s(o=>(o+1)%t.length)},u=()=>{s(o=>(o-1+t.length)%t.length)};return e.jsxs(e.Fragment,{children:[t.length===1?e.jsxs(p.button,{whileTap:{scale:.98},onClick:()=>h(0),className:"relative w-full aspect-video rounded-xl overflow-hidden bg-muted group",children:[e.jsx("img",{src:t[0],alt:r,loading:"lazy",className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute inset-0 bg-black/0 group-hover:bg-black/10 transition-colors flex items-center justify-center",children:e.jsx(J,{className:"w-8 h-8 text-white opacity-0 group-hover:opacity-80 transition-opacity drop-shadow-lg"})})]}):e.jsx("div",{className:"flex gap-2 overflow-x-auto scrollbar-hide -mx-4 px-4",children:t.map((o,l)=>e.jsxs(p.button,{whileTap:{scale:.95},onClick:()=>h(l),className:"relative flex-shrink-0 w-32 h-32 rounded-xl overflow-hidden bg-muted group",children:[e.jsx("img",{src:o,alt:`${r} ${l+1}`,loading:"lazy",className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute inset-0 bg-black/0 group-hover:bg-black/10 transition-colors"})]},l))}),n!==null&&W.createPortal(e.jsx(K,{children:e.jsxs(p.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-50 bg-black flex flex-col",onClick:x,children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 safe-top",children:[e.jsxs("span",{className:"text-white/70 text-sm",children:[i+1," / ",t.length]}),e.jsx("button",{onClick:x,className:"p-2 rounded-full bg-white/10 hover:bg-white/20 transition-colors min-h-[44px] min-w-[44px] flex items-center justify-center","aria-label":"Fechar",children:e.jsx(Z,{className:"w-6 h-6 text-white"})})]}),e.jsx("div",{className:"flex-1 flex items-center justify-center px-4",onClick:o=>o.stopPropagation(),children:e.jsx(p.img,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},src:t[i],alt:`${r} ${i+1}`,className:"max-w-full max-h-full object-contain rounded-lg",draggable:!1},i)}),t.length>1&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:o=>{o.stopPropagation(),u()},className:"absolute left-2 top-1/2 -translate-y-1/2 p-3 rounded-full bg-white/10 hover:bg-white/20 transition-colors min-h-[44px] min-w-[44px] flex items-center justify-center","aria-label":"Imagem anterior",children:e.jsx(ee,{className:"w-6 h-6 text-white"})}),e.jsx("button",{onClick:o=>{o.stopPropagation(),g()},className:"absolute right-2 top-1/2 -translate-y-1/2 p-3 rounded-full bg-white/10 hover:bg-white/20 transition-colors min-h-[44px] min-w-[44px] flex items-center justify-center","aria-label":"Pr√≥xima imagem",children:e.jsx(te,{className:"w-6 h-6 text-white"})})]}),t.length>1&&e.jsx("div",{className:"flex justify-center gap-2 py-4 safe-bottom",children:t.map((o,l)=>e.jsx("button",{onClick:b=>{b.stopPropagation(),s(l)},className:`w-2 h-2 rounded-full transition-colors ${l===i?"bg-white":"bg-white/30"}`,"aria-label":`Ir para imagem ${l+1}`},l))})]})}),document.body)]})}function Me({topicId:t,isAnonymous:r,children:n,onSave:a,onHide:i,onReport:s,onBlock:h}){const{toast:x}=O(),[g,u]=v.useState(!1),o=async()=>{const A=`${window.location.origin}/topico/${t}`;await navigator.clipboard.writeText(A),x({title:"Link copiado!",description:"O link foi copiado para a √°rea de transfer√™ncia."}),u(!1)},l=()=>{a?.(),x({title:"T√≥pico salvo",description:"Voc√™ pode encontr√°-lo nos salvos."}),u(!1)},b=()=>{i?.(),x({title:"T√≥pico oculto",description:"Voc√™ n√£o ver√° mais este t√≥pico."}),u(!1)},T=()=>{s?.(),x({title:"Den√∫ncia enviada",description:"Obrigado por ajudar a manter a comunidade segura."}),u(!1)},S=()=>{h?.(),x({title:"Usu√°rio bloqueado",description:"Voc√™ n√£o ver√° mais publica√ß√µes desta pessoa."}),u(!1)};return e.jsxs(Ce,{open:g,onOpenChange:u,children:[e.jsx(Te,{asChild:!0,children:n}),e.jsxs(Se,{align:"end",className:"w-56 rounded-xl",children:[e.jsxs(y,{onClick:l,className:"flex items-center gap-3 py-3 cursor-pointer",children:[e.jsx(se,{className:"w-4 h-4"}),e.jsx("span",{children:"Salvar"})]}),e.jsxs(y,{onClick:o,className:"flex items-center gap-3 py-3 cursor-pointer",children:[e.jsx(ae,{className:"w-4 h-4"}),e.jsx("span",{children:"Copiar link"})]}),e.jsx(Ae,{}),e.jsxs(y,{onClick:b,className:"flex items-center gap-3 py-3 cursor-pointer",children:[e.jsx(re,{className:"w-4 h-4"}),e.jsx("span",{children:"Ocultar este assunto"})]}),e.jsxs(y,{onClick:T,className:"flex items-center gap-3 py-3 cursor-pointer text-orange-600",children:[e.jsx(ne,{className:"w-4 h-4"}),e.jsx("span",{children:"Denunciar"})]}),!r&&e.jsxs(y,{onClick:S,className:"flex items-center gap-3 py-3 cursor-pointer text-red-600",children:[e.jsx(oe,{className:"w-4 h-4"}),e.jsx("span",{children:"Bloquear usu√°rio"})]})]})]})}const R={reclamacao:{label:"Reclama√ß√£o",color:"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400"},sugestao:{label:"Sugest√£o",color:"bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400"},duvida:{label:"D√∫vida",color:"bg-purple-100 text-purple-700 dark:bg-purple-900/30 dark:text-purple-400"},alerta:{label:"Alerta",color:"bg-orange-100 text-orange-700 dark:bg-orange-900/30 dark:text-orange-400"},elogio:{label:"Elogio",color:"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400"},outros:{label:"Outros",color:"bg-gray-100 text-gray-700 dark:bg-gray-800 dark:text-gray-400"}};function Qe(){return e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx("header",{className:"sticky top-0 z-20 bg-background/95 backdrop-blur-md border-b border-border safe-top",children:e.jsxs("div",{className:"flex items-center justify-between px-4 py-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(d,{className:"w-10 h-10 rounded-full"}),e.jsx(d,{className:"w-24 h-6"})]}),e.jsx(d,{className:"w-10 h-10 rounded-full"})]})}),e.jsxs("article",{className:"px-4 py-4 space-y-4",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(d,{className:"w-24 h-6 rounded-full"}),e.jsx(d,{className:"w-20 h-6 rounded-full"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(d,{className:"w-10 h-10 rounded-full"}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(d,{className:"w-32 h-4"}),e.jsx(d,{className:"w-16 h-3"})]})]}),e.jsx(d,{className:"w-full h-8"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{className:"w-full h-4"}),e.jsx(d,{className:"w-full h-4"}),e.jsx(d,{className:"w-3/4 h-4"})]})]})]})}function $e(){const t=B();return e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center p-4",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("div",{className:"w-20 h-20 mx-auto rounded-full bg-muted flex items-center justify-center",children:e.jsx("span",{className:"text-3xl",children:"üîç"})}),e.jsx("h2",{className:"text-xl font-semibold",children:"T√≥pico n√£o encontrado"}),e.jsx("p",{className:"text-muted-foreground max-w-sm",children:"Este t√≥pico pode ter sido removido ou o link est√° incorreto."}),e.jsx(L,{onClick:()=>t(-1),variant:"outline",children:"Voltar"})]})})}function Ye(){const{id:t}=ie(),[r]=le(),n=B(),{toast:a}=O(),{isAuthenticated:i}=be(),{data:s,isLoading:h,isError:x}=De(t||""),{data:g}=Le(t||""),u=g?.data||[],o=Pe(),l=qe(t||""),b=Ee(t||""),[T,S]=v.useState(),A=r.get("comment")==="true",j=v.useCallback(c=>i?!0:(a({title:"Login necess√°rio",description:`Para ${c}, voc√™ precisa estar logado.`,action:e.jsx(L,{variant:"outline",size:"sm",onClick:()=>n(`/login?redirect=${encodeURIComponent(window.location.pathname)}`),children:"Entrar"})}),!1),[i,a,n]);if(h)return e.jsx(Qe,{});if(x||!s)return e.jsx($e,{});const E=R[s.categoria]||R.outros,I=s.bairro?.nome||je.find(c=>c.id===s.bairroId)?.nome||"Tijucas",D=s.autor?.nome||(s.isAnon?"An√¥nimo":"Usu√°rio"),V=async()=>{const c={title:s.titulo,text:s.texto,url:window.location.href};if(navigator.share)try{await navigator.share(c)}catch{}else await navigator.clipboard.writeText(c.url),a({title:"Link copiado!",description:"O link foi copiado para a √°rea de transfer√™ncia."})},_=()=>{j("curtir")&&(navigator.vibrate&&navigator.vibrate(10),o.mutate({id:s.id,liked:s.liked||!1}))},Y=async(c,f,N)=>{if(j("comentar"))try{await l.mutateAsync({texto:c,isAnon:f,imageUrl:N}),a({title:"Coment√°rio enviado!",description:"Seu coment√°rio foi publicado."}),S(void 0)}catch{a({title:"Erro ao enviar coment√°rio",description:"Tente novamente.",variant:"destructive"})}},H=async(c,f,N,k)=>{if(j("responder"))try{await l.mutateAsync({texto:f,parentId:c,isAnon:N,imageUrl:k}),a({title:"Resposta enviada!"})}catch{a({title:"Erro ao enviar resposta",description:"Tente novamente.",variant:"destructive"})}},X=c=>{if(!j("curtir"))return;const f=(M,Q)=>{for(const C of M){if(C.id===Q)return C;if(C.replies){const $=f(C.replies,Q);if($)return $}}},k=f(u,c)?.liked??!1;navigator.vibrate&&navigator.vibrate(10),b.mutate({commentId:c,liked:k})},G=()=>{i||j("comentar")},F=s.fotoUrl?[s.fotoUrl]:[];return e.jsxs("div",{className:"min-h-screen bg-background pb-32",children:[e.jsx("header",{className:"sticky top-0 z-20 bg-background/95 backdrop-blur-md border-b border-border safe-top",children:e.jsxs("div",{className:"flex items-center justify-between px-4 py-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(p.button,{whileTap:{scale:.9},onClick:()=>n(-1),className:"p-2 -ml-2 rounded-full hover:bg-muted transition-colors min-h-[44px] min-w-[44px] flex items-center justify-center","aria-label":"Voltar",children:e.jsx(ce,{className:"w-5 h-5"})}),e.jsx("h1",{className:"text-lg font-semibold",children:"T√≥pico"})]}),e.jsx(p.button,{whileTap:{scale:.9},onClick:V,className:"p-2 rounded-full hover:bg-muted transition-colors min-h-[44px] min-w-[44px] flex items-center justify-center","aria-label":"Compartilhar",children:e.jsx(de,{className:"w-5 h-5"})})]})}),e.jsxs("article",{className:"px-4 py-4",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2 mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx(we,{className:`${E.color} border-0`,children:E.label}),e.jsxs("span",{className:"text-sm text-muted-foreground flex items-center gap-1",children:[e.jsx(ue,{className:"w-3 h-3"}),I]})]}),e.jsx("time",{dateTime:new Date(s.createdAt).toISOString(),title:ve(s.createdAt),className:"text-sm text-muted-foreground",children:ye(s.createdAt)})]}),e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-muted flex items-center justify-center text-sm font-medium text-muted-foreground overflow-hidden",children:s.autor?.avatarUrl?e.jsx("img",{src:s.autor.avatarUrl,alt:D,className:"w-full h-full object-cover"}):s.isAnon?"?":D[0]?.toUpperCase()}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-foreground",children:D}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Autor"})]})]}),e.jsx("h2",{className:"text-xl font-bold text-foreground leading-tight mb-3",children:s.titulo}),e.jsx("p",{className:"text-base text-foreground leading-relaxed whitespace-pre-wrap mb-4",children:s.texto}),F.length>0&&e.jsx("div",{className:"mb-4",children:e.jsx(Fe,{images:F,alt:s.titulo})}),e.jsxs("div",{className:"flex items-center justify-between pt-4 border-t border-border/50",children:[e.jsxs(p.button,{whileTap:{scale:.9},onClick:_,disabled:o.isPending,className:"flex items-center gap-2 py-2 px-4 rounded-full hover:bg-muted/50 transition-colors min-h-[44px] disabled:opacity-50",children:[e.jsx(p.div,{animate:s.liked?{scale:[1,1.3,1]}:{},transition:{duration:.3},children:o.isPending?e.jsx(me,{className:"w-6 h-6 animate-spin text-muted-foreground"}):e.jsx(xe,{className:`w-6 h-6 ${s.liked?"fill-red-500 text-red-500":"text-muted-foreground"}`})}),e.jsxs("span",{className:`font-medium ${s.liked?"text-red-500":"text-muted-foreground"}`,children:[s.likesCount," Curtidas"]})]}),e.jsxs("div",{className:"flex items-center gap-1 text-muted-foreground",children:[e.jsx(pe,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm font-medium",children:s.commentsCount})]}),e.jsx(Me,{topicId:s.id,isAnonymous:s.isAnon,children:e.jsx(p.button,{whileTap:{scale:.9},className:"p-2 rounded-full hover:bg-muted/50 transition-colors min-h-[44px] min-w-[44px] flex items-center justify-center",children:e.jsx(he,{className:"w-5 h-5 text-muted-foreground"})})})]})]}),e.jsx("section",{className:"border-t border-border pb-24",children:e.jsx(Ne,{comments:u,onLike:X,onReply:H})}),e.jsx(K,{mode:"wait",children:i?e.jsx(ke,{onSubmit:Y,autoFocus:A,replyTo:T,isSubmitting:l.isPending}):e.jsx(p.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"fixed bottom-0 left-0 right-0 bg-background border-t border-border p-4 safe-bottom z-40",children:e.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-xl bg-muted cursor-pointer hover:bg-muted/80 transition-colors",onClick:G,children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-primary/10 flex items-center justify-center",children:e.jsx(fe,{className:"w-4 h-4 text-primary"})}),e.jsx("p",{className:"text-muted-foreground text-sm flex-1",children:"Fa√ßa login para comentar..."}),e.jsx(L,{size:"sm",asChild:!0,children:e.jsx(ge,{to:`/login?redirect=${encodeURIComponent(window.location.pathname)}`,children:"Entrar"})})]})})})]})}export{Ye as default};
