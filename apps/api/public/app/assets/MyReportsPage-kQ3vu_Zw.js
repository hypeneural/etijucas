import{r as h,j as e,l as R,m as w,aD as z,X as W,bq as L,b0 as H,aI as V,br as X,y as k,b1 as P,M as E,bs as $,bt as J,W as Q,ar as G,x as B,w as K,bu as Y,o as O,a6 as M,bv as Z,b2 as ee,ba as se,aJ as ae,z as te}from"./vendor-app-B8nTTOoa.js";import{B as u,c as g,x as le,y as re,z as ie,u as q,a as ne}from"./index-D-aY3LRG.js";import{a as oe}from"./useMyReports-DK0KpOSX.js";import{C as T}from"./card-DAtfMQc6.js";import{B as p}from"./badge-BwCT-Jwe.js";import{u as ce,L as de}from"./LoginRequired-CLDveRoG.js";import{B as me}from"./BottomTabBar-BYuhCDsB.js";import{C as I}from"./CategoryIcon-C6zckD_G.js";import{I as D}from"./input-MMdhuh1C.js";import"./useCityName-DVl_HqFo.js";import"./iconify-D28nYmSY.js";const xe=[{value:"all",label:"Todos",color:"bg-gray-100 text-gray-700"},{value:"recebido",label:"Recebido",color:"bg-blue-100 text-blue-700"},{value:"em_analise",label:"Em Análise",color:"bg-amber-100 text-amber-700"},{value:"resolvido",label:"Resolvido",color:"bg-green-100 text-green-700"},{value:"rejeitado",label:"Rejeitado",color:"bg-red-100 text-red-700"}],ue=[{value:"all",label:"Qualquer período"},{value:"7d",label:"Últimos 7 dias"},{value:"30d",label:"Últimos 30 dias"},{value:"90d",label:"Últimos 3 meses"},{value:"365d",label:"Último ano"},{value:"custom",label:"Personalizado"}];function he({isOpen:a,onClose:f,filters:n,onApplyFilters:o,showMyReportsOnly:m=!1}){const{categories:x}=ce(),[r,d]=h.useState(n),[t,c]=h.useState("all"),[j,v]=h.useState(!1);h.useEffect(()=>{d(n)},[n]);const N=s=>{d(l=>({...l,status:s}))},i=s=>{d(l=>({...l,categoryId:s})),v(!1)},b=s=>{c(s);const l=new Date;let y;switch(s){case"7d":y=new Date(l.setDate(l.getDate()-7)).toISOString().split("T")[0];break;case"30d":y=new Date(l.setDate(l.getDate()-30)).toISOString().split("T")[0];break;case"90d":y=new Date(l.setDate(l.getDate()-90)).toISOString().split("T")[0];break;case"365d":y=new Date(l.setDate(l.getDate()-365)).toISOString().split("T")[0];break;default:y=void 0}d(U=>({...U,startDate:y,endDate:s==="all"?void 0:new Date().toISOString().split("T")[0]}))},S=()=>{o(r),f()},_=()=>{d({status:"all",categoryId:void 0,startDate:void 0,endDate:void 0,protocol:void 0,address:void 0,title:void 0}),c("all")},F=Object.entries(r).filter(([s,l])=>l&&l!=="all"&&s!=="status").length+(r.status&&r.status!=="all"?1:0),C=x.find(s=>s.id===r.categoryId);return e.jsx(R,{children:a&&e.jsxs(e.Fragment,{children:[e.jsx(w.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 z-50",onClick:f}),e.jsxs(w.div,{initial:{y:"100%"},animate:{y:0},exit:{y:"100%"},transition:{type:"spring",damping:25,stiffness:300},className:"fixed bottom-0 left-0 right-0 z-50 bg-background rounded-t-3xl max-h-[85vh] overflow-hidden",children:[e.jsx("div",{className:"flex justify-center pt-3 pb-2",children:e.jsx("div",{className:"w-10 h-1 rounded-full bg-muted-foreground/30"})}),e.jsxs("div",{className:"flex items-center justify-between px-4 pb-4 border-b",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(z,{className:"h-5 w-5 text-primary"}),e.jsx("h2",{className:"text-lg font-semibold",children:"Filtros Avançados"}),F>0&&e.jsx(p,{variant:"secondary",className:"ml-2",children:F})]}),e.jsx(u,{variant:"ghost",size:"icon",onClick:f,className:"rounded-full",children:e.jsx(W,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"overflow-y-auto max-h-[calc(85vh-180px)] px-4 py-4 space-y-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium",children:[e.jsx(L,{className:"h-4 w-4 text-muted-foreground"}),"Situação"]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:xe.map(s=>e.jsx("button",{onClick:()=>N(s.value),className:g("px-3 py-1.5 rounded-full text-sm font-medium transition-all",r.status===s.value?s.color+" ring-2 ring-offset-2 ring-primary":"bg-muted hover:bg-muted/80"),children:s.label},s.value))})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium",children:[e.jsx(L,{className:"h-4 w-4 text-muted-foreground"}),"Categoria"]}),e.jsxs("button",{onClick:()=>v(!j),className:g("w-full flex items-center justify-between p-3 rounded-xl border transition-all",j?"border-primary bg-primary/5":"border-border"),children:[e.jsx("div",{className:"flex items-center gap-3",children:C?e.jsxs(e.Fragment,{children:[e.jsx(I,{icon:C.icon,color:C.color,size:"sm"}),e.jsx("span",{className:"font-medium",children:C.name})]}):e.jsx("span",{className:"text-muted-foreground",children:"Todas as categorias"})}),e.jsx(H,{className:g("h-5 w-5 text-muted-foreground transition-transform",j&&"rotate-180")})]}),e.jsx(R,{children:j&&e.jsx(w.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"overflow-hidden",children:e.jsxs("div",{className:"grid grid-cols-2 gap-2 pt-2",children:[e.jsx("button",{onClick:()=>i(void 0),className:g("p-3 rounded-xl border text-left transition-all",r.categoryId?"border-border hover:border-primary/50":"border-primary bg-primary/5"),children:e.jsx("span",{className:"text-sm font-medium",children:"Todas"})}),x.map(s=>e.jsxs("button",{onClick:()=>i(s.id),className:g("p-3 rounded-xl border text-left transition-all flex items-center gap-2",r.categoryId===s.id?"border-primary bg-primary/5":"border-border hover:border-primary/50"),children:[e.jsx(I,{icon:s.icon,color:s.color,size:"sm"}),e.jsx("span",{className:"text-sm font-medium line-clamp-1",children:s.name})]},s.id))]})})})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium",children:[e.jsx(V,{className:"h-4 w-4 text-muted-foreground"}),"Período"]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:ue.filter(s=>s.value!=="custom").map(s=>e.jsx("button",{onClick:()=>b(s.value),className:g("px-3 py-1.5 rounded-full text-sm font-medium transition-all",t===s.value?"bg-primary text-primary-foreground":"bg-muted hover:bg-muted/80"),children:s.label},s.value))})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium",children:[e.jsx(X,{className:"h-4 w-4 text-muted-foreground"}),"Protocolo"]}),e.jsxs("div",{className:"relative",children:[e.jsx(k,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(D,{placeholder:"Buscar por protocolo...",value:r.protocol||"",onChange:s=>d(l=>({...l,protocol:s.target.value||void 0})),className:"pl-10 rounded-xl"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium",children:[e.jsx(P,{className:"h-4 w-4 text-muted-foreground"}),"Título"]}),e.jsxs("div",{className:"relative",children:[e.jsx(k,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(D,{placeholder:"Buscar por título...",value:r.title||"",onChange:s=>d(l=>({...l,title:s.target.value||void 0})),className:"pl-10 rounded-xl"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium",children:[e.jsx(E,{className:"h-4 w-4 text-muted-foreground"}),"Endereço"]}),e.jsxs("div",{className:"relative",children:[e.jsx(k,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(D,{placeholder:"Buscar por endereço...",value:r.address||"",onChange:s=>d(l=>({...l,address:s.target.value||void 0})),className:"pl-10 rounded-xl"})]})]})]})]}),e.jsxs("div",{className:"border-t p-4 flex gap-3 safe-bottom",children:[e.jsxs(u,{variant:"outline",size:"lg",className:"flex-1 h-12 rounded-2xl",onClick:_,children:[e.jsx($,{className:"h-4 w-4 mr-2"}),"Limpar"]}),e.jsxs(u,{size:"lg",className:"flex-[2] h-12 rounded-2xl",onClick:S,children:[e.jsx(z,{className:"h-4 w-4 mr-2"}),"Aplicar Filtros"]})]})]})]})})}const fe=5e3;function ge(){const[a,f]=h.useState(null),[n,o]=h.useState(!1),m=h.useCallback(async()=>{try{const c=await le();f(c)}catch(c){console.error("[ReportSyncStatus] Failed to refresh sync status:",c)}},[]);if(h.useEffect(()=>{m();const c=window.setInterval(()=>{m()},fe);return window.addEventListener("online",m),()=>{window.clearInterval(c),window.removeEventListener("online",m)}},[m]),!a||a.pendingCount<=0)return null;const x=a.failedWithRetryInfo.filter(c=>c.attempts>0).length,r=a.isOnline&&!n,d=async()=>{if(r){o(!0);try{await re(),await m()}finally{o(!1)}}},t=async()=>{if(!(!r||x<=0)){o(!0);try{await ie(),await m()}finally{o(!1)}}};return e.jsx(T,{className:"mb-4 p-4 border-dashed",children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[a.isOnline?e.jsx(J,{className:"h-4 w-4 text-primary"}):e.jsx(Q,{className:"h-4 w-4 text-amber-600"}),e.jsx("p",{className:"text-sm font-medium",children:"Pendências de envio"}),e.jsx(p,{variant:"secondary",children:a.pendingCount})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:a.isOnline?a.isSyncing?"Sincronizando observações em segundo plano.":"Observações salvas offline aguardando sincronização.":"Sem conexão. As observações serão enviadas quando a internet voltar."}),x>0&&e.jsxs("p",{className:"text-xs text-amber-700 flex items-center gap-1",children:[e.jsx(G,{className:"h-3 w-3"}),x," item(ns) com falha de envio."]})]}),e.jsxs("div",{className:"flex flex-col gap-2 shrink-0",children:[e.jsxs(u,{size:"sm",className:g(!r&&"opacity-60"),onClick:d,disabled:!r,children:[n?e.jsx(B,{className:"h-3.5 w-3.5 animate-spin mr-1"}):null,"Enviar agora"]}),x>0&&e.jsx(u,{size:"sm",variant:"outline",onClick:t,disabled:!r,children:"Tentar falhas"})]})]})})}const A={recebido:{icon:ae,color:"text-blue-600 bg-blue-100",label:"Recebido"},em_analise:{icon:M,color:"text-amber-600 bg-amber-100",label:"Em verificação"},resolvido:{icon:se,color:"text-green-600 bg-green-100",label:"Melhoria concluída"},rejeitado:{icon:ee,color:"text-red-600 bg-red-100",label:"Arquivado"}};function pe({report:a}){const f=q(),n=A[a.status]||A.recebido,o=n.icon,m=x=>new Date(x).toLocaleDateString("pt-BR",{day:"2-digit",month:"short",year:"numeric"});return e.jsx(w.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},whileTap:{scale:.98},children:e.jsxs(T,{className:"p-4 cursor-pointer hover:shadow-md transition-shadow",onClick:()=>f(`/denuncia/${a.id}`),children:[e.jsxs("div",{className:"flex items-start gap-3",children:[a.media&&a.media.length>0?e.jsx("img",{src:a.media[0].thumbUrl||a.media[0].url,alt:"Foto da denúncia",className:"w-14 h-14 rounded-xl object-cover bg-muted shrink-0",loading:"lazy"}):e.jsx(I,{icon:a.category?.icon||"mdi:dots-horizontal",color:a.category?.color||"#64748b",size:"lg",withBackground:!0,className:"shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsx("h3",{className:"font-semibold line-clamp-2",children:a.title}),e.jsx(te,{className:"h-5 w-5 text-muted-foreground shrink-0"})]}),e.jsx("p",{className:"text-sm text-muted-foreground line-clamp-1 mt-0.5",children:a.category?.name}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsxs(p,{variant:"secondary",className:g("text-xs",n.color),children:[e.jsx(o,{className:"h-3 w-3 mr-1"}),a.statusLabel||n.label]}),e.jsx("span",{className:"text-xs text-muted-foreground",children:m(a.createdAt)})]}),a.addressText&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-2 flex items-center gap-1",children:[e.jsx(E,{className:"h-3 w-3 shrink-0"}),e.jsx("span",{className:"line-clamp-1",children:a.addressText})]})]})]}),e.jsxs("div",{className:"mt-3 pt-3 border-t flex items-center justify-between",children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"Protocolo"}),e.jsx("code",{className:"text-xs font-mono font-medium",children:a.protocol})]})]})})}function ze(){const a=q(),{isAuthenticated:f}=ne(),{reports:n,isLoading:o,error:m,refetch:x}=oe(),[r,d]=h.useState(!1),[t,c]=h.useState({status:"all"});if(!f)return e.jsx(de,{title:"Entrar para ver denúncias",message:"Faça login para ver e acompanhar suas denúncias.",returnUrl:"/minhas-denuncias"});const j=n.filter(i=>{if(t.status&&t.status!=="all"&&i.status!==t.status||t.categoryId&&i.category?.id!==t.categoryId||t.protocol&&!i.protocol?.toLowerCase().includes(t.protocol.toLowerCase())||t.title&&!i.title?.toLowerCase().includes(t.title.toLowerCase())||t.address&&!i.addressText?.toLowerCase().includes(t.address.toLowerCase()))return!1;if(t.startDate){const b=new Date(i.createdAt),S=new Date(t.startDate);if(b<S)return!1}return!0}),v=Object.entries(t).filter(([i,b])=>b&&b!=="all").length,N=!!m;return e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx("header",{className:"sticky top-0 z-50 bg-background/95 backdrop-blur-lg border-b safe-top",children:e.jsxs("div",{className:"flex items-center justify-between px-4 py-3",children:[e.jsx(u,{variant:"ghost",size:"icon",onClick:()=>a(-1),className:"rounded-full",children:e.jsx(K,{className:"h-5 w-5"})}),e.jsx("h1",{className:"font-semibold text-lg",children:"Minhas observações"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs(u,{variant:"ghost",size:"icon",onClick:()=>d(!0),className:"rounded-full relative",children:[e.jsx(Y,{className:"h-5 w-5"}),v>0&&e.jsx("span",{className:"absolute -top-1 -right-1 bg-primary text-primary-foreground text-xs w-5 h-5 rounded-full flex items-center justify-center",children:v})]}),e.jsx(u,{variant:"ghost",size:"icon",onClick:()=>x(),className:"rounded-full",children:e.jsx(O,{className:g("h-5 w-5",o&&"animate-spin")})})]})]})}),e.jsxs("main",{className:"p-4 pb-32",children:[e.jsx(ge,{}),v>0&&e.jsxs("div",{className:"flex gap-2 flex-wrap mb-4",children:[t.status&&t.status!=="all"&&e.jsxs(p,{variant:"secondary",className:"gap-1",children:["Status: ",t.status]}),t.categoryId&&e.jsx(p,{variant:"secondary",className:"gap-1",children:"Categoria filtrada"}),t.protocol&&e.jsxs(p,{variant:"secondary",className:"gap-1",children:["Protocolo: ",t.protocol]}),t.title&&e.jsxs(p,{variant:"secondary",className:"gap-1",children:["Título: ",t.title]}),t.address&&e.jsxs(p,{variant:"secondary",className:"gap-1",children:["Endereço: ",t.address]}),t.startDate&&e.jsx(p,{variant:"secondary",className:"gap-1",children:"Período filtrado"}),e.jsx(u,{variant:"ghost",size:"sm",onClick:()=>c({status:"all"}),className:"h-6 px-2 text-xs",children:"Limpar"})]}),o&&e.jsxs("div",{className:"flex flex-col items-center justify-center py-20",children:[e.jsx(B,{className:"h-8 w-8 animate-spin text-primary mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Carregando observações..."})]}),N&&e.jsxs(T,{className:"p-6 text-center",children:[e.jsx(M,{className:"h-12 w-12 text-red-500 mx-auto mb-4"}),e.jsx("h3",{className:"font-semibold mb-2",children:"Erro ao carregar"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Não foi possível carregar suas observações."}),e.jsxs(u,{onClick:()=>x(),children:[e.jsx(O,{className:"h-4 w-4 mr-2"}),"Tentar novamente"]})]}),!o&&!N&&n.length===0&&e.jsxs(w.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"text-center py-16",children:[e.jsx("div",{className:"p-6 rounded-full bg-muted/50 inline-block mb-6",children:e.jsx(P,{className:"h-12 w-12 text-muted-foreground"})}),e.jsx("h3",{className:"font-semibold text-lg mb-2",children:"Nenhuma observação"}),e.jsx("p",{className:"text-muted-foreground mb-6",children:"Você ainda não registrou nenhuma observação."}),e.jsxs(u,{onClick:()=>a("/report"),children:[e.jsx(Z,{className:"h-4 w-4 mr-2"}),"Registrar primeira observação"]})]}),!o&&!N&&j.length>0&&e.jsx("div",{className:"space-y-3",children:e.jsx(R,{children:j.map((i,b)=>e.jsx(w.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:b*.05},children:e.jsx(pe,{report:i})},i.id))})}),!o&&!N&&n.length>0&&j.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(z,{className:"h-8 w-8 text-muted-foreground mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Nenhuma observação com esse status."}),e.jsx(u,{variant:"ghost",onClick:()=>c({status:"all"}),className:"mt-2",children:"Limpar filtro"})]}),e.jsx("div",{className:"fixed bottom-0 left-0 right-0 z-50",children:e.jsx(me,{activeTab:"reportar",onTabChange:i=>a(`/?tab=${i}`)})})]}),e.jsx(he,{isOpen:r,onClose:()=>d(!1),filters:t,onApplyFilters:c,showMyReportsOnly:!0})]})}export{ze as default};
