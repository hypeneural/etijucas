import{r as i,j as e,l as P,m as g,X as O,Y as $,M as B,w as E,N as F,_ as H,$ as G,y as R,a3 as U,aQ as D,dn as I}from"./vendor-app-CSqspwsb.js";import{a as L,u as M}from"./index-CLbDGkY0.js";import{b as Q}from"./bairro.service-BOs3BPZV.js";import{B as _}from"./BottomTabBar-ueSIq0j7.js";import{u as q}from"./useAppStore-D75UxuXF.js";import{a as V}from"./auth.service-UBu2EYK-.js";import{u as K,a as X}from"./useCityName-Bu0sA8T7.js";import"./bairros-Cf5Z_oCw.js";const Y=100;function J({isOpen:o,onClose:r,children:u,title:b,snapPoints:n=[.5,.9],initialSnap:j=0,className:a=""}){const[l,c]=i.useState(j),x=i.useRef(null);i.useRef(0);const v=`${n[l]*100}vh`,d=i.useCallback((p,h)=>{const{velocity:t,offset:N}=h;if(t.y>500||N.y>Y){r();return}if(t.y<-500){c(n.length-1);return}const w=window.innerHeight,m=((x.current?.offsetHeight||0)-N.y)/w;let f=0,y=Math.abs(n[0]-m);n.forEach((A,T)=>{const C=Math.abs(A-m);C<y&&(y=C,f=T)}),c(f)},[r,n]);return e.jsx(P,{children:o&&e.jsxs(e.Fragment,{children:[e.jsx(g.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:r,className:"fixed inset-0 bg-black/50 z-40"}),e.jsxs(g.div,{ref:x,initial:{y:"100%"},animate:{y:0,height:v},exit:{y:"100%"},transition:{type:"spring",damping:30,stiffness:300},drag:"y",dragConstraints:{top:0,bottom:0},dragElastic:.2,onDragEnd:d,className:`fixed bottom-0 left-0 right-0 bg-background rounded-t-3xl z-50 overflow-hidden shadow-elevated ${a}`,children:[e.jsx("div",{className:"flex justify-center pt-3 pb-2 cursor-grab active:cursor-grabbing",children:e.jsx("div",{className:"w-10 h-1 rounded-full bg-muted-foreground/30"})}),b&&e.jsxs("div",{className:"flex items-center justify-between px-4 pb-3 border-b border-border",children:[e.jsx("h3",{className:"text-lg font-semibold",children:b}),e.jsx("button",{onClick:r,className:"p-2 rounded-full hover:bg-muted transition-colors",children:e.jsx(O,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"overflow-y-auto h-full pb-safe",children:u})]})]})})}function Z({isOpen:o,onComplete:r,bairros:u}){const{updateUser:b}=L(),n=K(),{name:j}=X(),[a,l]=i.useState("name"),[c,x]=i.useState(""),[v,d]=i.useState(),[p,h]=i.useState(!1),[t,N]=i.useState(!1),[w,S]=i.useState(!1),[k,m]=i.useState(null),f=c.trim().length>=2,y=a==="name"?f:a==="bairro"?!0:p,A=async()=>{if(!navigator.geolocation){m("GPS não suportado neste dispositivo");return}S(!0),m(null),navigator.geolocation.getCurrentPosition(async s=>{console.log("GPS:",s.coords.latitude,s.coords.longitude),u.length>0&&d(u[0].id),S(!1)},s=>{console.error("GPS error:",s),m("Não foi possível obter sua localização"),S(!1)},{enableHighAccuracy:!0,timeout:1e4})},T=async()=>{if(!(!f||!p)){N(!0),m(null);try{const s=await V.completeProfile({nome:c.trim(),bairroId:v,termsAccepted:!0});b(s.user),"vibrate"in navigator&&navigator.vibrate(50),r()}catch(s){m(s.message||"Erro ao salvar perfil")}finally{N(!1)}}},C=()=>{a==="name"&&f?l("bairro"):a==="bairro"?l("terms"):a==="terms"&&p&&T()};i.useEffect(()=>{o||(l("name"),x(""),d(void 0),h(!1),m(null))},[o]);const W={initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20}};return e.jsx(J,{isOpen:o,onClose:()=>{},title:`Bem-vindo ao ${n}!`,snapPoints:[.6,.9],initialSnap:0,children:e.jsxs("div",{className:"px-6 py-4",children:[e.jsx("div",{className:"flex gap-2 mb-6",children:["name","bairro","terms"].map((s,z)=>e.jsx("div",{className:`h-1 flex-1 rounded-full transition-colors ${s===a?"bg-primary":z<["name","bairro","terms"].indexOf(a)?"bg-primary/50":"bg-muted"}`},s))}),e.jsxs(P,{mode:"wait",children:[a==="name"&&e.jsxs(g.div,{variants:W,initial:"initial",animate:"animate",exit:"exit",className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-primary/10 flex items-center justify-center",children:e.jsx($,{className:"w-6 h-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-semibold",children:"Como podemos te chamar?"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Seu nome será exibido nas suas publicações"})]})]}),e.jsx("input",{type:"text",value:c,onChange:s=>x(s.target.value),placeholder:"Seu nome",autoFocus:!0,className:"w-full px-4 py-3 rounded-xl border border-border bg-muted/50 focus:border-primary focus:ring-2 focus:ring-primary/20 transition-all text-lg"}),c.length>0&&!f&&e.jsx("p",{className:"text-sm text-destructive",children:"Nome deve ter pelo menos 2 caracteres"})]},"name"),a==="bairro"&&e.jsxs(g.div,{variants:W,initial:"initial",animate:"animate",exit:"exit",className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-primary/10 flex items-center justify-center",children:e.jsx(B,{className:"w-6 h-6 text-primary"})}),e.jsxs("div",{children:[e.jsxs("h4",{className:"text-lg font-semibold",children:["Qual seu bairro em ",j,"? (opcional)"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Para mostrar notícias e eventos perto de você"})]})]}),e.jsxs("button",{onClick:A,disabled:w,className:"w-full flex items-center gap-3 px-4 py-3 rounded-xl border border-primary/30 bg-primary/5 hover:bg-primary/10 transition-all text-primary",children:[w?e.jsx(E,{className:"w-5 h-5 animate-spin"}):e.jsx(F,{className:"w-5 h-5"}),e.jsx("span",{className:"font-medium",children:"Usar minha localização"})]}),e.jsx("div",{className:"max-h-48 overflow-y-auto space-y-1",children:u.map(s=>e.jsxs("button",{onClick:()=>d(s.id),className:`w-full flex items-center justify-between px-4 py-3 rounded-lg transition-all ${v===s.id?"bg-primary text-primary-foreground":"hover:bg-muted"}`,children:[e.jsx("span",{children:s.nome}),v===s.id&&e.jsx(H,{className:"w-5 h-5"})]},s.id))})]},"bairro"),a==="terms"&&e.jsxs(g.div,{variants:W,initial:"initial",animate:"animate",exit:"exit",className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-primary/10 flex items-center justify-center",children:e.jsx(G,{className:"w-6 h-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-semibold",children:"Termos de Uso"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Quase pronto! Aceite os termos para continuar"})]})]}),e.jsx("div",{className:"p-4 rounded-xl bg-muted/50 border border-border",children:e.jsxs("p",{className:"text-sm text-muted-foreground leading-relaxed",children:["Ao usar o ",n,", você concorda em respeitar outros usuários, não publicar conteúdo ofensivo e usar o app de forma responsável. Seus dados são protegidos conforme nossa política de privacidade."]})}),e.jsxs("label",{className:"flex items-center gap-3 cursor-pointer p-4 rounded-xl border border-border hover:border-primary/50 transition-colors",children:[e.jsx("input",{type:"checkbox",checked:p,onChange:s=>h(s.target.checked),className:"w-5 h-5 rounded border-border text-primary focus:ring-primary"}),e.jsxs("span",{className:"text-sm",children:["Li e aceito os ",e.jsx("span",{className:"text-primary font-medium",children:"Termos de Uso"})," e a"," ",e.jsx("span",{className:"text-primary font-medium",children:"Política de Privacidade"})]})]})]},"terms")]}),k&&e.jsx(g.p,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"text-sm text-destructive mt-4 text-center",children:k}),e.jsx(g.button,{onClick:C,disabled:!y||t,className:`w-full mt-6 py-4 rounded-2xl font-semibold text-lg flex items-center justify-center gap-2 transition-all ${y?"bg-primary text-primary-foreground hover:bg-primary/90":"bg-muted text-muted-foreground cursor-not-allowed"}`,whileTap:y?{scale:.98}:void 0,children:t?e.jsxs(e.Fragment,{children:[e.jsx(E,{className:"w-5 h-5 animate-spin"}),"Salvando..."]}):a==="terms"?e.jsxs(e.Fragment,{children:[e.jsx(H,{className:"w-5 h-5"}),"Concluir"]}):e.jsxs(e.Fragment,{children:["Continuar",e.jsx(R,{className:"w-5 h-5"})]})}),a==="bairro"&&e.jsx("button",{onClick:()=>l("terms"),className:"w-full mt-3 py-2 text-sm text-muted-foreground hover:text-foreground transition-colors",children:"Pular por agora"})]})})}function ce(){const o=U(),r=M(),{setActiveTab:u}=q(),{isAuthenticated:b,user:n,needsOnboarding:j}=L(),[a,l]=i.useState(!1),{data:c=[]}=D({queryKey:["bairros"],queryFn:Q.getAll,staleTime:1e3*60*60});i.useEffect(()=>{j()&&l(!0)},[b,n]);const x=()=>{l(!1)},d=(h=>{const t=ee(h);return t==="/"?"home":t.startsWith("/denuncia")||t.startsWith("/minhas-denuncias")||t.startsWith("/denuncias")?"reportar":t.startsWith("/forum")||t.startsWith("/topico")?"forum":t.startsWith("/agenda")||t.startsWith("/evento")?"agenda":t.startsWith("/telefones")||t.startsWith("/coleta-lixo")||t.startsWith("/pontos-turisticos")||t.startsWith("/ponto-turistico")||t.startsWith("/missas")||t.startsWith("/votacoes")||t.startsWith("/vereadores")||t.startsWith("/perfil")?"mais":"home"})(o.pathname);i.useEffect(()=>{u(d)},[d,u]);const p=h=>{switch(h){case"home":r("/");break;case"reportar":r("/denuncias");break;case"forum":r("/forum");break;case"agenda":r("/agenda");break;case"mais":r("/mais");break}};return e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-muted/50",children:e.jsxs("div",{className:"relative w-full max-w-[420px] h-full bg-background overflow-hidden shadow-elevated",children:[e.jsx("div",{className:"absolute inset-0 overflow-y-auto scrollbar-hide pb-20",children:e.jsx(I,{})}),e.jsx(_,{activeTab:d,onTabChange:p}),e.jsx(Z,{isOpen:a,onComplete:x,bairros:c})]})})}function ee(o){const r=o.replace(/^\/[a-z]{2}\/[a-z0-9-]+(?=\/|$)/i,"");return r===""?"/":r}export{ce as default,ee as normalizeTenantPath};
