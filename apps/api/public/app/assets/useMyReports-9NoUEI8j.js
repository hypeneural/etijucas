import{u as d,b as g,c as m}from"./vendor-query-2Fnzm2h0.js";import{a as s,E as o}from"./client-BJjD0WXh.js";import{r as c,s as u}from"./localDatabase-CT1xSD6X.js";import{u as h}from"./useAuthStore-BreWARA5.js";async function y(){try{return(await s.get(o.reports.categories)).data}catch(e){throw console.error("[ReportService] Failed to fetch categories:",e),e}}async function S(e,t){const r=new FormData;r.append("categoryId",e.categoryId),r.append("title",e.title),r.append("description",e.description),e.addressText&&r.append("addressText",e.addressText),e.addressSource&&r.append("addressSource",e.addressSource),e.locationQuality&&r.append("locationQuality",e.locationQuality),e.latitude!==void 0&&r.append("latitude",String(e.latitude)),e.longitude!==void 0&&r.append("longitude",String(e.longitude)),e.locationAccuracyM!==void 0&&r.append("locationAccuracyM",String(e.locationAccuracyM)),e.bairroId&&r.append("bairroId",e.bairroId),e.images&&e.images.length>0&&e.images.forEach(a=>{r.append("images[]",a)});try{const a=await s.postFormData(o.reports.create,r,{headers:{"X-Idempotency-Key":t}});return a.data&&await c.save(a.data),a.data}catch(a){throw console.error("[ReportService] Failed to create report:",a),await u.exists(t)||await u.add({type:"report",data:{...e,images:[]},idempotencyKey:t}),a}}async function f(e){try{const t=new URLSearchParams;e?.status&&t.append("status",e.status),e?.categoryId&&t.append("categoryId",e.categoryId),e?.page&&t.append("page",String(e.page)),e?.perPage&&t.append("perPage",String(e.perPage));const r=t.toString(),a=r?`${o.reports.myReports}?${r}`:o.reports.myReports,n=await s.get(a);return n.data.length>0&&await c.saveMany(n.data),n}catch(t){console.error("[ReportService] Failed to fetch my reports:",t);const r=await c.getAll();return{data:r,meta:{current_page:1,last_page:1,per_page:10,total:r.length}}}}async function l(e){try{const t=new URLSearchParams;e?.status&&t.append("status",e.status),e?.categoryId&&t.append("categoryId",e.categoryId),e?.search&&t.append("search",e.search),e?.page&&t.append("page",String(e.page)),e?.perPage&&t.append("perPage",String(e.perPage));const r=t.toString(),a=r?`${o.reports.list}?${r}`:o.reports.list;return await s.get(a)}catch(t){throw console.error("[ReportService] Failed to fetch public reports:",t),t}}async function R(){try{return(await s.get(o.reports.stats)).data}catch(e){return console.error("[ReportService] Failed to fetch reports stats:",e),{total:0,byStatus:{recebido:0,em_analise:0,em_andamento:0,resolvido:0,nao_procede:0},thisMonth:0,resolvedThisMonth:0}}}async function v(e){try{const t=await s.get(o.reports.get(e));return await c.save(t.data),t.data}catch(t){return console.error("[ReportService] Failed to fetch report:",t),await c.getById(e)}}async function w(e,t){const r=new FormData;return t.forEach(n=>{r.append("images[]",n)}),(await s.postFormData(o.reports.addMedia(e),r)).data}async function b(e,t){await s.delete(o.reports.removeMedia(e,t))}async function M(e,t,r){try{const a=new URLSearchParams({q:e});return t!==void 0&&a.append("lat",String(t)),r!==void 0&&a.append("lon",String(r)),(await s.get(`${o.geocode.autocomplete}?${a.toString()}`)).data}catch(a){return console.error("[ReportService] Geocode autocomplete failed:",a),[]}}async function I(e,t){try{const r=new URLSearchParams({lat:String(e),lon:String(t)});return(await s.get(`${o.geocode.reverse}?${r.toString()}`)).data}catch(r){return console.error("[ReportService] Geocode reverse failed:",r),null}}const i={getCategories:y,createReport:S,getMyReports:f,getPublicReports:l,getReportsStats:R,getReportById:v,addReportMedia:w,removeReportMedia:b,geocodeAutocomplete:M,geocodeReverse:I},p={myReports:["reports","mine"],publicReports:["reports","public"],reportsStats:["reports","stats"]};function _(e){const{isAuthenticated:t}=h(),r=d({queryKey:[...p.myReports,e],queryFn:()=>i.getMyReports(e),staleTime:2*60*1e3,enabled:t});return{reports:r.data?.data??[],meta:r.data?.meta,isLoading:r.isLoading,error:r.error,refetch:r.refetch}}function D(){const e=g(),t=m({mutationFn:({payload:r,idempotencyKey:a})=>i.createReport(r,a),onSuccess:()=>{e.invalidateQueries({queryKey:p.myReports})}});return{createReport:t.mutateAsync,isCreating:t.isPending,error:t.error,reset:t.reset}}function T(e){const t=d({queryKey:[...p.publicReports,e],queryFn:()=>i.getPublicReports(e),staleTime:12e4});return{reports:t.data?.data??[],meta:t.data?.meta,isLoading:t.isLoading,error:t.error,refetch:t.refetch}}function A(){const e=d({queryKey:p.reportsStats,queryFn:()=>i.getReportsStats(),staleTime:3e5});return{stats:e.data??{total:0,byStatus:{recebido:0,em_analise:0,em_andamento:0,resolvido:0,nao_procede:0},thisMonth:0,resolvedThisMonth:0},isLoading:e.isLoading,error:e.error,refetch:e.refetch}}export{_ as a,A as b,T as c,i as r,D as u};
