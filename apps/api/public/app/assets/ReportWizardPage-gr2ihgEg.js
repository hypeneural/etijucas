import{j as e,r as o}from"./vendor-radix-i3jPA7eY.js";import{B as u}from"./button-rzM8wV8T.js";import{b as T,c as w,X as Y,R as L,T as F,C as I,k as ne,f as oe,H as de,u as me,i as K}from"./index-CcRQdJ8g.js";import{M as R}from"./map-pin-Cp2KGZMh.js";import{C as D}from"./camera-CrNuqkex.js";import{m as d,A as $}from"./vendor-motion-CFwwOuCD.js";import{C as xe}from"./check-EF03C0s3.js";import{C as N}from"./card-BmaSWi2r.js";import{I as O}from"./info-Cj_1K4B7.js";import{u as ue}from"./vendor-query-1wfeA5IL.js";import{r as Q,a as pe}from"./useMyReports-B1F9UMjQ.js";import{L as P}from"./loader-circle-CShzl_qH.js";import{C as he}from"./circle-alert-CrfZ01ce.js";import{C as W}from"./chevron-right-st6aQDg0.js";import{L as ge}from"./lightbulb-DQ3BQFSd.js";import{C as fe}from"./circle-help-CLM8RzsR.js";import{I as se}from"./input-Dt7gqGFv.js";import{S as V}from"./search-BXtWOdro.js";import{P as J}from"./pen-line-DNvTARW7.js";import{N as X}from"./navigation-BrxgmIb6.js";import{B as be}from"./badge-BAPp0roA.js";import{C as je}from"./checkbox-CRG9MP-c.js";import{T as Ne,S as ye}from"./textarea-CznSBDGe.js";import{F as ve}from"./file-text-JwfnLLnV.js";import{c as U,P as Z}from"./confetti.module-DhWgogWJ.js";import{S as ke}from"./sparkles-Bq-qOt_z.js";import{C as we}from"./copy-BbSspHn4.js";import{S as Ce}from"./share-2-CUtRIpGV.js";import{A as Se}from"./arrow-left-CfD044EO.js";import"./vendor-utils-DycLLelI.js";import"./client-BoGyDRku.js";import"./localDatabase-CDfLZ4Kb.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const te=T("FileCheck",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"m9 15 2 2 4-4",key:"1grp1n"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ze=T("FileSearch",[["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M4.268 21a2 2 0 0 0 1.727 1H18a2 2 0 0 0 2-2V7l-5-5H6a2 2 0 0 0-2 2v3",key:"ms7g94"}],["path",{d:"m9 18-1.5-1.5",key:"1j6qii"}],["circle",{cx:"5",cy:"14",r:"3",key:"ufru5t"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Me=T("ImageOff",[["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}],["path",{d:"M10.41 10.41a2 2 0 1 1-2.83-2.83",key:"1bzlo9"}],["line",{x1:"13.5",x2:"6",y1:"13.5",y2:"21",key:"1q0aeu"}],["line",{x1:"18",x2:"21",y1:"12",y2:"15",key:"5mozeu"}],["path",{d:"M3.59 3.59A1.99 1.99 0 0 0 3 5v14a2 2 0 0 0 2 2h14c.55 0 1.052-.22 1.41-.59",key:"mmje98"}],["path",{d:"M21 15V5a2 2 0 0 0-2-2H9",key:"43el77"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ie=T("List",[["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M3 18h.01",key:"1tta3j"}],["path",{d:"M3 6h.01",key:"1rqtza"}],["path",{d:"M8 12h13",key:"1za7za"}],["path",{d:"M8 18h13",key:"1lx6n3"}],["path",{d:"M8 6h13",key:"ik3vkj"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G=T("Pen",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const re=T("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ee=T("ShieldAlert",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M12 16h.01",key:"1drbdi"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Te=T("SwitchCamera",[["path",{d:"M11 19H4a2 2 0 0 1-2-2V7a2 2 0 0 1 2-2h5",key:"mtk2lu"}],["path",{d:"M13 5h7a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2h-5",key:"120jsl"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}],["path",{d:"m18 22-3-3 3-3",key:"kgdoj7"}],["path",{d:"m6 2 3 3-3 3",key:"1fnbkv"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qe=T("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]),Ee=[{icon:Ie,label:"Categoria"},{icon:R,label:"Localização"},{icon:D,label:"Fotos"},{icon:ze,label:"Revisão"}];function Ae({currentStep:a,totalSteps:s,labels:y}){return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between",children:Ee.slice(0,s).map((g,c)=>{const h=c+1,i=h<a,t=h===a,b=g.icon;return e.jsxs("div",{className:"flex flex-col items-center flex-1",children:[c>0&&e.jsx("div",{className:w("absolute h-0.5 -translate-y-4",i||t?"bg-primary":"bg-muted"),style:{width:`calc(100% / ${s} - 2rem)`,left:`calc((100% / ${s}) * ${c} + 1rem)`}}),e.jsx(d.div,{initial:{scale:.8},animate:{scale:t?1.1:1},className:w("relative z-10 h-10 w-10 rounded-full flex items-center justify-center transition-all",i&&"bg-primary text-primary-foreground",t&&"bg-primary text-primary-foreground ring-4 ring-primary/20",!i&&!t&&"bg-muted text-muted-foreground"),children:i?e.jsx(xe,{className:"h-5 w-5"}):e.jsx(b,{className:"h-5 w-5"})}),e.jsx("span",{className:w("text-xs mt-1.5 font-medium text-center",t&&"text-primary",i&&"text-foreground",!i&&!t&&"text-muted-foreground"),children:y?.[c]||g.label})]},h)})}),e.jsx("div",{className:"relative -mt-[3.2rem] mx-5 h-0.5 bg-muted rounded-full",children:e.jsx(d.div,{className:"h-full bg-primary rounded-full",initial:{width:0},animate:{width:`${(a-1)/(s-1)*100}%`},transition:{type:"spring",stiffness:300,damping:30}})}),e.jsx("div",{className:"h-4"}),e.jsxs("div",{className:"flex items-center justify-center gap-2 text-sm",children:[e.jsxs("span",{className:"font-semibold text-primary",children:["Etapa ",a]}),e.jsxs("span",{className:"text-muted-foreground",children:["de ",s]})]})]})}function Re({title:a,content:s,className:y}){const[g,c]=o.useState(!1),h=Array.isArray(s)?s:[s];return e.jsxs("div",{className:w("inline-flex items-center gap-1",y),children:[e.jsx(d.button,{type:"button",whileTap:{scale:.9},onClick:()=>c(!0),className:"flex h-5 w-5 items-center justify-center rounded-full bg-muted hover:bg-muted/80 transition-colors","aria-label":`Ajuda sobre ${a}`,children:e.jsx(O,{className:"h-3 w-3 text-muted-foreground"})}),e.jsx($,{children:g&&e.jsxs(e.Fragment,{children:[e.jsx(d.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-50 bg-black/40",onClick:()=>c(!1)}),e.jsxs(d.div,{initial:{y:"100%"},animate:{y:0},exit:{y:"100%"},transition:{type:"spring",damping:25,stiffness:300},className:"fixed bottom-0 left-0 right-0 z-50 rounded-t-3xl bg-background p-6 safe-bottom",children:[e.jsx("div",{className:"absolute top-3 left-1/2 -translate-x-1/2 h-1 w-10 rounded-full bg-muted"}),e.jsxs("div",{className:"flex items-start justify-between mt-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-2 rounded-full bg-primary/10",children:e.jsx(O,{className:"h-4 w-4 text-primary"})}),e.jsx("h3",{className:"font-semibold text-lg",children:a})]}),e.jsx(u,{variant:"ghost",size:"icon",className:"h-8 w-8 rounded-full",onClick:()=>c(!1),children:e.jsx(Y,{className:"h-4 w-4"})})]}),e.jsx("div",{className:"mt-4 space-y-2",children:h.map((i,t)=>e.jsxs("p",{className:"text-sm text-muted-foreground flex items-start gap-2",children:[e.jsx("span",{className:"text-primary mt-0.5",children:"•"}),e.jsx("span",{children:i})]},t))}),e.jsx(u,{className:"w-full mt-6",onClick:()=>c(!1),children:"Entendi"})]})]})})]})}function H({title:a,subtitle:s,helpTitle:y,helpContent:g}){return e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h1",{className:"text-2xl font-bold",children:a}),g&&e.jsx(Re,{title:y||a,content:g})]}),s&&e.jsx("p",{className:"text-sm text-muted-foreground",children:s})]})}const De={categories:["report","categories"]};function ie(){const a=ue({queryKey:De.categories,queryFn:()=>Q.getCategories(),staleTime:18e5,gcTime:36e5});return{categories:a.data??[],isLoading:a.isLoading,error:a.error,refetch:a.refetch}}function Pe({draft:a,onUpdate:s,onNext:y}){const{categories:g,isLoading:c,error:h,refetch:i}=ie(),t=g.find(m=>m.id===a.categoryId),b=m=>{s({categoryId:m.id,category:m})},j=!!a.categoryId;return c?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 gap-4",children:[e.jsx(P,{className:"h-8 w-8 animate-spin text-primary"}),e.jsx("p",{className:"text-muted-foreground",children:"Carregando categorias..."})]}):h?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 gap-4",children:[e.jsx(he,{className:"h-12 w-12 text-destructive"}),e.jsx("p",{className:"text-muted-foreground text-center",children:"Erro ao carregar categorias."}),e.jsx(u,{onClick:()=>i(),variant:"outline",children:"Tentar novamente"})]}):e.jsxs("div",{className:"space-y-6 pb-48",children:[e.jsx(H,{title:"O que aconteceu?",subtitle:"Escolha a categoria que melhor descreve o problema",helpTitle:"Como escolher a categoria",helpContent:["Escolha a categoria que mais combina com o problema que você quer reportar.","Se tiver dúvida, escolha 'Outros' e descreva com suas palavras.","Não se preocupe em acertar perfeitamente, nossa equipe vai analisar."]}),e.jsx(N,{className:"p-4 bg-blue-50 dark:bg-blue-950/30 border-blue-200 dark:border-blue-800",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-blue-100 dark:bg-blue-900/50",children:e.jsx(O,{className:"h-4 w-4 text-blue-600 dark:text-blue-400"})}),e.jsx("div",{children:e.jsxs("p",{className:"text-sm text-blue-700 dark:text-blue-300",children:[e.jsx("span",{className:"font-medium",children:"Toque em uma categoria"})," para selecioná-la. Depois você pode detalhar melhor o problema."]})})]})}),e.jsx("div",{className:"grid grid-cols-2 gap-3",children:g.map((m,r)=>{const v=a.categoryId===m.id;return e.jsxs(d.button,{type:"button",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:r*.03},whileTap:{scale:.95},onClick:()=>b(m),className:w("relative flex flex-col items-center gap-2 rounded-2xl border-2 p-4 text-center transition-all",v?"border-primary bg-primary/10 shadow-lg":"border-border bg-card hover:bg-muted/50 hover:border-muted-foreground/30"),children:[e.jsx("div",{className:w("text-3xl p-2 rounded-xl transition-colors",v?"bg-primary/20":"bg-muted"),style:{backgroundColor:v?`${m.color}20`:void 0},children:m.icon}),e.jsx("span",{className:w("text-sm font-medium leading-tight",v&&"text-primary"),style:{color:v?m.color:void 0},children:m.name}),v&&e.jsx(d.div,{initial:{scale:0},animate:{scale:1},className:"absolute -top-1 -right-1 h-5 w-5 rounded-full bg-primary flex items-center justify-center",style:{backgroundColor:m.color},children:e.jsx(W,{className:"h-3 w-3 text-white"})})]},m.id)})}),t&&t.tips.length>0&&e.jsx(d.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},className:"space-y-3",children:e.jsx(N,{className:"p-4 border-amber-200 bg-amber-50 dark:bg-amber-950/20 dark:border-amber-800",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-amber-100 dark:bg-amber-900/50",children:e.jsx(ge,{className:"h-4 w-4 text-amber-600 dark:text-amber-400"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("p",{className:"text-sm font-medium text-amber-800 dark:text-amber-300",children:['Dicas para "',t.name,'"']}),e.jsx("ul",{className:"mt-2 space-y-1",children:t.tips.map((m,r)=>e.jsxs("li",{className:"text-sm text-amber-700 dark:text-amber-400 flex gap-2",children:[e.jsx("span",{className:"shrink-0",children:"•"}),e.jsx("span",{children:m})]},r))})]})]})})}),!a.categoryId&&e.jsx(N,{className:"p-4 border-muted bg-muted/30",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-muted",children:e.jsx(fe,{className:"h-4 w-4 text-muted-foreground"})}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Selecione uma categoria acima para continuar"})]})}),e.jsx("div",{className:"fixed bottom-0 left-0 right-0 p-4 pb-24 bg-background/95 backdrop-blur-lg border-t z-10",children:e.jsx("div",{className:"max-w-lg mx-auto",children:e.jsx(u,{size:"lg",className:w("w-full h-14 text-base font-semibold rounded-2xl transition-all",!j&&"opacity-50"),disabled:!j,onClick:y,children:j?e.jsxs(e.Fragment,{children:["Continuar",e.jsx(W,{className:"h-5 w-5 ml-2"})]}):"Selecione uma categoria"})})})]})}function Le({draft:a,onUpdate:s,onNext:y,onBack:g}){const[c,h]=o.useState({status:"idle"}),[i,t]=o.useState(!1),[b,j]=o.useState(""),[m,r]=o.useState([]),[v,q]=o.useState(!1),[z,A]=o.useState(!1),l=o.useCallback(async(x,f)=>{try{A(!0);const M=await Q.geocodeReverse(x,f);return M?.address||M?.displayName}catch(M){console.warn("[StepLocation] Reverse geocode failed:",M);return}finally{A(!1)}},[]),n=o.useCallback(async()=>{if(!navigator.geolocation){h({status:"error",errorMessage:"Seu navegador não suporta geolocalização. Tente usar Chrome, Safari ou Firefox."});return}h({status:"requesting"}),navigator.geolocation.getCurrentPosition(async x=>{const f=x.coords.latitude,M=x.coords.longitude,le=await l(f,M),ce={latitude:f,longitude:M,accuracy:x.coords.accuracy,address:le||"Tijucas, SC",source:"gps",quality:x.coords.accuracy<=50?"precisa":"aproximada"};s({location:ce}),h({status:"success"})},x=>{let f="Não conseguimos acessar sua localização.";x.code===x.PERMISSION_DENIED?(f="Você não permitiu o acesso à sua localização.",h({status:"denied",errorMessage:f})):x.code===x.POSITION_UNAVAILABLE?(f="Não foi possível determinar sua localização. Verifique se o GPS está ativado.",h({status:"error",errorMessage:f})):x.code===x.TIMEOUT&&(f="Demorou muito para obter sua localização. Verifique sua conexão e tente novamente.",h({status:"error",errorMessage:f}))},{enableHighAccuracy:!0,timeout:15e3,maximumAge:6e4})},[s,l]),C=o.useCallback(async x=>{if(x.length<3){r([]);return}q(!0);try{const f=await Q.geocodeAutocomplete(x);r(f)}catch(f){console.warn("[StepLocation] Search failed:",f),r([])}finally{q(!1)}},[]);o.useEffect(()=>{const x=setTimeout(()=>{b&&C(b)},300);return()=>clearTimeout(x)},[b,C]);const p=x=>{const f={latitude:x.latitude,longitude:x.longitude,accuracy:100,address:x.address||x.displayName,source:"manual",quality:"manual"};s({location:f}),h({status:"success"}),j(""),r([]),t(!1)};o.useEffect(()=>{!a.location&&c.status==="idle"&&n()},[a.location,c.status,n]);const k=!!a.location,E=({quality:x})=>{const f={precisa:{color:"text-green-600 bg-green-100",icon:qe,label:"Precisa"},aproximada:{color:"text-amber-600 bg-amber-100",icon:R,label:"Aproximada"},manual:{color:"text-blue-600 bg-blue-100",icon:J,label:"Informada"}}[x]||{color:"text-gray-600 bg-gray-100",icon:R,label:"Desconhecida"},M=f.icon;return e.jsxs("span",{className:w("inline-flex items-center gap-1 px-2 py-0.5 rounded-full text-xs font-medium",f.color),children:[e.jsx(M,{className:"h-3 w-3"}),f.label]})};return e.jsxs("div",{className:"space-y-6 pb-48",children:[e.jsx(H,{title:"Onde foi?",subtitle:"Precisamos saber o local do problema",helpTitle:"Por que precisamos da localização?",helpContent:["A localização ajuda nossa equipe a encontrar o problema rapidamente.","Usamos o GPS do seu celular para maior precisão.","Sua localização não é compartilhada publicamente, apenas com a equipe responsável."]}),e.jsx(N,{className:"p-4 bg-blue-50 dark:bg-blue-950/30 border-blue-200 dark:border-blue-800",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-blue-100 dark:bg-blue-900/50",children:e.jsx(O,{className:"h-4 w-4 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{className:"text-sm text-blue-700 dark:text-blue-300",children:[e.jsx("p",{className:"font-medium mb-1",children:"Como funciona:"}),e.jsx("p",{children:"Usamos o GPS para marcar o local, ou você pode buscar o endereço manualmente."})]})]})}),e.jsxs("div",{className:"space-y-4",children:[c.status==="requesting"&&e.jsxs(d.div,{initial:{opacity:0},animate:{opacity:1},className:"flex flex-col items-center justify-center py-12 text-center",children:[e.jsx("div",{className:"p-4 rounded-full bg-primary/10 mb-4",children:e.jsx(P,{className:"h-8 w-8 text-primary animate-spin"})}),e.jsx("p",{className:"font-medium mb-1",children:z?"Buscando endereço...":"Buscando sua localização..."}),e.jsx("p",{className:"text-sm text-muted-foreground",children:'Se aparecer uma mensagem, toque em "Permitir"'})]}),c.status==="denied"&&e.jsx(d.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},children:e.jsx(N,{className:"p-6 border-amber-200 bg-amber-50 dark:bg-amber-950/20 dark:border-amber-800",children:e.jsxs("div",{className:"flex flex-col items-center text-center",children:[e.jsx("div",{className:"p-4 rounded-full bg-amber-100 dark:bg-amber-900/30 mb-4",children:e.jsx(R,{className:"h-8 w-8 text-amber-600 dark:text-amber-400"})}),e.jsx("h3",{className:"font-semibold text-lg text-amber-800 dark:text-amber-300",children:"Localização bloqueada"}),e.jsx("p",{className:"text-sm text-amber-700 dark:text-amber-400 mt-2 mb-4",children:c.errorMessage}),e.jsxs(N,{className:"w-full p-4 bg-white dark:bg-background border-amber-200 dark:border-amber-700 text-left",children:[e.jsxs("p",{className:"font-medium text-sm mb-3 flex items-center gap-2",children:[e.jsx(re,{className:"h-4 w-4"}),"Como permitir o acesso:"]}),e.jsxs("ol",{className:"text-sm space-y-2 text-muted-foreground",children:[e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"font-bold text-primary",children:"1."}),e.jsx("span",{children:"Olhe na barra de endereço do navegador"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"font-bold text-primary",children:"2."}),e.jsx("span",{children:"Clique no ícone de cadeado"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"font-bold text-primary",children:"3."}),e.jsx("span",{children:'Mude "Localização" para "Permitir"'})]})]})]}),e.jsxs("div",{className:"flex gap-2 mt-4 w-full",children:[e.jsxs(u,{variant:"outline",className:"flex-1",onClick:n,children:[e.jsx(L,{className:"h-4 w-4 mr-2"}),"Tentar GPS"]}),e.jsxs(u,{variant:"secondary",className:"flex-1",onClick:()=>t(!0),children:[e.jsx(V,{className:"h-4 w-4 mr-2"}),"Buscar endereço"]})]})]})})}),c.status==="error"&&e.jsx(d.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},children:e.jsx(N,{className:"p-6 border-red-200 bg-red-50 dark:bg-red-950/20 dark:border-red-800",children:e.jsxs("div",{className:"flex flex-col items-center text-center",children:[e.jsx("div",{className:"p-4 rounded-full bg-red-100 dark:bg-red-900/30 mb-4",children:e.jsx(F,{className:"h-8 w-8 text-red-600 dark:text-red-400"})}),e.jsx("h3",{className:"font-semibold text-lg text-red-800 dark:text-red-300",children:"Erro ao obter localização"}),e.jsx("p",{className:"text-sm text-red-700 dark:text-red-400 mt-2 mb-4",children:c.errorMessage}),e.jsxs("div",{className:"flex gap-2 w-full",children:[e.jsxs(u,{variant:"outline",className:"flex-1",onClick:n,children:[e.jsx(L,{className:"h-4 w-4 mr-2"}),"Tentar GPS"]}),e.jsxs(u,{variant:"secondary",className:"flex-1",onClick:()=>t(!0),children:[e.jsx(V,{className:"h-4 w-4 mr-2"}),"Buscar endereço"]})]})]})})}),a.location&&e.jsxs(d.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"space-y-4",children:[e.jsx(N,{className:"p-4 bg-green-50 dark:bg-green-950/20 border-green-200 dark:border-green-800",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-green-100 dark:bg-green-900/50",children:e.jsx(I,{className:"h-5 w-5 text-green-600 dark:text-green-400"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-green-800 dark:text-green-300",children:"Localização capturada!"}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(E,{quality:a.location.quality}),a.location.accuracy&&a.location.source==="gps"&&e.jsxs("span",{className:"text-xs text-muted-foreground",children:["±",Math.round(a.location.accuracy),"m"]})]})]})]})}),e.jsxs(N,{className:"overflow-hidden",children:[e.jsxs("div",{className:"relative h-40 bg-gradient-to-br from-green-100 to-blue-100 dark:from-green-900/20 dark:to-blue-900/20",children:[e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx(d.div,{animate:{scale:[1,1.1,1]},transition:{repeat:1/0,duration:2},className:"p-3 rounded-full bg-primary shadow-lg",children:e.jsx(R,{className:"h-6 w-6 text-primary-foreground"})})}),e.jsx("div",{className:"absolute inset-0 opacity-30",children:e.jsx("div",{className:"h-full w-full",style:{backgroundImage:"linear-gradient(rgba(0,0,0,0.1) 1px, transparent 1px), linear-gradient(90deg, rgba(0,0,0,0.1) 1px, transparent 1px)",backgroundSize:"20px 20px"}})})]}),e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:a.location.address||"Localização capturada"}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Coordenadas: ",a.location.latitude.toFixed(4),", ",a.location.longitude.toFixed(4)]})]}),e.jsxs(u,{variant:"outline",size:"sm",onClick:()=>t(!0),children:[e.jsx(J,{className:"h-3.5 w-3.5 mr-1"}),"Alterar"]})]})})]})]}),c.status==="idle"&&!a.location&&e.jsxs(d.div,{initial:{opacity:0},animate:{opacity:1},className:"flex flex-col items-center py-8 gap-4",children:[e.jsxs(u,{size:"lg",onClick:n,className:"h-14 px-8 rounded-2xl",children:[e.jsx(X,{className:"h-5 w-5 mr-2"}),"Usar minha localização"]}),e.jsx("p",{className:"text-xs text-muted-foreground text-center",children:"ou"}),e.jsxs(u,{variant:"outline",onClick:()=>t(!0),children:[e.jsx(V,{className:"h-4 w-4 mr-2"}),"Buscar endereço manualmente"]})]})]}),e.jsx($,{children:i&&e.jsxs(e.Fragment,{children:[e.jsx(d.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-50 bg-black/40",onClick:()=>t(!1)}),e.jsxs(d.div,{initial:{y:"100%"},animate:{y:0},exit:{y:"100%"},transition:{type:"spring",damping:25,stiffness:300},className:"fixed bottom-0 left-0 right-0 z-50 rounded-t-3xl bg-background p-6 pb-8 max-h-[80vh] overflow-y-auto",children:[e.jsx("div",{className:"absolute top-3 left-1/2 -translate-x-1/2 h-1 w-10 rounded-full bg-muted"}),e.jsx("h3",{className:"font-semibold text-lg mt-4",children:"Buscar endereço"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Digite o nome da rua ou local"}),e.jsxs("div",{className:"relative mt-4",children:[e.jsx(V,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(se,{placeholder:"Ex: Rua Principal, Centro, Tijucas",value:b,onChange:x=>j(x.target.value),className:"pl-10 h-12 rounded-xl",autoFocus:!0}),v&&e.jsx(P,{className:"absolute right-3 top-1/2 -translate-y-1/2 h-4 w-4 animate-spin text-muted-foreground"})]}),m.length>0&&e.jsx("div",{className:"mt-4 space-y-2",children:m.map((x,f)=>e.jsx(d.button,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:f*.05},onClick:()=>p(x),className:"w-full text-left p-3 rounded-xl border hover:bg-muted/50 transition-colors",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(R,{className:"h-5 w-5 text-primary shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",children:x.address}),e.jsx("p",{className:"text-xs text-muted-foreground mt-0.5",children:x.displayName})]})]})},x.placeId||f))}),b.length>=3&&m.length===0&&!v&&e.jsx("p",{className:"text-sm text-muted-foreground text-center py-8",children:"Nenhum resultado encontrado. Tente outro endereço."}),e.jsxs("div",{className:"flex gap-2 mt-6",children:[e.jsx(u,{variant:"outline",className:"flex-1",onClick:()=>t(!1),children:"Cancelar"}),e.jsxs(u,{className:"flex-1",onClick:n,children:[e.jsx(X,{className:"h-4 w-4 mr-2"}),"Usar GPS"]})]})]})]})}),e.jsx("div",{className:"fixed bottom-0 left-0 right-0 p-4 pb-24 bg-background/95 backdrop-blur-lg border-t z-10",children:e.jsxs("div",{className:"flex gap-3 max-w-lg mx-auto",children:[e.jsx(u,{variant:"outline",size:"lg",className:"h-14 rounded-2xl flex-1 text-base",onClick:g,children:"Voltar"}),e.jsx(u,{size:"lg",className:w("h-14 rounded-2xl flex-[2] text-base font-semibold",!k&&"opacity-50"),disabled:!k,onClick:y,children:k?e.jsxs(e.Fragment,{children:["Continuar",e.jsx(W,{className:"h-5 w-5 ml-2"})]}):"Aguardando localização..."})]})})]})}const S=3;function Fe({draft:a,onUpdate:s,onNext:y,onBack:g}){const c=o.useRef(null),h=o.useRef(null),[i,t]=o.useState({status:"idle",facingMode:"environment",stream:null}),[b,j]=o.useState(!1),m=o.useCallback(async()=>{if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia){t(l=>({...l,status:"error",errorMessage:"Seu navegador não suporta acesso à câmera. Tente usar Chrome, Safari ou Firefox."}));return}t(l=>({...l,status:"requesting"}));try{const l=await navigator.mediaDevices.getUserMedia({video:{facingMode:i.facingMode,width:{ideal:1920},height:{ideal:1080}},audio:!1});c.current&&(c.current.srcObject=l,await c.current.play()),t(n=>({...n,status:"active",stream:l,errorMessage:void 0}))}catch(l){if(console.error("Camera error:",l),l instanceof DOMException)if(l.name==="NotAllowedError")t(n=>({...n,status:"denied",errorMessage:"Você não permitiu o acesso à câmera."}));else if(l.name==="NotFoundError")t(n=>({...n,status:"error",errorMessage:"Nenhuma câmera foi encontrada no seu dispositivo."}));else if(l.name==="NotReadableError")t(n=>({...n,status:"error",errorMessage:"A câmera está sendo usada por outro aplicativo. Feche outros apps e tente novamente."}));else if(l.name==="OverconstrainedError"){t(n=>({...n,status:"error",errorMessage:"Sua câmera não atende aos requisitos. Tentando configuração alternativa..."}));try{const n=await navigator.mediaDevices.getUserMedia({video:!0,audio:!1});c.current&&(c.current.srcObject=n,await c.current.play()),t(C=>({...C,status:"active",stream:n,errorMessage:void 0}))}catch{t(n=>({...n,status:"error",errorMessage:"Não foi possível acessar sua câmera."}))}}else t(n=>({...n,status:"error",errorMessage:"Ocorreu um erro ao acessar a câmera. Tente novamente."}));else t(n=>({...n,status:"error",errorMessage:"Erro desconhecido ao acessar a câmera."}))}},[i.facingMode]),r=o.useCallback(()=>{i.stream&&i.stream.getTracks().forEach(l=>l.stop()),c.current&&(c.current.srcObject=null),t(l=>({...l,status:"idle",stream:null}))},[i.stream]);o.useEffect(()=>(a.images.length<S&&i.status==="idle"&&m(),()=>{i.stream&&i.stream.getTracks().forEach(l=>l.stop())}),[]);const v=o.useCallback(async()=>{r(),t(l=>({...l,facingMode:l.facingMode==="environment"?"user":"environment"})),setTimeout(()=>m(),100)},[m,r]),q=o.useCallback(async()=>{if(!c.current||!h.current||a.images.length>=S)return;j(!0);const l=c.current,n=h.current,C=n.getContext("2d");if(!C){j(!1);return}n.width=l.videoWidth,n.height=l.videoHeight,C.drawImage(l,0,0),n.toBlob(p=>{if(!p){j(!1);return}const k=new File([p],`photo_${Date.now()}.jpg`,{type:"image/jpeg",lastModified:Date.now()}),E={id:ne(),file:k,previewUrl:URL.createObjectURL(p),capturedAt:new Date};s({images:[...a.images,E]}),j(!1),a.images.length+1>=S&&r()},"image/jpeg",.85)},[a.images,s,r]),z=o.useCallback(l=>{const n=a.images.find(C=>C.id===l);n&&URL.revokeObjectURL(n.previewUrl),s({images:a.images.filter(C=>C.id!==l)}),i.status==="idle"&&a.images.length<=S&&m()},[a.images,i.status,s,m]),A=o.useCallback(l=>{z(l),i.status!=="active"&&m()},[z,i.status,m]);return e.jsxs("div",{className:"space-y-4 pb-48",children:[e.jsx(H,{title:"Tire até 3 fotos",subtitle:"Registre o problema com fotos tiradas agora",helpTitle:"Por que só fotos da câmera?",helpContent:["Por segurança, só aceitamos fotos tiradas no momento da denúncia.","Isso garante que o problema existe e é recente.","Não é possível enviar fotos da galeria do celular."]}),e.jsx(N,{className:"p-4 bg-blue-50 dark:bg-blue-950/30 border-blue-200 dark:border-blue-800",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-blue-100 dark:bg-blue-900/50",children:e.jsx(O,{className:"h-4 w-4 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{className:"space-y-2 text-sm text-blue-700 dark:text-blue-300",children:[e.jsx("p",{className:"font-medium",children:"Dicas para boas fotos:"}),e.jsxs("ul",{className:"space-y-1 text-blue-600 dark:text-blue-400",children:[e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx(D,{className:"h-3.5 w-3.5"}),e.jsx("span",{children:"1 foto de perto do problema"})]}),e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx(Me,{className:"h-3.5 w-3.5"}),e.jsx("span",{children:"1 foto mostrando o contexto da rua"})]}),e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx(ee,{className:"h-3.5 w-3.5"}),e.jsx("span",{children:"Evite se colocar em risco"})]})]})]})]})}),e.jsxs("div",{className:"relative",children:[i.status==="active"&&a.images.length<S&&e.jsxs(d.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"relative rounded-2xl overflow-hidden bg-muted aspect-[4/3]",children:[e.jsx("video",{ref:c,autoPlay:!0,playsInline:!0,muted:!0,"webkit-playsinline":"true","x-webkit-airplay":"allow",style:{backgroundColor:"transparent"},className:"w-full h-full object-cover"}),e.jsxs("div",{className:"absolute bottom-4 left-0 right-0 flex items-center justify-center gap-4",children:[e.jsx(d.button,{whileTap:{scale:.9},onClick:v,className:"p-3 rounded-full bg-black/50 text-white backdrop-blur-sm","aria-label":"Trocar câmera",children:e.jsx(Te,{className:"h-5 w-5"})}),e.jsx(d.button,{whileTap:{scale:.9},onClick:q,disabled:b,className:w("p-1 rounded-full bg-white",b&&"opacity-50"),"aria-label":"Capturar foto",children:e.jsx("div",{className:"h-16 w-16 rounded-full border-4 border-primary flex items-center justify-center",children:b?e.jsx(P,{className:"h-6 w-6 text-primary animate-spin"}):e.jsx(D,{className:"h-6 w-6 text-primary"})})}),e.jsx("div",{className:"w-12"})]}),e.jsxs("div",{className:"absolute top-4 right-4 px-3 py-1.5 rounded-full bg-black/50 text-white text-sm backdrop-blur-sm flex items-center gap-1",children:[e.jsx(D,{className:"h-3.5 w-3.5"}),e.jsxs("span",{children:[a.images.length,"/",S]})]})]}),i.status==="requesting"&&e.jsxs(d.div,{initial:{opacity:0},animate:{opacity:1},className:"rounded-2xl bg-muted aspect-[4/3] flex flex-col items-center justify-center p-6 text-center",children:[e.jsx("div",{className:"p-4 rounded-full bg-primary/10 mb-4",children:e.jsx(P,{className:"h-8 w-8 text-primary animate-spin"})}),e.jsx("p",{className:"font-medium mb-1",children:"Iniciando câmera..."}),e.jsx("p",{className:"text-sm text-muted-foreground",children:'Se aparecer uma mensagem, toque em "Permitir"'})]}),i.status==="denied"&&e.jsx(d.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},children:e.jsx(N,{className:"p-6 border-amber-200 bg-amber-50 dark:bg-amber-950/20 dark:border-amber-800",children:e.jsxs("div",{className:"flex flex-col items-center text-center",children:[e.jsx("div",{className:"p-4 rounded-full bg-amber-100 dark:bg-amber-900/30 mb-4",children:e.jsx(ee,{className:"h-8 w-8 text-amber-600 dark:text-amber-400"})}),e.jsx("h3",{className:"font-semibold text-lg text-amber-800 dark:text-amber-300",children:"Câmera bloqueada"}),e.jsx("p",{className:"text-sm text-amber-700 dark:text-amber-400 mt-2 mb-4",children:i.errorMessage}),e.jsxs(N,{className:"w-full p-4 bg-white dark:bg-background border-amber-200 dark:border-amber-700",children:[e.jsxs("p",{className:"font-medium text-sm mb-3 flex items-center gap-2",children:[e.jsx(re,{className:"h-4 w-4"}),"Como permitir o acesso:"]}),e.jsxs("ol",{className:"text-left text-sm space-y-2 text-muted-foreground",children:[e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"font-bold text-primary",children:"1."}),e.jsx("span",{children:"Olhe na barra de endereço do navegador"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"font-bold text-primary",children:"2."}),e.jsx("span",{children:"Clique no ícone de cadeado ou câmera"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"font-bold text-primary",children:"3."}),e.jsx("span",{children:'Mude "Câmera" para "Permitir"'})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"font-bold text-primary",children:"4."}),e.jsx("span",{children:"Recarregue a página ou toque no botão abaixo"})]})]})]}),e.jsxs(u,{variant:"outline",className:"mt-4 w-full",onClick:m,children:[e.jsx(L,{className:"h-4 w-4 mr-2"}),"Tentar novamente"]})]})})}),i.status==="error"&&e.jsx(d.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},children:e.jsx(N,{className:"p-6 border-red-200 bg-red-50 dark:bg-red-950/20 dark:border-red-800",children:e.jsxs("div",{className:"flex flex-col items-center text-center",children:[e.jsx("div",{className:"p-4 rounded-full bg-red-100 dark:bg-red-900/30 mb-4",children:e.jsx(F,{className:"h-8 w-8 text-red-600 dark:text-red-400"})}),e.jsx("h3",{className:"font-semibold text-lg text-red-800 dark:text-red-300",children:"Problema com a câmera"}),e.jsx("p",{className:"text-sm text-red-700 dark:text-red-400 mt-2 mb-4",children:i.errorMessage}),e.jsxs(N,{className:"w-full p-4 bg-white dark:bg-background border-red-200 dark:border-red-700",children:[e.jsx("p",{className:"font-medium text-sm mb-3",children:"O que você pode fazer:"}),e.jsxs("ul",{className:"text-left text-sm space-y-2 text-muted-foreground",children:[e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(I,{className:"h-4 w-4 text-green-500 shrink-0 mt-0.5"}),e.jsx("span",{children:"Verifique se seu dispositivo tem câmera"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(I,{className:"h-4 w-4 text-green-500 shrink-0 mt-0.5"}),e.jsx("span",{children:"Feche outros aplicativos que usam a câmera"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(I,{className:"h-4 w-4 text-green-500 shrink-0 mt-0.5"}),e.jsx("span",{children:"Tente acessar pelo celular em vez do computador"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(I,{className:"h-4 w-4 text-green-500 shrink-0 mt-0.5"}),e.jsx("span",{children:"Você pode continuar sem foto (opcional)"})]})]})]}),e.jsxs(u,{variant:"outline",className:"mt-4 w-full",onClick:m,children:[e.jsx(L,{className:"h-4 w-4 mr-2"}),"Tentar novamente"]})]})})}),e.jsx("canvas",{ref:h,className:"hidden"})]}),a.images.length>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("p",{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(I,{className:"h-4 w-4 text-green-500"}),"Fotos capturadas (",a.images.length,"/",S,")"]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsx($,{mode:"popLayout",children:a.images.map((l,n)=>e.jsxs(d.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.8},layout:!0,className:"relative aspect-square rounded-xl overflow-hidden bg-muted",children:[e.jsx("img",{src:l.previewUrl,alt:`Foto ${n+1}`,className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute inset-x-0 bottom-0 p-2 bg-gradient-to-t from-black/70 to-transparent",children:e.jsxs("div",{className:"flex justify-center gap-2",children:[e.jsxs(d.button,{whileTap:{scale:.9},onClick:()=>A(l.id),className:"px-2 py-1 text-xs bg-white/20 text-white rounded-md backdrop-blur-sm flex items-center gap-1",children:[e.jsx(L,{className:"h-3 w-3"}),"Refazer"]}),e.jsxs(d.button,{whileTap:{scale:.9},onClick:()=>z(l.id),className:"px-2 py-1 text-xs bg-red-500/80 text-white rounded-md flex items-center gap-1",children:[e.jsx(Y,{className:"h-3 w-3"}),"Remover"]})]})}),e.jsx("div",{className:"absolute top-2 left-2 h-6 w-6 rounded-full bg-primary text-primary-foreground text-xs font-bold flex items-center justify-center",children:n+1})]},l.id))}),Array.from({length:S-a.images.length}).map((l,n)=>e.jsxs("div",{className:"aspect-square rounded-xl border-2 border-dashed border-muted-foreground/30 flex flex-col items-center justify-center gap-1",children:[e.jsx(D,{className:"h-5 w-5 text-muted-foreground/30"}),e.jsx("span",{className:"text-xs text-muted-foreground/50",children:"Vazio"})]},`empty-${n}`))]})]}),a.images.length>=S&&e.jsx(N,{className:"p-4 text-center bg-green-50 dark:bg-green-950/20 border-green-200 dark:border-green-800",children:e.jsxs("div",{className:"flex items-center justify-center gap-2 text-green-700 dark:text-green-300",children:[e.jsx(I,{className:"h-5 w-5"}),e.jsxs("span",{className:"font-medium",children:["Você tirou ",S," fotos. Pronto para continuar!"]})]})}),a.images.length===0&&(i.status==="error"||i.status==="denied")&&e.jsx(N,{className:"p-4 border-amber-200 bg-amber-50 dark:bg-amber-950/20 dark:border-amber-800",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(F,{className:"h-5 w-5 text-amber-600 shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-amber-800 dark:text-amber-300",children:"Continuar sem foto?"}),e.jsx("p",{className:"text-sm text-amber-700 dark:text-amber-400 mt-1",children:"Fotos ajudam muito a identificar o problema, mas você pode continuar sem elas."})]})]})}),e.jsx("div",{className:"fixed bottom-0 left-0 right-0 p-4 pb-24 bg-background/95 backdrop-blur-lg border-t z-10",children:e.jsxs("div",{className:"flex gap-3 max-w-lg mx-auto",children:[e.jsx(u,{variant:"outline",size:"lg",className:"h-14 rounded-2xl flex-1 text-base",onClick:()=>{r(),g()},children:"Voltar"}),e.jsxs(u,{size:"lg",className:"h-14 rounded-2xl flex-[2] text-base font-semibold",onClick:()=>{r(),y()},children:["Continuar",a.images.length===0&&e.jsx("span",{className:"text-xs ml-2 opacity-70",children:"(sem foto)"})]})]})})]})}function Oe({draft:a,onUpdate:s,onBack:y,onGoToStep:g,onSubmit:c}){const[h,i]=o.useState(!1),{categories:t}=ie(),b=t.find(r=>r.id===a.categoryId),j=!!a.categoryId&&!!a.location&&a.confirmed&&!!a.title?.trim(),m=async()=>{if(j){i(!0);try{await c()}catch(r){console.error("Submit error:",r)}finally{i(!1)}}};return e.jsxs("div",{className:"space-y-4 pb-48",children:[e.jsx(H,{title:"Revisar e enviar",subtitle:"Adicione um título e confira as informações",helpTitle:"Última etapa!",helpContent:["Adicione um título curto que descreva o problema.","Revise todas as informações antes de enviar.","Após enviar, você receberá um número de protocolo."]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(ve,{className:"h-4 w-4 text-muted-foreground"}),"Título da denúncia *"]}),e.jsx(se,{placeholder:"Ex: Buraco grande na Rua Principal",value:a.title||"",onChange:r=>s({title:r.target.value}),className:"h-12 rounded-xl",maxLength:100}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Descreva o problema em poucas palavras (obrigatório)"})]}),e.jsx(N,{className:"p-4",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-3 rounded-xl text-2xl",style:{backgroundColor:b?.color+"20"},children:b?.icon||"❓"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Categoria"}),e.jsx("p",{className:"font-semibold",children:b?.name||"Não selecionada"})]})]}),e.jsxs(u,{variant:"ghost",size:"sm",onClick:()=>g(1),className:"text-primary",children:[e.jsx(G,{className:"h-4 w-4 mr-1"}),"Editar"]})]})}),e.jsx(N,{className:"p-4",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-3 rounded-xl bg-primary/10",children:e.jsx(R,{className:"h-6 w-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Localização"}),e.jsx("p",{className:"font-semibold",children:a.location?.address||"Localização capturada"}),a.location?.quality&&e.jsx(be,{variant:"secondary",className:"mt-1 text-xs capitalize",children:a.location.quality})]})]}),e.jsxs(u,{variant:"ghost",size:"sm",onClick:()=>g(2),className:"text-primary",children:[e.jsx(G,{className:"h-4 w-4 mr-1"}),"Editar"]})]})}),e.jsxs(N,{className:"p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-3 rounded-xl bg-primary/10",children:e.jsx(D,{className:"h-6 w-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Fotos"}),e.jsxs("p",{className:"font-semibold",children:[a.images.length," ",a.images.length===1?"foto anexada":"fotos anexadas"]})]})]}),e.jsxs(u,{variant:"ghost",size:"sm",onClick:()=>g(3),className:"text-primary",children:[e.jsx(G,{className:"h-4 w-4 mr-1"}),"Editar"]})]}),a.images.length>0?e.jsx("div",{className:"flex gap-2 overflow-x-auto pb-1",children:a.images.map((r,v)=>e.jsx("img",{src:r.previewUrl,alt:`Foto ${v+1}`,className:"h-20 w-20 rounded-lg object-cover shrink-0"},r.id))}):e.jsxs("div",{className:"flex items-center gap-2 text-amber-600 dark:text-amber-400",children:[e.jsx(F,{className:"h-4 w-4"}),e.jsx("p",{className:"text-sm",children:"Nenhuma foto anexada (opcional)"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(te,{className:"h-4 w-4 text-muted-foreground"}),"Descrição adicional (opcional)"]}),e.jsx(Ne,{placeholder:"Algum detalhe importante? (máx. 500 caracteres)",maxLength:500,value:a.description,onChange:r=>s({description:r.target.value}),className:"min-h-[100px] rounded-xl resize-none"}),e.jsxs("p",{className:"text-xs text-muted-foreground text-right",children:[a.description.length,"/500"]})]}),e.jsx(N,{className:w("p-4 transition-all border-2",a.confirmed?"border-green-400 bg-green-50 dark:bg-green-950/20 dark:border-green-700":"border-amber-400 bg-amber-50 dark:bg-amber-950/20 dark:border-amber-700"),children:e.jsxs("label",{className:"flex items-start gap-3 cursor-pointer",children:[e.jsx(je,{checked:a.confirmed,onCheckedChange:r=>s({confirmed:!!r}),className:"mt-0.5 h-5 w-5"}),e.jsxs("div",{children:[e.jsx("p",{className:w("font-medium",a.confirmed?"text-green-700 dark:text-green-300":"text-amber-700 dark:text-amber-300"),children:a.confirmed?e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(I,{className:"h-4 w-4"}),"Confirmado!"]}):"Confirmo que as informações são verdadeiras"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:a.confirmed?"Você confirmou que as informações são verdadeiras":"Marque para poder enviar a denúncia"})]})]})}),!j&&e.jsx(N,{className:"p-4 border-red-200 bg-red-50 dark:bg-red-950/20 dark:border-red-800",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(F,{className:"h-5 w-5 text-red-600 dark:text-red-400 shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-red-800 dark:text-red-300",children:"Não é possível enviar ainda"}),e.jsxs("ul",{className:"text-sm text-red-700 dark:text-red-400 mt-1 space-y-1",children:[!a.title?.trim()&&e.jsx("li",{children:"• Adicione um título"}),!a.categoryId&&e.jsx("li",{children:"• Selecione uma categoria"}),!a.location&&e.jsx("li",{children:"• Capture sua localização"}),!a.confirmed&&e.jsx("li",{children:"• Confirme que as informações são verdadeiras"})]})]})]})}),e.jsx("div",{className:"fixed bottom-0 left-0 right-0 p-4 pb-24 bg-background/95 backdrop-blur-lg border-t z-10",children:e.jsxs("div",{className:"flex gap-3 max-w-lg mx-auto",children:[e.jsx(u,{variant:"outline",size:"lg",className:"h-14 rounded-2xl flex-1 text-base",onClick:y,disabled:h,children:"Voltar"}),e.jsx(u,{size:"lg",className:w("h-14 rounded-2xl flex-[2] text-base font-semibold",j?"bg-green-600 hover:bg-green-700":"opacity-50"),disabled:!j||h,onClick:m,children:h?e.jsxs(e.Fragment,{children:[e.jsx(P,{className:"h-5 w-5 mr-2 animate-spin"}),"Enviando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ye,{className:"h-5 w-5 mr-2"}),"Enviar denúncia"]})})]})})]})}function Ve({protocolNumber:a,onClose:s}){const{toast:y}=oe(),g=o.useCallback(()=>{const t=Date.now()+3e3,b={startVelocity:30,spread:360,ticks:60,zIndex:100},j=(r,v)=>Math.random()*(v-r)+r,m=setInterval(()=>{const r=t-Date.now();if(r<=0)return clearInterval(m);const v=50*(r/3e3);U({...b,particleCount:v,origin:{x:j(.1,.3),y:Math.random()-.2},colors:["#22c55e","#3b82f6","#f59e0b","#ec4899","#8b5cf6"]}),U({...b,particleCount:v,origin:{x:j(.7,.9),y:Math.random()-.2},colors:["#22c55e","#3b82f6","#f59e0b","#ec4899","#8b5cf6"]})},250);return U({particleCount:100,spread:70,origin:{y:.6},colors:["#22c55e","#3b82f6","#f59e0b","#ec4899","#8b5cf6"]}),()=>clearInterval(m)},[]);o.useEffect(()=>g(),[g]);const c=async()=>{try{await navigator.clipboard.writeText(a),y({title:"Protocolo copiado!",description:"Cole onde quiser para guardar."})}catch{y({title:"Erro ao copiar",description:"Tente copiar manualmente.",variant:"destructive"})}},h=async()=>{if(navigator.share)try{await navigator.share({title:"Denúncia Enviada - eTijucas",text:`Minha denúncia foi registrada com sucesso! Protocolo: ${a}`})}catch{console.log("Share cancelled")}else c()};return e.jsxs("div",{className:"fixed inset-0 z-50 bg-gradient-to-b from-green-50 to-background dark:from-green-950/30 dark:to-background flex flex-col items-center justify-center p-6 overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 overflow-hidden pointer-events-none",children:[...Array(6)].map((i,t)=>e.jsx(d.div,{initial:{opacity:0,scale:0},animate:{opacity:[0,.3,0],scale:[0,1.5,2],x:Math.random()*100-50,y:Math.random()*100-50},transition:{duration:3,delay:t*.3,repeat:1/0,repeatDelay:2},className:"absolute rounded-full bg-green-400/20",style:{width:100+t*30,height:100+t*30,left:`${20+t*10}%`,top:`${15+t*12}%`}},t))}),e.jsxs(d.div,{initial:{opacity:0,y:50},animate:{opacity:1,y:0},transition:{duration:.5},className:"relative z-10 w-full max-w-sm flex flex-col items-center text-center",children:[e.jsxs(d.div,{initial:{scale:0,rotate:-180},animate:{scale:1,rotate:0},transition:{type:"spring",stiffness:200,damping:15,delay:.2},className:"relative mb-6",children:[e.jsx("div",{className:"p-6 rounded-full bg-green-100 dark:bg-green-900/50 shadow-lg shadow-green-500/20",children:e.jsx(I,{className:"h-20 w-20 text-green-600 dark:text-green-400"})}),e.jsx(d.div,{animate:{rotate:360},transition:{duration:3,repeat:1/0,ease:"linear"},className:"absolute -top-2 -right-2",children:e.jsx(ke,{className:"h-8 w-8 text-yellow-500"})}),e.jsx(d.div,{animate:{rotate:-360},transition:{duration:4,repeat:1/0,ease:"linear"},className:"absolute -bottom-1 -left-3",children:e.jsx(Z,{className:"h-7 w-7 text-pink-500"})})]}),e.jsx(d.h1,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},className:"text-3xl font-bold text-green-700 dark:text-green-400 mb-2",children:"Denúncia Enviada!"}),e.jsx(d.p,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4},className:"text-muted-foreground mb-6",children:"Obrigado por ajudar a melhorar nossa cidade!"}),e.jsx(d.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.5},className:"w-full",children:e.jsxs(N,{className:"p-6 bg-white dark:bg-card border-green-200 dark:border-green-800 shadow-lg",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 mb-3",children:[e.jsx(te,{className:"h-5 w-5 text-primary"}),e.jsx("span",{className:"text-sm text-muted-foreground font-medium",children:"Número do Protocolo"})]}),e.jsx(d.p,{className:"text-2xl font-bold font-mono text-primary mb-4",animate:{scale:[1,1.02,1]},transition:{duration:2,repeat:1/0},children:a}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(u,{variant:"outline",size:"sm",className:"flex-1",onClick:c,children:[e.jsx(we,{className:"h-4 w-4 mr-2"}),"Copiar"]}),e.jsxs(u,{variant:"outline",size:"sm",className:"flex-1",onClick:h,children:[e.jsx(Ce,{className:"h-4 w-4 mr-2"}),"Compartilhar"]})]})]})}),e.jsx(d.p,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.7},className:"text-xs text-muted-foreground mt-4 max-w-xs",children:"Guarde este número para acompanhar o andamento da sua denúncia. Nossa equipe irá analisar e tomar as providências necessárias."}),e.jsxs(d.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.8},className:"w-full mt-8 space-y-3",children:[e.jsxs(u,{size:"lg",className:"w-full h-14 rounded-2xl text-base font-semibold bg-green-600 hover:bg-green-700",onClick:s,children:[e.jsx(de,{className:"h-5 w-5 mr-2"}),"Voltar para o início"]}),e.jsxs(u,{variant:"ghost",size:"lg",className:"w-full h-12 rounded-2xl text-base",onClick:()=>{U({particleCount:100,spread:70,origin:{y:.6},colors:["#22c55e","#3b82f6","#f59e0b","#ec4899","#8b5cf6"]})},children:[e.jsx(Z,{className:"h-5 w-5 mr-2"}),"Celebrar mais! 🎉"]})]})]})]})}const B=()=>`report-${Date.now()}-${Math.random().toString(36).slice(2,11)}`,ae={categoryId:null,category:null,location:null,images:[],title:"",description:"",confirmed:!1,currentStep:1,createdAt:new Date,updatedAt:new Date,idempotencyKey:B()},_="etijucas-report-draft",Ue=["Categoria","Localização","Fotos","Revisão"],Be={enter:a=>({x:a>0?"100%":"-100%",opacity:0}),center:{x:0,opacity:1},exit:a=>({x:a<0?"100%":"-100%",opacity:0})};function ya(){const a=me(),[s,y]=o.useState(()=>({...ae,idempotencyKey:B()})),[g,c]=o.useState(0),[h,i]=o.useState(!1),[t,b]=o.useState(null),{createReport:j}=pe();o.useEffect(()=>{try{const p=localStorage.getItem(_);if(p){const k=JSON.parse(p);y({...k,createdAt:new Date(k.createdAt),updatedAt:new Date(k.updatedAt),images:[],idempotencyKey:k.idempotencyKey||B()})}}catch(p){console.error("Error loading draft:",p)}},[]);const m=o.useCallback(p=>{try{const k={...p,images:[],updatedAt:new Date};localStorage.setItem(_,JSON.stringify(k))}catch(k){console.error("Error saving draft:",k)}},[]),r=o.useCallback(p=>{y(k=>{const E={...k,...p,updatedAt:new Date};return m(E),E})},[m]),v=o.useCallback(p=>{c(p>s.currentStep?1:-1),r({currentStep:p})},[s.currentStep,r]),q=o.useCallback(()=>{s.currentStep<4&&(c(1),r({currentStep:s.currentStep+1}))},[s.currentStep,r]),z=o.useCallback(()=>{s.currentStep>1&&(c(-1),r({currentStep:s.currentStep-1}))},[s.currentStep,r]),A=o.useCallback(()=>{s.images.forEach(p=>URL.revokeObjectURL(p.previewUrl)),localStorage.removeItem(_),y({...ae,idempotencyKey:B()})},[s.images]),l=o.useCallback(async()=>{if(!s.categoryId||!s.title){K.error("Preencha todos os campos obrigatórios");return}try{const p={categoryId:s.categoryId,title:s.title,description:s.description,images:s.images.map(E=>E.file)};s.location&&(p.addressText=s.location.address,p.addressSource=s.location.source,p.locationQuality=s.location.quality,p.latitude=s.location.latitude,p.longitude=s.location.longitude,p.locationAccuracyM=s.location.accuracy);const k=await j({payload:p,idempotencyKey:s.idempotencyKey});b(k.protocol),i(!0),A(),K.success("Denúncia enviada com sucesso!")}catch(p){console.error("Error submitting report:",p),K.error("Erro ao enviar denúncia. Tente novamente.")}},[s,j,A]),n=()=>{s.categoryId||s.location||s.images.length>0?window.confirm("Tem certeza que deseja sair? Seu rascunho será salvo.")&&a(-1):a(-1)},C=()=>{a("/")};return h&&t?e.jsx(Ve,{protocolNumber:t,onClose:C}):e.jsxs("div",{className:"fixed inset-0 z-50 bg-background flex flex-col overflow-hidden",children:[e.jsxs("header",{className:"shrink-0 bg-background/95 backdrop-blur-lg border-b safe-top",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3",children:[e.jsx(u,{variant:"ghost",size:"icon",onClick:n,className:"rounded-full",children:e.jsx(Se,{className:"h-5 w-5"})}),e.jsx("h1",{className:"font-semibold text-lg",children:"Enviar Denúncia"}),e.jsx(u,{variant:"ghost",size:"icon",onClick:n,className:"rounded-full",children:e.jsx(Y,{className:"h-5 w-5"})})]}),e.jsx("div",{className:"px-4 pb-4",children:e.jsx(Ae,{currentStep:s.currentStep,totalSteps:4,labels:Ue})})]}),e.jsx("main",{className:"flex-1 overflow-hidden",children:e.jsx($,{mode:"wait",custom:g,children:e.jsxs(d.div,{custom:g,variants:Be,initial:"enter",animate:"center",exit:"exit",transition:{x:{type:"spring",stiffness:300,damping:30},opacity:{duration:.2}},className:"h-full overflow-y-auto px-4 pt-4",children:[s.currentStep===1&&e.jsx(Pe,{draft:s,onUpdate:r,onNext:q}),s.currentStep===2&&e.jsx(Le,{draft:s,onUpdate:r,onNext:q,onBack:z}),s.currentStep===3&&e.jsx(Fe,{draft:s,onUpdate:r,onNext:q,onBack:z}),s.currentStep===4&&e.jsx(Oe,{draft:s,onUpdate:r,onBack:z,onGoToStep:v,onSubmit:l})]},s.currentStep)})})]})}export{ya as default};
