import{k as n,E as o,K as c,I as i}from"./index-BxQAMxYM.js";async function p(){try{return(await n.get(o.reports.categories)).data}catch(e){throw console.error("[ReportService] Failed to fetch categories:",e),e}}async function d(e,t){const r=new FormData;r.append("categoryId",e.categoryId),r.append("title",e.title),r.append("description",e.description),e.addressText&&r.append("addressText",e.addressText),e.addressSource&&r.append("addressSource",e.addressSource),e.locationQuality&&r.append("locationQuality",e.locationQuality),e.latitude!==void 0&&r.append("latitude",String(e.latitude)),e.longitude!==void 0&&r.append("longitude",String(e.longitude)),e.locationAccuracyM!==void 0&&r.append("locationAccuracyM",String(e.locationAccuracyM)),e.bairroId&&r.append("bairroId",e.bairroId),e.images&&e.images.length>0&&e.images.forEach(a=>{r.append("images[]",a)});try{const a=await n.postFormData(o.reports.create,r,{headers:{"X-Idempotency-Key":t}});return a.data&&await c.save(a.data),a.data}catch(a){throw console.error("[ReportService] Failed to create report:",a),await i.exists(t)||await i.add({type:"report",data:{...e,images:[]},idempotencyKey:t}),a}}async function g(e){try{const t=new URLSearchParams;e?.status&&t.append("status",e.status),e?.categoryId&&t.append("categoryId",e.categoryId),e?.page&&t.append("page",String(e.page)),e?.perPage&&t.append("perPage",String(e.perPage));const r=t.toString(),a=r?`${o.reports.myReports}?${r}`:o.reports.myReports,s=await n.get(a);return s.data.length>0&&await c.saveMany(s.data),s}catch(t){console.error("[ReportService] Failed to fetch my reports:",t);const r=await c.getAll();return{data:r,meta:{current_page:1,last_page:1,per_page:10,total:r.length}}}}async function u(e){try{const t=new URLSearchParams;e?.status&&t.append("status",e.status),e?.categoryId&&t.append("categoryId",e.categoryId),e?.search&&t.append("search",e.search),e?.page&&t.append("page",String(e.page)),e?.perPage&&t.append("perPage",String(e.perPage));const r=t.toString(),a=r?`${o.reports.list}?${r}`:o.reports.list;return await n.get(a)}catch(t){throw console.error("[ReportService] Failed to fetch public reports:",t),t}}async function h(){try{return(await n.get(o.reports.stats)).data}catch(e){return console.error("[ReportService] Failed to fetch reports stats:",e),{total:0,byStatus:{recebido:0,em_analise:0,resolvido:0,rejeitado:0},thisMonth:0,resolvedThisMonth:0}}}async function S(e){try{const t=await n.get(o.reports.get(e));return await c.save(t.data),t.data}catch(t){return console.error("[ReportService] Failed to fetch report:",t),await c.getById(e)}}async function m(e,t){const r=new FormData;return t.forEach(s=>{r.append("images[]",s)}),(await n.postFormData(o.reports.addMedia(e),r)).data}async function f(e,t){await n.delete(o.reports.removeMedia(e,t))}async function w(e,t,r){try{const a=new URLSearchParams({q:e});return t!==void 0&&a.append("lat",String(t)),r!==void 0&&a.append("lon",String(r)),(await n.get(`${o.geocode.autocomplete}?${a.toString()}`)).data}catch(a){return console.error("[ReportService] Geocode autocomplete failed:",a),[]}}async function v(e,t){try{const r=new URLSearchParams({lat:String(e),lon:String(t)});return(await n.get(`${o.geocode.reverse}?${r.toString()}`)).data}catch(r){return console.error("[ReportService] Geocode reverse failed:",r),null}}const y={getCategories:p,createReport:d,getMyReports:g,getPublicReports:u,getReportsStats:h,getReportById:S,addReportMedia:m,removeReportMedia:f,geocodeAutocomplete:w,geocodeReverse:v};export{y as r};
