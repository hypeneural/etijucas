import{r as l,j as t,M as ue,l as V,m as w,x as te,$ as U,a6 as le,H as at,ad as rt,g as st,ae as ot,af as P,X as it,ag as nt,ah as Re,ai as ct,aj as lt,a7 as dt,Z as me,ak as ht,al as pt,am as ut,an as mt,w as ft,ac as Pe,z as ae,L as de,ao as Ae,ap as xt,aq as gt,ar as re,as as ze,a0 as _e,a8 as vt,a9 as wt}from"./vendor-app-B8nTTOoa.js";import{t as yt,f as De}from"./auth.service-DHjiWbHT.js";import{d as G,E as q,g as bt,A as jt,e as Nt,c as O,B as k,u as Ct,a as St}from"./index-DCL-AqRy.js";import{I as T}from"./input-Cl-fV-tt.js";import{L as D}from"./label-BDr5uG4Q.js";import{C as K}from"./card-BX7Tpw0d.js";import{S as he}from"./switch-Cbzd0rOf.js";import{S as Et}from"./slider-SI6GJ52C.js";import"./checkbox-BMMP1vHX.js";import{B as Rt}from"./BottomTabBar-C1TySGJ8.js";import{u as Pt}from"./useAppStore-BzXpTAO0.js";import{m as ke,P as At}from"./auth-utils-B5I9WPFS.js";import"./useCityName-DUrWkBfG.js";import"./bairros-Cf5Z_oCw.js";const Q={async getProfile(){return(await G.get(q.users.me)).data},async updateProfile(s){return(await G.put(q.users.update,s)).data},async uploadAvatar(s){const r=new FormData;r.append("file",s);const e=yt.getToken(),a=`${jt.baseURL}${q.users.avatar}`,o=bt(),i=await fetch(a,{method:"POST",headers:{Accept:"application/json",...e&&{Authorization:`Bearer ${e}`},...o},body:r});if(!i.ok){const n=await i.json().catch(()=>({}));throw new Error(n.message||"Falha no upload da imagem")}return await i.json()},async removeAvatar(){await G.delete(q.users.avatar)},async changePassword(s){await G.put(q.users.password,s)},async updateNotifications(s){return(await G.put(q.users.notifications,s)).data}};function Be(s){const r=s.replace(/\D/g,"");return/^\d{8}$/.test(r)}function zt(s){const r=s.replace(/\D/g,"");return r.length<=5?r:`${r.slice(0,5)}-${r.slice(5,8)}`}function fe(s){return s.replace(/\D/g,"")}const pe={async lookup(s){const r=fe(s);if(!Be(r))return{success:!1,error:"CEP inválido",message:"O CEP deve ter 8 dígitos."};try{return await G.get(`/cep/${r}`)}catch(e){return e instanceof Nt?{success:!1,error:e.code||"API_ERROR",message:e.message}:{success:!1,error:"Erro de conexão",message:"Não foi possível consultar o CEP. Tente novamente."}}},async getBairros(){try{return(await G.get("/bairros")).data||[]}catch{return[]}}};function _t({value:s,onChange:r,error:e,disabled:a=!1}){const[o,i]=l.useState(s.cep||""),[c,n]=l.useState(!1),[d,h]=l.useState(null),[p,f]=l.useState(!1),[g,v]=l.useState(!1),[j,y]=l.useState([]),[b,u]=l.useState(!1),E=l.useRef(null),A=l.useCallback(x=>{const W=x.target.value,z=fe(W);z.length<=8&&(i(zt(z)),h(null),f(!1),v(!1),u(!1),r({...s,cep:z,bairroId:void 0}))},[r,s]);l.useEffect(()=>{const x=fe(o);x.length===8&&Be(x)&&(async()=>{n(!0),h(null),f(!1);const z=await pe.lookup(x);if(!z.success||!z.data){h(z.message||"Erro ao buscar CEP"),r({cep:x}),n(!1);return}const{address:I,match:R,ui_hints:N,available_bairros:C}=z.data;if(!R.city_ok){h(`Somente moradores de Tijucas podem se cadastrar. Este CEP é de ${I.city_name||"outra cidade"}.`),r({cep:x}),n(!1);return}const S={cep:x,logradouro:I.logradouro||"",bairro:I.bairro_text||"",localidade:"Tijucas",uf:"SC",complemento:I.complemento||void 0};R.bairro_ok&&R.bairro_id?(S.bairroId=R.bairro_id,u(!0),f(!0)):(y(C||[]),v(!0),u(!1)),r(S),N.toast&&console.info(N.toast),N.focus_next==="numero"&&R.bairro_ok&&setTimeout(()=>E.current?.focus(),100),n(!1)})()},[o]);const L=l.useCallback((x,W)=>{r({...s,[x]:W})},[r,s]),Z=l.useCallback(x=>{r({...s,bairro:x.nome,bairroId:x.id}),v(!1),u(!0),f(!0),setTimeout(()=>E.current?.focus(),100)},[r,s]);return t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"space-y-2",children:[t.jsxs(D,{className:"flex items-center gap-2",children:[t.jsx(ue,{className:"h-4 w-4"}),"CEP"]}),t.jsxs("div",{className:"relative",children:[t.jsx(T,{type:"text",inputMode:"numeric",placeholder:"00000-000",value:o,onChange:A,disabled:a||c,className:O("h-12 text-base pr-12",d&&"border-red-400",p&&"border-green-400")}),t.jsx("div",{className:"absolute right-3 top-1/2 -translate-y-1/2",children:t.jsxs(V,{mode:"wait",children:[c&&t.jsx(w.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.8},children:t.jsx(te,{className:"h-5 w-5 animate-spin text-primary"})},"loading"),p&&!c&&t.jsx(w.div,{initial:{opacity:0,scale:0},animate:{opacity:1,scale:1},className:"p-1 rounded-full bg-green-100 dark:bg-green-900/30",children:t.jsx(U,{className:"h-4 w-4 text-green-600 dark:text-green-400"})},"success"),d&&!c&&t.jsx(w.div,{initial:{opacity:0,scale:0},animate:{opacity:1,scale:1},className:"p-1 rounded-full bg-red-100 dark:bg-red-900/30",children:t.jsx(le,{className:"h-4 w-4 text-red-600 dark:text-red-400"})},"error")]})})]}),d&&t.jsx(w.p,{initial:{opacity:0,y:-5},animate:{opacity:1,y:0},className:"text-sm text-red-500",children:d}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("p",{className:"text-xs text-muted-foreground",children:"Digite o CEP para preencher automaticamente"}),!s.logradouro&&t.jsx("button",{type:"button",onClick:()=>{pe.getBairros().then(y),v(!0),r({...s,logradouro:" ",bairro:"",localidade:"Tijucas",uf:"SC"})},className:"text-xs text-primary hover:underline",children:"Não sei o CEP"})]})]}),t.jsx(V,{children:g&&j.length>0&&!b&&t.jsxs(w.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"space-y-2",children:[t.jsxs(D,{className:"flex items-center gap-2 text-amber-600 dark:text-amber-400",children:[t.jsx(le,{className:"h-4 w-4"}),"Selecione seu bairro"]}),t.jsx("p",{className:"text-xs text-muted-foreground",children:"Não conseguimos identificar seu bairro automaticamente. Selecione abaixo:"}),t.jsx("div",{className:"grid grid-cols-2 gap-2 max-h-48 overflow-y-auto p-1",children:j.map(x=>t.jsx(w.button,{type:"button",whileTap:{scale:.95},onClick:()=>Z(x),className:O("p-3 rounded-xl text-left text-sm font-medium transition-colors","bg-muted hover:bg-primary hover:text-primary-foreground",s.bairroId===x.id&&"bg-primary text-primary-foreground"),children:x.nome},x.id))})]})}),t.jsx(V,{children:s.logradouro&&t.jsxs(w.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"space-y-4",children:[t.jsxs("div",{className:"space-y-2",children:[t.jsxs(D,{className:"flex items-center gap-2",children:[t.jsx(at,{className:"h-4 w-4"}),"Rua"]}),t.jsx(T,{type:"text",value:s.logradouro||"",onChange:x=>L("logradouro",x.target.value),disabled:a,className:"h-12 bg-muted/30"})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[t.jsxs("div",{className:"space-y-2",children:[t.jsx(D,{children:"Número"}),t.jsx(T,{ref:E,type:"text",placeholder:"123",value:s.numero||"",onChange:x=>L("numero",x.target.value),disabled:a,className:"h-12"})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(D,{children:"Complemento"}),t.jsx(T,{type:"text",placeholder:"Apto, Bloco...",value:s.complemento||"",onChange:x=>L("complemento",x.target.value),disabled:a,className:"h-12"})]})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsxs(D,{className:"flex items-center gap-2",children:["Bairro",b&&s.bairroId&&t.jsxs("span",{className:"text-xs text-green-600 dark:text-green-400 flex items-center gap-1",children:[t.jsx(U,{className:"h-3 w-3"})," Verificado"]})]}),t.jsxs("div",{className:"relative",children:[t.jsx(T,{type:"text",value:s.bairro||"",onChange:x=>{b||L("bairro",x.target.value)},disabled:a||b,className:O("h-12 bg-muted/30",b&&"bg-green-50 dark:bg-green-900/20 border-green-200 dark:border-green-800")}),b&&t.jsx("button",{type:"button",onClick:()=>{u(!1),v(!0),pe.getBairros().then(y)},className:"absolute right-3 top-1/2 -translate-y-1/2 text-xs text-primary hover:underline",children:"Alterar"})]})]}),t.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[t.jsxs("div",{className:"col-span-2 space-y-2",children:[t.jsxs(D,{className:"flex items-center gap-2",children:[t.jsx(rt,{className:"h-4 w-4"}),"Cidade"]}),t.jsx(T,{type:"text",value:s.localidade||"Tijucas",disabled:!0,className:"h-12 bg-muted/30"})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(D,{children:"UF"}),t.jsx(T,{type:"text",value:s.uf||"SC",disabled:!0,maxLength:2,className:"h-12 bg-muted/30 text-center uppercase"})]})]})]})}),e&&t.jsxs(w.p,{initial:{opacity:0},animate:{opacity:1},className:"text-sm text-red-500 flex items-center gap-1",children:[t.jsx(le,{className:"h-4 w-4"}),e]})]})}var Me=!1,X,xe,ge,oe,ie,He,ne,ve,we,ye,Ge,be,je,Xe,Ve;function _(){if(!Me){Me=!0;var s=navigator.userAgent,r=/(?:MSIE.(\d+\.\d+))|(?:(?:Firefox|GranParadiso|Iceweasel).(\d+\.\d+))|(?:Opera(?:.+Version.|.)(\d+\.\d+))|(?:AppleWebKit.(\d+(?:\.\d+)?))|(?:Trident\/\d+\.\d+.*rv:(\d+\.\d+))/.exec(s),e=/(Mac OS X)|(Windows)|(Linux)/.exec(s);if(be=/\b(iPhone|iP[ao]d)/.exec(s),je=/\b(iP[ao]d)/.exec(s),ye=/Android/i.exec(s),Xe=/FBAN\/\w+;/i.exec(s),Ve=/Mobile/i.exec(s),Ge=!!/Win64/.exec(s),r){X=r[1]?parseFloat(r[1]):r[5]?parseFloat(r[5]):NaN,X&&document&&document.documentMode&&(X=document.documentMode);var a=/(?:Trident\/(\d+.\d+))/.exec(s);He=a?parseFloat(a[1])+4:X,xe=r[2]?parseFloat(r[2]):NaN,ge=r[3]?parseFloat(r[3]):NaN,oe=r[4]?parseFloat(r[4]):NaN,oe?(r=/(?:Chrome\/(\d+\.\d+))/.exec(s),ie=r&&r[1]?parseFloat(r[1]):NaN):ie=NaN}else X=xe=ge=ie=oe=NaN;if(e){if(e[1]){var o=/(?:Mac OS X (\d+(?:[._]\d+)?))/.exec(s);ne=o?parseFloat(o[1].replace("_",".")):!0}else ne=!1;ve=!!e[2],we=!!e[3]}else ne=ve=we=!1}}var Ne={ie:function(){return _()||X},ieCompatibilityMode:function(){return _()||He>X},ie64:function(){return Ne.ie()&&Ge},firefox:function(){return _()||xe},opera:function(){return _()||ge},webkit:function(){return _()||oe},safari:function(){return Ne.webkit()},chrome:function(){return _()||ie},windows:function(){return _()||ve},osx:function(){return _()||ne},linux:function(){return _()||we},iphone:function(){return _()||be},mobile:function(){return _()||be||je||ye||Ve},nativeApp:function(){return _()||Xe},android:function(){return _()||ye},ipad:function(){return _()||je}},Dt=Ne,kt=!!(typeof window<"u"&&window.document&&window.document.createElement),Mt={canUseDOM:kt},Tt=Mt,$e=Tt,Ye;$e.canUseDOM&&(Ye=document.implementation&&document.implementation.hasFeature&&document.implementation.hasFeature("","")!==!0);/**
 * Checks if an event is supported in the current execution environment.
 *
 * NOTE: This will not work correctly for non-generic events such as `change`,
 * `reset`, `load`, `error`, and `select`.
 *
 * Borrows from Modernizr.
 *
 * @param {string} eventNameSuffix Event name, e.g. "click".
 * @param {?boolean} capture Check if the capture phase is supported.
 * @return {boolean} True if the event is supported.
 * @internal
 * @license Modernizr 3.0.0pre (Custom Build) | MIT
 */function It(s,r){if(!$e.canUseDOM||r&&!("addEventListener"in document))return!1;var e="on"+s,a=e in document;if(!a){var o=document.createElement("div");o.setAttribute(e,"return;"),a=typeof o[e]=="function"}return!a&&Ye&&s==="wheel"&&(a=document.implementation.hasFeature("Events.wheel","3.0")),a}var Ft=It,Lt=Dt,Wt=Ft,Te=10,Ie=40,Fe=800;function qe(s){var r=0,e=0,a=0,o=0;return"detail"in s&&(e=s.detail),"wheelDelta"in s&&(e=-s.wheelDelta/120),"wheelDeltaY"in s&&(e=-s.wheelDeltaY/120),"wheelDeltaX"in s&&(r=-s.wheelDeltaX/120),"axis"in s&&s.axis===s.HORIZONTAL_AXIS&&(r=e,e=0),a=r*Te,o=e*Te,"deltaY"in s&&(o=s.deltaY),"deltaX"in s&&(a=s.deltaX),(a||o)&&s.deltaMode&&(s.deltaMode==1?(a*=Ie,o*=Ie):(a*=Fe,o*=Fe)),a&&!r&&(r=a<1?-1:1),o&&!e&&(e=o<1?-1:1),{spinX:r,spinY:e,pixelX:a,pixelY:o}}qe.getEventType=function(){return Lt.firefox()?"DOMMouseScroll":Wt("wheel")?"wheel":"mousewheel"};var Ot=qe,Ut=Ot;const Zt=st(Ut);function Bt(s,r,e,a,o,i){i===void 0&&(i=0);var c=J(s,r,i),n=c.width,d=c.height,h=Math.min(n,e),p=Math.min(d,a);return h>p*o?{width:p*o,height:p}:{width:h,height:h/o}}function Ht(s){return s.width>s.height?s.width/s.naturalWidth:s.height/s.naturalHeight}function ee(s,r,e,a,o){o===void 0&&(o=0);var i=J(r.width,r.height,o),c=i.width,n=i.height;return{x:Le(s.x,c,e.width,a),y:Le(s.y,n,e.height,a)}}function Le(s,r,e,a){var o=r*a/2-e/2;return ce(s,-o,o)}function We(s,r){return Math.sqrt(Math.pow(s.y-r.y,2)+Math.pow(s.x-r.x,2))}function Oe(s,r){return Math.atan2(r.y-s.y,r.x-s.x)*180/Math.PI}function Gt(s,r,e,a,o,i,c){i===void 0&&(i=0),c===void 0&&(c=!0);var n=c?Xt:Vt,d=J(r.width,r.height,i),h=J(r.naturalWidth,r.naturalHeight,i),p={x:n(100,((d.width-e.width/o)/2-s.x/o)/d.width*100),y:n(100,((d.height-e.height/o)/2-s.y/o)/d.height*100),width:n(100,e.width/d.width*100/o),height:n(100,e.height/d.height*100/o)},f=Math.round(n(h.width,p.width*h.width/100)),g=Math.round(n(h.height,p.height*h.height/100)),v=h.width>=h.height*a,j=v?{width:Math.round(g*a),height:g}:{width:f,height:Math.round(f/a)},y=P(P({},j),{x:Math.round(n(h.width-j.width,p.x*h.width/100)),y:Math.round(n(h.height-j.height,p.y*h.height/100))});return{croppedAreaPercentages:p,croppedAreaPixels:y}}function Xt(s,r){return Math.min(s,Math.max(0,r))}function Vt(s,r){return r}function $t(s,r,e,a,o,i){var c=J(r.width,r.height,e),n=ce(a.width/c.width*(100/s.width),o,i),d={x:n*c.width/2-a.width/2-c.width*n*(s.x/100),y:n*c.height/2-a.height/2-c.height*n*(s.y/100)};return{crop:d,zoom:n}}function Yt(s,r,e){var a=Ht(r);return e.height>e.width?e.height/(s.height*a):e.width/(s.width*a)}function qt(s,r,e,a,o,i){e===void 0&&(e=0);var c=J(r.naturalWidth,r.naturalHeight,e),n=ce(Yt(s,r,a),o,i),d=a.height>a.width?a.height/s.height:a.width/s.width,h={x:((c.width-s.width)/2-s.x)*d,y:((c.height-s.height)/2-s.y)*d};return{crop:h,zoom:n}}function Ue(s,r){return{x:(r.x+s.x)/2,y:(r.y+s.y)/2}}function Kt(s){return s*Math.PI/180}function J(s,r,e){var a=Kt(e);return{width:Math.abs(Math.cos(a)*s)+Math.abs(Math.sin(a)*r),height:Math.abs(Math.sin(a)*s)+Math.abs(Math.cos(a)*r)}}function ce(s,r,e){return Math.min(Math.max(s,r),e)}function se(){for(var s=[],r=0;r<arguments.length;r++)s[r]=arguments[r];return s.filter(function(e){return typeof e=="string"&&e.length>0}).join(" ").trim()}var Jt=`.reactEasyCrop_Container {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  overflow: hidden;
  user-select: none;
  touch-action: none;
  cursor: move;
  display: flex;
  justify-content: center;
  align-items: center;
}

.reactEasyCrop_Image,
.reactEasyCrop_Video {
  will-change: transform; /* this improves performances and prevent painting issues on iOS Chrome */
}

.reactEasyCrop_Contain {
  max-width: 100%;
  max-height: 100%;
  margin: auto;
  position: absolute;
  top: 0;
  bottom: 0;
  left: 0;
  right: 0;
}
.reactEasyCrop_Cover_Horizontal {
  width: 100%;
  height: auto;
}
.reactEasyCrop_Cover_Vertical {
  width: auto;
  height: 100%;
}

.reactEasyCrop_CropArea {
  position: absolute;
  left: 50%;
  top: 50%;
  transform: translate(-50%, -50%);
  border: 1px solid rgba(255, 255, 255, 0.5);
  box-sizing: border-box;
  box-shadow: 0 0 0 9999em;
  color: rgba(0, 0, 0, 0.5);
  overflow: hidden;
}

.reactEasyCrop_CropAreaRound {
  border-radius: 50%;
}

.reactEasyCrop_CropAreaGrid::before {
  content: ' ';
  box-sizing: border-box;
  position: absolute;
  border: 1px solid rgba(255, 255, 255, 0.5);
  top: 0;
  bottom: 0;
  left: 33.33%;
  right: 33.33%;
  border-top: 0;
  border-bottom: 0;
}

.reactEasyCrop_CropAreaGrid::after {
  content: ' ';
  box-sizing: border-box;
  position: absolute;
  border: 1px solid rgba(255, 255, 255, 0.5);
  top: 33.33%;
  bottom: 33.33%;
  left: 0;
  right: 0;
  border-left: 0;
  border-right: 0;
}
`,Qt=1,ea=3,ta=1,aa=function(s){ot(r,s);function r(){var e=s!==null&&s.apply(this,arguments)||this;return e.cropperRef=l.createRef(),e.imageRef=l.createRef(),e.videoRef=l.createRef(),e.containerPosition={x:0,y:0},e.containerRef=null,e.styleRef=null,e.containerRect=null,e.mediaSize={width:0,height:0,naturalWidth:0,naturalHeight:0},e.dragStartPosition={x:0,y:0},e.dragStartCrop={x:0,y:0},e.gestureZoomStart=0,e.gestureRotationStart=0,e.isTouching=!1,e.lastPinchDistance=0,e.lastPinchRotation=0,e.rafDragTimeout=null,e.rafPinchTimeout=null,e.wheelTimer=null,e.currentDoc=typeof document<"u"?document:null,e.currentWindow=typeof window<"u"?window:null,e.resizeObserver=null,e.previousCropSize=null,e.isInitialized=!1,e.state={cropSize:null,hasWheelJustStarted:!1,mediaObjectFit:void 0},e.initResizeObserver=function(){if(!(typeof window.ResizeObserver>"u"||!e.containerRef)){var a=!0;e.resizeObserver=new window.ResizeObserver(function(o){if(a){a=!1;return}e.computeSizes()}),e.resizeObserver.observe(e.containerRef)}},e.preventZoomSafari=function(a){return a.preventDefault()},e.cleanEvents=function(){e.currentDoc&&(e.currentDoc.removeEventListener("mousemove",e.onMouseMove),e.currentDoc.removeEventListener("mouseup",e.onDragStopped),e.currentDoc.removeEventListener("touchmove",e.onTouchMove),e.currentDoc.removeEventListener("touchend",e.onDragStopped),e.currentDoc.removeEventListener("gesturechange",e.onGestureChange),e.currentDoc.removeEventListener("gestureend",e.onGestureEnd),e.currentDoc.removeEventListener("scroll",e.onScroll))},e.clearScrollEvent=function(){e.containerRef&&e.containerRef.removeEventListener("wheel",e.onWheel),e.wheelTimer&&clearTimeout(e.wheelTimer)},e.onMediaLoad=function(){var a=e.computeSizes();a&&(e.previousCropSize=a,e.emitCropData(),e.setInitialCrop(a),e.isInitialized=!0),e.props.onMediaLoaded&&e.props.onMediaLoaded(e.mediaSize)},e.setInitialCrop=function(a){if(e.props.initialCroppedAreaPercentages){var o=$t(e.props.initialCroppedAreaPercentages,e.mediaSize,e.props.rotation,a,e.props.minZoom,e.props.maxZoom),i=o.crop,c=o.zoom;e.props.onCropChange(i),e.props.onZoomChange&&e.props.onZoomChange(c)}else if(e.props.initialCroppedAreaPixels){var n=qt(e.props.initialCroppedAreaPixels,e.mediaSize,e.props.rotation,a,e.props.minZoom,e.props.maxZoom),i=n.crop,c=n.zoom;e.props.onCropChange(i),e.props.onZoomChange&&e.props.onZoomChange(c)}},e.computeSizes=function(){var a,o,i,c,n,d,h=e.imageRef.current||e.videoRef.current;if(h&&e.containerRef){e.containerRect=e.containerRef.getBoundingClientRect(),e.saveContainerPosition();var p=e.containerRect.width/e.containerRect.height,f=((a=e.imageRef.current)===null||a===void 0?void 0:a.naturalWidth)||((o=e.videoRef.current)===null||o===void 0?void 0:o.videoWidth)||0,g=((i=e.imageRef.current)===null||i===void 0?void 0:i.naturalHeight)||((c=e.videoRef.current)===null||c===void 0?void 0:c.videoHeight)||0,v=h.offsetWidth<f||h.offsetHeight<g,j=f/g,y=void 0;if(v)switch(e.state.mediaObjectFit){default:case"contain":y=p>j?{width:e.containerRect.height*j,height:e.containerRect.height}:{width:e.containerRect.width,height:e.containerRect.width/j};break;case"horizontal-cover":y={width:e.containerRect.width,height:e.containerRect.width/j};break;case"vertical-cover":y={width:e.containerRect.height*j,height:e.containerRect.height};break}else y={width:h.offsetWidth,height:h.offsetHeight};e.mediaSize=P(P({},y),{naturalWidth:f,naturalHeight:g}),e.props.setMediaSize&&e.props.setMediaSize(e.mediaSize);var b=e.props.cropSize?e.props.cropSize:Bt(e.mediaSize.width,e.mediaSize.height,e.containerRect.width,e.containerRect.height,e.props.aspect,e.props.rotation);return(((n=e.state.cropSize)===null||n===void 0?void 0:n.height)!==b.height||((d=e.state.cropSize)===null||d===void 0?void 0:d.width)!==b.width)&&e.props.onCropSizeChange&&e.props.onCropSizeChange(b),e.setState({cropSize:b},e.recomputeCropPosition),e.props.setCropSize&&e.props.setCropSize(b),b}},e.saveContainerPosition=function(){if(e.containerRef){var a=e.containerRef.getBoundingClientRect();e.containerPosition={x:a.left,y:a.top}}},e.onMouseDown=function(a){e.currentDoc&&(a.preventDefault(),e.currentDoc.addEventListener("mousemove",e.onMouseMove),e.currentDoc.addEventListener("mouseup",e.onDragStopped),e.saveContainerPosition(),e.onDragStart(r.getMousePoint(a)))},e.onMouseMove=function(a){return e.onDrag(r.getMousePoint(a))},e.onScroll=function(a){e.currentDoc&&(a.preventDefault(),e.saveContainerPosition())},e.onTouchStart=function(a){e.currentDoc&&(e.isTouching=!0,!(e.props.onTouchRequest&&!e.props.onTouchRequest(a))&&(e.currentDoc.addEventListener("touchmove",e.onTouchMove,{passive:!1}),e.currentDoc.addEventListener("touchend",e.onDragStopped),e.saveContainerPosition(),a.touches.length===2?e.onPinchStart(a):a.touches.length===1&&e.onDragStart(r.getTouchPoint(a.touches[0]))))},e.onTouchMove=function(a){a.preventDefault(),a.touches.length===2?e.onPinchMove(a):a.touches.length===1&&e.onDrag(r.getTouchPoint(a.touches[0]))},e.onGestureStart=function(a){e.currentDoc&&(a.preventDefault(),e.currentDoc.addEventListener("gesturechange",e.onGestureChange),e.currentDoc.addEventListener("gestureend",e.onGestureEnd),e.gestureZoomStart=e.props.zoom,e.gestureRotationStart=e.props.rotation)},e.onGestureChange=function(a){if(a.preventDefault(),!e.isTouching){var o=r.getMousePoint(a),i=e.gestureZoomStart-1+a.scale;if(e.setNewZoom(i,o,{shouldUpdatePosition:!0}),e.props.onRotationChange){var c=e.gestureRotationStart+a.rotation;e.props.onRotationChange(c)}}},e.onGestureEnd=function(a){e.cleanEvents()},e.onDragStart=function(a){var o,i,c=a.x,n=a.y;e.dragStartPosition={x:c,y:n},e.dragStartCrop=P({},e.props.crop),(i=(o=e.props).onInteractionStart)===null||i===void 0||i.call(o)},e.onDrag=function(a){var o=a.x,i=a.y;e.currentWindow&&(e.rafDragTimeout&&e.currentWindow.cancelAnimationFrame(e.rafDragTimeout),e.rafDragTimeout=e.currentWindow.requestAnimationFrame(function(){if(e.state.cropSize&&!(o===void 0||i===void 0)){var c=o-e.dragStartPosition.x,n=i-e.dragStartPosition.y,d={x:e.dragStartCrop.x+c,y:e.dragStartCrop.y+n},h=e.props.restrictPosition?ee(d,e.mediaSize,e.state.cropSize,e.props.zoom,e.props.rotation):d;e.props.onCropChange(h)}}))},e.onDragStopped=function(){var a,o;e.isTouching=!1,e.cleanEvents(),e.emitCropData(),(o=(a=e.props).onInteractionEnd)===null||o===void 0||o.call(a)},e.onWheel=function(a){if(e.currentWindow&&!(e.props.onWheelRequest&&!e.props.onWheelRequest(a))){a.preventDefault();var o=r.getMousePoint(a),i=Zt(a).pixelY,c=e.props.zoom-i*e.props.zoomSpeed/200;e.setNewZoom(c,o,{shouldUpdatePosition:!0}),e.state.hasWheelJustStarted||e.setState({hasWheelJustStarted:!0},function(){var n,d;return(d=(n=e.props).onInteractionStart)===null||d===void 0?void 0:d.call(n)}),e.wheelTimer&&clearTimeout(e.wheelTimer),e.wheelTimer=e.currentWindow.setTimeout(function(){return e.setState({hasWheelJustStarted:!1},function(){var n,d;return(d=(n=e.props).onInteractionEnd)===null||d===void 0?void 0:d.call(n)})},250)}},e.getPointOnContainer=function(a,o){var i=a.x,c=a.y;if(!e.containerRect)throw new Error("The Cropper is not mounted");return{x:e.containerRect.width/2-(i-o.x),y:e.containerRect.height/2-(c-o.y)}},e.getPointOnMedia=function(a){var o=a.x,i=a.y,c=e.props,n=c.crop,d=c.zoom;return{x:(o+n.x)/d,y:(i+n.y)/d}},e.setNewZoom=function(a,o,i){var c=i===void 0?{}:i,n=c.shouldUpdatePosition,d=n===void 0?!0:n;if(!(!e.state.cropSize||!e.props.onZoomChange)){var h=ce(a,e.props.minZoom,e.props.maxZoom);if(d){var p=e.getPointOnContainer(o,e.containerPosition),f=e.getPointOnMedia(p),g={x:f.x*h-p.x,y:f.y*h-p.y},v=e.props.restrictPosition?ee(g,e.mediaSize,e.state.cropSize,h,e.props.rotation):g;e.props.onCropChange(v)}e.props.onZoomChange(h)}},e.getCropData=function(){if(!e.state.cropSize)return null;var a=e.props.restrictPosition?ee(e.props.crop,e.mediaSize,e.state.cropSize,e.props.zoom,e.props.rotation):e.props.crop;return Gt(a,e.mediaSize,e.state.cropSize,e.getAspect(),e.props.zoom,e.props.rotation,e.props.restrictPosition)},e.emitCropData=function(){var a=e.getCropData();if(a){var o=a.croppedAreaPercentages,i=a.croppedAreaPixels;e.props.onCropComplete&&e.props.onCropComplete(o,i),e.props.onCropAreaChange&&e.props.onCropAreaChange(o,i)}},e.emitCropAreaChange=function(){var a=e.getCropData();if(a){var o=a.croppedAreaPercentages,i=a.croppedAreaPixels;e.props.onCropAreaChange&&e.props.onCropAreaChange(o,i)}},e.recomputeCropPosition=function(){var a,o;if(e.state.cropSize){var i=e.props.crop;if(e.isInitialized&&(!((a=e.previousCropSize)===null||a===void 0)&&a.width)&&(!((o=e.previousCropSize)===null||o===void 0)&&o.height)){var c=Math.abs(e.previousCropSize.width-e.state.cropSize.width)>1e-6||Math.abs(e.previousCropSize.height-e.state.cropSize.height)>1e-6;if(c){var n=e.state.cropSize.width/e.previousCropSize.width,d=e.state.cropSize.height/e.previousCropSize.height;i={x:e.props.crop.x*n,y:e.props.crop.y*d}}}var h=e.props.restrictPosition?ee(i,e.mediaSize,e.state.cropSize,e.props.zoom,e.props.rotation):i;e.previousCropSize=e.state.cropSize,e.props.onCropChange(h),e.emitCropData()}},e.onKeyDown=function(a){var o,i,c=e.props,n=c.crop,d=c.onCropChange,h=c.keyboardStep,p=c.zoom,f=c.rotation,g=h;if(e.state.cropSize){a.shiftKey&&(g*=.2);var v=P({},n);switch(a.key){case"ArrowUp":v.y-=g,a.preventDefault();break;case"ArrowDown":v.y+=g,a.preventDefault();break;case"ArrowLeft":v.x-=g,a.preventDefault();break;case"ArrowRight":v.x+=g,a.preventDefault();break;default:return}e.props.restrictPosition&&(v=ee(v,e.mediaSize,e.state.cropSize,p,f)),a.repeat||(i=(o=e.props).onInteractionStart)===null||i===void 0||i.call(o),d(v)}},e.onKeyUp=function(a){var o,i;switch(a.key){case"ArrowUp":case"ArrowDown":case"ArrowLeft":case"ArrowRight":a.preventDefault();break;default:return}e.emitCropData(),(i=(o=e.props).onInteractionEnd)===null||i===void 0||i.call(o)},e}return r.prototype.componentDidMount=function(){!this.currentDoc||!this.currentWindow||(this.containerRef&&(this.containerRef.ownerDocument&&(this.currentDoc=this.containerRef.ownerDocument),this.currentDoc.defaultView&&(this.currentWindow=this.currentDoc.defaultView),this.initResizeObserver(),typeof window.ResizeObserver>"u"&&this.currentWindow.addEventListener("resize",this.computeSizes),this.props.zoomWithScroll&&this.containerRef.addEventListener("wheel",this.onWheel,{passive:!1}),this.containerRef.addEventListener("gesturestart",this.onGestureStart)),this.currentDoc.addEventListener("scroll",this.onScroll),this.props.disableAutomaticStylesInjection||(this.styleRef=this.currentDoc.createElement("style"),this.styleRef.setAttribute("type","text/css"),this.props.nonce&&this.styleRef.setAttribute("nonce",this.props.nonce),this.styleRef.innerHTML=Jt,this.currentDoc.head.appendChild(this.styleRef)),this.imageRef.current&&this.imageRef.current.complete&&this.onMediaLoad(),this.props.setImageRef&&this.props.setImageRef(this.imageRef),this.props.setVideoRef&&this.props.setVideoRef(this.videoRef),this.props.setCropperRef&&this.props.setCropperRef(this.cropperRef))},r.prototype.componentWillUnmount=function(){var e,a;!this.currentDoc||!this.currentWindow||(typeof window.ResizeObserver>"u"&&this.currentWindow.removeEventListener("resize",this.computeSizes),(e=this.resizeObserver)===null||e===void 0||e.disconnect(),this.containerRef&&this.containerRef.removeEventListener("gesturestart",this.preventZoomSafari),this.styleRef&&((a=this.styleRef.parentNode)===null||a===void 0||a.removeChild(this.styleRef)),this.cleanEvents(),this.props.zoomWithScroll&&this.clearScrollEvent())},r.prototype.componentDidUpdate=function(e){var a,o,i,c,n,d,h,p,f;e.rotation!==this.props.rotation?(this.computeSizes(),this.recomputeCropPosition()):e.aspect!==this.props.aspect?this.computeSizes():e.objectFit!==this.props.objectFit?this.computeSizes():e.zoom!==this.props.zoom?this.recomputeCropPosition():((a=e.cropSize)===null||a===void 0?void 0:a.height)!==((o=this.props.cropSize)===null||o===void 0?void 0:o.height)||((i=e.cropSize)===null||i===void 0?void 0:i.width)!==((c=this.props.cropSize)===null||c===void 0?void 0:c.width)?this.computeSizes():(((n=e.crop)===null||n===void 0?void 0:n.x)!==((d=this.props.crop)===null||d===void 0?void 0:d.x)||((h=e.crop)===null||h===void 0?void 0:h.y)!==((p=this.props.crop)===null||p===void 0?void 0:p.y))&&this.emitCropAreaChange(),e.zoomWithScroll!==this.props.zoomWithScroll&&this.containerRef&&(this.props.zoomWithScroll?this.containerRef.addEventListener("wheel",this.onWheel,{passive:!1}):this.clearScrollEvent()),e.video!==this.props.video&&((f=this.videoRef.current)===null||f===void 0||f.load());var g=this.getObjectFit();g!==this.state.mediaObjectFit&&this.setState({mediaObjectFit:g},this.computeSizes)},r.prototype.getAspect=function(){var e=this.props,a=e.cropSize,o=e.aspect;return a?a.width/a.height:o},r.prototype.getObjectFit=function(){var e,a,o,i;if(this.props.objectFit==="cover"){var c=this.imageRef.current||this.videoRef.current;if(c&&this.containerRef){this.containerRect=this.containerRef.getBoundingClientRect();var n=this.containerRect.width/this.containerRect.height,d=((e=this.imageRef.current)===null||e===void 0?void 0:e.naturalWidth)||((a=this.videoRef.current)===null||a===void 0?void 0:a.videoWidth)||0,h=((o=this.imageRef.current)===null||o===void 0?void 0:o.naturalHeight)||((i=this.videoRef.current)===null||i===void 0?void 0:i.videoHeight)||0,p=d/h;return p<n?"horizontal-cover":"vertical-cover"}return"horizontal-cover"}return this.props.objectFit},r.prototype.onPinchStart=function(e){var a=r.getTouchPoint(e.touches[0]),o=r.getTouchPoint(e.touches[1]);this.lastPinchDistance=We(a,o),this.lastPinchRotation=Oe(a,o),this.onDragStart(Ue(a,o))},r.prototype.onPinchMove=function(e){var a=this;if(!(!this.currentDoc||!this.currentWindow)){var o=r.getTouchPoint(e.touches[0]),i=r.getTouchPoint(e.touches[1]),c=Ue(o,i);this.onDrag(c),this.rafPinchTimeout&&this.currentWindow.cancelAnimationFrame(this.rafPinchTimeout),this.rafPinchTimeout=this.currentWindow.requestAnimationFrame(function(){var n=We(o,i),d=a.props.zoom*(n/a.lastPinchDistance);a.setNewZoom(d,c,{shouldUpdatePosition:!1}),a.lastPinchDistance=n;var h=Oe(o,i),p=a.props.rotation+(h-a.lastPinchRotation);a.props.onRotationChange&&a.props.onRotationChange(p),a.lastPinchRotation=h})}},r.prototype.render=function(){var e=this,a,o=this.props,i=o.image,c=o.video,n=o.mediaProps,d=o.cropperProps,h=o.transform,p=o.crop,f=p.x,g=p.y,v=o.rotation,j=o.zoom,y=o.cropShape,b=o.showGrid,u=o.roundCropAreaPixels,E=o.style,A=E.containerStyle,L=E.cropAreaStyle,Z=E.mediaStyle,x=o.classes,W=x.containerClassName,z=x.cropAreaClassName,I=x.mediaClassName,R=(a=this.state.mediaObjectFit)!==null&&a!==void 0?a:this.getObjectFit();return l.createElement("div",{onMouseDown:this.onMouseDown,onTouchStart:this.onTouchStart,ref:function(C){return e.containerRef=C},"data-testid":"container",style:A,className:se("reactEasyCrop_Container",W)},i?l.createElement("img",P({alt:"",className:se("reactEasyCrop_Image",R==="contain"&&"reactEasyCrop_Contain",R==="horizontal-cover"&&"reactEasyCrop_Cover_Horizontal",R==="vertical-cover"&&"reactEasyCrop_Cover_Vertical",I)},n,{src:i,ref:this.imageRef,style:P(P({},Z),{transform:h||"translate(".concat(f,"px, ").concat(g,"px) rotate(").concat(v,"deg) scale(").concat(j,")")}),onLoad:this.onMediaLoad})):c&&l.createElement("video",P({autoPlay:!0,playsInline:!0,loop:!0,muted:!0,className:se("reactEasyCrop_Video",R==="contain"&&"reactEasyCrop_Contain",R==="horizontal-cover"&&"reactEasyCrop_Cover_Horizontal",R==="vertical-cover"&&"reactEasyCrop_Cover_Vertical",I)},n,{ref:this.videoRef,onLoadedMetadata:this.onMediaLoad,style:P(P({},Z),{transform:h||"translate(".concat(f,"px, ").concat(g,"px) rotate(").concat(v,"deg) scale(").concat(j,")")}),controls:!1}),(Array.isArray(c)?c:[{src:c}]).map(function(N){return l.createElement("source",P({key:N.src},N))})),this.state.cropSize&&l.createElement("div",P({ref:this.cropperRef,style:P(P({},L),{width:u?Math.round(this.state.cropSize.width):this.state.cropSize.width,height:u?Math.round(this.state.cropSize.height):this.state.cropSize.height}),tabIndex:0,onKeyDown:this.onKeyDown,onKeyUp:this.onKeyUp,"data-testid":"cropper",className:se("reactEasyCrop_CropArea",y==="round"&&"reactEasyCrop_CropAreaRound",b&&"reactEasyCrop_CropAreaGrid",z)},d)))},r.defaultProps={zoom:1,rotation:0,aspect:4/3,maxZoom:ea,minZoom:Qt,cropShape:"rect",objectFit:"contain",showGrid:!0,style:{},classes:{},mediaProps:{},cropperProps:{},zoomSpeed:1,restrictPosition:!0,zoomWithScroll:!0,keyboardStep:ta},r.getMousePoint=function(e){return{x:Number(e.clientX),y:Number(e.clientY)}},r.getTouchPoint=function(e){return{x:Number(e.clientX),y:Number(e.clientY)}},r}(l.Component);async function ra(s,r,e=0){const a=await sa(s),o=document.createElement("canvas"),i=o.getContext("2d");if(!i)throw new Error("No 2d context");const n=2*(Math.max(a.width,a.height)/2*Math.sqrt(2));o.width=n,o.height=n,i.translate(n/2,n/2),i.rotate(e*Math.PI/180),i.translate(-n/2,-n/2),i.drawImage(a,n/2-a.width/2,n/2-a.height/2);const d=i.getImageData(0,0,n,n);return o.width=r.width,o.height=r.height,i.putImageData(d,Math.round(0-n/2+a.width/2-r.x),Math.round(0-n/2+a.height/2-r.y)),o.toDataURL("image/jpeg",.9)}function sa(s){return new Promise((r,e)=>{const a=new Image;a.addEventListener("load",()=>r(a)),a.addEventListener("error",o=>e(o)),a.crossOrigin="anonymous",a.src=s})}function oa({image:s,onCrop:r,onCancel:e,aspectRatio:a=1}){const[o,i]=l.useState({x:0,y:0}),[c,n]=l.useState(1),[d,h]=l.useState(0),[p,f]=l.useState(null),[g,v]=l.useState(!1),j=l.useCallback((u,E)=>{f(E)},[]),y=l.useCallback(async()=>{if(p){v(!0);try{const u=await ra(s,p,d);r(u)}catch(u){console.error("Error cropping image:",u)}finally{v(!1)}}},[p,s,d,r]),b=l.useCallback(()=>{h(u=>(u+90)%360)},[]);return t.jsx(V,{children:t.jsxs(w.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-[60] bg-black flex flex-col",children:[t.jsxs(w.div,{initial:{y:-20,opacity:0},animate:{y:0,opacity:1},className:"flex items-center justify-between p-4 text-white safe-top",children:[t.jsx(k,{variant:"ghost",size:"icon",onClick:e,className:"text-white hover:bg-white/10 rounded-full",children:t.jsx(it,{className:"h-6 w-6"})}),t.jsxs("h2",{className:"font-semibold text-lg flex items-center gap-2",children:[t.jsx(nt,{className:"h-5 w-5"}),"Ajustar foto"]}),t.jsx(k,{variant:"ghost",size:"icon",onClick:y,disabled:g,className:"text-green-400 hover:bg-green-500/20 rounded-full",children:t.jsx(U,{className:"h-6 w-6"})})]}),t.jsx("div",{className:"relative flex-1 bg-black",children:t.jsx(aa,{image:s,crop:o,zoom:c,rotation:d,aspect:a,cropShape:"round",showGrid:!1,onCropChange:i,onZoomChange:n,onCropComplete:j,classes:{containerClassName:"bg-black",cropAreaClassName:"rounded-full"},style:{containerStyle:{background:"#000"},cropAreaStyle:{border:"3px solid rgba(255, 255, 255, 0.8)",boxShadow:"0 0 0 9999px rgba(0, 0, 0, 0.7)"}}})}),t.jsxs(w.div,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},className:"p-6 space-y-5 bg-gradient-to-t from-black via-black/95 to-transparent safe-bottom",children:[t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"flex items-center justify-between text-white/70 text-sm",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(Re,{className:"h-4 w-4"}),t.jsx("span",{children:"Zoom"})]}),t.jsxs("span",{className:"font-mono",children:[Math.round(c*100),"%"]})]}),t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsx(k,{variant:"ghost",size:"icon",onClick:()=>n(u=>Math.max(1,u-.2)),className:"text-white hover:bg-white/10 rounded-full h-10 w-10",children:t.jsx(ct,{className:"h-5 w-5"})}),t.jsx(Et,{value:[c],min:1,max:3,step:.05,onValueChange:([u])=>n(u),className:"flex-1"}),t.jsx(k,{variant:"ghost",size:"icon",onClick:()=>n(u=>Math.min(3,u+.2)),className:"text-white hover:bg-white/10 rounded-full h-10 w-10",children:t.jsx(lt,{className:"h-5 w-5"})})]})]}),t.jsxs("div",{className:"flex gap-3",children:[t.jsxs(k,{variant:"outline",onClick:b,className:"flex-1 h-12 border-white/20 bg-white/5 text-white hover:bg-white/10 rounded-xl",children:[t.jsx(dt,{className:"h-5 w-5 mr-2"}),"Girar 90°"]}),t.jsx(k,{onClick:y,disabled:g,className:"flex-1 h-12 bg-primary hover:bg-primary/90 rounded-xl font-semibold",children:g?t.jsx(w.div,{animate:{rotate:360},transition:{repeat:1/0,duration:1,ease:"linear"},children:t.jsx(Re,{className:"h-5 w-5"})}):t.jsxs(t.Fragment,{children:[t.jsx(U,{className:"h-5 w-5 mr-2"}),"Aplicar"]})})]})]})]})})}function Ze({currentUrl:s,name:r="U",onUpload:e,onRemove:a,disabled:o=!1,size:i="lg"}){const c=l.useRef(null),[n,d]=l.useState(!1),[h,p]=l.useState(null),[f,g]=l.useState(!1),[v,j]=l.useState(!1),[y,b]=l.useState(!1),[u,E]=l.useState(null),A=h||s,L=r.split(" ").map(C=>C[0]).join("").slice(0,2).toUpperCase(),Z={sm:"w-16 h-16",md:"w-24 h-24",lg:"w-32 h-32"},x={sm:"h-6 w-6",md:"h-8 w-8",lg:"h-10 w-10"},W=l.useCallback(async C=>{const S=C.target.files?.[0];if(!S)return;if(!S.type.startsWith("image/")){alert("Por favor, selecione uma imagem.");return}if(S.size>5*1024*1024){alert("A imagem deve ter no máximo 5MB.");return}g(!1);const F=new FileReader;F.onload=B=>{const H=B.target?.result;E(H),b(!0)},F.readAsDataURL(S),c.current&&(c.current.value="")},[]),z=l.useCallback(C=>{b(!1),E(null),d(!0),p(C),fetch(C).then(S=>S.blob()).then(async S=>{const F=new File([S],"avatar.jpg",{type:"image/jpeg"});await e(F,C),j(!0),setTimeout(()=>j(!1),2e3)}).catch(S=>{console.error("Upload failed",S)}).finally(()=>{d(!1)})},[e]),I=l.useCallback(()=>{b(!1),E(null)},[]),R=l.useCallback(()=>{p(null),g(!1),a?.()},[a]),N=l.useCallback(()=>{c.current?.click()},[]);return t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"flex flex-col items-center gap-4",children:[t.jsxs("div",{className:"relative",children:[t.jsxs(w.div,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>!o&&g(!f),className:O(Z[i],"rounded-full overflow-hidden cursor-pointer","ring-4 ring-background shadow-xl","relative group"),children:[A?t.jsx(w.img,{initial:{opacity:0,scale:1.1},animate:{opacity:1,scale:1},src:A,alt:r,className:"w-full h-full object-cover"},A):t.jsx("div",{className:O("w-full h-full flex items-center justify-center","bg-gradient-to-br from-primary to-primary/70","text-white font-bold",i==="lg"?"text-4xl":i==="md"?"text-2xl":"text-lg"),children:L||t.jsx(me,{className:x[i]})}),t.jsx(w.div,{initial:{opacity:0},whileHover:{opacity:1},className:"absolute inset-0 bg-black/50 flex items-center justify-center",children:n?t.jsx(te,{className:"h-8 w-8 text-white animate-spin"}):t.jsx(ht,{className:"h-8 w-8 text-white"})}),t.jsx(V,{children:v&&t.jsx(w.div,{initial:{opacity:0,scale:0},animate:{opacity:1,scale:1},exit:{opacity:0,scale:0},className:"absolute inset-0 bg-green-500/80 flex items-center justify-center",children:t.jsx(U,{className:"h-12 w-12 text-white"})})})]}),t.jsx(w.div,{whileHover:{scale:1.1},className:O("absolute -bottom-1 -right-1 p-2 rounded-full","bg-primary text-white shadow-lg cursor-pointer",o&&"opacity-50 cursor-not-allowed"),onClick:()=>!o&&N(),children:t.jsx(pt,{className:"h-4 w-4"})})]}),t.jsx(V,{children:f&&!o&&t.jsxs(w.div,{initial:{opacity:0,y:-10,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:-10,scale:.95},className:"flex gap-2",children:[t.jsxs(k,{size:"sm",variant:"outline",onClick:N,className:"rounded-full",children:[t.jsx(ut,{className:"h-4 w-4 mr-1"}),A?"Trocar":"Adicionar"]}),A&&a&&t.jsxs(k,{size:"sm",variant:"outline",onClick:R,className:"rounded-full text-red-500 hover:text-red-600 hover:bg-red-50",children:[t.jsx(mt,{className:"h-4 w-4 mr-1"}),"Remover"]})]})}),t.jsx("input",{ref:c,type:"file",accept:"image/*",capture:"user",onChange:W,className:"hidden"}),t.jsx("p",{className:"text-xs text-muted-foreground text-center",children:"Toque para alterar sua foto"})]}),y&&u&&t.jsx(oa,{image:u,onCrop:z,onCancel:I})]})}function ya(){const s=Ct(),{user:r,updateUser:e,logout:a,isAuthenticated:o}=St(),[i,c]=l.useState(r?.nome||""),[n,d]=l.useState(r?.email||""),[h,p]=l.useState(r?.avatarUrl||""),[f,g]=l.useState(r?.address||{}),[v,j]=l.useState(""),[y,b]=l.useState(""),[u,E]=l.useState(""),[A,L]=l.useState(!1),[Z,x]=l.useState(r?.notificationSettings?.reportsEnabled??!0),[W,z]=l.useState(r?.notificationSettings?.eventsEnabled??!0),[I,R]=l.useState(r?.notificationSettings?.alertsEnabled??!0),[N,C]=l.useState(null),[S,F]=l.useState(!1),[B,H]=l.useState(!1),[$,M]=l.useState(null);l.useEffect(()=>{o||s("/login")},[o,s]);const Ce=l.useCallback(async m=>{if(m)try{const Y=await Q.uploadAvatar(m);p(Y.url),r&&e({...r,avatarUrl:Y.url})}catch(Y){console.error("Avatar upload failed:",Y),M(ke(Y))}},[r,e]),Se=l.useCallback(async()=>{try{await Q.removeAvatar(),p(""),r&&e({...r,avatarUrl:void 0})}catch(m){console.error("Avatar remove failed:",m),M("Falha ao remover avatar")}},[r,e]),Ke=l.useCallback(async()=>{if(!i.trim()){M("Nome é obrigatório");return}F(!0),M(null);try{const m=await Q.updateProfile({nome:i.trim(),email:n.trim()||void 0});e(m),H(!0),setTimeout(()=>{H(!1),C(null)},1500)}catch(m){M(m instanceof Error?m.message:"Erro ao salvar")}finally{F(!1)}},[i,n,e]),Je=l.useCallback(async()=>{if(!f.cep||!f.logradouro){M("Preencha o endereço completo");return}F(!0),M(null);try{const m=await Q.updateProfile({address:f});e(m),H(!0),setTimeout(()=>{H(!1),C(null)},1500)}catch(m){M(m instanceof Error?m.message:"Erro ao salvar")}finally{F(!1)}},[f,e]),Qe=l.useCallback(async()=>{if(!v||!y||!u){M("Preencha todos os campos de senha");return}if(y!==u){M("As senhas não conferem");return}if(!At.test(y)){M("A nova senha deve ter min. 8 chars, maiúscula, minúscula e número.");return}F(!0),M(null);try{await Q.changePassword({currentPassword:v,newPassword:y,confirmPassword:u}),H(!0),j(""),b(""),E(""),setTimeout(()=>{H(!1),C(null)},1500)}catch(m){M(ke(m))}finally{F(!1)}},[v,y,u]),et=l.useCallback(()=>{a(),s("/login")},[a,s]),{setActiveTab:Ee}=Pt(),tt=l.useCallback(m=>{Ee(m),s("/")},[Ee,s]);return r?t.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-primary/5 via-background to-primary/10",children:[t.jsx(w.header,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"sticky top-0 z-50 bg-background/80 backdrop-blur-lg border-b",children:t.jsxs("div",{className:"flex items-center justify-between p-4",children:[t.jsx(k,{variant:"ghost",size:"icon",onClick:()=>N?C(null):s(-1),className:"rounded-xl",children:t.jsx(ft,{className:"h-5 w-5"})}),t.jsx("h1",{className:"font-semibold text-lg",children:N==="profile"?"Editar Perfil":N==="address"?"Editar Endereço":N==="password"?"Alterar Senha":N==="notifications"?"Notificações":"Minha Conta"}),t.jsx("div",{className:"w-10"})]})}),t.jsx("div",{className:"p-4 pb-24 space-y-6",children:t.jsxs(V,{mode:"wait",children:[!N&&t.jsxs(w.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},className:"space-y-6",children:[t.jsxs(K,{className:"p-6 text-center",children:[t.jsx(Ze,{currentUrl:r.avatarUrl,name:r.nome,onUpload:Ce,onRemove:Se,size:"lg"}),t.jsx("h2",{className:"text-xl font-bold mt-4",children:r.nome}),t.jsxs("p",{className:"text-muted-foreground flex items-center justify-center gap-1",children:[t.jsx(Pe,{className:"h-4 w-4"}),De(r.phone)]}),r.phoneVerified&&t.jsxs("div",{className:"mt-2 inline-flex items-center gap-1 px-2 py-1 rounded-full bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300 text-xs",children:[t.jsx(U,{className:"h-3 w-3"}),"Verificado"]})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsxs(w.button,{whileTap:{scale:.98},onClick:()=>C("profile"),className:"w-full flex items-center justify-between p-4 bg-card rounded-xl border",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"p-2 rounded-lg bg-primary/10",children:t.jsx(me,{className:"h-5 w-5 text-primary"})}),t.jsxs("div",{className:"text-left",children:[t.jsx("p",{className:"font-medium",children:"Dados pessoais"}),t.jsx("p",{className:"text-xs text-muted-foreground",children:"Nome, e-mail e foto"})]})]}),t.jsx(ae,{className:"h-5 w-5 text-muted-foreground"})]}),t.jsxs(w.button,{whileTap:{scale:.98},onClick:()=>C("address"),className:"w-full flex items-center justify-between p-4 bg-card rounded-xl border",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"p-2 rounded-lg bg-blue-500/10",children:t.jsx(ue,{className:"h-5 w-5 text-blue-500"})}),t.jsxs("div",{className:"text-left",children:[t.jsx("p",{className:"font-medium",children:"Endereço"}),t.jsx("p",{className:"text-xs text-muted-foreground",children:(()=>{const m=r.address;return!m||!m.localidade&&!m.bairro?"Cadastre seu endereço":[m.bairro,m.localidade,m.uf].filter(Boolean).join(", ")||"Cadastre seu endereço"})()})]})]}),t.jsx(ae,{className:"h-5 w-5 text-muted-foreground"})]}),t.jsxs(w.button,{whileTap:{scale:.98},onClick:()=>C("password"),className:"w-full flex items-center justify-between p-4 bg-card rounded-xl border",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"p-2 rounded-lg bg-amber-500/10",children:t.jsx(de,{className:"h-5 w-5 text-amber-500"})}),t.jsxs("div",{className:"text-left",children:[t.jsx("p",{className:"font-medium",children:"Alterar senha"}),t.jsx("p",{className:"text-xs text-muted-foreground",children:"Trocar sua senha de acesso"})]})]}),t.jsx(ae,{className:"h-5 w-5 text-muted-foreground"})]}),t.jsxs(w.button,{whileTap:{scale:.98},onClick:()=>C("notifications"),className:"w-full flex items-center justify-between p-4 bg-card rounded-xl border",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"p-2 rounded-lg bg-purple-500/10",children:t.jsx(Ae,{className:"h-5 w-5 text-purple-500"})}),t.jsxs("div",{className:"text-left",children:[t.jsx("p",{className:"font-medium",children:"Notificações"}),t.jsx("p",{className:"text-xs text-muted-foreground",children:"Configurar alertas"})]})]}),t.jsx(ae,{className:"h-5 w-5 text-muted-foreground"})]})]}),t.jsxs(k,{variant:"outline",size:"lg",onClick:et,className:"w-full h-14 rounded-2xl text-red-500 border-red-200 hover:bg-red-50 dark:border-red-800 dark:hover:bg-red-950/30",children:[t.jsx(xt,{className:"h-5 w-5 mr-2"}),"Sair da conta"]})]},"main"),N==="profile"&&t.jsxs(w.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},className:"space-y-6",children:[t.jsx(K,{className:"p-6",children:t.jsx(Ze,{currentUrl:h,name:i,onUpload:Ce,onRemove:Se,size:"lg"})}),t.jsxs(K,{className:"p-4 space-y-4",children:[t.jsxs("div",{className:"space-y-2",children:[t.jsxs(D,{className:"flex items-center gap-2",children:[t.jsx(me,{className:"h-4 w-4"}),"Nome completo"]}),t.jsx(T,{type:"text",value:i,onChange:m=>c(m.target.value),className:"h-12"})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsxs(D,{className:"flex items-center gap-2",children:[t.jsx(gt,{className:"h-4 w-4"}),"E-mail"]}),t.jsx(T,{type:"email",value:n,onChange:m=>d(m.target.value),placeholder:"seu@email.com",className:"h-12"})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsxs(D,{className:"flex items-center gap-2",children:[t.jsx(Pe,{className:"h-4 w-4"}),"WhatsApp"]}),t.jsx(T,{type:"tel",value:De(r.phone),disabled:!0,className:"h-12 bg-muted"}),t.jsx("p",{className:"text-xs text-muted-foreground",children:"O número de WhatsApp não pode ser alterado"})]})]}),$&&t.jsx(w.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"p-3 rounded-xl bg-red-50 dark:bg-red-950/30 border border-red-200 dark:border-red-800",children:t.jsxs("p",{className:"text-sm text-red-600 dark:text-red-400 flex items-center gap-2",children:[t.jsx(re,{className:"h-4 w-4"}),$]})}),t.jsx(k,{size:"lg",onClick:Ke,disabled:S,className:O("w-full h-14 rounded-2xl text-lg font-semibold",B?"bg-green-600 hover:bg-green-600":"bg-gradient-to-r from-primary to-primary/80"),children:S?t.jsxs(t.Fragment,{children:[t.jsx(te,{className:"h-5 w-5 mr-2 animate-spin"}),"Salvando..."]}):B?t.jsxs(t.Fragment,{children:[t.jsx(U,{className:"h-5 w-5 mr-2"}),"Salvo!"]}):t.jsxs(t.Fragment,{children:[t.jsx(ze,{className:"h-5 w-5 mr-2"}),"Salvar alterações"]})})]},"profile"),N==="address"&&t.jsxs(w.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},className:"space-y-6",children:[t.jsx(K,{className:"p-4",children:t.jsx(_t,{value:f,onChange:g})}),$&&t.jsx(w.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"p-3 rounded-xl bg-red-50 dark:bg-red-950/30 border border-red-200 dark:border-red-800",children:t.jsxs("p",{className:"text-sm text-red-600 dark:text-red-400 flex items-center gap-2",children:[t.jsx(re,{className:"h-4 w-4"}),$]})}),t.jsx(k,{size:"lg",onClick:Je,disabled:S,className:O("w-full h-14 rounded-2xl text-lg font-semibold",B?"bg-green-600 hover:bg-green-600":"bg-gradient-to-r from-primary to-primary/80"),children:S?t.jsxs(t.Fragment,{children:[t.jsx(te,{className:"h-5 w-5 mr-2 animate-spin"}),"Salvando..."]}):B?t.jsxs(t.Fragment,{children:[t.jsx(U,{className:"h-5 w-5 mr-2"}),"Salvo!"]}):t.jsxs(t.Fragment,{children:[t.jsx(ze,{className:"h-5 w-5 mr-2"}),"Salvar endereço"]})})]},"address"),N==="password"&&t.jsxs(w.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},className:"space-y-6",children:[t.jsxs(K,{className:"p-4 space-y-4",children:[t.jsxs("div",{className:"space-y-2",children:[t.jsxs(D,{className:"flex items-center gap-2",children:[t.jsx(_e,{className:"h-4 w-4"}),"Senha atual"]}),t.jsxs("div",{className:"relative",children:[t.jsx(T,{type:A?"text":"password",value:v,onChange:m=>j(m.target.value),className:"h-12 pr-12"}),t.jsx(k,{type:"button",variant:"ghost",size:"icon",className:"absolute right-2 top-1/2 -translate-y-1/2",onClick:()=>L(!A),children:A?t.jsx(vt,{className:"h-5 w-5"}):t.jsx(wt,{className:"h-5 w-5"})})]})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsxs(D,{className:"flex items-center gap-2",children:[t.jsx(de,{className:"h-4 w-4"}),"Nova senha"]}),t.jsx(T,{type:A?"text":"password",value:y,onChange:m=>b(m.target.value),placeholder:"Mínimo 6 caracteres",className:"h-12"})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsxs(D,{className:"flex items-center gap-2",children:[t.jsx(de,{className:"h-4 w-4"}),"Confirmar nova senha"]}),t.jsx(T,{type:A?"text":"password",value:u,onChange:m=>E(m.target.value),className:O("h-12",u&&y!==u&&"border-red-400")}),u&&y!==u&&t.jsx("p",{className:"text-xs text-red-500",children:"As senhas não conferem"})]})]}),$&&t.jsx(w.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"p-3 rounded-xl bg-red-50 dark:bg-red-950/30 border border-red-200 dark:border-red-800",children:t.jsxs("p",{className:"text-sm text-red-600 dark:text-red-400 flex items-center gap-2",children:[t.jsx(re,{className:"h-4 w-4"}),$]})}),t.jsx(k,{size:"lg",onClick:Qe,disabled:S||!v||!y||!u,className:O("w-full h-14 rounded-2xl text-lg font-semibold",B?"bg-green-600 hover:bg-green-600":"bg-gradient-to-r from-primary to-primary/80"),children:S?t.jsxs(t.Fragment,{children:[t.jsx(te,{className:"h-5 w-5 mr-2 animate-spin"}),"Alterando..."]}):B?t.jsxs(t.Fragment,{children:[t.jsx(U,{className:"h-5 w-5 mr-2"}),"Senha alterada!"]}):t.jsxs(t.Fragment,{children:[t.jsx(_e,{className:"h-5 w-5 mr-2"}),"Alterar senha"]})})]},"password"),N==="notifications"&&t.jsxs(w.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},className:"space-y-4",children:[t.jsxs(K,{className:"p-4 space-y-4",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"p-2 rounded-lg bg-green-500/10",children:t.jsx(ue,{className:"h-5 w-5 text-green-500"})}),t.jsxs("div",{children:[t.jsx("p",{className:"font-medium",children:"Minhas observações"}),t.jsx("p",{className:"text-xs text-muted-foreground",children:"Atualizações sobre suas observações"})]})]}),t.jsx(he,{checked:Z,onCheckedChange:x})]}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"p-2 rounded-lg bg-blue-500/10",children:t.jsx(Ae,{className:"h-5 w-5 text-blue-500"})}),t.jsxs("div",{children:[t.jsx("p",{className:"font-medium",children:"Eventos"}),t.jsx("p",{className:"text-xs text-muted-foreground",children:"Novos eventos na cidade"})]})]}),t.jsx(he,{checked:W,onCheckedChange:z})]}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"p-2 rounded-lg bg-amber-500/10",children:t.jsx(re,{className:"h-5 w-5 text-amber-500"})}),t.jsxs("div",{children:[t.jsx("p",{className:"font-medium",children:"Alertas"}),t.jsx("p",{className:"text-xs text-muted-foreground",children:"Alertas importantes da cidade"})]})]}),t.jsx(he,{checked:I,onCheckedChange:R})]})]}),t.jsx("p",{className:"text-xs text-muted-foreground text-center px-4",children:"Você receberá notificações via WhatsApp para as opções ativadas"})]},"notifications")]})}),t.jsx(Rt,{activeTab:"mais",onTabChange:tt})]}):null}export{ya as default};
