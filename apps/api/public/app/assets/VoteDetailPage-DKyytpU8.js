import{j as e,r as u}from"./vendor-radix-CZ2RePwe.js";import{B as T}from"./button-DA0QF7Hj.js";import{B as te}from"./badge-DXD14Gja.js";import{C as se}from"./card-DfUgg8bH.js";import{f as I,C as O,X as V,d as o,U as z,m as ae,o as W,a as re,r as F,k as U,b as Q,n as oe,u as ne,l as ie,i as le,p as de,B as ce,Q as me}from"./index-D_a8Gkfa.js";import{b as xe,u as K,c as $}from"./vendor-query-CX3RJjg_.js";import{m as h,A as ue}from"./vendor-motion-DKd-IkFU.js";import{V as pe}from"./vote-Dmi2P4Rp.js";import{S as G}from"./search-Dfn0ytKz.js";import{C as he}from"./chevron-down-BfUlk0YR.js";import{V as D,a as R}from"./votes--jqTh9CK.js";import{S as fe,a as ge,b as be,c as je}from"./sheet-ChlXcJCF.js";import{F as ye}from"./file-text-B-We1suR.js";import{S as H}from"./share-2-C8MezJk1.js";import{E as X}from"./external-link-CH-zlSQ7.js";import{U as ve}from"./users-QXiSDaUy.js";import{C as Ne}from"./circle-alert-BsvKKkyx.js";import{v as we}from"./votes.service-JdeQ8dMu.js";import{C as Ce,a as ke}from"./CommentList-C3Szosk7.js";import{L as Se}from"./LoginPromptSheet-CjwINFDW.js";import{M as q}from"./message-circle-Cqek51lA.js";import{A as Ae}from"./arrow-left-BTmB4lZC.js";import{C as Te}from"./circle-x-Dx2T2uXu.js";import"./vendor-utils-BtjSOnCr.js";import"./useHaptics-QdUZx3l_.js";import"./textarea-Ce9c8WyY.js";import"./useUploadImage-DcnJOjmO.js";import"./eye-BMpNBrur.js";import"./image-CZEdxg5X.js";import"./send-60r2vi6S.js";import"./heart-BF0_ouVC.js";import"./chevron-up-CNa6DSvA.js";import"./log-in-C2_nC_S8.js";import"./user-plus-BsG-54R2.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const B=I("Minus",[["path",{d:"M5 12h14",key:"1ays0h"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const E=I("Pause",[["rect",{x:"14",y:"4",width:"4",height:"16",rx:"1",key:"zuxfzm"}],["rect",{x:"6",y:"4",width:"4",height:"16",rx:"1",key:"1okwgv"}]]),Ve=[{key:"sim",label:"Sim",icon:O,bgColor:"bg-green-50 dark:bg-green-950/30",iconBg:"bg-green-500",textColor:"text-green-700 dark:text-green-400",borderColor:"border-green-200 dark:border-green-800/50"},{key:"nao",label:"Não",icon:V,bgColor:"bg-red-50 dark:bg-red-950/30",iconBg:"bg-red-500",textColor:"text-red-700 dark:text-red-400",borderColor:"border-red-200 dark:border-red-800/50"},{key:"abstencao",label:"Abstenção",icon:E,bgColor:"bg-amber-50 dark:bg-amber-950/30",iconBg:"bg-amber-500",textColor:"text-amber-700 dark:text-amber-400",borderColor:"border-amber-200 dark:border-amber-800/50"},{key:"naoVotou",label:"Ausente",icon:B,bgColor:"bg-gray-50 dark:bg-gray-800/30",iconBg:"bg-gray-400",textColor:"text-gray-600 dark:text-gray-400",borderColor:"border-gray-200 dark:border-gray-700"}];function Oe({value:t,duration:a=1e3}){const[s,l]=u.useState(0);return u.useEffect(()=>{const i=Date.now(),n=0,c=()=>{const x=Date.now()-i,b=Math.min(x/a,1),d=1-Math.pow(1-b,3),f=Math.round(n+(t-n)*d);l(f),b<1&&requestAnimationFrame(c)};requestAnimationFrame(c)},[t,a]),e.jsx("span",{children:s})}function De({counts:t,className:a}){return e.jsx("div",{className:o("grid grid-cols-4 gap-2",a),children:Ve.map((s,l)=>{const i=s.icon,n=t[s.key];return e.jsxs(h.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:l*.1},className:o("flex flex-col items-center gap-1.5 p-3 rounded-xl border",s.bgColor,s.borderColor),children:[e.jsx("div",{className:o("flex items-center justify-center w-8 h-8 rounded-full",s.iconBg),children:e.jsx(i,{className:"w-4 h-4 text-white",strokeWidth:2.5})}),e.jsx("span",{className:o("text-2xl font-bold tabular-nums",s.textColor),children:e.jsx(Oe,{value:n,duration:800})}),e.jsx("span",{className:"text-[10px] font-medium text-muted-foreground uppercase tracking-wide",children:s.label})]},s.key)})})}function _({value:t,duration:a=1200}){const[s,l]=u.useState(0);return u.useEffect(()=>{const i=Date.now(),n=()=>{const c=Date.now()-i,x=Math.min(c/a,1),b=1-Math.pow(1-x,4),d=Math.round(t*b);l(d),x<1&&requestAnimationFrame(n)};requestAnimationFrame(n)},[t,a]),e.jsx("span",{children:s})}function Be({counts:t,status:a,className:s}){const[l,i]=u.useState(0),n=u.useRef(null),c=t.sim+t.nao+t.abstencao+t.naoVotou,x=c>0?t.sim/c*100:0,b=c>0?t.nao/c*100:0;u.useEffect(()=>{const C=Date.now(),k=1500,y=()=>{const r=Date.now()-C,v=Math.min(r/k,1),N=1-Math.pow(1-v,3);i(N),v<1&&requestAnimationFrame(y)};requestAnimationFrame(y)},[]);const d=x*3.6*l,f=b*3.6*l,p=(100-x-b)*3.6*l,w=`conic-gradient(
    #22c55e 0deg ${d}deg,
    #ef4444 ${d}deg ${d+f}deg,
    #9ca3af ${d+f}deg ${d+f+p}deg,
    #e5e7eb ${d+f+p}deg 360deg
  )`;return e.jsxs(h.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:o("flex items-center justify-between gap-4",s),children:[e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"flex items-baseline gap-2",children:[e.jsx(h.span,{className:"text-5xl font-extrabold text-foreground tabular-nums tracking-tight",initial:{scale:.5,opacity:0},animate:{scale:1,opacity:1},transition:{type:"spring",stiffness:200,damping:15},children:e.jsx(_,{value:t.sim})}),e.jsx("span",{className:"text-2xl text-muted-foreground font-medium",children:"×"}),e.jsx(h.span,{className:"text-5xl font-extrabold text-foreground tabular-nums tracking-tight",initial:{scale:.5,opacity:0},animate:{scale:1,opacity:1},transition:{type:"spring",stiffness:200,damping:15,delay:.1},children:e.jsx(_,{value:t.nao})})]}),e.jsxs("div",{className:"flex flex-col gap-1.5",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("div",{className:"w-2.5 h-2.5 rounded-full bg-green-500"}),e.jsxs("span",{className:"text-green-600 dark:text-green-400 font-medium",children:[t.sim," ",t.sim===1?"voto":"votos"," Sim"]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("div",{className:"w-2.5 h-2.5 rounded-full bg-red-500"}),e.jsxs("span",{className:"text-red-600 dark:text-red-400 font-medium",children:[t.nao," ",t.nao===1?"voto":"votos"," Não"]})]}),(t.abstencao>0||t.naoVotou>0)&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("div",{className:"w-2.5 h-2.5 rounded-full bg-gray-400"}),e.jsxs("span",{className:"text-muted-foreground font-medium",children:[t.abstencao+t.naoVotou," outros"]})]})]})]}),e.jsx(h.div,{ref:n,initial:{scale:0,rotate:-90},animate:{scale:1,rotate:0},transition:{type:"spring",stiffness:100,damping:15,delay:.2},className:"relative w-28 h-28 shrink-0 rounded-full flex items-center justify-center",style:{background:w},children:e.jsx("div",{className:"w-20 h-20 rounded-full bg-card flex items-center justify-center shadow-inner",children:e.jsx(pe,{className:"w-7 h-7 text-muted-foreground"})})})]})}const Ee=[{value:"all",label:"Todos"},{value:"SIM",label:"Sim"},{value:"NAO",label:"Não"},{value:"ABSTENCAO",label:"Abstenção"},{value:"NAO_VOTOU",label:"Ausente"}];function Me({searchQuery:t,onSearchChange:a,selectedParty:s,onPartyChange:l,selectedVote:i,onVoteChange:n,sortBy:c,onSortChange:x,availableParties:b,className:d}){const[f,j]=u.useState(!1);return e.jsxs("div",{className:o("flex flex-col gap-3",d),children:[e.jsxs("div",{className:"relative",children:[e.jsx(G,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx("input",{type:"text",value:t,onChange:p=>a(p.target.value),placeholder:"Buscar vereador...",className:o("w-full h-11 pl-10 pr-10 rounded-xl border bg-card","text-sm placeholder:text-muted-foreground","focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary","transition-all duration-200")}),t&&e.jsx("button",{onClick:()=>a(""),className:"absolute right-3 top-1/2 -translate-y-1/2 p-1 rounded-full hover:bg-muted transition-colors",children:e.jsx(V,{className:"w-4 h-4 text-muted-foreground"})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsxs("button",{onClick:()=>j(!f),className:o("w-full h-10 px-3 rounded-lg border bg-card","flex items-center justify-between gap-2","text-sm font-medium transition-colors",s!=="all"&&"border-primary/30 bg-primary/5"),children:[e.jsx("span",{className:"truncate",children:s==="all"?"Todos os Partidos":s}),e.jsx(he,{className:o("w-4 h-4 text-muted-foreground transition-transform",f&&"rotate-180")})]}),f&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-10",onClick:()=>j(!1)}),e.jsxs(h.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"absolute top-full left-0 right-0 mt-1 p-1 rounded-lg border bg-card shadow-lg z-20 max-h-48 overflow-auto",children:[e.jsx("button",{onClick:()=>{l("all"),j(!1)},className:o("w-full px-3 py-2 text-left text-sm rounded-md transition-colors",s==="all"?"bg-primary/10 text-primary":"hover:bg-muted"),children:"Todos os Partidos"}),b.map(p=>e.jsx("button",{onClick:()=>{l(p),j(!1)},className:o("w-full px-3 py-2 text-left text-sm rounded-md transition-colors",s===p?"bg-primary/10 text-primary":"hover:bg-muted"),children:p},p))]})]})]}),e.jsx("button",{onClick:()=>x(c==="relevance"?"alphabetical":"relevance"),className:o("h-10 px-3 rounded-lg border bg-card","text-xs font-medium transition-colors whitespace-nowrap","hover:bg-muted"),children:c==="relevance"?"A-Z":"⭐"})]}),e.jsx("div",{className:"flex p-1 bg-muted rounded-xl",children:Ee.map(p=>e.jsxs("button",{onClick:()=>n(p.value),className:o("relative flex-1 py-2 text-xs font-medium rounded-lg transition-all duration-200",i===p.value?"text-foreground":"text-muted-foreground hover:text-foreground/70"),children:[i===p.value&&e.jsx(h.div,{layoutId:"vote-tab-indicator",className:"absolute inset-0 bg-card rounded-lg shadow-sm",transition:{type:"spring",stiffness:400,damping:30}}),e.jsx("span",{className:"relative z-10",children:p.label})]},p.value))})]})}function Pe({vote:t}){const a=D[t],s={SIM:O,NAO:V,ABSTENCAO:E,NAO_VOTOU:B}[t];return e.jsxs(h.div,{initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},transition:{type:"spring",stiffness:400,damping:25},className:"flex flex-col items-center gap-1",children:[e.jsx("div",{className:o("flex items-center justify-center w-12 h-12 rounded-full","shadow-lg transition-transform duration-200",a.bgColor),children:e.jsx(s,{className:"w-6 h-6 text-white",strokeWidth:2.5})}),e.jsx("span",{className:o("text-xs font-bold uppercase tracking-wide",a.color),children:a.label})]})}function Le({text:t,query:a}){if(!a||a.trim()==="")return e.jsx("span",{children:t});const s=new RegExp(`(${a.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")})`,"gi"),l=t.split(s);return e.jsx("span",{children:l.map((i,n)=>s.test(i)?e.jsx("mark",{className:"bg-primary/20 text-primary rounded px-0.5",children:i},n):e.jsx("span",{children:i},n))})}function Ue({councilor:t,searchQuery:a,onClick:s,index:l=0}){const i=D[t.vote],n=t.vote==="NAO_VOTOU",c=t.party==="???"||!t.party?"—":t.party;return e.jsxs(h.button,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,scale:.95},transition:{delay:l*.04,type:"spring",stiffness:300,damping:25},whileTap:{scale:.97},whileHover:{y:-2},onClick:s,className:o("group relative w-full flex items-center gap-4 p-4 pl-5","bg-card rounded-2xl border transition-all duration-200","text-left shadow-card","hover:shadow-lg hover:border-primary/20","overflow-hidden",n&&"opacity-60"),children:[e.jsx(h.div,{initial:{height:0},animate:{height:"100%"},transition:{delay:l*.04+.1,duration:.3},className:o("absolute left-0 top-0 bottom-0 w-1.5 rounded-l-2xl",n?"bg-gray-300 dark:bg-gray-600":i.accentColor)}),e.jsxs("div",{className:"relative shrink-0",children:[e.jsxs(h.div,{initial:{scale:0},animate:{scale:1},transition:{delay:l*.04+.05,type:"spring",stiffness:400},className:o("w-14 h-14 rounded-full overflow-hidden","ring-2 ring-offset-2 ring-offset-card",n?"ring-gray-300 dark:ring-gray-600":i.borderColor.replace("border-","ring-")),children:[t.photoUrl?e.jsx("img",{src:t.photoUrl,alt:t.name,className:o("w-full h-full object-cover",n&&"grayscale opacity-60"),onError:x=>{x.currentTarget.style.display="none",x.currentTarget.nextElementSibling?.classList.remove("hidden")}}):null,e.jsx("div",{className:o("absolute inset-0 bg-muted flex items-center justify-center",t.photoUrl?"hidden":"",n&&"bg-gray-100 dark:bg-gray-800"),children:e.jsx(z,{className:o("w-7 h-7",n?"text-gray-400":"text-muted-foreground")})})]}),e.jsxs("div",{className:o("absolute -bottom-0.5 -right-0.5 w-5 h-5 rounded-full","flex items-center justify-center ring-2 ring-card",i.bgColor),children:[t.vote==="SIM"&&e.jsx(O,{className:"w-3 h-3 text-white",strokeWidth:3}),t.vote==="NAO"&&e.jsx(V,{className:"w-3 h-3 text-white",strokeWidth:3}),t.vote==="ABSTENCAO"&&e.jsx(E,{className:"w-3 h-3 text-white",strokeWidth:3}),t.vote==="NAO_VOTOU"&&e.jsx(B,{className:"w-3 h-3 text-white",strokeWidth:3})]})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:o("text-base font-bold leading-tight truncate",n?"text-muted-foreground":"text-foreground"),children:e.jsx(Le,{text:t.name,query:a})}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-0.5 flex items-center gap-2",children:[e.jsx("span",{className:"font-medium",children:c}),e.jsx("span",{className:"text-border",children:"•"}),e.jsx("span",{className:o("font-semibold",i.color),children:i.label})]})]}),e.jsx(Pe,{vote:t.vote}),e.jsx(ae,{className:"w-5 h-5 text-muted-foreground/50 group-hover:text-primary transition-colors"})]})}function Fe({vote:t}){const a=D[t],s={SIM:O,NAO:V,ABSTENCAO:E,NAO_VOTOU:B}[t];return e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx("div",{className:o("flex items-center justify-center w-16 h-16 rounded-full",a.bgColor),children:e.jsx(s,{className:"w-8 h-8 text-white",strokeWidth:2.5})}),e.jsx("span",{className:o("text-sm font-bold uppercase tracking-wide",a.color),children:a.label})]})}function $e({councilor:t,isOpen:a,onClose:s,voteTitle:l}){const{toast:i}=W();if(!t)return null;const n=D[t.vote],c=t.vote==="NAO_VOTOU",x=t.party==="???"||!t.party?"—":t.party,b=async()=>{const d=`${t.name} (${x}) votou ${n.label} em "${l||"votação"}"`;if(navigator.share)try{await navigator.share({title:"Voto do Vereador",text:d,url:window.location.href})}catch{}else navigator.clipboard&&(await navigator.clipboard.writeText(`${d}
${window.location.href}`),i({title:"Copiado!",description:"Texto copiado para compartilhar."}))};return e.jsx(fe,{open:a,onOpenChange:d=>!d&&s(),children:e.jsxs(ge,{side:"bottom",className:"rounded-t-3xl px-6 pb-8 pt-4 max-h-[80vh]",children:[e.jsx("div",{className:"w-12 h-1 bg-muted rounded-full mx-auto mb-4"}),e.jsxs(be,{className:"text-center pb-4",children:[e.jsx("div",{className:"flex justify-center mb-3",children:e.jsxs("div",{className:o("relative w-20 h-20 rounded-full overflow-hidden","border-3",c?"border-gray-200 dark:border-gray-700":n.borderColor),children:[t.photoUrl?e.jsx("img",{src:t.photoUrl,alt:t.name,className:o("w-full h-full object-cover",c&&"grayscale opacity-70"),onError:d=>{d.currentTarget.style.display="none",d.currentTarget.nextElementSibling?.classList.remove("hidden")}}):null,e.jsx("div",{className:o("absolute inset-0 bg-muted flex items-center justify-center",t.photoUrl?"hidden":""),children:e.jsx(z,{className:"w-10 h-10 text-muted-foreground"})})]})}),e.jsx(je,{className:"text-xl",children:t.name}),e.jsxs("p",{className:"text-muted-foreground font-medium",children:[x," • Vereador"]})]}),e.jsx("div",{className:"flex justify-center py-4 border-y border-border",children:e.jsx(Fe,{vote:t.vote})}),t.justification&&e.jsxs("div",{className:"mt-4 p-4 rounded-xl bg-muted/50 border",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-medium text-muted-foreground mb-2",children:[e.jsx(ye,{className:"w-4 h-4"}),"Justificativa"]}),e.jsx("p",{className:"text-sm leading-relaxed",children:t.justification})]}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsxs(T,{onClick:b,className:"flex-1 h-12 gap-2",variant:"default",children:[e.jsx(H,{className:"w-4 h-4"}),"Compartilhar voto"]}),t.videoUrl&&e.jsxs(T,{onClick:()=>window.open(t.videoUrl,"_blank"),variant:"outline",className:"h-12 gap-2",children:[e.jsx(X,{className:"w-4 h-4"}),"Vídeo"]})]}),e.jsx("p",{className:"text-center text-xs text-muted-foreground mt-4",children:"Dados sujeitos à fonte oficial da Câmara"})]})})}function Re({type:t="no-results",message:a,className:s}){const l=t==="no-results";return e.jsxs(h.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:o("flex flex-col items-center justify-center py-12 px-6 text-center",s),children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-muted flex items-center justify-center mb-4",children:l?e.jsx(G,{className:"w-7 h-7 text-muted-foreground"}):e.jsx(ve,{className:"w-7 h-7 text-muted-foreground"})}),e.jsx("h3",{className:"text-lg font-semibold text-foreground mb-1",children:l?"Nenhum resultado":"Sem dados"}),e.jsx("p",{className:"text-sm text-muted-foreground max-w-[260px]",children:a||(l?"Nenhum vereador encontrado com os filtros selecionados.":"Não há dados de votação disponíveis no momento.")})]})}function qe({source:t,className:a}){return e.jsxs("div",{className:o("flex flex-col items-center gap-2 pt-6 pb-4 text-center",a),children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-xs text-muted-foreground",children:[e.jsx(Ne,{className:"w-3.5 h-3.5"}),e.jsx("span",{children:"Dados sujeitos à fonte oficial"})]}),e.jsxs("a",{href:t.url,target:"_blank",rel:"noopener noreferrer",className:o("inline-flex items-center gap-1.5 px-3 py-1.5","text-sm font-medium text-primary","rounded-full border border-primary/20 bg-primary/5","hover:bg-primary/10 transition-colors"),children:[e.jsx(X,{className:"w-3.5 h-3.5"}),t.label]})]})}function _e({votacaoId:t}){const a=xe(),{isAuthenticated:s}=re(),[l,i]=u.useState(!1),[n,c]=u.useState("comment"),{data:x,isLoading:b,error:d}=K({queryKey:["votacao-comments",t],queryFn:async()=>await U.get(`/votacoes/${t}/comments`)}),f=$({mutationFn:async r=>U.post(`/votacoes/${t}/comments`,r),onSuccess:()=>{a.invalidateQueries({queryKey:["votacao-comments",t]}),F.success("Comentário adicionado!")},onError:()=>{F.error("Erro ao adicionar comentário")}}),j=$({mutationFn:async r=>U.post(`/votacoes/${t}/comments/${r}/like`),onSuccess:()=>{a.invalidateQueries({queryKey:["votacao-comments",t]})}}),p=u.useCallback(r=>{if(!s){c("like"),i(!0);return}j.mutate(r)},[s,j]),w=u.useCallback(async(r,v,N,M)=>{if(!s){c("comment"),i(!0);return}await f.mutateAsync({texto:v,isAnon:N,imageUrl:M,parentId:r})},[s,f]),C=u.useCallback(async(r,v,N)=>{if(!s){c("comment"),i(!0);return}await f.mutateAsync({texto:r,isAnon:v,imageUrl:N})},[s,f]),k=x?.data??[],y=x?.meta?.total??0;return e.jsxs("div",{className:"bg-card rounded-2xl border shadow-card overflow-hidden",children:[e.jsxs("div",{className:"px-4 py-3 border-b border-border/50 flex items-center gap-2",children:[e.jsx(q,{className:"w-5 h-5 text-primary"}),e.jsx("h3",{className:"font-semibold text-foreground",children:"Comentários da População"}),y>0&&e.jsxs("span",{className:"text-sm text-muted-foreground",children:["(",y,")"]})]}),b?e.jsx("div",{className:"py-12 flex justify-center",children:e.jsx(Q,{className:"w-6 h-6 animate-spin text-muted-foreground"})}):d?e.jsx("div",{className:"py-12 text-center",children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"Erro ao carregar comentários"})}):e.jsx(Ce,{comments:k,onLike:p,onReply:w}),e.jsx("div",{className:"border-t border-border/50 bg-muted/30",children:s?e.jsx("div",{className:"relative",children:e.jsx(ke,{onSubmit:C,placeholder:"Deixe seu comentário sobre esta votação...",isSubmitting:f.isPending})}):e.jsx(h.button,{whileTap:{scale:.98},onClick:()=>{c("comment"),i(!0)},className:"w-full px-4 py-4 text-left text-muted-foreground hover:bg-muted/50 transition-colors",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-muted flex items-center justify-center",children:e.jsx(q,{className:"w-4 h-4"})}),e.jsx("span",{className:"text-sm",children:"Faça login para comentar..."})]})})}),e.jsx(Se,{open:l,onClose:()=>i(!1),action:n})]})}function Ie(t){return{id:t.vereador.id,name:t.vereador.nome,party:t.vereador.partido?.sigla||"???",vote:t.voto,photoUrl:t.vereador.fotoUrl||"",justification:t.justificativa,videoUrl:t.urlVideo}}function Ct(){const{id:t}=oe(),a=ne(),{toast:s}=W(),{activeTab:l,setActiveTab:i}=ie(),[n,c]=u.useState(""),[x,b]=u.useState("all"),[d,f]=u.useState("all"),[j,p]=u.useState("relevance"),[w,C]=u.useState(null),[k,y]=u.useState(!1),{data:r,isLoading:v,error:N}=K({queryKey:me.votes.votacao(t||""),queryFn:()=>we.getById(t),enabled:!!t,staleTime:5*60*1e3}),M=u.useMemo(()=>{if(!r?.votos)return[];const m=new Set(r.votos.map(g=>g.vereador.partido?.sigla).filter(g=>!!g&&g!=="???"));return Array.from(m).sort()},[r]),P=u.useMemo(()=>r?.votos?r.votos.map(Ie):[],[r]),S=r?r.counts.sim>r.counts.nao?"approved":"rejected":"approved",L=u.useMemo(()=>{let m=[...P];if(n.trim()){const g=n.toLowerCase();m=m.filter(A=>A.name.toLowerCase().includes(g))}return x!=="all"&&(m=m.filter(g=>g.party===x)),d!=="all"&&(m=m.filter(g=>g.vote===d)),j==="alphabetical"?m.sort((g,A)=>g.name.localeCompare(A.name,"pt-BR")):m.sort((g,A)=>R[g.vote]-R[A.vote]),m},[P,n,x,d,j]),Y=async()=>{if(!r)return;const m={title:r.titulo,text:`${r.titulo} • ${r.subtitulo||""}`,url:window.location.href};if(navigator.share)try{await navigator.share(m)}catch{}else navigator.clipboard&&(await navigator.clipboard.writeText(m.url),s({title:"Link copiado!",description:"Cole onde quiser compartilhar."}))},J=m=>{C(m),y(!0)},Z=m=>{i(m),a("/")},ee=m=>new Date(m).toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric"});return v?e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-muted/50",children:e.jsx("div",{className:"relative w-full max-w-[420px] h-full bg-background flex items-center justify-center",children:e.jsx(Q,{className:"h-8 w-8 animate-spin text-primary"})})}):N||!r?e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-muted/50",children:e.jsxs("div",{className:"relative w-full max-w-[420px] h-full bg-background flex flex-col items-center justify-center gap-4 p-6",children:[e.jsx("p",{className:"text-muted-foreground text-center",children:"Não foi possível carregar os detalhes da votação"}),e.jsx(T,{variant:"outline",onClick:()=>a(-1),children:"Voltar"})]})}):e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-muted/50",children:e.jsxs("div",{className:"relative w-full max-w-[420px] h-full bg-background overflow-hidden shadow-elevated",children:[e.jsxs("div",{className:"h-full overflow-y-auto pb-24",children:[e.jsx("header",{className:"sticky top-0 z-40 bg-background/95 backdrop-blur-xl border-b",children:e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 safe-top",children:[e.jsx(T,{variant:"ghost",size:"icon",onClick:()=>a(-1),children:e.jsx(Ae,{className:"h-5 w-5"})}),e.jsx("h1",{className:"text-lg font-bold",children:"Detalhes da Votação"}),e.jsx(T,{variant:"ghost",size:"icon",onClick:Y,children:e.jsx(H,{className:"h-5 w-5"})})]})}),e.jsxs("main",{className:"px-4 py-5 space-y-6",children:[e.jsx(h.section,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:e.jsxs(se,{className:"rounded-2xl p-5 bg-gradient-to-br from-card to-muted/30 border shadow-card overflow-hidden relative",children:[e.jsx("div",{className:o("absolute top-0 left-0 right-0 h-1",S==="approved"?"bg-green-500":"bg-red-500")}),e.jsxs("div",{className:"flex items-center justify-between mb-4 pt-1",children:[e.jsxs(te,{className:o("gap-1.5 px-3 py-1.5 text-xs font-bold uppercase tracking-wider",S==="approved"?"bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400 border-green-200 dark:border-green-800":"bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-400 border-red-200 dark:border-red-800"),children:[S==="approved"?e.jsx(le,{className:"w-3.5 h-3.5"}):e.jsx(Te,{className:"w-3.5 h-3.5"}),S==="approved"?"Aprovado":"Rejeitado"]}),e.jsxs("span",{className:"text-xs text-muted-foreground flex items-center gap-1",children:[e.jsx(de,{className:"w-3.5 h-3.5"}),ee(r.data)]})]}),e.jsx(h.h2,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},transition:{delay:.1},className:"text-2xl font-bold text-foreground leading-tight mb-2",children:r.titulo}),e.jsx(h.p,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.2},className:"text-sm text-muted-foreground leading-relaxed mb-5",children:r.descricao}),e.jsx("div",{className:"h-px w-full bg-border mb-5"}),e.jsx(Be,{counts:r.counts,status:S})]})}),e.jsx(h.section,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},children:e.jsx(De,{counts:r.counts})}),e.jsx(h.section,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"sticky top-14 z-30 -mx-4 px-4 py-3 bg-background/95 backdrop-blur-xl border-y",children:e.jsx(Me,{searchQuery:n,onSearchChange:c,selectedParty:x,onPartyChange:b,selectedVote:d,onVoteChange:f,sortBy:j,onSortChange:p,availableParties:M})}),e.jsxs("section",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-base font-bold text-foreground",children:"Votos dos Vereadores"}),e.jsxs("span",{className:"text-sm text-muted-foreground font-medium",children:[L.length," de ",P.length]})]}),e.jsxs("div",{className:"flex flex-wrap gap-3 text-xs",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-green-500"}),e.jsx("span",{className:"text-muted-foreground",children:"Sim"})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-red-500"}),e.jsx("span",{className:"text-muted-foreground",children:"Não"})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-amber-500"}),e.jsx("span",{className:"text-muted-foreground",children:"Abstenção"})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-gray-400"}),e.jsx("span",{className:"text-muted-foreground",children:"Ausente"})]})]}),e.jsx(ue,{mode:"popLayout",children:L.length===0?e.jsx(Re,{type:"no-results"}):e.jsx(h.div,{layout:!0,className:"space-y-3",children:L.map((m,g)=>e.jsx(Ue,{councilor:m,searchQuery:n,onClick:()=>J(m),index:g},m.id))})})]}),e.jsx("section",{className:"px-4 py-4",children:e.jsx(_e,{votacaoId:r.id})}),r.urlFonte&&e.jsx(qe,{source:{label:"Fonte oficial",url:r.urlFonte}})]})]}),e.jsx(ce,{activeTab:l,onTabChange:Z}),e.jsx($e,{councilor:w,isOpen:k,onClose:()=>y(!1),voteTitle:r.titulo})]})})}export{Ct as default};
