import{w as pe,F as he,r,K as q,O as ue,Y as D,M as G,n as H,j as e,m as i,Z as fe,l as ge,y as $,_ as ye,L as be,$ as je,a0 as Ne,S as ve,a1 as we,x as K,a2 as Ce,a3 as ke}from"./vendor-app-Pv0Z4osg.js";import{c as W}from"./confetti.module-B5JVzsfH.js";import{B as P}from"./button-B7-sfbgK.js";import{I as E}from"./input-04vMBuGZ.js";import{L as A}from"./label-DSj85rYg.js";import{C as Se}from"./card-0QRq6-PB.js";import{P as Pe}from"./PhoneInput-BhpC_vAp.js";import{O as Ee}from"./OTPInput-DB7qAHf2.js";import{A as Ae}from"./AddressAutocomplete-CVlk5E5f.js";import{c as y}from"./index-CAH5beYL.js";import"./slider-hEtJbjx7.js";import{v as Oe,c as u,a as b}from"./auth.service-2WiSOYkP.js";import{u as Ve}from"./useAuthStore-DoPqv0cf.js";import{P as _,m as L}from"./auth-utils-B5I9WPFS.js";import"./useHaptics-BkU0Ve6f.js";import"./client-BdVdTjkU.js";import"./middleware-WYGlAF-S.js";const O=[{id:"phone",icon:q,label:"Telefone"},{id:"verify",icon:ue,label:"Verificar"},{id:"profile",icon:D,label:"Perfil"},{id:"address",icon:G,label:"Endereço"},{id:"done",icon:H,label:"Pronto"}];function Ue(){const F=pe(),J=he(),V=Ve(a=>a.setAuth),M=J.state,U=M?.phone,X=M?.otpVerified,[s,x]=r.useState(X?"profile":"phone"),j=O.findIndex(a=>a.id===s),[o,Y]=r.useState(U||""),[w,R]=r.useState(""),[Z,T]=r.useState(null),[l,Q]=r.useState(""),[C,ee]=r.useState(""),[d,ae]=r.useState(""),[p,se]=r.useState(""),[t,te]=r.useState({}),[k,re]=r.useState(!1),[f,m]=r.useState(!1),[N,c]=r.useState(null),ie=Oe(u(o)),oe=w.length===6,S=_.test(d),v=d===p,ne=l.trim().length>=2&&S&&v,z=t.cep&&t.logradouro&&t.bairro,le=r.useCallback(()=>{const a=Math.max(0,j-1);x(O[a].id),c(null)},[j]),ce=r.useCallback(async()=>{c(null),m(!0);try{switch(s){case"phone":const a=await b.sendOtp({phone:u(o)});if(a.userExists){c("Este telefone já está cadastrado. Faça login.");return}const n=new Date(Date.now()+a.expiresIn*1e3);T(n),x("verify");break;case"verify":await b.verifyOtp({phone:u(o),code:w}),x("profile");break;case"profile":if(!_.test(d))throw new Error("A senha deve ter min. 8 chars, maiúscula, minúscula e número.");if(!v)throw new Error("As senhas não conferem");x("address");break;case"address":if(!t.cep||!t.logradouro||!t.bairro||!t.localidade||!t.uf)throw new Error("Endereço incompleto");const g={zipCode:t.cep,street:t.logradouro,number:t.numero||"S/N",neighborhood:t.bairro,city:t.localidade,state:t.uf,complement:t.complemento},h=await b.register({phone:u(o),nome:l.trim(),email:C.trim()||void 0,password:d,confirmPassword:p,address:g});V(h.user,h.token,h.refreshToken),x("done");break}}catch(a){c(L(a))}finally{m(!1)}},[s,o,w,l,C,d,p,S,v,t,V]),de=r.useCallback(async()=>{m(!0),c(null);try{const a=await b.sendOtp({phone:u(o)}),n=new Date(Date.now()+a.expiresIn*1e3);T(n),R("")}catch(a){c(a instanceof Error?a.message:"Erro ao reenviar código")}finally{m(!1)}},[o]),me=r.useCallback(async a=>{m(!0),c(null);try{await b.verifyOtp({phone:u(o),code:a}),x("profile")}catch(n){c(L(n)),R("")}finally{m(!1)}},[o]);r.useEffect(()=>{if(s==="done"){const n=Date.now()+3e3,g=()=>{W({particleCount:3,angle:60,spread:55,origin:{x:0},colors:["#22c55e","#3b82f6","#f59e0b"]}),W({particleCount:3,angle:120,spread:55,origin:{x:1},colors:["#22c55e","#3b82f6","#f59e0b"]}),Date.now()<n&&requestAnimationFrame(g)};g()}},[s]);const B=()=>{switch(s){case"phone":return ie;case"verify":return oe;case"profile":return ne;case"address":return z;default:return!1}},xe=()=>{switch(s){case"phone":return e.jsxs(i.div,{initial:{opacity:0,x:30},animate:{opacity:1,x:0},exit:{opacity:0,x:-30},className:"space-y-6",children:[e.jsxs("div",{className:"text-center mb-4",children:[e.jsx("div",{className:"inline-flex p-4 rounded-2xl bg-primary/10 mb-4",children:e.jsx(q,{className:"h-8 w-8 text-primary"})}),e.jsx("h2",{className:"text-xl font-semibold",children:"Seu WhatsApp"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Vamos enviar um código de verificação"})]}),e.jsx(Pe,{value:o,onChange:Y,error:N||void 0,autoFocus:!0})]},"phone");case"verify":return e.jsx(i.div,{initial:{opacity:0,x:30},animate:{opacity:1,x:0},exit:{opacity:0,x:-30},className:"space-y-4",children:e.jsx(Ee,{value:w,onChange:R,onComplete:me,onResend:de,expiresAt:Z||void 0,error:N||void 0,isResending:f,isVerifying:f,phone:`(${o.slice(0,2)}) ${o.slice(2,7)}-${o.slice(7)}`})},"verify");case"profile":return e.jsxs(i.div,{initial:{opacity:0,x:30},animate:{opacity:1,x:0},exit:{opacity:0,x:-30},className:"space-y-5",children:[e.jsxs("div",{className:"text-center mb-4",children:[e.jsx("div",{className:"inline-flex p-4 rounded-2xl bg-primary/10 mb-4",children:e.jsx(D,{className:"h-8 w-8 text-primary"})}),e.jsx("h2",{className:"text-xl font-semibold",children:"Seus dados"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Crie sua conta com segurança"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(A,{className:"flex items-center gap-2",children:[e.jsx(D,{className:"h-4 w-4"}),"Nome completo"]}),e.jsx(E,{type:"text",placeholder:"Seu nome",value:l,onChange:a=>Q(a.target.value),className:y("h-12 text-base",l.length>0&&l.trim().length<2&&"border-amber-400"),autoFocus:!0}),l.length>0&&l.trim().length<2&&e.jsx("p",{className:"text-xs text-amber-600 dark:text-amber-400",children:"Nome muito curto (mínimo 2 caracteres)"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(A,{className:"flex items-center gap-2",children:[e.jsx(we,{className:"h-4 w-4"}),"E-mail ",e.jsx("span",{className:"text-muted-foreground text-xs",children:"(opcional)"})]}),e.jsx(E,{type:"email",placeholder:"seu@email.com",value:C,onChange:a=>ee(a.target.value),className:"h-12 text-base"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(A,{className:"flex items-center gap-2",children:[e.jsx(K,{className:"h-4 w-4"}),"Senha"]}),e.jsxs("div",{className:"relative",children:[e.jsx(E,{type:k?"text":"password",placeholder:"Mínimo 8 caracteres",value:d,onChange:a=>ae(a.target.value),className:y("h-12 text-base pr-10",d.length>0&&!S&&"border-amber-400")}),e.jsx("button",{type:"button",onClick:()=>re(!k),className:"absolute right-3 top-3 text-muted-foreground hover:text-foreground",children:k?e.jsx(Ce,{className:"h-5 w-5"}):e.jsx(ke,{className:"h-5 w-5"})})]}),d.length>0&&!S&&e.jsx("p",{className:"text-xs text-amber-600 dark:text-amber-400",children:"Mínimo 8 caracteres"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(A,{className:"flex items-center gap-2",children:[e.jsx(K,{className:"h-4 w-4"}),"Confirmar Senha"]}),e.jsx(E,{type:k?"text":"password",placeholder:"Repita a senha",value:p,onChange:a=>se(a.target.value),className:y("h-12 text-base",p.length>0&&!v&&"border-red-400")}),p.length>0&&!v&&e.jsx("p",{className:"text-xs text-red-600 dark:text-red-400",children:"As senhas não conferem"})]})]},"profile");case"address":return e.jsxs(i.div,{initial:{opacity:0,x:30},animate:{opacity:1,x:0},exit:{opacity:0,x:-30},className:"space-y-4",children:[e.jsxs("div",{className:"text-center mb-4",children:[e.jsx("div",{className:"inline-flex p-4 rounded-2xl bg-primary/10 mb-4",children:e.jsx(G,{className:"h-8 w-8 text-primary"})}),e.jsx("h2",{className:"text-xl font-semibold",children:"Seu endereço"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Digite o CEP para preencher automaticamente"})]}),e.jsx(Ae,{value:t,onChange:te,error:N||void 0})]},"address");case"done":return e.jsxs(i.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"text-center py-8",children:[e.jsx(i.div,{initial:{scale:0},animate:{scale:1},transition:{type:"spring",delay:.2,bounce:.5},className:"inline-flex p-6 rounded-full bg-green-100 dark:bg-green-900/30 mb-6",children:e.jsx(je,{className:"h-12 w-12 text-green-600 dark:text-green-400"})}),e.jsx(i.h2,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},className:"text-2xl font-bold",children:"Bem-vindo(a)!"}),e.jsxs(i.p,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4},className:"text-muted-foreground mt-2",children:[l,", sua conta foi criada com sucesso!"]}),e.jsx(i.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.6},className:"mt-8",children:e.jsxs(P,{size:"lg",className:"h-14 px-8 rounded-2xl bg-gradient-to-r from-green-600 to-green-500",onClick:()=>F("/"),children:[e.jsx(Ne,{className:"h-5 w-5 mr-2"}),"Explorar o app",e.jsx(ve,{className:"h-5 w-5 ml-2"})]})})]},"done")}};return e.jsxs("div",{className:"min-h-screen flex flex-col bg-gradient-to-br from-primary/5 via-background to-primary/10",children:[e.jsxs(i.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"p-4 flex items-center justify-between",children:[s!=="done"?e.jsx(P,{variant:"ghost",size:"icon",onClick:j>0?le:()=>F("/login"),className:"rounded-xl",children:e.jsx(fe,{className:"h-5 w-5"})}):e.jsx("div",{}),e.jsx("h1",{className:"font-semibold text-lg",children:s==="done"?"Sucesso!":"Criar conta"}),e.jsx("div",{className:"w-10"})]}),s!=="done"&&e.jsx(i.div,{initial:{opacity:0},animate:{opacity:1},className:"px-6 mb-6",children:e.jsx("div",{className:"flex items-center justify-between mb-2",children:O.slice(0,-1).map((a,n)=>{const g=a.icon,h=n===j,I=n<j;return e.jsxs("div",{className:"flex items-center",children:[e.jsx(i.div,{animate:{scale:h?1.1:1,backgroundColor:I?"rgb(34, 197, 94)":h?"hsl(var(--primary))":"hsl(var(--muted))"},className:y("w-10 h-10 rounded-full flex items-center justify-center","transition-colors"),children:I?e.jsx(H,{className:"h-5 w-5 text-white"}):e.jsx(g,{className:y("h-5 w-5",h?"text-white":"text-muted-foreground")})}),n<O.length-2&&e.jsx(i.div,{animate:{backgroundColor:I?"rgb(34, 197, 94)":"hsl(var(--muted))"},className:"w-8 h-1 mx-1 rounded-full"})]},a.id)})})}),e.jsx("div",{className:"flex-1 px-6 overflow-y-auto pb-32",children:e.jsxs(Se,{className:"p-6 shadow-xl border-0 bg-background/80 backdrop-blur-xl",children:[e.jsx(ge,{mode:"wait",children:xe()}),N&&s!=="verify"&&e.jsx(i.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"mt-4 p-3 rounded-xl bg-red-50 dark:bg-red-950/30 border border-red-200 dark:border-red-800",children:e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400 text-center",children:N})})]})}),s!=="done"&&s!=="verify"&&e.jsxs(i.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"fixed bottom-0 left-0 right-0 p-4 pb-8 bg-background/90 backdrop-blur-lg border-t",children:[s==="address"&&!z&&e.jsx(P,{variant:"ghost",size:"lg",onClick:async()=>{m(!0),c(null);try{const a=await b.register({phone:u(o),nome:l.trim(),email:C.trim()||void 0,password:d,confirmPassword:p});V(a.user,a.token,a.refreshToken),x("done")}catch(a){c(L(a))}finally{m(!1)}},disabled:f,className:"w-full h-12 mb-3 text-muted-foreground",children:f?e.jsxs(e.Fragment,{children:[e.jsx($,{className:"h-4 w-4 mr-2 animate-spin"}),"Criando conta..."]}):"Pular esta etapa"}),e.jsx(P,{size:"lg",onClick:ce,disabled:!B()||f,className:y("w-full h-14 text-lg font-semibold rounded-2xl","bg-gradient-to-r from-primary to-primary/80","shadow-lg shadow-primary/30",B()&&"hover:shadow-xl hover:shadow-primary/40"),children:f?e.jsxs(e.Fragment,{children:[e.jsx($,{className:"h-5 w-5 mr-2 animate-spin"}),s==="address"?"Criando conta...":"Verificando..."]}):e.jsxs(e.Fragment,{children:[s==="address"?"Criar conta com endereço":"Continuar",e.jsx(ye,{className:"h-5 w-5 ml-2"})]})}),s==="phone"&&e.jsxs("p",{className:"text-center text-sm text-muted-foreground mt-4",children:["Já tem conta?"," ",e.jsx(be,{to:"/login",className:"text-primary font-semibold hover:underline",children:"Entrar"})]})]})]})}export{Ue as default};
