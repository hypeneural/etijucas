import{r as u,a as Ae,j as e,o as Fe,p as Re,q as he,s as Le,t as _e,u as fe,w as De,x as xe,y as Be,z as $e,S as pe,B as ge,L as be,E as ve}from"./vendor-radix-Dq3xRYQM.js";import{b as je,c as z,X as V,E as Pe,W as We,R as ye,T as Ve,i as He,d as Ue,h as qe,f as Qe,j as Ke}from"./index-c_fDHSq9.js";import{B as H}from"./button-MlY_P9J9.js";import{u as Xe}from"./useAuthStore-N8t3jw6u.js";import{u as Ge,a as Ye,b as Je}from"./useOfflineTopics-Cs5Qau2Y.js";import{f as Ze,a as et,c as ie}from"./formatTimeAgo-COfck6cW.js";import{I as we}from"./input-C5nmp32D.js";import{m as v,A as J}from"./vendor-motion-CBZKS1Mr.js";import{S as Ne}from"./search-BlpecVKF.js";import{T as tt}from"./trending-up-CJeBHsEo.js";import{C as st}from"./clock-CHDv1Dkh.js";import{M as D}from"./map-pin-Ch0e7eiH.js";import{C as se}from"./chevron-down-CvS-XTg8.js";import{C as Se}from"./check-CpSNnAoS.js";import{C as at}from"./dropdown-menu-Cqw5X6vf.js";import{b as ae}from"./bairros-Cf5Z_oCw.js";import{I as Z}from"./image-CGCyfRi0.js";import{B as rt}from"./badge-D0Hrtn6k.js";import{H as it}from"./heart-CfMPnxZf.js";import{M as nt}from"./message-circle-B3WSdRjo.js";import{S as ot}from"./share-2-Ccbl6uvQ.js";import{C as L}from"./circle-alert-CS-79IyJ.js";import{S as lt,a as ct,b as dt,c as ut}from"./sheet-VWei9tBe.js";import{T as mt,S as ht}from"./textarea-BefFO1EZ.js";import{S as ft}from"./switch-CskCvbc5.js";import{u as xt}from"./useUploadImage-oVdfNXQB.js";import{C as pt}from"./camera-C7eH1yPh.js";import{E as gt,a as bt}from"./eye-DYcqzQXg.js";import{L as vt}from"./loader-circle-BJs9O_2i.js";import{L as jt}from"./lightbulb-DQSpjcSf.js";import{C as yt}from"./circle-help-9tjK_1tm.js";import{B as wt}from"./bell-CwFdQuqW.js";import{T as Nt}from"./thumbs-up-C7wDFG7l.js";import{P as St}from"./plus-DPou_4VM.js";import"./vendor-utils-DHocNF0y.js";import"./vendor-query-DJ0Mukyd.js";import"./localDatabase-WXoWnzPu.js";import"./client-BTgelhMB.js";import"./chevron-right-BGEfj7IE.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ct=je("MessageSquarePlus",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}],["path",{d:"M12 7v6",key:"lw1j43"}],["path",{d:"M9 10h6",key:"9gxzsh"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kt=je("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]);function R(r,i,t){let a=t.initialDeps??[],s,n=!0;function l(){var o,m,c;let f;t.key&&((o=t.debug)!=null&&o.call(t))&&(f=Date.now());const j=r();if(!(j.length!==a.length||j.some((w,b)=>a[b]!==w)))return s;a=j;let y;if(t.key&&((m=t.debug)!=null&&m.call(t))&&(y=Date.now()),s=i(...j),t.key&&((c=t.debug)!=null&&c.call(t))){const w=Math.round((Date.now()-f)*100)/100,b=Math.round((Date.now()-y)*100)/100,g=b/16,k=(S,I)=>{for(S=String(S);S.length<I;)S=" "+S;return S};console.info(`%c‚è± ${k(b,5)} /${k(w,5)} ms`,`
            font-size: .6rem;
            font-weight: bold;
            color: hsl(${Math.max(0,Math.min(120-120*g,120))}deg 100% 31%);`,t?.key)}return t?.onChange&&!(n&&t.skipInitialOnChange)&&t.onChange(s),n=!1,s}return l.updateDeps=o=>{a=o},l}function ne(r,i){if(r===void 0)throw new Error("Unexpected undefined");return r}const Et=(r,i)=>Math.abs(r-i)<1.01,It=(r,i,t)=>{let a;return function(...s){r.clearTimeout(a),a=r.setTimeout(()=>i.apply(this,s),t)}},oe=r=>{const{offsetWidth:i,offsetHeight:t}=r;return{width:i,height:t}},Tt=r=>r,Mt=r=>{const i=Math.max(r.startIndex-r.overscan,0),t=Math.min(r.endIndex+r.overscan,r.count-1),a=[];for(let s=i;s<=t;s++)a.push(s);return a},zt=(r,i)=>{const t=r.scrollElement;if(!t)return;const a=r.targetWindow;if(!a)return;const s=l=>{const{width:o,height:m}=l;i({width:Math.round(o),height:Math.round(m)})};if(s(oe(t)),!a.ResizeObserver)return()=>{};const n=new a.ResizeObserver(l=>{const o=()=>{const m=l[0];if(m?.borderBoxSize){const c=m.borderBoxSize[0];if(c){s({width:c.inlineSize,height:c.blockSize});return}}s(oe(t))};r.options.useAnimationFrameWithResizeObserver?requestAnimationFrame(o):o()});return n.observe(t,{box:"border-box"}),()=>{n.unobserve(t)}},le={passive:!0},ce=typeof window>"u"?!0:"onscrollend"in window,Ot=(r,i)=>{const t=r.scrollElement;if(!t)return;const a=r.targetWindow;if(!a)return;let s=0;const n=r.options.useScrollendEvent&&ce?()=>{}:It(a,()=>{i(s,!1)},r.options.isScrollingResetDelay),l=f=>()=>{const{horizontal:j,isRtl:h}=r.options;s=j?t.scrollLeft*(h&&-1||1):t.scrollTop,n(),i(s,f)},o=l(!0),m=l(!1);t.addEventListener("scroll",o,le);const c=r.options.useScrollendEvent&&ce;return c&&t.addEventListener("scrollend",m,le),()=>{t.removeEventListener("scroll",o),c&&t.removeEventListener("scrollend",m)}},At=(r,i,t)=>{if(i?.borderBoxSize){const a=i.borderBoxSize[0];if(a)return Math.round(a[t.options.horizontal?"inlineSize":"blockSize"])}return r[t.options.horizontal?"offsetWidth":"offsetHeight"]},Ft=(r,{adjustments:i=0,behavior:t},a)=>{var s,n;const l=r+i;(n=(s=a.scrollElement)==null?void 0:s.scrollTo)==null||n.call(s,{[a.options.horizontal?"left":"top"]:l,behavior:t})};class Rt{constructor(i){this.unsubs=[],this.scrollElement=null,this.targetWindow=null,this.isScrolling=!1,this.currentScrollToIndex=null,this.measurementsCache=[],this.itemSizeCache=new Map,this.laneAssignments=new Map,this.pendingMeasuredCacheIndexes=[],this.prevLanes=void 0,this.lanesChangedFlag=!1,this.lanesSettling=!1,this.scrollRect=null,this.scrollOffset=null,this.scrollDirection=null,this.scrollAdjustments=0,this.elementsCache=new Map,this.observer=(()=>{let t=null;const a=()=>t||(!this.targetWindow||!this.targetWindow.ResizeObserver?null:t=new this.targetWindow.ResizeObserver(s=>{s.forEach(n=>{const l=()=>{this._measureElement(n.target,n)};this.options.useAnimationFrameWithResizeObserver?requestAnimationFrame(l):l()})}));return{disconnect:()=>{var s;(s=a())==null||s.disconnect(),t=null},observe:s=>{var n;return(n=a())==null?void 0:n.observe(s,{box:"border-box"})},unobserve:s=>{var n;return(n=a())==null?void 0:n.unobserve(s)}}})(),this.range=null,this.setOptions=t=>{Object.entries(t).forEach(([a,s])=>{typeof s>"u"&&delete t[a]}),this.options={debug:!1,initialOffset:0,overscan:1,paddingStart:0,paddingEnd:0,scrollPaddingStart:0,scrollPaddingEnd:0,horizontal:!1,getItemKey:Tt,rangeExtractor:Mt,onChange:()=>{},measureElement:At,initialRect:{width:0,height:0},scrollMargin:0,gap:0,indexAttribute:"data-index",initialMeasurementsCache:[],lanes:1,isScrollingResetDelay:150,enabled:!0,isRtl:!1,useScrollendEvent:!1,useAnimationFrameWithResizeObserver:!1,...t}},this.notify=t=>{var a,s;(s=(a=this.options).onChange)==null||s.call(a,this,t)},this.maybeNotify=R(()=>(this.calculateRange(),[this.isScrolling,this.range?this.range.startIndex:null,this.range?this.range.endIndex:null]),t=>{this.notify(t)},{key:!1,debug:()=>this.options.debug,initialDeps:[this.isScrolling,this.range?this.range.startIndex:null,this.range?this.range.endIndex:null]}),this.cleanup=()=>{this.unsubs.filter(Boolean).forEach(t=>t()),this.unsubs=[],this.observer.disconnect(),this.scrollElement=null,this.targetWindow=null},this._didMount=()=>()=>{this.cleanup()},this._willUpdate=()=>{var t;const a=this.options.enabled?this.options.getScrollElement():null;if(this.scrollElement!==a){if(this.cleanup(),!a){this.maybeNotify();return}this.scrollElement=a,this.scrollElement&&"ownerDocument"in this.scrollElement?this.targetWindow=this.scrollElement.ownerDocument.defaultView:this.targetWindow=((t=this.scrollElement)==null?void 0:t.window)??null,this.elementsCache.forEach(s=>{this.observer.observe(s)}),this.unsubs.push(this.options.observeElementRect(this,s=>{this.scrollRect=s,this.maybeNotify()})),this.unsubs.push(this.options.observeElementOffset(this,(s,n)=>{this.scrollAdjustments=0,this.scrollDirection=n?this.getScrollOffset()<s?"forward":"backward":null,this.scrollOffset=s,this.isScrolling=n,this.maybeNotify()})),this._scrollToOffset(this.getScrollOffset(),{adjustments:void 0,behavior:void 0})}},this.getSize=()=>this.options.enabled?(this.scrollRect=this.scrollRect??this.options.initialRect,this.scrollRect[this.options.horizontal?"width":"height"]):(this.scrollRect=null,0),this.getScrollOffset=()=>this.options.enabled?(this.scrollOffset=this.scrollOffset??(typeof this.options.initialOffset=="function"?this.options.initialOffset():this.options.initialOffset),this.scrollOffset):(this.scrollOffset=null,0),this.getFurthestMeasurement=(t,a)=>{const s=new Map,n=new Map;for(let l=a-1;l>=0;l--){const o=t[l];if(s.has(o.lane))continue;const m=n.get(o.lane);if(m==null||o.end>m.end?n.set(o.lane,o):o.end<m.end&&s.set(o.lane,!0),s.size===this.options.lanes)break}return n.size===this.options.lanes?Array.from(n.values()).sort((l,o)=>l.end===o.end?l.index-o.index:l.end-o.end)[0]:void 0},this.getMeasurementOptions=R(()=>[this.options.count,this.options.paddingStart,this.options.scrollMargin,this.options.getItemKey,this.options.enabled,this.options.lanes],(t,a,s,n,l,o)=>(this.prevLanes!==void 0&&this.prevLanes!==o&&(this.lanesChangedFlag=!0),this.prevLanes=o,this.pendingMeasuredCacheIndexes=[],{count:t,paddingStart:a,scrollMargin:s,getItemKey:n,enabled:l,lanes:o}),{key:!1}),this.getMeasurements=R(()=>[this.getMeasurementOptions(),this.itemSizeCache],({count:t,paddingStart:a,scrollMargin:s,getItemKey:n,enabled:l,lanes:o},m)=>{if(!l)return this.measurementsCache=[],this.itemSizeCache.clear(),this.laneAssignments.clear(),[];if(this.laneAssignments.size>t)for(const h of this.laneAssignments.keys())h>=t&&this.laneAssignments.delete(h);this.lanesChangedFlag&&(this.lanesChangedFlag=!1,this.lanesSettling=!0,this.measurementsCache=[],this.itemSizeCache.clear(),this.laneAssignments.clear(),this.pendingMeasuredCacheIndexes=[]),this.measurementsCache.length===0&&!this.lanesSettling&&(this.measurementsCache=this.options.initialMeasurementsCache,this.measurementsCache.forEach(h=>{this.itemSizeCache.set(h.key,h.size)}));const c=this.lanesSettling?0:this.pendingMeasuredCacheIndexes.length>0?Math.min(...this.pendingMeasuredCacheIndexes):0;this.pendingMeasuredCacheIndexes=[],this.lanesSettling&&this.measurementsCache.length===t&&(this.lanesSettling=!1);const f=this.measurementsCache.slice(0,c),j=new Array(o).fill(void 0);for(let h=0;h<c;h++){const y=f[h];y&&(j[y.lane]=h)}for(let h=c;h<t;h++){const y=n(h),w=this.laneAssignments.get(h);let b,g;if(w!==void 0&&this.options.lanes>1){b=w;const T=j[b],A=T!==void 0?f[T]:void 0;g=A?A.end+this.options.gap:a+s}else{const T=this.options.lanes===1?f[h-1]:this.getFurthestMeasurement(f,h);g=T?T.end+this.options.gap:a+s,b=T?T.lane:h%this.options.lanes,this.options.lanes>1&&this.laneAssignments.set(h,b)}const k=m.get(y),S=typeof k=="number"?k:this.options.estimateSize(h),I=g+S;f[h]={index:h,start:g,size:S,end:I,key:y,lane:b},j[b]=h}return this.measurementsCache=f,f},{key:!1,debug:()=>this.options.debug}),this.calculateRange=R(()=>[this.getMeasurements(),this.getSize(),this.getScrollOffset(),this.options.lanes],(t,a,s,n)=>this.range=t.length>0&&a>0?Lt({measurements:t,outerSize:a,scrollOffset:s,lanes:n}):null,{key:!1,debug:()=>this.options.debug}),this.getVirtualIndexes=R(()=>{let t=null,a=null;const s=this.calculateRange();return s&&(t=s.startIndex,a=s.endIndex),this.maybeNotify.updateDeps([this.isScrolling,t,a]),[this.options.rangeExtractor,this.options.overscan,this.options.count,t,a]},(t,a,s,n,l)=>n===null||l===null?[]:t({startIndex:n,endIndex:l,overscan:a,count:s}),{key:!1,debug:()=>this.options.debug}),this.indexFromElement=t=>{const a=this.options.indexAttribute,s=t.getAttribute(a);return s?parseInt(s,10):(console.warn(`Missing attribute name '${a}={index}' on measured element.`),-1)},this._measureElement=(t,a)=>{const s=this.indexFromElement(t),n=this.measurementsCache[s];if(!n)return;const l=n.key,o=this.elementsCache.get(l);o!==t&&(o&&this.observer.unobserve(o),this.observer.observe(t),this.elementsCache.set(l,t)),t.isConnected&&this.resizeItem(s,this.options.measureElement(t,a,this))},this.resizeItem=(t,a)=>{const s=this.measurementsCache[t];if(!s)return;const n=this.itemSizeCache.get(s.key)??s.size,l=a-n;l!==0&&((this.shouldAdjustScrollPositionOnItemSizeChange!==void 0?this.shouldAdjustScrollPositionOnItemSizeChange(s,l,this):s.start<this.getScrollOffset()+this.scrollAdjustments)&&this._scrollToOffset(this.getScrollOffset(),{adjustments:this.scrollAdjustments+=l,behavior:void 0}),this.pendingMeasuredCacheIndexes.push(s.index),this.itemSizeCache=new Map(this.itemSizeCache.set(s.key,a)),this.notify(!1))},this.measureElement=t=>{if(!t){this.elementsCache.forEach((a,s)=>{a.isConnected||(this.observer.unobserve(a),this.elementsCache.delete(s))});return}this._measureElement(t,void 0)},this.getVirtualItems=R(()=>[this.getVirtualIndexes(),this.getMeasurements()],(t,a)=>{const s=[];for(let n=0,l=t.length;n<l;n++){const o=t[n],m=a[o];s.push(m)}return s},{key:!1,debug:()=>this.options.debug}),this.getVirtualItemForOffset=t=>{const a=this.getMeasurements();if(a.length!==0)return ne(a[Ce(0,a.length-1,s=>ne(a[s]).start,t)])},this.getMaxScrollOffset=()=>{if(!this.scrollElement)return 0;if("scrollHeight"in this.scrollElement)return this.options.horizontal?this.scrollElement.scrollWidth-this.scrollElement.clientWidth:this.scrollElement.scrollHeight-this.scrollElement.clientHeight;{const t=this.scrollElement.document.documentElement;return this.options.horizontal?t.scrollWidth-this.scrollElement.innerWidth:t.scrollHeight-this.scrollElement.innerHeight}},this.getOffsetForAlignment=(t,a,s=0)=>{if(!this.scrollElement)return 0;const n=this.getSize(),l=this.getScrollOffset();a==="auto"&&(a=t>=l+n?"end":"start"),a==="center"?t+=(s-n)/2:a==="end"&&(t-=n);const o=this.getMaxScrollOffset();return Math.max(Math.min(o,t),0)},this.getOffsetForIndex=(t,a="auto")=>{t=Math.max(0,Math.min(t,this.options.count-1));const s=this.measurementsCache[t];if(!s)return;const n=this.getSize(),l=this.getScrollOffset();if(a==="auto")if(s.end>=l+n-this.options.scrollPaddingEnd)a="end";else if(s.start<=l+this.options.scrollPaddingStart)a="start";else return[l,a];if(a==="end"&&t===this.options.count-1)return[this.getMaxScrollOffset(),a];const o=a==="end"?s.end+this.options.scrollPaddingEnd:s.start-this.options.scrollPaddingStart;return[this.getOffsetForAlignment(o,a,s.size),a]},this.isDynamicMode=()=>this.elementsCache.size>0,this.scrollToOffset=(t,{align:a="start",behavior:s}={})=>{s==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),this._scrollToOffset(this.getOffsetForAlignment(t,a),{adjustments:void 0,behavior:s})},this.scrollToIndex=(t,{align:a="auto",behavior:s}={})=>{s==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),t=Math.max(0,Math.min(t,this.options.count-1)),this.currentScrollToIndex=t;let n=0;const l=10,o=c=>{if(!this.targetWindow)return;const f=this.getOffsetForIndex(t,c);if(!f){console.warn("Failed to get offset for index:",t);return}const[j,h]=f;this._scrollToOffset(j,{adjustments:void 0,behavior:s}),this.targetWindow.requestAnimationFrame(()=>{const y=()=>{if(this.currentScrollToIndex!==t)return;const w=this.getScrollOffset(),b=this.getOffsetForIndex(t,h);if(!b){console.warn("Failed to get offset for index:",t);return}Et(b[0],w)||m(h)};this.isDynamicMode()?this.targetWindow.requestAnimationFrame(y):y()})},m=c=>{this.targetWindow&&this.currentScrollToIndex===t&&(n++,n<l?this.targetWindow.requestAnimationFrame(()=>o(c)):console.warn(`Failed to scroll to index ${t} after ${l} attempts.`))};o(a)},this.scrollBy=(t,{behavior:a}={})=>{a==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),this._scrollToOffset(this.getScrollOffset()+t,{adjustments:void 0,behavior:a})},this.getTotalSize=()=>{var t;const a=this.getMeasurements();let s;if(a.length===0)s=this.options.paddingStart;else if(this.options.lanes===1)s=((t=a[a.length-1])==null?void 0:t.end)??0;else{const n=Array(this.options.lanes).fill(null);let l=a.length-1;for(;l>=0&&n.some(o=>o===null);){const o=a[l];n[o.lane]===null&&(n[o.lane]=o.end),l--}s=Math.max(...n.filter(o=>o!==null))}return Math.max(s-this.options.scrollMargin+this.options.paddingEnd,0)},this._scrollToOffset=(t,{adjustments:a,behavior:s})=>{this.options.scrollToFn(t,{behavior:s,adjustments:a},this)},this.measure=()=>{this.itemSizeCache=new Map,this.laneAssignments=new Map,this.notify(!1)},this.setOptions(i)}}const Ce=(r,i,t,a)=>{for(;r<=i;){const s=(r+i)/2|0,n=t(s);if(n<a)r=s+1;else if(n>a)i=s-1;else return s}return r>0?r-1:0};function Lt({measurements:r,outerSize:i,scrollOffset:t,lanes:a}){const s=r.length-1,n=m=>r[m].start;if(r.length<=a)return{startIndex:0,endIndex:s};let l=Ce(0,s,n,t),o=l;if(a===1)for(;o<s&&r[o].end<t+i;)o++;else if(a>1){const m=Array(a).fill(0);for(;o<s&&m.some(f=>f<t+i);){const f=r[o];m[f.lane]=f.end,o++}const c=Array(a).fill(t+i);for(;l>=0&&c.some(f=>f>=t);){const f=r[l];c[f.lane]=f.start,l--}l=Math.max(0,l-l%a),o=Math.min(s,o+(a-1-o%a))}return{startIndex:l,endIndex:o}}const de=typeof document<"u"?u.useLayoutEffect:u.useEffect;function _t({useFlushSync:r=!0,...i}){const t=u.useReducer(()=>({}),{})[1],a={...i,onChange:(n,l)=>{var o;r&&l?Ae.flushSync(t):t(),(o=i.onChange)==null||o.call(i,n,l)}},[s]=u.useState(()=>new Rt(a));return s.setOptions(a),de(()=>s._didMount(),[]),de(()=>s._willUpdate()),s}function Dt(r){return _t({observeElementRect:zt,observeElementOffset:Ot,scrollToFn:Ft,...r})}function Bt({items:r,estimatedItemSize:i=100,overscan:t=5,height:a,className:s,gap:n=0,renderItem:l,getItemKey:o,emptyState:m,isLoading:c,loadingComponent:f,scrollRef:j}){const h=u.useRef(null),y=Dt({count:r.length,getScrollElement:()=>h.current,estimateSize:()=>i,overscan:t,gap:n}),w=y.getVirtualItems(),b=u.useCallback(g=>{h.current=g,j&&j(g)},[j]);return c?e.jsx("div",{className:z("flex items-center justify-center",s),style:{height:a},children:f||e.jsx("div",{className:"animate-pulse text-muted-foreground",children:"Carregando..."})}):r.length===0?e.jsx("div",{className:z("flex items-center justify-center",s),style:{height:a},children:m||e.jsx("div",{className:"text-muted-foreground",children:"Nenhum item encontrado"})}):e.jsx("div",{ref:b,className:z("overflow-auto",s),style:{height:a},children:e.jsx("div",{style:{height:`${y.getTotalSize()}px`,width:"100%",position:"relative"},children:w.map(g=>{const k=r[g.index],S=o?o(k,g.index):g.index;return e.jsx("div",{"data-index":g.index,ref:y.measureElement,style:{position:"absolute",top:0,left:0,width:"100%",transform:`translateY(${g.start}px)`},children:l(k,g.index)},S)})})})}function $t({onSearch:r,onSearchFocus:i}){const[t,a]=u.useState(""),[s,n]=u.useState(!1),l=c=>{a(c),r?.(c)},o=()=>{a(""),r?.("")},m=()=>{n(!0),i?.()};return e.jsxs("div",{className:"sticky top-0 z-20 bg-background/95 backdrop-blur-md safe-top",children:[e.jsxs(v.div,{className:"px-4 pt-4 pb-3",initial:{opacity:0,y:-10},animate:{opacity:1,y:0},transition:{duration:.3},children:[e.jsx("h1",{className:"text-2xl font-bold text-foreground tracking-tight",children:"Boca no Trombone"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-0.5",children:"A voz da comunidade"})]}),e.jsx("div",{className:"px-4 pb-3",children:e.jsxs(v.div,{className:"relative",animate:{scale:s?1.01:1},transition:{duration:.2},children:[e.jsx(Ne,{className:`absolute left-3.5 top-1/2 -translate-y-1/2 w-5 h-5 transition-colors ${s?"text-primary":"text-muted-foreground"}`}),e.jsx(we,{value:t,onChange:c=>l(c.target.value),onFocus:m,onBlur:()=>n(!1),placeholder:"Buscar assunto, rua, bairro‚Ä¶",className:`pl-11 pr-10 h-12 rounded-2xl border-2 text-base transition-all ${s?"border-primary bg-background shadow-lg":"border-transparent bg-muted/50"}`}),t&&e.jsx(v.button,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.8},onClick:o,className:"absolute right-3 top-1/2 -translate-y-1/2 p-1 rounded-full bg-muted hover:bg-muted-foreground/20 transition-colors","aria-label":"Limpar busca",children:e.jsx(V,{className:"w-4 h-4 text-muted-foreground"})})]})})]})}const G=[{id:"curtidos",label:"Mais curtidos",icon:tt},{id:"recentes",label:"Recentes",icon:st},{id:"perto",label:"Perto de mim",icon:D}];function Pt({value:r,onChange:i}){return e.jsx("div",{className:"px-4 pb-3",children:e.jsxs("div",{className:"relative flex bg-muted/60 rounded-xl p-1",children:[e.jsx(v.div,{className:"absolute inset-y-1 bg-background rounded-lg shadow-sm",initial:!1,animate:{x:`${G.findIndex(t=>t.id===r)*100}%`,width:`${100/G.length}%`},transition:{type:"spring",stiffness:400,damping:30},style:{left:"4px",right:"4px"}}),G.map(t=>{const a=t.icon,s=r===t.id;return e.jsxs(v.button,{onClick:()=>i(t.id),whileTap:{scale:.97},className:`relative flex-1 flex items-center justify-center gap-1.5 py-2.5 px-2 rounded-lg text-sm font-medium transition-colors z-10 min-h-[44px] ${s?"text-foreground":"text-muted-foreground"}`,"aria-pressed":s,"aria-label":t.label,children:[e.jsx(a,{className:`w-4 h-4 ${s?"text-primary":""}`}),e.jsx("span",{className:"hidden xs:inline",children:t.label}),e.jsx("span",{className:"xs:hidden",children:t.label.split(" ")[0]})]},t.id)})]})})}const ee=Fe,te=Re,U=u.forwardRef(({className:r,children:i,...t},a)=>e.jsxs(he,{ref:a,className:z("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",r),...t,children:[i,e.jsx(Le,{asChild:!0,children:e.jsx(se,{className:"h-4 w-4 opacity-50"})})]}));U.displayName=he.displayName;const ke=u.forwardRef(({className:r,...i},t)=>e.jsx(pe,{ref:t,className:z("flex cursor-default items-center justify-center py-1",r),...i,children:e.jsx(at,{className:"h-4 w-4"})}));ke.displayName=pe.displayName;const Ee=u.forwardRef(({className:r,...i},t)=>e.jsx(ge,{ref:t,className:z("flex cursor-default items-center justify-center py-1",r),...i,children:e.jsx(se,{className:"h-4 w-4"})}));Ee.displayName=ge.displayName;const q=u.forwardRef(({className:r,children:i,position:t="popper",...a},s)=>e.jsx(_e,{children:e.jsxs(fe,{ref:s,className:z("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",t==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",r),position:t,...a,children:[e.jsx(ke,{}),e.jsx(De,{className:z("p-1",t==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:i}),e.jsx(Ee,{})]})}));q.displayName=fe.displayName;const Wt=u.forwardRef(({className:r,...i},t)=>e.jsx(be,{ref:t,className:z("py-1.5 pl-8 pr-2 text-sm font-semibold",r),...i}));Wt.displayName=be.displayName;const _=u.forwardRef(({className:r,children:i,...t},a)=>e.jsxs(xe,{ref:a,className:z("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 focus:bg-accent focus:text-accent-foreground",r),...t,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(Be,{children:e.jsx(Se,{className:"h-4 w-4"})})}),e.jsx($e,{children:i})]}));_.displayName=xe.displayName;const Vt=u.forwardRef(({className:r,...i},t)=>e.jsx(ve,{ref:t,className:z("-mx-1 my-1 h-px bg-muted",r),...i}));Vt.displayName=ve.displayName;const ue=[{value:"reclamacao",label:"Reclama√ß√£o",color:"bg-red-100 text-red-700 border-red-200"},{value:"sugestao",label:"Sugest√£o",color:"bg-blue-100 text-blue-700 border-blue-200"},{value:"duvida",label:"D√∫vida",color:"bg-purple-100 text-purple-700 border-purple-200"},{value:"alerta",label:"Alerta",color:"bg-orange-100 text-orange-700 border-orange-200"},{value:"elogio",label:"Elogio",color:"bg-green-100 text-green-700 border-green-200"},{value:"outros",label:"Outros",color:"bg-gray-100 text-gray-700 border-gray-200"}],Ht=[{value:"hoje",label:"Hoje"},{value:"7dias",label:"7 dias"},{value:"30dias",label:"30 dias"},{value:"todos",label:"Todos"}];function Ut({filters:r,onChange:i,userBairroId:t}){const[a,s]=u.useState(!1),n=Object.values(r).filter(Boolean).length,l=(c,f)=>{i({...r,[c]:f})},o=c=>{const f={...r};delete f[c],i(f)},m=()=>{i({})};return e.jsxs("div",{className:"px-4 pb-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsxs(v.button,{onClick:()=>s(!a),whileTap:{scale:.95},className:`flex items-center gap-1.5 px-3 py-2 rounded-full text-sm font-medium transition-colors min-h-[44px] ${a||n>0?"bg-primary/10 text-primary":"bg-muted text-muted-foreground"}`,children:[e.jsx("span",{children:"Filtros"}),n>0&&e.jsx("span",{className:"bg-primary text-primary-foreground w-5 h-5 rounded-full text-xs flex items-center justify-center",children:n}),e.jsx(v.div,{animate:{rotate:a?180:0},transition:{duration:.2},children:e.jsx(se,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"flex-1 overflow-x-auto scrollbar-hide",children:e.jsxs("div",{className:"flex gap-1.5",children:[r.categoria&&e.jsx(Y,{label:ue.find(c=>c.value===r.categoria)?.label||"",onRemove:()=>o("categoria")}),r.comFoto&&e.jsx(Y,{label:"Com foto",icon:e.jsx(Z,{className:"w-3 h-3"}),onRemove:()=>o("comFoto")}),r.meuBairro&&e.jsx(Y,{label:"Meu bairro",icon:e.jsx(D,{className:"w-3 h-3"}),onRemove:()=>o("meuBairro")})]})}),n>0&&e.jsx("button",{onClick:m,className:"text-xs text-muted-foreground hover:text-foreground transition-colors whitespace-nowrap",children:"Limpar"})]}),e.jsx(J,{children:a&&e.jsx(v.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.2},className:"overflow-hidden",children:e.jsxs("div",{className:"space-y-3 py-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-muted-foreground mb-1.5 block",children:"Categoria"}),e.jsx("div",{className:"flex flex-wrap gap-1.5",children:ue.map(c=>e.jsx(v.button,{whileTap:{scale:.95},onClick:()=>l("categoria",r.categoria===c.value?void 0:c.value),className:`px-3 py-1.5 rounded-full text-sm font-medium border transition-all min-h-[36px] ${r.categoria===c.value?`${c.color} border-current`:"bg-background border-border text-muted-foreground hover:border-foreground/30"}`,children:c.label},c.value))})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"text-xs font-medium text-muted-foreground mb-1.5 block",children:"Bairro"}),e.jsxs(ee,{value:r.bairroId||"__all__",onValueChange:c=>l("bairroId",c==="__all__"?void 0:c),children:[e.jsx(U,{className:"h-11 rounded-xl",children:e.jsx(te,{placeholder:"Todos"})}),e.jsxs(q,{children:[e.jsx(_,{value:"__all__",children:"Todos"}),ae.map(c=>e.jsx(_,{value:c.id,children:c.nome},c.id))]})]})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"text-xs font-medium text-muted-foreground mb-1.5 block",children:"Per√≠odo"}),e.jsxs(ee,{value:r.periodo||"__all__",onValueChange:c=>l("periodo",c==="__all__"?void 0:c),children:[e.jsx(U,{className:"h-11 rounded-xl",children:e.jsx(te,{placeholder:"Todos"})}),e.jsxs(q,{children:[e.jsx(_,{value:"__all__",children:"Todos"}),Ht.map(c=>e.jsx(_,{value:c.value,children:c.label},c.value))]})]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(me,{label:"S√≥ com foto",icon:e.jsx(Z,{className:"w-4 h-4"}),active:!!r.comFoto,onClick:()=>l("comFoto",!r.comFoto)}),t&&e.jsx(me,{label:"Meu bairro",icon:e.jsx(D,{className:"w-4 h-4"}),active:!!r.meuBairro,onClick:()=>l("meuBairro",!r.meuBairro)})]})]})})})]})}function Y({label:r,icon:i,onRemove:t}){return e.jsxs(v.span,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.8},className:"inline-flex items-center gap-1 px-2 py-1 rounded-full bg-primary/10 text-primary text-xs font-medium",children:[i,r,e.jsx("button",{onClick:t,className:"ml-0.5 p-0.5 rounded-full hover:bg-primary/20 transition-colors","aria-label":`Remover filtro ${r}`,children:e.jsx(V,{className:"w-3 h-3"})})]})}function me({label:r,icon:i,active:t,onClick:a}){return e.jsxs(v.button,{whileTap:{scale:.95},onClick:a,className:`flex items-center gap-2 px-3 py-2 rounded-full text-sm font-medium transition-all min-h-[44px] ${t?"bg-primary text-primary-foreground":"bg-muted text-muted-foreground hover:bg-muted-foreground/10"}`,children:[i,r]})}const qt={reclamacao:{label:"Reclama√ß√£o",color:"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400"},sugestao:{label:"Sugest√£o",color:"bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400"},duvida:{label:"D√∫vida",color:"bg-purple-100 text-purple-700 dark:bg-purple-900/30 dark:text-purple-400"},alerta:{label:"Alerta",color:"bg-orange-100 text-orange-700 dark:bg-orange-900/30 dark:text-orange-400"},elogio:{label:"Elogio",color:"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400"},outros:{label:"Outros",color:"bg-gray-100 text-gray-700 dark:bg-gray-800 dark:text-gray-400"}},Qt=u.memo(function({topic:i,onPress:t,onLike:a,onComment:s,onShare:n,onMore:l}){const o=qt[i.categoria],m=ae.find(b=>b.id===i.bairroId)?.nome||"Tijucas",c=Ze(i.createdAt),f=et(i.createdAt),j=b=>{b.stopPropagation(),navigator.vibrate&&navigator.vibrate(10),a?.()},h=b=>{b.stopPropagation(),s?.()},y=b=>{b.stopPropagation(),n?.()},w=b=>{b.stopPropagation(),l?.()};return e.jsxs(v.article,{layout:!0,initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,scale:.95},whileTap:{scale:.99},onClick:t,className:"bg-card rounded-2xl p-4 shadow-sm border border-border/50 cursor-pointer active:bg-muted/50 transition-colors",role:"article","aria-label":`${i.titulo} - ${o.label} em ${m}`,children:[e.jsxs("div",{className:"flex items-center justify-between gap-2 mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap min-w-0",children:[e.jsx(rt,{variant:"secondary",className:`${o.color} border-0 font-medium text-xs px-2 py-0.5`,children:o.label}),e.jsxs("span",{className:"text-xs text-muted-foreground flex items-center gap-1 truncate",children:[e.jsx(D,{className:"w-3 h-3 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:m})]})]}),e.jsx("time",{dateTime:new Date(i.createdAt).toISOString(),title:f,className:"text-xs text-muted-foreground whitespace-nowrap",children:c})]}),e.jsx("h3",{className:"font-semibold text-foreground text-base leading-snug line-clamp-2 mb-1",children:i.titulo}),e.jsx("p",{className:"text-sm text-muted-foreground leading-relaxed line-clamp-2 mb-3",children:i.texto}),i.fotoUrl&&e.jsxs("div",{className:"relative mb-3 rounded-xl overflow-hidden bg-muted aspect-video",children:[e.jsx("img",{src:i.fotoUrl,alt:"",loading:"lazy",className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/20 to-transparent"})]}),e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("div",{className:"w-6 h-6 rounded-full bg-muted flex items-center justify-center text-xs font-medium text-muted-foreground",children:i.isAnon?"?":i.autorNome?.[0]||"U"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:i.isAnon?"An√¥nimo":i.autorNome})]}),e.jsxs("div",{className:"flex items-center justify-between pt-2 border-t border-border/50",children:[e.jsxs(v.button,{whileTap:{scale:.9},onClick:j,className:"flex items-center gap-1.5 py-2 px-3 -ml-3 rounded-lg hover:bg-muted/50 transition-colors min-h-[44px]","aria-label":i.liked?"Remover curtida":"Curtir","aria-pressed":i.liked,children:[e.jsx(v.div,{animate:i.liked?{scale:[1,1.3,1]}:{},transition:{duration:.3},children:e.jsx(it,{className:`w-5 h-5 ${i.liked?"fill-red-500 text-red-500":"text-muted-foreground"}`})}),e.jsx("span",{className:`text-sm font-medium ${i.liked?"text-red-500":"text-muted-foreground"}`,children:i.likesCount>0?i.likesCount:"Curtir"})]}),e.jsxs(v.button,{whileTap:{scale:.9},onClick:h,className:"flex items-center gap-1.5 py-2 px-3 rounded-lg hover:bg-muted/50 transition-colors min-h-[44px]","aria-label":`${i.commentsCount} coment√°rios`,children:[e.jsx(nt,{className:"w-5 h-5 text-muted-foreground"}),e.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:i.commentsCount>0?i.commentsCount:"Comentar"})]}),e.jsx(v.button,{whileTap:{scale:.9},onClick:y,className:"flex items-center gap-1.5 py-2 px-3 rounded-lg hover:bg-muted/50 transition-colors min-h-[44px]","aria-label":"Compartilhar",children:e.jsx(ot,{className:"w-5 h-5 text-muted-foreground"})}),e.jsx(v.button,{whileTap:{scale:.9},onClick:w,className:"flex items-center justify-center p-2 rounded-lg hover:bg-muted/50 transition-colors min-h-[44px] min-w-[44px]","aria-label":"Mais op√ß√µes",children:e.jsx(Pe,{className:"w-5 h-5 text-muted-foreground"})})]})]})});function Kt(){return e.jsxs(v.div,{initial:{opacity:0},animate:{opacity:1},className:"bg-card rounded-2xl p-4 shadow-sm border border-border/50",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2 mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-5 w-20 bg-muted rounded-full animate-pulse"}),e.jsx("div",{className:"h-4 w-24 bg-muted rounded animate-pulse"})]}),e.jsx("div",{className:"h-4 w-12 bg-muted rounded animate-pulse"})]}),e.jsx("div",{className:"h-5 w-3/4 bg-muted rounded animate-pulse mb-2"}),e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsx("div",{className:"h-4 w-full bg-muted rounded animate-pulse"}),e.jsx("div",{className:"h-4 w-2/3 bg-muted rounded animate-pulse"})]}),e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("div",{className:"w-6 h-6 rounded-full bg-muted animate-pulse"}),e.jsx("div",{className:"h-3 w-16 bg-muted rounded animate-pulse"})]}),e.jsxs("div",{className:"flex items-center gap-6 pt-3 border-t border-border/50",children:[e.jsx("div",{className:"h-5 w-14 bg-muted rounded animate-pulse"}),e.jsx("div",{className:"h-5 w-14 bg-muted rounded animate-pulse"}),e.jsx("div",{className:"h-5 w-8 bg-muted rounded animate-pulse"})]})]})}function Xt({count:r=3}){return e.jsx("div",{className:"space-y-3",children:Array.from({length:r}).map((i,t)=>e.jsx(Kt,{},t))})}const Gt={empty:{icon:Ct,title:"Nenhum t√≥pico ainda",description:"Seja o primeiro a abrir um assunto na comunidade!",actionLabel:"Criar t√≥pico",iconColor:"text-primary"},"no-results":{icon:Ne,title:"Sem resultados",description:"Tente outro termo ou remova alguns filtros.",actionLabel:"Limpar filtros",iconColor:"text-muted-foreground"},offline:{icon:We,title:"Voc√™ est√° offline",description:"Mostrando t√≥picos salvos. Conecte-se para ver novidades.",actionLabel:"Tentar novamente",iconColor:"text-orange-500"},error:{icon:L,title:"Algo deu errado",description:"N√£o foi poss√≠vel carregar os t√≥picos. Tente novamente.",actionLabel:"Tentar novamente",iconColor:"text-red-500"}};function Yt({type:r,onAction:i,onClearFilters:t}){const a=Gt[r],s=a.icon,n=()=>{r==="no-results"&&t?t():i?.()};return e.jsxs(v.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"flex flex-col items-center justify-center py-16 px-6 text-center",children:[e.jsx(v.div,{initial:{scale:.8},animate:{scale:1},transition:{delay:.1,type:"spring",stiffness:200},className:`w-16 h-16 rounded-full bg-muted flex items-center justify-center mb-4 ${a.iconColor}`,children:e.jsx(s,{className:"w-8 h-8"})}),e.jsx("h3",{className:"text-lg font-semibold text-foreground mb-2",children:a.title}),e.jsx("p",{className:"text-sm text-muted-foreground mb-6 max-w-[260px]",children:a.description}),i&&e.jsxs(H,{onClick:n,variant:r==="empty"?"default":"outline",className:"min-h-[44px] px-6 rounded-full",children:[r==="error"||r==="offline"?e.jsx(ye,{className:"w-4 h-4 mr-2"}):null,a.actionLabel]})]})}const Jt=[{value:"reclamacao",label:"Reclama√ß√£o",icon:e.jsx(Ve,{className:"w-4 h-4"}),color:"bg-red-100 text-red-700 border-red-200"},{value:"sugestao",label:"Sugest√£o",icon:e.jsx(jt,{className:"w-4 h-4"}),color:"bg-blue-100 text-blue-700 border-blue-200"},{value:"duvida",label:"D√∫vida",icon:e.jsx(yt,{className:"w-4 h-4"}),color:"bg-purple-100 text-purple-700 border-purple-200"},{value:"alerta",label:"Alerta",icon:e.jsx(wt,{className:"w-4 h-4"}),color:"bg-orange-100 text-orange-700 border-orange-200"},{value:"elogio",label:"Elogio",icon:e.jsx(Nt,{className:"w-4 h-4"}),color:"bg-green-100 text-green-700 border-green-200"},{value:"outros",label:"Outros",icon:e.jsx(kt,{className:"w-4 h-4"}),color:"bg-gray-100 text-gray-700 border-gray-200"}];function Zt({open:r,onOpenChange:i,onSubmit:t,defaultBairroId:a}){const[s,n]=u.useState(null),[l,o]=u.useState(""),[m,c]=u.useState(""),[f,j]=u.useState(a||""),[h,y]=u.useState(!1),[w,b]=u.useState(null),[g,k]=u.useState(null),[S,I]=u.useState(!1),[T,A]=u.useState("idle"),[E,O]=u.useState({}),M=u.useRef(null),{uploadAsync:B}=xt(),$=()=>{const p={};return s||(p.categoria="Escolha um tipo: Reclama√ß√£o, Sugest√£o‚Ä¶"),l.trim()?l.length<5&&(p.titulo="O t√≠tulo precisa ter pelo menos 5 caracteres"):p.titulo="D√™ um t√≠tulo curto pro pessoal entender r√°pido",m.trim()||(p.texto="Conte mais detalhes sobre o assunto"),f||(p.bairroId="Selecione o bairro"),O(p),Object.keys(p).length===0},P=async()=>{if(!(!$()||!s)){I(!0),A("idle");try{let p;if(g)try{p=(await B(g)).url}catch(N){const F=N instanceof Error?N.message:"Erro no upload";He.error(`Falha no upload da imagem: ${F}`),I(!1);return}await t({titulo:l.trim(),texto:m.trim(),categoria:s,bairroId:f,isAnon:h,fotoUrl:p}),navigator.vibrate&&navigator.vibrate([30,50,30]),A("success"),setTimeout(()=>{Q(),i(!1)},800)}catch{A("error")}finally{I(!1)}}},Q=()=>{n(null),o(""),c(""),j(a||""),y(!1),b(null),k(null),O({}),A("idle")},K=p=>{const N=p.target.files?.[0];if(N){k(N);const F=new FileReader;F.onload=()=>{b(F.result)},F.readAsDataURL(N)}},W=()=>{b(null),k(null),M.current&&(M.current.value="")};return e.jsx(lt,{open:r,onOpenChange:i,children:e.jsxs(ct,{side:"bottom",className:"rounded-t-3xl h-[85vh] flex flex-col p-0 overflow-hidden",children:[e.jsx(dt,{className:"px-4 py-4 border-b flex-shrink-0",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(ut,{className:"text-lg font-semibold",children:"Novo t√≥pico"}),e.jsx("button",{onClick:()=>i(!1),className:"p-2 -mr-2 rounded-full hover:bg-muted transition-colors min-h-[44px] min-w-[44px] flex items-center justify-center","aria-label":"Fechar",children:e.jsx(V,{className:"w-5 h-5"})})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto px-4 py-4 space-y-5",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-foreground mb-2 block",children:"O que voc√™ quer compartilhar?"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:Jt.map(p=>e.jsxs(v.button,{whileTap:{scale:.95},onClick:()=>{n(p.value),O(N=>({...N,categoria:""}))},className:`flex items-center gap-1.5 px-4 py-2.5 rounded-full text-sm font-medium border transition-all min-h-[44px] ${s===p.value?`${p.color} border-current shadow-sm`:"bg-background border-border text-muted-foreground hover:border-foreground/30"}`,children:[p.icon,e.jsx("span",{children:p.label})]},p.value))}),E.categoria&&e.jsxs("p",{className:"text-xs text-red-500 mt-2 flex items-center gap-1",children:[e.jsx(L,{className:"w-3 h-3"}),E.categoria]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-foreground mb-2 block",children:"T√≠tulo"}),e.jsx(we,{value:l,onChange:p=>{o(p.target.value),O(N=>({...N,titulo:""}))},placeholder:"Ex: Buraco na Rua X perto do mercado",className:`h-12 rounded-xl text-base ${E.titulo?"border-red-500":""}`,maxLength:100}),E.titulo&&e.jsxs("p",{className:"text-xs text-red-500 mt-1.5 flex items-center gap-1",children:[e.jsx(L,{className:"w-3 h-3"}),E.titulo]}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1 text-right",children:[l.length,"/100"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-foreground mb-2 block",children:"Conte mais detalhes"}),e.jsx(mt,{value:m,onChange:p=>{c(p.target.value),O(N=>({...N,texto:""}))},placeholder:"Diga onde √© e o que est√° acontecendo‚Ä¶",className:`min-h-[120px] rounded-xl resize-none text-base ${E.texto?"border-red-500":""}`,maxLength:500}),E.texto&&e.jsxs("p",{className:"text-xs text-red-500 mt-1.5 flex items-center gap-1",children:[e.jsx(L,{className:"w-3 h-3"}),E.texto]}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1 text-right",children:[m.length,"/500"]})]}),e.jsx(J,{children:w&&e.jsxs(v.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"relative",children:[e.jsx("img",{src:w,alt:"Preview",className:"w-full h-40 object-cover rounded-xl"}),e.jsx("button",{onClick:W,className:"absolute top-2 right-2 p-2 bg-black/50 rounded-full text-white hover:bg-black/70 transition-colors","aria-label":"Remover imagem",children:e.jsx(V,{className:"w-4 h-4"})})]})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(v.button,{whileTap:{scale:.95},onClick:()=>{M.current&&(M.current.accept="image/*",M.current.capture="environment",M.current.click())},className:"flex items-center gap-2 px-4 py-2.5 rounded-xl bg-muted text-muted-foreground hover:bg-muted-foreground/10 transition-colors min-h-[44px]",children:[e.jsx(pt,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm font-medium",children:"C√¢mera"})]}),e.jsxs(v.button,{whileTap:{scale:.95},onClick:()=>{M.current&&(M.current.accept="image/*",M.current.removeAttribute("capture"),M.current.click())},className:"flex items-center gap-2 px-4 py-2.5 rounded-xl bg-muted text-muted-foreground hover:bg-muted-foreground/10 transition-colors min-h-[44px]",children:[e.jsx(Z,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm font-medium",children:"Galeria"})]}),e.jsx("input",{ref:M,type:"file",accept:"image/*",onChange:K,className:"hidden"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-sm font-medium text-foreground mb-2 block",children:[e.jsx(D,{className:"w-4 h-4 inline mr-1"}),"Bairro"]}),e.jsxs(ee,{value:f,onValueChange:p=>{j(p),O(N=>({...N,bairroId:""}))},children:[e.jsx(U,{className:`h-12 rounded-xl ${E.bairroId?"border-red-500":""}`,children:e.jsx(te,{placeholder:"Selecione o bairro"})}),e.jsx(q,{children:ae.map(p=>e.jsx(_,{value:p.id,children:p.nome},p.id))})]}),E.bairroId&&e.jsxs("p",{className:"text-xs text-red-500 mt-1.5 flex items-center gap-1",children:[e.jsx(L,{className:"w-3 h-3"}),E.bairroId]})]}),e.jsxs("div",{className:"flex items-center justify-between py-3 px-4 bg-muted/50 rounded-xl",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[h?e.jsx(gt,{className:"w-5 h-5 text-muted-foreground"}):e.jsx(bt,{className:"w-5 h-5 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-foreground",children:"Postar anonimamente"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Seu nome n√£o aparecer√° no post"})]})]}),e.jsx(ft,{checked:h,onCheckedChange:y})]})]}),e.jsx("div",{className:"px-4 py-4 border-t bg-background safe-bottom flex-shrink-0",children:e.jsx(H,{onClick:P,disabled:S,className:"w-full h-14 rounded-2xl text-base font-semibold",children:e.jsx(J,{mode:"wait",children:S?e.jsxs(v.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"flex items-center gap-2",children:[e.jsx(vt,{className:"w-5 h-5 animate-spin"}),e.jsx("span",{children:"Publicando..."})]},"loading"):T==="success"?e.jsxs(v.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},className:"flex items-center gap-2 text-green-500",children:[e.jsx(Se,{className:"w-5 h-5"}),e.jsx("span",{children:"Publicado!"})]},"success"):T==="error"?e.jsxs(v.div,{initial:{opacity:0},animate:{opacity:1},className:"flex items-center gap-2",children:[e.jsx(L,{className:"w-5 h-5"}),e.jsx("span",{children:"Tentar novamente"})]},"error"):e.jsxs(v.div,{initial:{opacity:0},animate:{opacity:1},className:"flex items-center gap-2",children:[e.jsx(ht,{className:"w-5 h-5"}),e.jsx("span",{children:"Publicar"})]},"idle")})})})]})})}function $s({scrollRef:r}){const{selectedBairro:i}=Ue(),{isAuthenticated:t}=Xe(),{isOnline:a}=qe(),{toast:s}=Qe(),[n,l]=Ke(),{data:o=[],isLoading:m,refetch:c}=Ge(),f=Ye(),j=Je(),[h,y]=u.useState("curtidos"),[w,b]=u.useState(""),[g,k]=u.useState({}),[S,I]=u.useState(!1),[T,A]=u.useState(!1),[E,O]=u.useState(!1);u.useEffect(()=>{n.get("novo")==="true"&&(I(!0),n.delete("novo"),l(n,{replace:!0}))},[n,l]);const[M,B]=u.useState(10),[$,P]=u.useState(!1),Q=u.useRef(null),K=u.useRef(null);u.useEffect(()=>{const d=Q.current;if(!d)return;const x=new IntersectionObserver(C=>{C[0].isIntersecting&&!$&&(P(!0),setTimeout(()=>{B(X=>X+10),P(!1)},300))},{rootMargin:"200px"});return x.observe(d),()=>x.disconnect()},[$]),u.useEffect(()=>{B(10)},[w,g,h]);const W=u.useMemo(()=>{let d=[...o];if(w.trim()){const x=w.toLowerCase();d=d.filter(C=>C.titulo.toLowerCase().includes(x)||C.texto.toLowerCase().includes(x))}if(g.categoria&&(d=d.filter(x=>x.categoria===g.categoria)),g.bairroId&&(d=d.filter(x=>x.bairroId===g.bairroId)),g.meuBairro&&i&&(d=d.filter(x=>x.bairroId===i.id)),g.comFoto&&(d=d.filter(x=>x.fotoUrl)),g.periodo){const x=new Date;switch(g.periodo){case"hoje":x.setHours(0,0,0,0);break;case"7dias":x.setDate(x.getDate()-7);break;case"30dias":x.setDate(x.getDate()-30);break}g.periodo!=="todos"&&(d=d.filter(C=>new Date(C.createdAt)>=x))}switch(h){case"curtidos":d.sort((x,C)=>{const X=ie(x.likesCount,x.commentsCount,x.createdAt);return ie(C.likesCount,C.commentsCount,C.createdAt)-X});break;case"recentes":d.sort((x,C)=>new Date(C.createdAt).getTime()-new Date(x.createdAt).getTime());break;case"perto":d=d.filter(x=>x.bairroId===i?.id).sort((x,C)=>new Date(C.createdAt).getTime()-new Date(x.createdAt).getTime());break}return d},[o,w,g,h,i]),p=u.useCallback(d=>t?!0:(s({title:"Login necess√°rio",description:`Para ${d}, voc√™ precisa estar logado.`,action:e.jsx(H,{variant:"outline",size:"sm",onClick:()=>window.location.href="/login",children:"Entrar"})}),!1),[t,s]),N=u.useCallback(d=>{if(!p("curtir"))return;const x=o.find(C=>C.id===d);x&&f.mutate({id:d,currentlyLiked:x.liked??!1})},[o,f,p]),F=u.useCallback(async d=>{const x={title:d.titulo,text:d.texto,url:`${window.location.origin}/topico/${d.id}`};if(navigator.share)try{await navigator.share(x)}catch{}else await navigator.clipboard.writeText(x.url),s({title:"Link copiado!",description:"O link foi copiado para a √°rea de transfer√™ncia."})},[s]),Ie=u.useCallback(d=>{window.location.href=`/topico/${d}`},[]),Te=u.useCallback(d=>{p("comentar")&&(window.location.href=`/topico/${d}?comment=true`)},[p]),Me=u.useCallback(async d=>{try{await j.mutateAsync({categoria:d.categoria,titulo:d.titulo,texto:d.texto,isAnon:d.isAnon,bairroId:d.bairroId,fotoUrl:d.fotoUrl}),s({title:"T√≥pico publicado! üéâ",description:a?"Seu t√≥pico foi publicado na comunidade.":"Seu t√≥pico ser√° publicado quando voltar online."})}catch{s({title:"Erro ao publicar",description:"Tente novamente.",variant:"destructive"})}},[j,s,a]);u.useCallback(async()=>{O(!0),await c(),O(!1),s({title:"Atualizado!",description:"O feed foi atualizado."})},[c,s]);const re=u.useCallback(()=>{k({}),b("")},[]),ze=()=>!a&&o.length===0?"offline":w||Object.keys(g).length>0?"no-results":"empty",Oe=w||Object.keys(g).length>0;return e.jsxs("div",{ref:d=>{r?.(d),K.current=d},className:"h-full overflow-y-auto bg-background",children:[e.jsx($t,{onSearch:b,onSearchFocus:()=>{}}),e.jsx(Pt,{value:h,onChange:y}),e.jsx(Ut,{filters:g,onChange:k,userBairroId:i?.id}),!a&&e.jsxs(v.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"mx-4 mb-3 px-4 py-2 bg-orange-100 dark:bg-orange-900/30 rounded-xl flex items-center gap-2 text-sm text-orange-700 dark:text-orange-400",children:[e.jsx("span",{children:"üì°"}),e.jsx("span",{children:"Voc√™ est√° offline. Mostrando t√≥picos salvos."})]}),E&&e.jsx(v.div,{initial:{opacity:0},animate:{opacity:1},className:"flex justify-center py-2",children:e.jsx(ye,{className:"w-5 h-5 animate-spin text-primary"})}),e.jsx("div",{className:"flex-1 px-4 pb-32",children:T||m?e.jsx(Xt,{count:3}):W.length>0?e.jsx(Bt,{items:W,estimatedItemSize:180,overscan:3,gap:12,className:"h-full",getItemKey:d=>d.id,renderItem:d=>e.jsx(Qt,{topic:d,onPress:()=>Ie(d.id),onLike:()=>N(d.id),onComment:()=>Te(d.id),onShare:()=>F(d)})}):e.jsx(Yt,{type:ze(),onAction:Oe?re:()=>I(!0),onClearFilters:re})}),e.jsx(v.div,{initial:{scale:0,opacity:0},animate:{scale:1,opacity:1},transition:{type:"spring",stiffness:400,damping:15,delay:.3},className:"fixed bottom-24 right-4 z-30",children:e.jsx(v.div,{whileHover:{scale:1.05},whileTap:{scale:.95},children:e.jsx(H,{onClick:()=>{p("criar um t√≥pico")&&I(!0)},size:"lg",className:"w-14 h-14 rounded-full shadow-lg bg-primary text-primary-foreground hover:bg-primary/90","aria-label":"Criar novo t√≥pico",children:e.jsx(St,{className:"w-6 h-6"})})})}),e.jsx(Zt,{open:S,onOpenChange:I,onSubmit:Me,defaultBairroId:i?.id})]})}export{$s as default};
