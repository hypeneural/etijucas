import{r as A,f as _}from"./index-C4Iad8d5.js";const C="/api/v1",m={baseURL:C,timeout:1e4,retryAttempts:3,retryDelay:1e3},E={auth:{login:"/auth/login",sendOtp:"/auth/send-otp",resendOtp:"/auth/resend-otp",verifyOtp:"/auth/verify-otp",register:"/auth/register",forgotPassword:"/auth/forgot-password",resetPassword:"/auth/reset-password",refresh:"/auth/refresh",logout:"/auth/logout",me:"/auth/me"},users:{me:"/users/me",update:"/users/me",avatar:"/users/me/avatar",password:"/users/me/password",notifications:"/users/me/notifications"},reports:{categories:"/report-categories",create:"/reports",list:"/reports",stats:"/reports/stats",myReports:"/reports/me",get:e=>`/reports/${e}`,addMedia:e=>`/reports/${e}/media`,removeMedia:(e,t)=>`/reports/${e}/media/${t}`,updateStatus:e=>`/reports/${e}/status`,adminList:"/admin/reports"},geocode:{autocomplete:"/geocode/autocomplete",reverse:"/geocode/reverse"},forum:{topics:"/forum/topics",topic:e=>`/forum/topics/${e}`,createTopic:"/forum/topics",updateTopic:e=>`/forum/topics/${e}`,deleteTopic:e=>`/forum/topics/${e}`,likeTopic:e=>`/forum/topics/${e}/like`,saveTopic:e=>`/forum/topics/${e}/save`,reportTopic:e=>`/forum/topics/${e}/report`,savedTopics:"/forum/saved",comments:e=>`/forum/topics/${e}/comments`,deleteComment:(e,t)=>`/forum/topics/${e}/comments/${t}`,likeComment:e=>`/forum/comments/${e}/like`,reportComment:e=>`/forum/comments/${e}/report`,upload:"/forum/upload"},topics:{list:"/forum/topics",get:e=>`/forum/topics/${e}`,create:"/forum/topics",update:e=>`/forum/topics/${e}`,delete:e=>`/forum/topics/${e}`,like:e=>`/forum/topics/${e}/like`,unlike:e=>`/forum/topics/${e}/like`,comments:e=>`/forum/topics/${e}/comments`},events:{list:"/events",get:e=>`/events/${e}`,upcoming:"/events/upcoming",today:"/events/today",weekend:"/events/weekend",featured:"/events/featured",search:"/events/search",homeFeatured:"/events/home-featured",calendarSummary:"/events/calendar-summary",byDate:e=>`/events/date/${e}`,byMonth:(e,t)=>`/events/month/${e}/${t}`,byCategory:e=>`/events/category/${e}`,byBairro:e=>`/events/bairro/${e}`,byVenue:e=>`/events/venue/${e}`,byTag:e=>`/events/tag/${e}`,byOrganizer:e=>`/events/organizer/${e}`,categories:"/events/categories",tags:"/events/tags",tagsTrending:"/events/tags/trending",rsvp:e=>`/events/${e}/rsvp`,attendees:e=>`/events/${e}/attendees`,favorite:e=>`/events/${e}/favorite`,myEvents:"/users/me/events",myFavorites:"/users/me/favorites/events"},trash:{schedules:"/trash/schedules",byBairro:e=>`/trash/schedules/bairro/${e}`,today:"/trash/today",next:"/trash/next",types:"/trash/types"},masses:{list:"/masses",byBairro:e=>`/masses/bairro/${e}`,today:"/masses/today",tomorrow:"/masses/tomorrow"},phones:{list:"/phones",byCategory:e=>`/phones/category/${e}`,search:"/phones/search"},alerts:{list:"/alerts",get:e=>`/alerts/${e}`,active:"/alerts/active"},bairros:{list:"/bairros",get:e=>`/bairros/${e}`},tourism:{spots:"/tourism/spots",get:e=>`/tourism/spots/${e}`,categories:"/tourism/categories",like:e=>`/tourism/spots/${e}/like`,save:e=>`/tourism/spots/${e}/save`,reviews:e=>`/tourism/spots/${e}/reviews`,createReview:e=>`/tourism/spots/${e}/reviews`,deleteReview:e=>`/tourism/reviews/${e}`},uploads:{image:"/uploads/image",images:"/uploads/images"},votes:{vereadores:"/vereadores",vereador:e=>`/vereadores/${e}`,vereadorVotacoes:e=>`/vereadores/${e}/votacoes`,votacoes:"/votacoes",votacao:e=>`/votacoes/${e}`,votacoesStats:"/votacoes/stats",votacoesAnos:"/votacoes/anos",partidos:"/partidos",legislaturas:"/legislaturas"},vehicles:{lookup:"/vehicles/lookup",stats:"/vehicles/stats"},plates:{recognize:"/plates/recognize"}},P={reports:{all:["reports"],list:e=>["reports","list",e],mine:["reports","mine"],public:["reports","public"],stats:()=>["reports","stats"],detail:e=>["reports","detail",e],categories:["reports","categories"]},myReports:["reports","mine"],topics:{all:["topics"],list:e=>["topics","list",e],detail:e=>["topics","detail",e],comments:e=>["topics",e,"comments"]},tourism:{all:["tourism"],spots:e=>["tourism","spots",e],detail:e=>["tourism","detail",e],reviews:e=>["tourism",e,"reviews"],categories:["tourism","categories"]},votes:{all:["votes"],vereadores:e=>["votes","vereadores",e],vereador:e=>["votes","vereador",e],vereadorVotacoes:e=>["votes","vereador",e,"votacoes"],votacoes:e=>["votes","votacoes",e],votacao:e=>["votes","votacao",e],stats:["votes","stats"],anos:["votes","anos"],partidos:["votes","partidos"],legislaturas:["votes","legislaturas"]}},F=Object.freeze(Object.defineProperty({__proto__:null,API_CONFIG:m,ENDPOINTS:E,QUERY_KEYS:P},Symbol.toStringTag,{value:"Module"})),y="etijucas_token",T="etijucas_refresh_token";let g=!1,f=null;function $(){return localStorage.getItem(y)}function j(){return localStorage.getItem(T)}function R(e,t){localStorage.setItem(y,e),localStorage.setItem(T,t)}function h(){localStorage.removeItem(y),localStorage.removeItem(T)}class c extends Error{constructor(t,s,r,a){super(t),this.status=s,this.code=r,this.errors=a,this.name="ApiError"}}const U=e=>new Promise(t=>setTimeout(t,e));function w(e,t){const s=m.baseURL.endsWith("/")?m.baseURL.slice(0,-1):m.baseURL,r=e.startsWith("/")?e:`/${e}`;let a=`${s}${r}`;if(t){const u=new URLSearchParams;Object.entries(t).forEach(([l,d])=>{d!=null&&u.append(l,String(d))});const n=u.toString();n&&(a+=(a.includes("?")?"&":"?")+n)}return a}function I(e){if(typeof navigator<"u"&&"connection"in navigator){const t=navigator.connection;if(t?.saveData||t?.effectiveType==="slow-2g"||t?.effectiveType==="2g")return 3e3;if(t?.effectiveType==="3g")return 5e3}return e}function b(){const e=A();return e?{"X-City":e}:{}}function k(e){const t=e.headers.get("X-Tenant-Key"),s=e.headers.get("X-Tenant-Timezone"),r=e.headers.get("X-Tenant-City");!t&&!s&&!r||_.getState().syncTransportContext({citySlug:r,tenantKey:t,tenantTimezone:s})}async function N(){if(g&&f)return f;const e=j();return e?(g=!0,f=(async()=>{try{const t=await fetch(w(E.auth.refresh,void 0),{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json",...b()},body:JSON.stringify({refreshToken:e})});if(k(t),!t.ok)return h(),null;const s=await t.json();return R(s.token,s.refreshToken),s.token}catch{return h(),null}finally{g=!1,f=null}})(),f):null}async function p(e,t={},s=1){if(typeof navigator<"u"&&!navigator.onLine)throw new c("Você está offline. Os dados serão sincronizados quando a conexão voltar.",0,"OFFLINE");const{params:r,timeout:a,...u}=t,n=a??I(m.timeout),l=w(e,r),d=new AbortController,S=setTimeout(()=>d.abort(),n);try{const o=$(),O={"Content-Type":"application/json",Accept:"application/json","X-App-Version":"1.0.0",...o&&{Authorization:`Bearer ${o}`},...b(),...u.headers},i=await fetch(l,{...u,signal:d.signal,headers:O});if(clearTimeout(S),k(i),i.status===401){if(!t._skipRefresh&&!g&&await N())return p(e,{...t,_skipRefresh:!0},s);throw h(),new c("Sessão expirada. Faça login novamente.",401,"UNAUTHENTICATED")}if(!i.ok){const v=await i.json().catch(()=>({}));throw new c(v.message||`HTTP ${i.status}: ${i.statusText}`,i.status,v.code,v.errors)}return i.status===204?{}:i.json()}catch(o){if(clearTimeout(S),o instanceof c&&o.status>=400&&o.status<500)throw o;if(s<m.retryAttempts)return await U(m.retryDelay*s),p(e,t,s+1);throw o instanceof Error&&o.name==="AbortError"?new c("Request timeout",408):o instanceof c?o:new c(o instanceof Error?o.message:"Network error",0)}}const z={get:(e,t)=>p(e,{method:"GET",params:t}),post:(e,t)=>p(e,{method:"POST",body:t?JSON.stringify(t):void 0}),put:(e,t)=>p(e,{method:"PUT",body:t?JSON.stringify(t):void 0}),patch:(e,t)=>p(e,{method:"PATCH",body:t?JSON.stringify(t):void 0}),postFormData:async(e,t,s)=>{const r=w(e),a=$(),u={Accept:"application/json","X-App-Version":"1.0.0",...a&&{Authorization:`Bearer ${a}`},...b(),...s?.headers||{}},n=await fetch(r,{method:"POST",headers:u,body:t});if(k(n),!n.ok){const l=await n.json().catch(()=>({}));throw new c(l.message||"Upload failed",n.status,l.code,l.errors)}return n.json()},delete:e=>p(e,{method:"DELETE"})},x=Object.freeze(Object.defineProperty({__proto__:null,ApiError:c,apiClient:z,clearAuthToken:h,getAuthToken:$,setTokens:R},Symbol.toStringTag,{value:"Module"}));export{m as A,E,P as Q,z as a,c as b,h as c,F as d,x as e,R as s};
