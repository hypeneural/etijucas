import{j as e,r as n}from"./vendor-radix-i3jPA7eY.js";import{B as p}from"./button-B1VXCcgu.js";import{b as q,c as C,X as Y,R as L,T as F,C as I,k as ne,f as oe,H as de,u as me,i as K}from"./index-Bh7TmgIu.js";import{M as E}from"./map-pin-DK-zj8ow.js";import{C as D}from"./camera-k3vq_jlQ.js";import{m as o,A as $}from"./vendor-motion-CFwwOuCD.js";import{C as xe}from"./check-Gu5gAyKM.js";import{C as y}from"./card-BEDvugie.js";import{I as O}from"./info-6Gs8pnKC.js";import{u as ue}from"./vendor-query-1wfeA5IL.js";import{r as Q,L as pe,a as he}from"./useMyReports-HZlTog2I.js";import{L as P}from"./loader-circle-C64V2WM_.js";import{C as ge}from"./circle-alert-CQFujaAp.js";import{C as W}from"./chevron-right-C_IureTA.js";import{L as fe}from"./lightbulb-CbVqo4QC.js";import{C as be}from"./circle-help-K3UbjGMm.js";import{I as se}from"./input-CwzrLyKZ.js";import{S as V}from"./search-B1ljKiO8.js";import{P as J}from"./pen-line-Cw27SEbO.js";import{N as X}from"./navigation-D4kdTXo9.js";import{B as je}from"./badge-DSPvnf2u.js";import{C as Ne}from"./checkbox-CwWy8p8l.js";import{T as ye,S as ve}from"./textarea-BNvj5yLp.js";import{F as ke}from"./file-text-BCANmNuJ.js";import{c as U,P as Z}from"./confetti.module-Bz-bFteH.js";import{S as we}from"./sparkles-8XNeMtKU.js";import{C as Ce}from"./copy-IpGXuuMF.js";import{S as Se}from"./share-2-y8bElEib.js";import{u as ze}from"./useAuthStore-Bizwf6F5.js";import{A as Me}from"./arrow-left-DhMGGVee.js";import"./vendor-utils-DycLLelI.js";import"./log-in-XcDw6ru0.js";import"./client-BoGyDRku.js";import"./localDatabase-DQvpZPSm.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const te=q("FileCheck",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"m9 15 2 2 4-4",key:"1grp1n"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ie=q("FileSearch",[["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M4.268 21a2 2 0 0 0 1.727 1H18a2 2 0 0 0 2-2V7l-5-5H6a2 2 0 0 0-2 2v3",key:"ms7g94"}],["path",{d:"m9 18-1.5-1.5",key:"1j6qii"}],["circle",{cx:"5",cy:"14",r:"3",key:"ufru5t"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qe=q("ImageOff",[["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}],["path",{d:"M10.41 10.41a2 2 0 1 1-2.83-2.83",key:"1bzlo9"}],["line",{x1:"13.5",x2:"6",y1:"13.5",y2:"21",key:"1q0aeu"}],["line",{x1:"18",x2:"21",y1:"12",y2:"15",key:"5mozeu"}],["path",{d:"M3.59 3.59A1.99 1.99 0 0 0 3 5v14a2 2 0 0 0 2 2h14c.55 0 1.052-.22 1.41-.59",key:"mmje98"}],["path",{d:"M21 15V5a2 2 0 0 0-2-2H9",key:"43el77"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Te=q("List",[["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M3 18h.01",key:"1tta3j"}],["path",{d:"M3 6h.01",key:"1rqtza"}],["path",{d:"M8 12h13",key:"1za7za"}],["path",{d:"M8 18h13",key:"1lx6n3"}],["path",{d:"M8 6h13",key:"ik3vkj"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G=q("Pen",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const re=q("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ee=q("ShieldAlert",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M12 16h.01",key:"1drbdi"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ae=q("SwitchCamera",[["path",{d:"M11 19H4a2 2 0 0 1-2-2V7a2 2 0 0 1 2-2h5",key:"mtk2lu"}],["path",{d:"M13 5h7a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2h-5",key:"120jsl"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}],["path",{d:"m18 22-3-3 3-3",key:"kgdoj7"}],["path",{d:"m6 2 3 3-3 3",key:"1fnbkv"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ee=q("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]),Re=[{icon:Te,label:"Categoria"},{icon:E,label:"Localização"},{icon:D,label:"Fotos"},{icon:Ie,label:"Revisão"}];function De({currentStep:a,totalSteps:u,labels:s}){return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between",children:Re.slice(0,u).map((b,l)=>{const h=l+1,i=h<a,t=h===a,N=b.icon;return e.jsxs("div",{className:"flex flex-col items-center flex-1",children:[l>0&&e.jsx("div",{className:C("absolute h-0.5 -translate-y-4",i||t?"bg-primary":"bg-muted"),style:{width:`calc(100% / ${u} - 2rem)`,left:`calc((100% / ${u}) * ${l} + 1rem)`}}),e.jsx(o.div,{initial:{scale:.8},animate:{scale:t?1.1:1},className:C("relative z-10 h-10 w-10 rounded-full flex items-center justify-center transition-all",i&&"bg-primary text-primary-foreground",t&&"bg-primary text-primary-foreground ring-4 ring-primary/20",!i&&!t&&"bg-muted text-muted-foreground"),children:i?e.jsx(xe,{className:"h-5 w-5"}):e.jsx(N,{className:"h-5 w-5"})}),e.jsx("span",{className:C("text-xs mt-1.5 font-medium text-center",t&&"text-primary",i&&"text-foreground",!i&&!t&&"text-muted-foreground"),children:s?.[l]||b.label})]},h)})}),e.jsx("div",{className:"relative -mt-[3.2rem] mx-5 h-0.5 bg-muted rounded-full",children:e.jsx(o.div,{className:"h-full bg-primary rounded-full",initial:{width:0},animate:{width:`${(a-1)/(u-1)*100}%`},transition:{type:"spring",stiffness:300,damping:30}})}),e.jsx("div",{className:"h-4"}),e.jsxs("div",{className:"flex items-center justify-center gap-2 text-sm",children:[e.jsxs("span",{className:"font-semibold text-primary",children:["Etapa ",a]}),e.jsxs("span",{className:"text-muted-foreground",children:["de ",u]})]})]})}function Pe({title:a,content:u,className:s}){const[b,l]=n.useState(!1),h=Array.isArray(u)?u:[u];return e.jsxs("div",{className:C("inline-flex items-center gap-1",s),children:[e.jsx(o.button,{type:"button",whileTap:{scale:.9},onClick:()=>l(!0),className:"flex h-5 w-5 items-center justify-center rounded-full bg-muted hover:bg-muted/80 transition-colors","aria-label":`Ajuda sobre ${a}`,children:e.jsx(O,{className:"h-3 w-3 text-muted-foreground"})}),e.jsx($,{children:b&&e.jsxs(e.Fragment,{children:[e.jsx(o.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-50 bg-black/40",onClick:()=>l(!1)}),e.jsxs(o.div,{initial:{y:"100%"},animate:{y:0},exit:{y:"100%"},transition:{type:"spring",damping:25,stiffness:300},className:"fixed bottom-0 left-0 right-0 z-50 rounded-t-3xl bg-background p-6 safe-bottom",children:[e.jsx("div",{className:"absolute top-3 left-1/2 -translate-x-1/2 h-1 w-10 rounded-full bg-muted"}),e.jsxs("div",{className:"flex items-start justify-between mt-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-2 rounded-full bg-primary/10",children:e.jsx(O,{className:"h-4 w-4 text-primary"})}),e.jsx("h3",{className:"font-semibold text-lg",children:a})]}),e.jsx(p,{variant:"ghost",size:"icon",className:"h-8 w-8 rounded-full",onClick:()=>l(!1),children:e.jsx(Y,{className:"h-4 w-4"})})]}),e.jsx("div",{className:"mt-4 space-y-2",children:h.map((i,t)=>e.jsxs("p",{className:"text-sm text-muted-foreground flex items-start gap-2",children:[e.jsx("span",{className:"text-primary mt-0.5",children:"•"}),e.jsx("span",{children:i})]},t))}),e.jsx(p,{className:"w-full mt-6",onClick:()=>l(!1),children:"Entendi"})]})]})})]})}function H({title:a,subtitle:u,helpTitle:s,helpContent:b}){return e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h1",{className:"text-2xl font-bold",children:a}),b&&e.jsx(Pe,{title:s||a,content:b})]}),u&&e.jsx("p",{className:"text-sm text-muted-foreground",children:u})]})}const Le={categories:["report","categories"]};function ie(){const a=ue({queryKey:Le.categories,queryFn:()=>Q.getCategories(),staleTime:18e5,gcTime:36e5});return{categories:a.data??[],isLoading:a.isLoading,error:a.error,refetch:a.refetch}}function Fe({draft:a,onUpdate:u,onNext:s}){const{categories:b,isLoading:l,error:h,refetch:i}=ie(),t=b.find(d=>d.id===a.categoryId),N=d=>{u({categoryId:d.id,category:d})},v=!!a.categoryId;return l?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 gap-4",children:[e.jsx(P,{className:"h-8 w-8 animate-spin text-primary"}),e.jsx("p",{className:"text-muted-foreground",children:"Carregando categorias..."})]}):h?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 gap-4",children:[e.jsx(ge,{className:"h-12 w-12 text-destructive"}),e.jsx("p",{className:"text-muted-foreground text-center",children:"Erro ao carregar categorias."}),e.jsx(p,{onClick:()=>i(),variant:"outline",children:"Tentar novamente"})]}):e.jsxs("div",{className:"space-y-6 pb-48",children:[e.jsx(H,{title:"O que aconteceu?",subtitle:"Escolha a categoria que melhor descreve o problema",helpTitle:"Como escolher a categoria",helpContent:["Escolha a categoria que mais combina com o problema que você quer reportar.","Se tiver dúvida, escolha 'Outros' e descreva com suas palavras.","Não se preocupe em acertar perfeitamente, nossa equipe vai analisar."]}),e.jsx(y,{className:"p-4 bg-blue-50 dark:bg-blue-950/30 border-blue-200 dark:border-blue-800",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-blue-100 dark:bg-blue-900/50",children:e.jsx(O,{className:"h-4 w-4 text-blue-600 dark:text-blue-400"})}),e.jsx("div",{children:e.jsxs("p",{className:"text-sm text-blue-700 dark:text-blue-300",children:[e.jsx("span",{className:"font-medium",children:"Toque em uma categoria"})," para selecioná-la. Depois você pode detalhar melhor o problema."]})})]})}),e.jsx("div",{className:"grid grid-cols-2 gap-3",children:b.map((d,m)=>{const g=a.categoryId===d.id;return e.jsxs(o.button,{type:"button",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:m*.03},whileTap:{scale:.95},onClick:()=>N(d),className:C("relative flex flex-col items-center gap-2 rounded-2xl border-2 p-4 text-center transition-all",g?"border-primary bg-primary/10 shadow-lg":"border-border bg-card hover:bg-muted/50 hover:border-muted-foreground/30"),children:[e.jsx("div",{className:C("text-3xl p-2 rounded-xl transition-colors",g?"bg-primary/20":"bg-muted"),style:{backgroundColor:g?`${d.color}20`:void 0},children:d.icon}),e.jsx("span",{className:C("text-sm font-medium leading-tight",g&&"text-primary"),style:{color:g?d.color:void 0},children:d.name}),g&&e.jsx(o.div,{initial:{scale:0},animate:{scale:1},className:"absolute -top-1 -right-1 h-5 w-5 rounded-full bg-primary flex items-center justify-center",style:{backgroundColor:d.color},children:e.jsx(W,{className:"h-3 w-3 text-white"})})]},d.id)})}),t&&t.tips.length>0&&e.jsx(o.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},className:"space-y-3",children:e.jsx(y,{className:"p-4 border-amber-200 bg-amber-50 dark:bg-amber-950/20 dark:border-amber-800",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-amber-100 dark:bg-amber-900/50",children:e.jsx(fe,{className:"h-4 w-4 text-amber-600 dark:text-amber-400"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("p",{className:"text-sm font-medium text-amber-800 dark:text-amber-300",children:['Dicas para "',t.name,'"']}),e.jsx("ul",{className:"mt-2 space-y-1",children:t.tips.map((d,m)=>e.jsxs("li",{className:"text-sm text-amber-700 dark:text-amber-400 flex gap-2",children:[e.jsx("span",{className:"shrink-0",children:"•"}),e.jsx("span",{children:d})]},m))})]})]})})}),!a.categoryId&&e.jsx(y,{className:"p-4 border-muted bg-muted/30",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-muted",children:e.jsx(be,{className:"h-4 w-4 text-muted-foreground"})}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Selecione uma categoria acima para continuar"})]})}),e.jsx("div",{className:"fixed bottom-0 left-0 right-0 p-4 pb-24 bg-background/95 backdrop-blur-lg border-t z-10",children:e.jsx("div",{className:"max-w-lg mx-auto",children:e.jsx(p,{size:"lg",className:C("w-full h-14 text-base font-semibold rounded-2xl transition-all",!v&&"opacity-50"),disabled:!v,onClick:s,children:v?e.jsxs(e.Fragment,{children:["Continuar",e.jsx(W,{className:"h-5 w-5 ml-2"})]}):"Selecione uma categoria"})})})]})}function Oe({draft:a,onUpdate:u,onNext:s,onBack:b}){const[l,h]=n.useState({status:"idle"}),[i,t]=n.useState(!1),[N,v]=n.useState(""),[d,m]=n.useState([]),[g,R]=n.useState(!1),[z,T]=n.useState(!1),r=n.useCallback(async(x,j)=>{try{T(!0);const M=await Q.geocodeReverse(x,j);return M?.address||M?.displayName}catch(M){console.warn("[StepLocation] Reverse geocode failed:",M);return}finally{T(!1)}},[]),c=n.useCallback(async()=>{if(!navigator.geolocation){h({status:"error",errorMessage:"Seu navegador não suporta geolocalização. Tente usar Chrome, Safari ou Firefox."});return}h({status:"requesting"}),navigator.geolocation.getCurrentPosition(async x=>{const j=x.coords.latitude,M=x.coords.longitude,le=await r(j,M),ce={latitude:j,longitude:M,accuracy:x.coords.accuracy,address:le||"Tijucas, SC",source:"gps",quality:x.coords.accuracy<=50?"precisa":"aproximada"};u({location:ce}),h({status:"success"})},x=>{let j="Não conseguimos acessar sua localização.";x.code===x.PERMISSION_DENIED?(j="Você não permitiu o acesso à sua localização.",h({status:"denied",errorMessage:j})):x.code===x.POSITION_UNAVAILABLE?(j="Não foi possível determinar sua localização. Verifique se o GPS está ativado.",h({status:"error",errorMessage:j})):x.code===x.TIMEOUT&&(j="Demorou muito para obter sua localização. Verifique sua conexão e tente novamente.",h({status:"error",errorMessage:j}))},{enableHighAccuracy:!0,timeout:15e3,maximumAge:6e4})},[u,r]),w=n.useCallback(async x=>{if(x.length<3){m([]);return}R(!0);try{const j=await Q.geocodeAutocomplete(x);m(j)}catch(j){console.warn("[StepLocation] Search failed:",j),m([])}finally{R(!1)}},[]);n.useEffect(()=>{const x=setTimeout(()=>{N&&w(N)},300);return()=>clearTimeout(x)},[N,w]);const A=x=>{const j={latitude:x.latitude,longitude:x.longitude,accuracy:100,address:x.address||x.displayName,source:"manual",quality:"manual"};u({location:j}),h({status:"success"}),v(""),m([]),t(!1)};n.useEffect(()=>{!a.location&&l.status==="idle"&&c()},[a.location,l.status,c]);const f=!!a.location,k=({quality:x})=>{const j={precisa:{color:"text-green-600 bg-green-100",icon:Ee,label:"Precisa"},aproximada:{color:"text-amber-600 bg-amber-100",icon:E,label:"Aproximada"},manual:{color:"text-blue-600 bg-blue-100",icon:J,label:"Informada"}}[x]||{color:"text-gray-600 bg-gray-100",icon:E,label:"Desconhecida"},M=j.icon;return e.jsxs("span",{className:C("inline-flex items-center gap-1 px-2 py-0.5 rounded-full text-xs font-medium",j.color),children:[e.jsx(M,{className:"h-3 w-3"}),j.label]})};return e.jsxs("div",{className:"space-y-6 pb-48",children:[e.jsx(H,{title:"Onde foi?",subtitle:"Precisamos saber o local do problema",helpTitle:"Por que precisamos da localização?",helpContent:["A localização ajuda nossa equipe a encontrar o problema rapidamente.","Usamos o GPS do seu celular para maior precisão.","Sua localização não é compartilhada publicamente, apenas com a equipe responsável."]}),e.jsx(y,{className:"p-4 bg-blue-50 dark:bg-blue-950/30 border-blue-200 dark:border-blue-800",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-blue-100 dark:bg-blue-900/50",children:e.jsx(O,{className:"h-4 w-4 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{className:"text-sm text-blue-700 dark:text-blue-300",children:[e.jsx("p",{className:"font-medium mb-1",children:"Como funciona:"}),e.jsx("p",{children:"Usamos o GPS para marcar o local, ou você pode buscar o endereço manualmente."})]})]})}),e.jsxs("div",{className:"space-y-4",children:[l.status==="requesting"&&e.jsxs(o.div,{initial:{opacity:0},animate:{opacity:1},className:"flex flex-col items-center justify-center py-12 text-center",children:[e.jsx("div",{className:"p-4 rounded-full bg-primary/10 mb-4",children:e.jsx(P,{className:"h-8 w-8 text-primary animate-spin"})}),e.jsx("p",{className:"font-medium mb-1",children:z?"Buscando endereço...":"Buscando sua localização..."}),e.jsx("p",{className:"text-sm text-muted-foreground",children:'Se aparecer uma mensagem, toque em "Permitir"'})]}),l.status==="denied"&&e.jsx(o.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},children:e.jsx(y,{className:"p-6 border-amber-200 bg-amber-50 dark:bg-amber-950/20 dark:border-amber-800",children:e.jsxs("div",{className:"flex flex-col items-center text-center",children:[e.jsx("div",{className:"p-4 rounded-full bg-amber-100 dark:bg-amber-900/30 mb-4",children:e.jsx(E,{className:"h-8 w-8 text-amber-600 dark:text-amber-400"})}),e.jsx("h3",{className:"font-semibold text-lg text-amber-800 dark:text-amber-300",children:"Localização bloqueada"}),e.jsx("p",{className:"text-sm text-amber-700 dark:text-amber-400 mt-2 mb-4",children:l.errorMessage}),e.jsxs(y,{className:"w-full p-4 bg-white dark:bg-background border-amber-200 dark:border-amber-700 text-left",children:[e.jsxs("p",{className:"font-medium text-sm mb-3 flex items-center gap-2",children:[e.jsx(re,{className:"h-4 w-4"}),"Como permitir o acesso:"]}),e.jsxs("ol",{className:"text-sm space-y-2 text-muted-foreground",children:[e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"font-bold text-primary",children:"1."}),e.jsx("span",{children:"Olhe na barra de endereço do navegador"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"font-bold text-primary",children:"2."}),e.jsx("span",{children:"Clique no ícone de cadeado"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"font-bold text-primary",children:"3."}),e.jsx("span",{children:'Mude "Localização" para "Permitir"'})]})]})]}),e.jsxs("div",{className:"flex gap-2 mt-4 w-full",children:[e.jsxs(p,{variant:"outline",className:"flex-1",onClick:c,children:[e.jsx(L,{className:"h-4 w-4 mr-2"}),"Tentar GPS"]}),e.jsxs(p,{variant:"secondary",className:"flex-1",onClick:()=>t(!0),children:[e.jsx(V,{className:"h-4 w-4 mr-2"}),"Buscar endereço"]})]})]})})}),l.status==="error"&&e.jsx(o.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},children:e.jsx(y,{className:"p-6 border-red-200 bg-red-50 dark:bg-red-950/20 dark:border-red-800",children:e.jsxs("div",{className:"flex flex-col items-center text-center",children:[e.jsx("div",{className:"p-4 rounded-full bg-red-100 dark:bg-red-900/30 mb-4",children:e.jsx(F,{className:"h-8 w-8 text-red-600 dark:text-red-400"})}),e.jsx("h3",{className:"font-semibold text-lg text-red-800 dark:text-red-300",children:"Erro ao obter localização"}),e.jsx("p",{className:"text-sm text-red-700 dark:text-red-400 mt-2 mb-4",children:l.errorMessage}),e.jsxs("div",{className:"flex gap-2 w-full",children:[e.jsxs(p,{variant:"outline",className:"flex-1",onClick:c,children:[e.jsx(L,{className:"h-4 w-4 mr-2"}),"Tentar GPS"]}),e.jsxs(p,{variant:"secondary",className:"flex-1",onClick:()=>t(!0),children:[e.jsx(V,{className:"h-4 w-4 mr-2"}),"Buscar endereço"]})]})]})})}),a.location&&e.jsxs(o.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"space-y-4",children:[e.jsx(y,{className:"p-4 bg-green-50 dark:bg-green-950/20 border-green-200 dark:border-green-800",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-green-100 dark:bg-green-900/50",children:e.jsx(I,{className:"h-5 w-5 text-green-600 dark:text-green-400"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-green-800 dark:text-green-300",children:"Localização capturada!"}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(k,{quality:a.location.quality}),a.location.accuracy&&a.location.source==="gps"&&e.jsxs("span",{className:"text-xs text-muted-foreground",children:["±",Math.round(a.location.accuracy),"m"]})]})]})]})}),e.jsxs(y,{className:"overflow-hidden",children:[e.jsxs("div",{className:"relative h-40 bg-gradient-to-br from-green-100 to-blue-100 dark:from-green-900/20 dark:to-blue-900/20",children:[e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx(o.div,{animate:{scale:[1,1.1,1]},transition:{repeat:1/0,duration:2},className:"p-3 rounded-full bg-primary shadow-lg",children:e.jsx(E,{className:"h-6 w-6 text-primary-foreground"})})}),e.jsx("div",{className:"absolute inset-0 opacity-30",children:e.jsx("div",{className:"h-full w-full",style:{backgroundImage:"linear-gradient(rgba(0,0,0,0.1) 1px, transparent 1px), linear-gradient(90deg, rgba(0,0,0,0.1) 1px, transparent 1px)",backgroundSize:"20px 20px"}})})]}),e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:a.location.address||"Localização capturada"}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Coordenadas: ",a.location.latitude.toFixed(4),", ",a.location.longitude.toFixed(4)]})]}),e.jsxs(p,{variant:"outline",size:"sm",onClick:()=>t(!0),children:[e.jsx(J,{className:"h-3.5 w-3.5 mr-1"}),"Alterar"]})]})})]})]}),l.status==="idle"&&!a.location&&e.jsxs(o.div,{initial:{opacity:0},animate:{opacity:1},className:"flex flex-col items-center py-8 gap-4",children:[e.jsxs(p,{size:"lg",onClick:c,className:"h-14 px-8 rounded-2xl",children:[e.jsx(X,{className:"h-5 w-5 mr-2"}),"Usar minha localização"]}),e.jsx("p",{className:"text-xs text-muted-foreground text-center",children:"ou"}),e.jsxs(p,{variant:"outline",onClick:()=>t(!0),children:[e.jsx(V,{className:"h-4 w-4 mr-2"}),"Buscar endereço manualmente"]})]})]}),e.jsx($,{children:i&&e.jsxs(e.Fragment,{children:[e.jsx(o.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-50 bg-black/40",onClick:()=>t(!1)}),e.jsxs(o.div,{initial:{y:"100%"},animate:{y:0},exit:{y:"100%"},transition:{type:"spring",damping:25,stiffness:300},className:"fixed bottom-0 left-0 right-0 z-50 rounded-t-3xl bg-background p-6 pb-8 max-h-[80vh] overflow-y-auto",children:[e.jsx("div",{className:"absolute top-3 left-1/2 -translate-x-1/2 h-1 w-10 rounded-full bg-muted"}),e.jsx("h3",{className:"font-semibold text-lg mt-4",children:"Buscar endereço"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Digite o nome da rua ou local"}),e.jsxs("div",{className:"relative mt-4",children:[e.jsx(V,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(se,{placeholder:"Ex: Rua Principal, Centro, Tijucas",value:N,onChange:x=>v(x.target.value),className:"pl-10 h-12 rounded-xl",autoFocus:!0}),g&&e.jsx(P,{className:"absolute right-3 top-1/2 -translate-y-1/2 h-4 w-4 animate-spin text-muted-foreground"})]}),d.length>0&&e.jsx("div",{className:"mt-4 space-y-2",children:d.map((x,j)=>e.jsx(o.button,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:j*.05},onClick:()=>A(x),className:"w-full text-left p-3 rounded-xl border hover:bg-muted/50 transition-colors",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(E,{className:"h-5 w-5 text-primary shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",children:x.address}),e.jsx("p",{className:"text-xs text-muted-foreground mt-0.5",children:x.displayName})]})]})},x.placeId||j))}),N.length>=3&&d.length===0&&!g&&e.jsx("p",{className:"text-sm text-muted-foreground text-center py-8",children:"Nenhum resultado encontrado. Tente outro endereço."}),e.jsxs("div",{className:"flex gap-2 mt-6",children:[e.jsx(p,{variant:"outline",className:"flex-1",onClick:()=>t(!1),children:"Cancelar"}),e.jsxs(p,{className:"flex-1",onClick:c,children:[e.jsx(X,{className:"h-4 w-4 mr-2"}),"Usar GPS"]})]})]})]})}),e.jsx("div",{className:"fixed bottom-0 left-0 right-0 p-4 pb-24 bg-background/95 backdrop-blur-lg border-t z-10",children:e.jsxs("div",{className:"flex gap-3 max-w-lg mx-auto",children:[e.jsx(p,{variant:"outline",size:"lg",className:"h-14 rounded-2xl flex-1 text-base",onClick:b,children:"Voltar"}),e.jsx(p,{size:"lg",className:C("h-14 rounded-2xl flex-[2] text-base font-semibold",!f&&"opacity-50"),disabled:!f,onClick:s,children:f?e.jsxs(e.Fragment,{children:["Continuar",e.jsx(W,{className:"h-5 w-5 ml-2"})]}):"Aguardando localização..."})]})})]})}const S=3;function Ve({draft:a,onUpdate:u,onNext:s,onBack:b}){const l=n.useRef(null),h=n.useRef(null),[i,t]=n.useState({status:"idle",facingMode:"environment",stream:null}),[N,v]=n.useState(!1),d=n.useCallback(async()=>{if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia){t(r=>({...r,status:"error",errorMessage:"Seu navegador não suporta acesso à câmera. Tente usar Chrome, Safari ou Firefox."}));return}t(r=>({...r,status:"requesting"}));try{const r=await navigator.mediaDevices.getUserMedia({video:{facingMode:i.facingMode,width:{ideal:1920},height:{ideal:1080}},audio:!1});l.current&&(l.current.srcObject=r,await l.current.play()),t(c=>({...c,status:"active",stream:r,errorMessage:void 0}))}catch(r){if(console.error("Camera error:",r),r instanceof DOMException)if(r.name==="NotAllowedError")t(c=>({...c,status:"denied",errorMessage:"Você não permitiu o acesso à câmera."}));else if(r.name==="NotFoundError")t(c=>({...c,status:"error",errorMessage:"Nenhuma câmera foi encontrada no seu dispositivo."}));else if(r.name==="NotReadableError")t(c=>({...c,status:"error",errorMessage:"A câmera está sendo usada por outro aplicativo. Feche outros apps e tente novamente."}));else if(r.name==="OverconstrainedError"){t(c=>({...c,status:"error",errorMessage:"Sua câmera não atende aos requisitos. Tentando configuração alternativa..."}));try{const c=await navigator.mediaDevices.getUserMedia({video:!0,audio:!1});l.current&&(l.current.srcObject=c,await l.current.play()),t(w=>({...w,status:"active",stream:c,errorMessage:void 0}))}catch{t(c=>({...c,status:"error",errorMessage:"Não foi possível acessar sua câmera."}))}}else t(c=>({...c,status:"error",errorMessage:"Ocorreu um erro ao acessar a câmera. Tente novamente."}));else t(c=>({...c,status:"error",errorMessage:"Erro desconhecido ao acessar a câmera."}))}},[i.facingMode]),m=n.useCallback(()=>{i.stream&&i.stream.getTracks().forEach(r=>r.stop()),l.current&&(l.current.srcObject=null),t(r=>({...r,status:"idle",stream:null}))},[i.stream]);n.useEffect(()=>(a.images.length<S&&i.status==="idle"&&d(),()=>{i.stream&&i.stream.getTracks().forEach(r=>r.stop())}),[]);const g=n.useCallback(async()=>{m(),t(r=>({...r,facingMode:r.facingMode==="environment"?"user":"environment"})),setTimeout(()=>d(),100)},[d,m]),R=n.useCallback(async()=>{if(!l.current||!h.current||a.images.length>=S)return;v(!0);const r=l.current,c=h.current,w=c.getContext("2d");if(!w){v(!1);return}c.width=r.videoWidth,c.height=r.videoHeight,w.drawImage(r,0,0),c.toBlob(A=>{if(!A){v(!1);return}const f=new File([A],`photo_${Date.now()}.jpg`,{type:"image/jpeg",lastModified:Date.now()}),k={id:ne(),file:f,previewUrl:URL.createObjectURL(A),capturedAt:new Date};u({images:[...a.images,k]}),v(!1),a.images.length+1>=S&&m()},"image/jpeg",.85)},[a.images,u,m]),z=n.useCallback(r=>{const c=a.images.find(w=>w.id===r);c&&URL.revokeObjectURL(c.previewUrl),u({images:a.images.filter(w=>w.id!==r)}),i.status==="idle"&&a.images.length<=S&&d()},[a.images,i.status,u,d]),T=n.useCallback(r=>{z(r),i.status!=="active"&&d()},[z,i.status,d]);return e.jsxs("div",{className:"space-y-4 pb-48",children:[e.jsx(H,{title:"Tire até 3 fotos",subtitle:"Registre o problema com fotos tiradas agora",helpTitle:"Por que só fotos da câmera?",helpContent:["Por segurança, só aceitamos fotos tiradas no momento da denúncia.","Isso garante que o problema existe e é recente.","Não é possível enviar fotos da galeria do celular."]}),e.jsx(y,{className:"p-4 bg-blue-50 dark:bg-blue-950/30 border-blue-200 dark:border-blue-800",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-blue-100 dark:bg-blue-900/50",children:e.jsx(O,{className:"h-4 w-4 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{className:"space-y-2 text-sm text-blue-700 dark:text-blue-300",children:[e.jsx("p",{className:"font-medium",children:"Dicas para boas fotos:"}),e.jsxs("ul",{className:"space-y-1 text-blue-600 dark:text-blue-400",children:[e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx(D,{className:"h-3.5 w-3.5"}),e.jsx("span",{children:"1 foto de perto do problema"})]}),e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx(qe,{className:"h-3.5 w-3.5"}),e.jsx("span",{children:"1 foto mostrando o contexto da rua"})]}),e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx(ee,{className:"h-3.5 w-3.5"}),e.jsx("span",{children:"Evite se colocar em risco"})]})]})]})]})}),e.jsxs("div",{className:"relative",children:[i.status==="active"&&a.images.length<S&&e.jsxs(o.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"relative rounded-2xl overflow-hidden bg-muted aspect-[4/3]",children:[e.jsx("video",{ref:l,autoPlay:!0,playsInline:!0,muted:!0,"webkit-playsinline":"true","x-webkit-airplay":"allow",style:{backgroundColor:"transparent"},className:"w-full h-full object-cover"}),e.jsxs("div",{className:"absolute bottom-4 left-0 right-0 flex items-center justify-center gap-4",children:[e.jsx(o.button,{whileTap:{scale:.9},onClick:g,className:"p-3 rounded-full bg-black/50 text-white backdrop-blur-sm","aria-label":"Trocar câmera",children:e.jsx(Ae,{className:"h-5 w-5"})}),e.jsx(o.button,{whileTap:{scale:.9},onClick:R,disabled:N,className:C("p-1 rounded-full bg-white",N&&"opacity-50"),"aria-label":"Capturar foto",children:e.jsx("div",{className:"h-16 w-16 rounded-full border-4 border-primary flex items-center justify-center",children:N?e.jsx(P,{className:"h-6 w-6 text-primary animate-spin"}):e.jsx(D,{className:"h-6 w-6 text-primary"})})}),e.jsx("div",{className:"w-12"})]}),e.jsxs("div",{className:"absolute top-4 right-4 px-3 py-1.5 rounded-full bg-black/50 text-white text-sm backdrop-blur-sm flex items-center gap-1",children:[e.jsx(D,{className:"h-3.5 w-3.5"}),e.jsxs("span",{children:[a.images.length,"/",S]})]})]}),i.status==="requesting"&&e.jsxs(o.div,{initial:{opacity:0},animate:{opacity:1},className:"rounded-2xl bg-muted aspect-[4/3] flex flex-col items-center justify-center p-6 text-center",children:[e.jsx("div",{className:"p-4 rounded-full bg-primary/10 mb-4",children:e.jsx(P,{className:"h-8 w-8 text-primary animate-spin"})}),e.jsx("p",{className:"font-medium mb-1",children:"Iniciando câmera..."}),e.jsx("p",{className:"text-sm text-muted-foreground",children:'Se aparecer uma mensagem, toque em "Permitir"'})]}),i.status==="denied"&&e.jsx(o.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},children:e.jsx(y,{className:"p-6 border-amber-200 bg-amber-50 dark:bg-amber-950/20 dark:border-amber-800",children:e.jsxs("div",{className:"flex flex-col items-center text-center",children:[e.jsx("div",{className:"p-4 rounded-full bg-amber-100 dark:bg-amber-900/30 mb-4",children:e.jsx(ee,{className:"h-8 w-8 text-amber-600 dark:text-amber-400"})}),e.jsx("h3",{className:"font-semibold text-lg text-amber-800 dark:text-amber-300",children:"Câmera bloqueada"}),e.jsx("p",{className:"text-sm text-amber-700 dark:text-amber-400 mt-2 mb-4",children:i.errorMessage}),e.jsxs(y,{className:"w-full p-4 bg-white dark:bg-background border-amber-200 dark:border-amber-700",children:[e.jsxs("p",{className:"font-medium text-sm mb-3 flex items-center gap-2",children:[e.jsx(re,{className:"h-4 w-4"}),"Como permitir o acesso:"]}),e.jsxs("ol",{className:"text-left text-sm space-y-2 text-muted-foreground",children:[e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"font-bold text-primary",children:"1."}),e.jsx("span",{children:"Olhe na barra de endereço do navegador"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"font-bold text-primary",children:"2."}),e.jsx("span",{children:"Clique no ícone de cadeado ou câmera"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"font-bold text-primary",children:"3."}),e.jsx("span",{children:'Mude "Câmera" para "Permitir"'})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"font-bold text-primary",children:"4."}),e.jsx("span",{children:"Recarregue a página ou toque no botão abaixo"})]})]})]}),e.jsxs(p,{variant:"outline",className:"mt-4 w-full",onClick:d,children:[e.jsx(L,{className:"h-4 w-4 mr-2"}),"Tentar novamente"]})]})})}),i.status==="error"&&e.jsx(o.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},children:e.jsx(y,{className:"p-6 border-red-200 bg-red-50 dark:bg-red-950/20 dark:border-red-800",children:e.jsxs("div",{className:"flex flex-col items-center text-center",children:[e.jsx("div",{className:"p-4 rounded-full bg-red-100 dark:bg-red-900/30 mb-4",children:e.jsx(F,{className:"h-8 w-8 text-red-600 dark:text-red-400"})}),e.jsx("h3",{className:"font-semibold text-lg text-red-800 dark:text-red-300",children:"Problema com a câmera"}),e.jsx("p",{className:"text-sm text-red-700 dark:text-red-400 mt-2 mb-4",children:i.errorMessage}),e.jsxs(y,{className:"w-full p-4 bg-white dark:bg-background border-red-200 dark:border-red-700",children:[e.jsx("p",{className:"font-medium text-sm mb-3",children:"O que você pode fazer:"}),e.jsxs("ul",{className:"text-left text-sm space-y-2 text-muted-foreground",children:[e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(I,{className:"h-4 w-4 text-green-500 shrink-0 mt-0.5"}),e.jsx("span",{children:"Verifique se seu dispositivo tem câmera"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(I,{className:"h-4 w-4 text-green-500 shrink-0 mt-0.5"}),e.jsx("span",{children:"Feche outros aplicativos que usam a câmera"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(I,{className:"h-4 w-4 text-green-500 shrink-0 mt-0.5"}),e.jsx("span",{children:"Tente acessar pelo celular em vez do computador"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(I,{className:"h-4 w-4 text-green-500 shrink-0 mt-0.5"}),e.jsx("span",{children:"Você pode continuar sem foto (opcional)"})]})]})]}),e.jsxs(p,{variant:"outline",className:"mt-4 w-full",onClick:d,children:[e.jsx(L,{className:"h-4 w-4 mr-2"}),"Tentar novamente"]})]})})}),e.jsx("canvas",{ref:h,className:"hidden"})]}),a.images.length>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("p",{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(I,{className:"h-4 w-4 text-green-500"}),"Fotos capturadas (",a.images.length,"/",S,")"]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsx($,{mode:"popLayout",children:a.images.map((r,c)=>e.jsxs(o.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.8},layout:!0,className:"relative aspect-square rounded-xl overflow-hidden bg-muted",children:[e.jsx("img",{src:r.previewUrl,alt:`Foto ${c+1}`,className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute inset-x-0 bottom-0 p-2 bg-gradient-to-t from-black/70 to-transparent",children:e.jsxs("div",{className:"flex justify-center gap-2",children:[e.jsxs(o.button,{whileTap:{scale:.9},onClick:()=>T(r.id),className:"px-2 py-1 text-xs bg-white/20 text-white rounded-md backdrop-blur-sm flex items-center gap-1",children:[e.jsx(L,{className:"h-3 w-3"}),"Refazer"]}),e.jsxs(o.button,{whileTap:{scale:.9},onClick:()=>z(r.id),className:"px-2 py-1 text-xs bg-red-500/80 text-white rounded-md flex items-center gap-1",children:[e.jsx(Y,{className:"h-3 w-3"}),"Remover"]})]})}),e.jsx("div",{className:"absolute top-2 left-2 h-6 w-6 rounded-full bg-primary text-primary-foreground text-xs font-bold flex items-center justify-center",children:c+1})]},r.id))}),Array.from({length:S-a.images.length}).map((r,c)=>e.jsxs("div",{className:"aspect-square rounded-xl border-2 border-dashed border-muted-foreground/30 flex flex-col items-center justify-center gap-1",children:[e.jsx(D,{className:"h-5 w-5 text-muted-foreground/30"}),e.jsx("span",{className:"text-xs text-muted-foreground/50",children:"Vazio"})]},`empty-${c}`))]})]}),a.images.length>=S&&e.jsx(y,{className:"p-4 text-center bg-green-50 dark:bg-green-950/20 border-green-200 dark:border-green-800",children:e.jsxs("div",{className:"flex items-center justify-center gap-2 text-green-700 dark:text-green-300",children:[e.jsx(I,{className:"h-5 w-5"}),e.jsxs("span",{className:"font-medium",children:["Você tirou ",S," fotos. Pronto para continuar!"]})]})}),a.images.length===0&&(i.status==="error"||i.status==="denied")&&e.jsx(y,{className:"p-4 border-amber-200 bg-amber-50 dark:bg-amber-950/20 dark:border-amber-800",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(F,{className:"h-5 w-5 text-amber-600 shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-amber-800 dark:text-amber-300",children:"Continuar sem foto?"}),e.jsx("p",{className:"text-sm text-amber-700 dark:text-amber-400 mt-1",children:"Fotos ajudam muito a identificar o problema, mas você pode continuar sem elas."})]})]})}),e.jsx("div",{className:"fixed bottom-0 left-0 right-0 p-4 pb-24 bg-background/95 backdrop-blur-lg border-t z-10",children:e.jsxs("div",{className:"flex gap-3 max-w-lg mx-auto",children:[e.jsx(p,{variant:"outline",size:"lg",className:"h-14 rounded-2xl flex-1 text-base",onClick:()=>{m(),b()},children:"Voltar"}),e.jsxs(p,{size:"lg",className:"h-14 rounded-2xl flex-[2] text-base font-semibold",onClick:()=>{m(),s()},children:["Continuar",a.images.length===0&&e.jsx("span",{className:"text-xs ml-2 opacity-70",children:"(sem foto)"})]})]})})]})}function Ue({draft:a,onUpdate:u,onBack:s,onGoToStep:b,onSubmit:l}){const[h,i]=n.useState(!1),{categories:t}=ie(),N=t.find(m=>m.id===a.categoryId),v=!!a.categoryId&&!!a.location&&a.confirmed&&!!a.title?.trim(),d=async()=>{if(v){i(!0);try{await l()}catch(m){console.error("Submit error:",m)}finally{i(!1)}}};return e.jsxs("div",{className:"space-y-4 pb-48",children:[e.jsx(H,{title:"Revisar e enviar",subtitle:"Adicione um título e confira as informações",helpTitle:"Última etapa!",helpContent:["Adicione um título curto que descreva o problema.","Revise todas as informações antes de enviar.","Após enviar, você receberá um número de protocolo."]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(ke,{className:"h-4 w-4 text-muted-foreground"}),"Título da denúncia *"]}),e.jsx(se,{placeholder:"Ex: Buraco grande na Rua Principal",value:a.title||"",onChange:m=>u({title:m.target.value}),className:"h-12 rounded-xl",maxLength:100}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Descreva o problema em poucas palavras (obrigatório)"})]}),e.jsx(y,{className:"p-4",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-3 rounded-xl text-2xl",style:{backgroundColor:N?.color+"20"},children:N?.icon||"❓"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Categoria"}),e.jsx("p",{className:"font-semibold",children:N?.name||"Não selecionada"})]})]}),e.jsxs(p,{variant:"ghost",size:"sm",onClick:()=>b(1),className:"text-primary",children:[e.jsx(G,{className:"h-4 w-4 mr-1"}),"Editar"]})]})}),e.jsx(y,{className:"p-4",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-3 rounded-xl bg-primary/10",children:e.jsx(E,{className:"h-6 w-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Localização"}),e.jsx("p",{className:"font-semibold",children:a.location?.address||"Localização capturada"}),a.location?.quality&&e.jsx(je,{variant:"secondary",className:"mt-1 text-xs capitalize",children:a.location.quality})]})]}),e.jsxs(p,{variant:"ghost",size:"sm",onClick:()=>b(2),className:"text-primary",children:[e.jsx(G,{className:"h-4 w-4 mr-1"}),"Editar"]})]})}),e.jsxs(y,{className:"p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-3 rounded-xl bg-primary/10",children:e.jsx(D,{className:"h-6 w-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Fotos"}),e.jsxs("p",{className:"font-semibold",children:[a.images.length," ",a.images.length===1?"foto anexada":"fotos anexadas"]})]})]}),e.jsxs(p,{variant:"ghost",size:"sm",onClick:()=>b(3),className:"text-primary",children:[e.jsx(G,{className:"h-4 w-4 mr-1"}),"Editar"]})]}),a.images.length>0?e.jsx("div",{className:"flex gap-2 overflow-x-auto pb-1",children:a.images.map((m,g)=>e.jsx("img",{src:m.previewUrl,alt:`Foto ${g+1}`,className:"h-20 w-20 rounded-lg object-cover shrink-0"},m.id))}):e.jsxs("div",{className:"flex items-center gap-2 text-amber-600 dark:text-amber-400",children:[e.jsx(F,{className:"h-4 w-4"}),e.jsx("p",{className:"text-sm",children:"Nenhuma foto anexada (opcional)"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(te,{className:"h-4 w-4 text-muted-foreground"}),"Descrição adicional (opcional)"]}),e.jsx(ye,{placeholder:"Algum detalhe importante? (máx. 500 caracteres)",maxLength:500,value:a.description,onChange:m=>u({description:m.target.value}),className:"min-h-[100px] rounded-xl resize-none"}),e.jsxs("p",{className:"text-xs text-muted-foreground text-right",children:[a.description.length,"/500"]})]}),e.jsx(y,{className:C("p-4 transition-all border-2",a.confirmed?"border-green-400 bg-green-50 dark:bg-green-950/20 dark:border-green-700":"border-amber-400 bg-amber-50 dark:bg-amber-950/20 dark:border-amber-700"),children:e.jsxs("label",{className:"flex items-start gap-3 cursor-pointer",children:[e.jsx(Ne,{checked:a.confirmed,onCheckedChange:m=>u({confirmed:!!m}),className:"mt-0.5 h-5 w-5"}),e.jsxs("div",{children:[e.jsx("p",{className:C("font-medium",a.confirmed?"text-green-700 dark:text-green-300":"text-amber-700 dark:text-amber-300"),children:a.confirmed?e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(I,{className:"h-4 w-4"}),"Confirmado!"]}):"Confirmo que as informações são verdadeiras"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:a.confirmed?"Você confirmou que as informações são verdadeiras":"Marque para poder enviar a denúncia"})]})]})}),!v&&e.jsx(y,{className:"p-4 border-red-200 bg-red-50 dark:bg-red-950/20 dark:border-red-800",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(F,{className:"h-5 w-5 text-red-600 dark:text-red-400 shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-red-800 dark:text-red-300",children:"Não é possível enviar ainda"}),e.jsxs("ul",{className:"text-sm text-red-700 dark:text-red-400 mt-1 space-y-1",children:[!a.title?.trim()&&e.jsx("li",{children:"• Adicione um título"}),!a.categoryId&&e.jsx("li",{children:"• Selecione uma categoria"}),!a.location&&e.jsx("li",{children:"• Capture sua localização"}),!a.confirmed&&e.jsx("li",{children:"• Confirme que as informações são verdadeiras"})]})]})]})}),e.jsx("div",{className:"fixed bottom-0 left-0 right-0 p-4 pb-24 bg-background/95 backdrop-blur-lg border-t z-10",children:e.jsxs("div",{className:"flex gap-3 max-w-lg mx-auto",children:[e.jsx(p,{variant:"outline",size:"lg",className:"h-14 rounded-2xl flex-1 text-base",onClick:s,disabled:h,children:"Voltar"}),e.jsx(p,{size:"lg",className:C("h-14 rounded-2xl flex-[2] text-base font-semibold",v?"bg-green-600 hover:bg-green-700":"opacity-50"),disabled:!v||h,onClick:d,children:h?e.jsxs(e.Fragment,{children:[e.jsx(P,{className:"h-5 w-5 mr-2 animate-spin"}),"Enviando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ve,{className:"h-5 w-5 mr-2"}),"Enviar denúncia"]})})]})})]})}function Be({protocolNumber:a,onClose:u}){const{toast:s}=oe(),b=n.useCallback(()=>{const t=Date.now()+3e3,N={startVelocity:30,spread:360,ticks:60,zIndex:100},v=(m,g)=>Math.random()*(g-m)+m,d=setInterval(()=>{const m=t-Date.now();if(m<=0)return clearInterval(d);const g=50*(m/3e3);U({...N,particleCount:g,origin:{x:v(.1,.3),y:Math.random()-.2},colors:["#22c55e","#3b82f6","#f59e0b","#ec4899","#8b5cf6"]}),U({...N,particleCount:g,origin:{x:v(.7,.9),y:Math.random()-.2},colors:["#22c55e","#3b82f6","#f59e0b","#ec4899","#8b5cf6"]})},250);return U({particleCount:100,spread:70,origin:{y:.6},colors:["#22c55e","#3b82f6","#f59e0b","#ec4899","#8b5cf6"]}),()=>clearInterval(d)},[]);n.useEffect(()=>b(),[b]);const l=async()=>{try{await navigator.clipboard.writeText(a),s({title:"Protocolo copiado!",description:"Cole onde quiser para guardar."})}catch{s({title:"Erro ao copiar",description:"Tente copiar manualmente.",variant:"destructive"})}},h=async()=>{if(navigator.share)try{await navigator.share({title:"Denúncia Enviada - eTijucas",text:`Minha denúncia foi registrada com sucesso! Protocolo: ${a}`})}catch{console.log("Share cancelled")}else l()};return e.jsxs("div",{className:"fixed inset-0 z-50 bg-gradient-to-b from-green-50 to-background dark:from-green-950/30 dark:to-background flex flex-col items-center justify-center p-6 overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 overflow-hidden pointer-events-none",children:[...Array(6)].map((i,t)=>e.jsx(o.div,{initial:{opacity:0,scale:0},animate:{opacity:[0,.3,0],scale:[0,1.5,2],x:Math.random()*100-50,y:Math.random()*100-50},transition:{duration:3,delay:t*.3,repeat:1/0,repeatDelay:2},className:"absolute rounded-full bg-green-400/20",style:{width:100+t*30,height:100+t*30,left:`${20+t*10}%`,top:`${15+t*12}%`}},t))}),e.jsxs(o.div,{initial:{opacity:0,y:50},animate:{opacity:1,y:0},transition:{duration:.5},className:"relative z-10 w-full max-w-sm flex flex-col items-center text-center",children:[e.jsxs(o.div,{initial:{scale:0,rotate:-180},animate:{scale:1,rotate:0},transition:{type:"spring",stiffness:200,damping:15,delay:.2},className:"relative mb-6",children:[e.jsx("div",{className:"p-6 rounded-full bg-green-100 dark:bg-green-900/50 shadow-lg shadow-green-500/20",children:e.jsx(I,{className:"h-20 w-20 text-green-600 dark:text-green-400"})}),e.jsx(o.div,{animate:{rotate:360},transition:{duration:3,repeat:1/0,ease:"linear"},className:"absolute -top-2 -right-2",children:e.jsx(we,{className:"h-8 w-8 text-yellow-500"})}),e.jsx(o.div,{animate:{rotate:-360},transition:{duration:4,repeat:1/0,ease:"linear"},className:"absolute -bottom-1 -left-3",children:e.jsx(Z,{className:"h-7 w-7 text-pink-500"})})]}),e.jsx(o.h1,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},className:"text-3xl font-bold text-green-700 dark:text-green-400 mb-2",children:"Denúncia Enviada!"}),e.jsx(o.p,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4},className:"text-muted-foreground mb-6",children:"Obrigado por ajudar a melhorar nossa cidade!"}),e.jsx(o.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.5},className:"w-full",children:e.jsxs(y,{className:"p-6 bg-white dark:bg-card border-green-200 dark:border-green-800 shadow-lg",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 mb-3",children:[e.jsx(te,{className:"h-5 w-5 text-primary"}),e.jsx("span",{className:"text-sm text-muted-foreground font-medium",children:"Número do Protocolo"})]}),e.jsx(o.p,{className:"text-2xl font-bold font-mono text-primary mb-4",animate:{scale:[1,1.02,1]},transition:{duration:2,repeat:1/0},children:a}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(p,{variant:"outline",size:"sm",className:"flex-1",onClick:l,children:[e.jsx(Ce,{className:"h-4 w-4 mr-2"}),"Copiar"]}),e.jsxs(p,{variant:"outline",size:"sm",className:"flex-1",onClick:h,children:[e.jsx(Se,{className:"h-4 w-4 mr-2"}),"Compartilhar"]})]})]})}),e.jsx(o.p,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.7},className:"text-xs text-muted-foreground mt-4 max-w-xs",children:"Guarde este número para acompanhar o andamento da sua denúncia. Nossa equipe irá analisar e tomar as providências necessárias."}),e.jsxs(o.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.8},className:"w-full mt-8 space-y-3",children:[e.jsxs(p,{size:"lg",className:"w-full h-14 rounded-2xl text-base font-semibold bg-green-600 hover:bg-green-700",onClick:u,children:[e.jsx(de,{className:"h-5 w-5 mr-2"}),"Voltar para o início"]}),e.jsxs(p,{variant:"ghost",size:"lg",className:"w-full h-12 rounded-2xl text-base",onClick:()=>{U({particleCount:100,spread:70,origin:{y:.6},colors:["#22c55e","#3b82f6","#f59e0b","#ec4899","#8b5cf6"]})},children:[e.jsx(Z,{className:"h-5 w-5 mr-2"}),"Celebrar mais! 🎉"]})]})]})]})}const B=()=>`report-${Date.now()}-${Math.random().toString(36).slice(2,11)}`,ae={categoryId:null,category:null,location:null,images:[],title:"",description:"",confirmed:!1,currentStep:1,createdAt:new Date,updatedAt:new Date,idempotencyKey:B()},_="etijucas-report-draft",$e=["Categoria","Localização","Fotos","Revisão"],He={enter:a=>({x:a>0?"100%":"-100%",opacity:0}),center:{x:0,opacity:1},exit:a=>({x:a<0?"100%":"-100%",opacity:0})};function Ca(){const a=me(),{isAuthenticated:u}=ze();if(!u)return e.jsx(pe,{title:"Cadastre-se ou entre",message:"Para enviar uma denúncia, você precisa estar cadastrado no aplicativo.",returnUrl:"/denuncia/nova"});const[s,b]=n.useState(()=>({...ae,idempotencyKey:B()})),[l,h]=n.useState(0),[i,t]=n.useState(!1),[N,v]=n.useState(null),{createReport:d}=he();n.useEffect(()=>{try{const f=localStorage.getItem(_);if(f){const k=JSON.parse(f);b({...k,createdAt:new Date(k.createdAt),updatedAt:new Date(k.updatedAt),images:[],idempotencyKey:k.idempotencyKey||B()})}}catch(f){console.error("Error loading draft:",f)}},[]);const m=n.useCallback(f=>{try{const k={...f,images:[],updatedAt:new Date};localStorage.setItem(_,JSON.stringify(k))}catch(k){console.error("Error saving draft:",k)}},[]),g=n.useCallback(f=>{b(k=>{const x={...k,...f,updatedAt:new Date};return m(x),x})},[m]),R=n.useCallback(f=>{h(f>s.currentStep?1:-1),g({currentStep:f})},[s.currentStep,g]),z=n.useCallback(()=>{s.currentStep<4&&(h(1),g({currentStep:s.currentStep+1}))},[s.currentStep,g]),T=n.useCallback(()=>{s.currentStep>1&&(h(-1),g({currentStep:s.currentStep-1}))},[s.currentStep,g]),r=n.useCallback(()=>{s.images.forEach(f=>URL.revokeObjectURL(f.previewUrl)),localStorage.removeItem(_),b({...ae,idempotencyKey:B()})},[s.images]),c=n.useCallback(async()=>{if(!s.categoryId||!s.title){K.error("Preencha todos os campos obrigatórios");return}try{const f={categoryId:s.categoryId,title:s.title,description:s.description,images:s.images.map(x=>x.file)};s.location&&(f.addressText=s.location.address,f.addressSource=s.location.source,f.locationQuality=s.location.quality,f.latitude=s.location.latitude,f.longitude=s.location.longitude,f.locationAccuracyM=s.location.accuracy);const k=await d({payload:f,idempotencyKey:s.idempotencyKey});v(k.protocol),t(!0),r(),K.success("Denúncia enviada com sucesso!")}catch(f){console.error("Error submitting report:",f),K.error("Erro ao enviar denúncia. Tente novamente.")}},[s,d,r]),w=()=>{s.categoryId||s.location||s.images.length>0?window.confirm("Tem certeza que deseja sair? Seu rascunho será salvo.")&&a(-1):a(-1)},A=()=>{a("/")};return i&&N?e.jsx(Be,{protocolNumber:N,onClose:A}):e.jsxs("div",{className:"fixed inset-0 z-50 bg-background flex flex-col overflow-hidden",children:[e.jsxs("header",{className:"shrink-0 bg-background/95 backdrop-blur-lg border-b safe-top",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3",children:[e.jsx(p,{variant:"ghost",size:"icon",onClick:w,className:"rounded-full",children:e.jsx(Me,{className:"h-5 w-5"})}),e.jsx("h1",{className:"font-semibold text-lg",children:"Enviar Denúncia"}),e.jsx(p,{variant:"ghost",size:"icon",onClick:w,className:"rounded-full",children:e.jsx(Y,{className:"h-5 w-5"})})]}),e.jsx("div",{className:"px-4 pb-4",children:e.jsx(De,{currentStep:s.currentStep,totalSteps:4,labels:$e})})]}),e.jsx("main",{className:"flex-1 overflow-hidden",children:e.jsx($,{mode:"wait",custom:l,children:e.jsxs(o.div,{custom:l,variants:He,initial:"enter",animate:"center",exit:"exit",transition:{x:{type:"spring",stiffness:300,damping:30},opacity:{duration:.2}},className:"h-full overflow-y-auto px-4 pt-4",children:[s.currentStep===1&&e.jsx(Fe,{draft:s,onUpdate:g,onNext:z}),s.currentStep===2&&e.jsx(Oe,{draft:s,onUpdate:g,onNext:z,onBack:T}),s.currentStep===3&&e.jsx(Ve,{draft:s,onUpdate:g,onNext:z,onBack:T}),s.currentStep===4&&e.jsx(Ue,{draft:s,onUpdate:g,onBack:T,onGoToStep:R,onSubmit:c})]},s.currentStep)})})]})}export{Ca as default};
