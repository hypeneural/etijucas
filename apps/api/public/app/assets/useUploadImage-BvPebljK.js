import{r as y}from"./vendor-radix-CQkmBfGK.js";import{c as B}from"./vendor-query-BnSlUk-m.js";import{t as E}from"./formatTimeAgo-zSCKQOWG.js";import{r as w}from"./index-CGYk0rI5.js";function S(r={}){const{maxSizeMB:u=5}=r,[i,o]=y.useState(0),[m,d]=y.useState(!1),t=B({mutationFn:async e=>{o(0);const s=e.size/(1024*1024);if(s>u)throw new Error(`Imagem muito grande (${s.toFixed(1)}MB). MÃ¡ximo: ${u}MB`);if(!e.type.startsWith("image/"))throw new Error("Arquivo deve ser uma imagem (JPEG, PNG ou WebP)");let a=e;if(s>1){d(!0);try{a=await M(e)}finally{d(!1)}}o(30);const n=await E.uploadImage(a);return o(100),n},onSuccess:e=>{w.success("ðŸ“· Imagem enviada!"),r.onSuccess?.(e)},onError:e=>{const s=e instanceof Error?e.message:"Erro ao enviar imagem";s.includes("413")||s.includes("too large")?w.error("âŒ Imagem muito grande. MÃ¡ximo 5MB."):w.error(`âŒ ${s}`),r.onError?.(e instanceof Error?e:new Error(s))}});return{upload:t.mutate,uploadAsync:t.mutateAsync,isUploading:t.isPending,isCompressing:m,progress:i,error:t.error,reset:()=>{t.reset(),o(0)}}}async function M(r,u=2e3){return new Promise((i,o)=>{const m=new FileReader;m.onload=d=>{const t=new Image;t.onload=async()=>{const e=r.size/1048576;let s=e>3?.6:e>2?.7:.8,a=e>3?1024:1280;const n=document.createElement("canvas");let c=t.width,g=t.height;c>a&&(g=g*a/c,c=a),n.width=c,n.height=g;const f=n.getContext("2d");if(!f){i(r);return}f.drawImage(t,0,0,c,g);const h=p=>{n.toBlob(l=>{if(!l){i(r);return}if(l.size/1024>u&&p>.3){h(p-.1);return}const x=new File([l],r.name.replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg",lastModified:Date.now()});console.log(`[useUploadImage] Compressed: ${(r.size/1024).toFixed(0)}KB â†’ ${(x.size/1024).toFixed(0)}KB (quality: ${p.toFixed(1)})`),i(x)},"image/jpeg",p)};h(s)},t.onerror=o,t.src=d.target?.result},m.onerror=o,m.readAsDataURL(r)})}export{S as u};
