import{u as pe,r,P as q,K as he,f as D,M as G,C as J,j as e,m as n,A as ue,h as fe,b as $,i as ge,L as ye,k as be,H as je,S as Ne,l as ve,a as H,E as we,n as Ce}from"./vendor-app-CFsuVmH9.js";import{v as ke,c as u,a as y}from"./auth.service-BZPOLBHX.js";import{u as Se,a as Pe,B as P,c as b}from"./index-DeilxgjZ.js";import{c as K}from"./confetti.module-B5JVzsfH.js";import{I as E}from"./input-ClxaPzc5.js";import{L as A}from"./label-DFaz3-aU.js";import{C as Ee}from"./card-DCECeHj3.js";import{P as Ae}from"./PhoneInput-cq6Z3dHS.js";import{O as Oe}from"./OTPInput-Cf5eeYcd.js";import{A as Ve}from"./AddressAutocomplete-D41QnWX8.js";import"./slider-CN-_Dayh.js";import{P as W,m as L}from"./auth-utils-B5I9WPFS.js";const O=[{id:"phone",icon:q,label:"Telefone"},{id:"verify",icon:he,label:"Verificar"},{id:"profile",icon:D,label:"Perfil"},{id:"address",icon:G,label:"Endereço"},{id:"done",icon:J,label:"Pronto"}];function We(){const T=Se(),U=pe(),V=Pe(s=>s.setAuth),F=U.state,X=F?.phone,_=F?.otpVerified,[a,x]=r.useState(_?"profile":"phone"),j=O.findIndex(s=>s.id===a),[i,Q]=r.useState(X||""),[w,R]=r.useState(""),[Y,M]=r.useState(null),[l,Z]=r.useState(""),[C,ee]=r.useState(""),[d,se]=r.useState(""),[p,ae]=r.useState(""),[t,te]=r.useState({}),[k,re]=r.useState(!1),[f,m]=r.useState(!1),[N,c]=r.useState(null),ne=ke(u(i)),ie=w.length===6,S=W.test(d),v=d===p,oe=l.trim().length>=2&&S&&v,z=t.cep&&t.logradouro&&t.bairro,le=r.useCallback(()=>{const s=Math.max(0,j-1);x(O[s].id),c(null)},[j]),ce=r.useCallback(async()=>{c(null),m(!0);try{switch(a){case"phone":const s=await y.sendOtp({phone:u(i)});if(s.userExists){c("Este telefone já está cadastrado. Faça login.");return}const o=new Date(Date.now()+s.expiresIn*1e3);M(o),x("verify");break;case"verify":await y.verifyOtp({phone:u(i),code:w}),x("profile");break;case"profile":if(!W.test(d))throw new Error("A senha deve ter min. 8 chars, maiúscula, minúscula e número.");if(!v)throw new Error("As senhas não conferem");x("address");break;case"address":if(!t.cep||!t.logradouro||!t.bairro||!t.localidade||!t.uf)throw new Error("Endereço incompleto");const g={zipCode:t.cep,street:t.logradouro,number:t.numero||"S/N",neighborhood:t.bairro,city:t.localidade,state:t.uf,complement:t.complemento},h=await y.register({phone:u(i),nome:l.trim(),email:C.trim()||void 0,password:d,confirmPassword:p,address:g});V(h.user,h.token,h.refreshToken),x("done");break}}catch(s){c(L(s))}finally{m(!1)}},[a,i,w,l,C,d,p,S,v,t,V]),de=r.useCallback(async()=>{m(!0),c(null);try{const s=await y.sendOtp({phone:u(i)}),o=new Date(Date.now()+s.expiresIn*1e3);M(o),R("")}catch(s){c(s instanceof Error?s.message:"Erro ao reenviar código")}finally{m(!1)}},[i]),me=r.useCallback(async s=>{m(!0),c(null);try{await y.verifyOtp({phone:u(i),code:s}),x("profile")}catch(o){c(L(o)),R("")}finally{m(!1)}},[i]);r.useEffect(()=>{if(a==="done"){const o=Date.now()+3e3,g=()=>{K({particleCount:3,angle:60,spread:55,origin:{x:0},colors:["#22c55e","#3b82f6","#f59e0b"]}),K({particleCount:3,angle:120,spread:55,origin:{x:1},colors:["#22c55e","#3b82f6","#f59e0b"]}),Date.now()<o&&requestAnimationFrame(g)};g()}},[a]);const B=()=>{switch(a){case"phone":return ne;case"verify":return ie;case"profile":return oe;case"address":return z;default:return!1}},xe=()=>{switch(a){case"phone":return e.jsxs(n.div,{initial:{opacity:0,x:30},animate:{opacity:1,x:0},exit:{opacity:0,x:-30},className:"space-y-6",children:[e.jsxs("div",{className:"text-center mb-4",children:[e.jsx("div",{className:"inline-flex p-4 rounded-2xl bg-primary/10 mb-4",children:e.jsx(q,{className:"h-8 w-8 text-primary"})}),e.jsx("h2",{className:"text-xl font-semibold",children:"Seu WhatsApp"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Vamos enviar um código de verificação"})]}),e.jsx(Ae,{value:i,onChange:Q,error:N||void 0,autoFocus:!0})]},"phone");case"verify":return e.jsx(n.div,{initial:{opacity:0,x:30},animate:{opacity:1,x:0},exit:{opacity:0,x:-30},className:"space-y-4",children:e.jsx(Oe,{value:w,onChange:R,onComplete:me,onResend:de,expiresAt:Y||void 0,error:N||void 0,isResending:f,isVerifying:f,phone:`(${i.slice(0,2)}) ${i.slice(2,7)}-${i.slice(7)}`})},"verify");case"profile":return e.jsxs(n.div,{initial:{opacity:0,x:30},animate:{opacity:1,x:0},exit:{opacity:0,x:-30},className:"space-y-5",children:[e.jsxs("div",{className:"text-center mb-4",children:[e.jsx("div",{className:"inline-flex p-4 rounded-2xl bg-primary/10 mb-4",children:e.jsx(D,{className:"h-8 w-8 text-primary"})}),e.jsx("h2",{className:"text-xl font-semibold",children:"Seus dados"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Crie sua conta com segurança"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(A,{className:"flex items-center gap-2",children:[e.jsx(D,{className:"h-4 w-4"}),"Nome completo"]}),e.jsx(E,{type:"text",placeholder:"Seu nome",value:l,onChange:s=>Z(s.target.value),className:b("h-12 text-base",l.length>0&&l.trim().length<2&&"border-amber-400"),autoFocus:!0}),l.length>0&&l.trim().length<2&&e.jsx("p",{className:"text-xs text-amber-600 dark:text-amber-400",children:"Nome muito curto (mínimo 2 caracteres)"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(A,{className:"flex items-center gap-2",children:[e.jsx(ve,{className:"h-4 w-4"}),"E-mail ",e.jsx("span",{className:"text-muted-foreground text-xs",children:"(opcional)"})]}),e.jsx(E,{type:"email",placeholder:"seu@email.com",value:C,onChange:s=>ee(s.target.value),className:"h-12 text-base"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(A,{className:"flex items-center gap-2",children:[e.jsx(H,{className:"h-4 w-4"}),"Senha"]}),e.jsxs("div",{className:"relative",children:[e.jsx(E,{type:k?"text":"password",placeholder:"Mínimo 8 caracteres",value:d,onChange:s=>se(s.target.value),className:b("h-12 text-base pr-10",d.length>0&&!S&&"border-amber-400")}),e.jsx("button",{type:"button",onClick:()=>re(!k),className:"absolute right-3 top-3 text-muted-foreground hover:text-foreground",children:k?e.jsx(we,{className:"h-5 w-5"}):e.jsx(Ce,{className:"h-5 w-5"})})]}),d.length>0&&!S&&e.jsx("p",{className:"text-xs text-amber-600 dark:text-amber-400",children:"Mínimo 8 caracteres"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(A,{className:"flex items-center gap-2",children:[e.jsx(H,{className:"h-4 w-4"}),"Confirmar Senha"]}),e.jsx(E,{type:k?"text":"password",placeholder:"Repita a senha",value:p,onChange:s=>ae(s.target.value),className:b("h-12 text-base",p.length>0&&!v&&"border-red-400")}),p.length>0&&!v&&e.jsx("p",{className:"text-xs text-red-600 dark:text-red-400",children:"As senhas não conferem"})]})]},"profile");case"address":return e.jsxs(n.div,{initial:{opacity:0,x:30},animate:{opacity:1,x:0},exit:{opacity:0,x:-30},className:"space-y-4",children:[e.jsxs("div",{className:"text-center mb-4",children:[e.jsx("div",{className:"inline-flex p-4 rounded-2xl bg-primary/10 mb-4",children:e.jsx(G,{className:"h-8 w-8 text-primary"})}),e.jsx("h2",{className:"text-xl font-semibold",children:"Seu endereço"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Digite o CEP para preencher automaticamente"})]}),e.jsx(Ve,{value:t,onChange:te,error:N||void 0})]},"address");case"done":return e.jsxs(n.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"text-center py-8",children:[e.jsx(n.div,{initial:{scale:0},animate:{scale:1},transition:{type:"spring",delay:.2,bounce:.5},className:"inline-flex p-6 rounded-full bg-green-100 dark:bg-green-900/30 mb-6",children:e.jsx(be,{className:"h-12 w-12 text-green-600 dark:text-green-400"})}),e.jsx(n.h2,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},className:"text-2xl font-bold",children:"Bem-vindo(a)!"}),e.jsxs(n.p,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4},className:"text-muted-foreground mt-2",children:[l,", sua conta foi criada com sucesso!"]}),e.jsx(n.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.6},className:"mt-8",children:e.jsxs(P,{size:"lg",className:"h-14 px-8 rounded-2xl bg-gradient-to-r from-green-600 to-green-500",onClick:()=>T("/"),children:[e.jsx(je,{className:"h-5 w-5 mr-2"}),"Explorar o app",e.jsx(Ne,{className:"h-5 w-5 ml-2"})]})})]},"done")}};return e.jsxs("div",{className:"min-h-screen flex flex-col bg-gradient-to-br from-primary/5 via-background to-primary/10",children:[e.jsxs(n.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"p-4 flex items-center justify-between",children:[a!=="done"?e.jsx(P,{variant:"ghost",size:"icon",onClick:j>0?le:()=>T("/login"),className:"rounded-xl",children:e.jsx(ue,{className:"h-5 w-5"})}):e.jsx("div",{}),e.jsx("h1",{className:"font-semibold text-lg",children:a==="done"?"Sucesso!":"Criar conta"}),e.jsx("div",{className:"w-10"})]}),a!=="done"&&e.jsx(n.div,{initial:{opacity:0},animate:{opacity:1},className:"px-6 mb-6",children:e.jsx("div",{className:"flex items-center justify-between mb-2",children:O.slice(0,-1).map((s,o)=>{const g=s.icon,h=o===j,I=o<j;return e.jsxs("div",{className:"flex items-center",children:[e.jsx(n.div,{animate:{scale:h?1.1:1,backgroundColor:I?"rgb(34, 197, 94)":h?"hsl(var(--primary))":"hsl(var(--muted))"},className:b("w-10 h-10 rounded-full flex items-center justify-center","transition-colors"),children:I?e.jsx(J,{className:"h-5 w-5 text-white"}):e.jsx(g,{className:b("h-5 w-5",h?"text-white":"text-muted-foreground")})}),o<O.length-2&&e.jsx(n.div,{animate:{backgroundColor:I?"rgb(34, 197, 94)":"hsl(var(--muted))"},className:"w-8 h-1 mx-1 rounded-full"})]},s.id)})})}),e.jsx("div",{className:"flex-1 px-6 overflow-y-auto pb-32",children:e.jsxs(Ee,{className:"p-6 shadow-xl border-0 bg-background/80 backdrop-blur-xl",children:[e.jsx(fe,{mode:"wait",children:xe()}),N&&a!=="verify"&&e.jsx(n.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"mt-4 p-3 rounded-xl bg-red-50 dark:bg-red-950/30 border border-red-200 dark:border-red-800",children:e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400 text-center",children:N})})]})}),a!=="done"&&a!=="verify"&&e.jsxs(n.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"fixed bottom-0 left-0 right-0 p-4 pb-8 bg-background/90 backdrop-blur-lg border-t",children:[a==="address"&&!z&&e.jsx(P,{variant:"ghost",size:"lg",onClick:async()=>{m(!0),c(null);try{const s=await y.register({phone:u(i),nome:l.trim(),email:C.trim()||void 0,password:d,confirmPassword:p});V(s.user,s.token,s.refreshToken),x("done")}catch(s){c(L(s))}finally{m(!1)}},disabled:f,className:"w-full h-12 mb-3 text-muted-foreground",children:f?e.jsxs(e.Fragment,{children:[e.jsx($,{className:"h-4 w-4 mr-2 animate-spin"}),"Criando conta..."]}):"Pular esta etapa"}),e.jsx(P,{size:"lg",onClick:ce,disabled:!B()||f,className:b("w-full h-14 text-lg font-semibold rounded-2xl","bg-gradient-to-r from-primary to-primary/80","shadow-lg shadow-primary/30",B()&&"hover:shadow-xl hover:shadow-primary/40"),children:f?e.jsxs(e.Fragment,{children:[e.jsx($,{className:"h-5 w-5 mr-2 animate-spin"}),a==="address"?"Criando conta...":"Verificando..."]}):e.jsxs(e.Fragment,{children:[a==="address"?"Criar conta com endereço":"Continuar",e.jsx(ge,{className:"h-5 w-5 ml-2"})]})}),a==="phone"&&e.jsxs("p",{className:"text-center text-sm text-muted-foreground mt-4",children:["Já tem conta?"," ",e.jsx(ye,{to:"/login",className:"text-primary font-semibold hover:underline",children:"Entrar"})]})]})]})}export{We as default};
