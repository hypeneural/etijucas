const O="/api/v1",c={baseURL:O,timeout:1e4,retryAttempts:3,retryDelay:1e3},w={auth:{login:"/auth/login",sendOtp:"/auth/send-otp",resendOtp:"/auth/resend-otp",verifyOtp:"/auth/verify-otp",register:"/auth/register",forgotPassword:"/auth/forgot-password",resetPassword:"/auth/reset-password",refresh:"/auth/refresh",logout:"/auth/logout",me:"/auth/me"},users:{me:"/users/me",update:"/users/me",avatar:"/users/me/avatar",password:"/users/me/password",notifications:"/users/me/notifications"},reports:{list:"/reports",get:e=>`/reports/${e}`,create:"/reports",myReports:"/reports/me",like:e=>`/reports/${e}/like`,unlike:e=>`/reports/${e}/like`},forum:{topics:"/forum/topics",topic:e=>`/forum/topics/${e}`,createTopic:"/forum/topics",updateTopic:e=>`/forum/topics/${e}`,deleteTopic:e=>`/forum/topics/${e}`,likeTopic:e=>`/forum/topics/${e}/like`,saveTopic:e=>`/forum/topics/${e}/save`,reportTopic:e=>`/forum/topics/${e}/report`,savedTopics:"/forum/saved",comments:e=>`/forum/topics/${e}/comments`,deleteComment:(e,t)=>`/forum/topics/${e}/comments/${t}`,likeComment:e=>`/forum/comments/${e}/like`,reportComment:e=>`/forum/comments/${e}/report`,upload:"/forum/upload"},topics:{list:"/forum/topics",get:e=>`/forum/topics/${e}`,create:"/forum/topics",update:e=>`/forum/topics/${e}`,delete:e=>`/forum/topics/${e}`,like:e=>`/forum/topics/${e}/like`,unlike:e=>`/forum/topics/${e}/like`,comments:e=>`/forum/topics/${e}/comments`},events:{list:"/events",get:e=>`/events/${e}`,upcoming:"/events/upcoming",today:"/events/today",weekend:"/events/weekend",featured:"/events/featured",search:"/events/search",homeFeatured:"/events/home-featured",calendarSummary:"/events/calendar-summary",byDate:e=>`/events/date/${e}`,byMonth:(e,t)=>`/events/month/${e}/${t}`,byCategory:e=>`/events/category/${e}`,byBairro:e=>`/events/bairro/${e}`,byVenue:e=>`/events/venue/${e}`,byTag:e=>`/events/tag/${e}`,byOrganizer:e=>`/events/organizer/${e}`,categories:"/events/categories",tags:"/events/tags",tagsTrending:"/events/tags/trending",rsvp:e=>`/events/${e}/rsvp`,attendees:e=>`/events/${e}/attendees`,favorite:e=>`/events/${e}/favorite`,myEvents:"/users/me/events",myFavorites:"/users/me/favorites/events"},trash:{schedules:"/trash/schedules",byBairro:e=>`/trash/schedules/bairro/${e}`,today:"/trash/today",next:"/trash/next",types:"/trash/types"},masses:{list:"/masses",byBairro:e=>`/masses/bairro/${e}`,today:"/masses/today",tomorrow:"/masses/tomorrow"},phones:{list:"/phones",byCategory:e=>`/phones/category/${e}`,search:"/phones/search"},alerts:{list:"/alerts",get:e=>`/alerts/${e}`,active:"/alerts/active"},bairros:{list:"/bairros",get:e=>`/bairros/${e}`},tourism:{spots:"/tourism/spots",get:e=>`/tourism/spots/${e}`,categories:"/tourism/categories",like:e=>`/tourism/spots/${e}/like`,save:e=>`/tourism/spots/${e}/save`,reviews:e=>`/tourism/spots/${e}/reviews`,createReview:e=>`/tourism/spots/${e}/reviews`,deleteReview:e=>`/tourism/reviews/${e}`},uploads:{image:"/uploads/image",images:"/uploads/images"}},R={topics:{all:["topics"],list:e=>["topics","list",e],detail:e=>["topics","detail",e],comments:e=>["topics",e,"comments"]},tourism:{all:["tourism"],spots:e=>["tourism","spots",e],detail:e=>["tourism","detail",e],reviews:e=>["tourism",e,"reviews"],categories:["tourism","categories"]}},U=Object.freeze(Object.defineProperty({__proto__:null,API_CONFIG:c,ENDPOINTS:w,QUERY_KEYS:R},Symbol.toStringTag,{value:"Module"})),y="etijucas_token",$="etijucas_refresh_token";let h=!1,p=null;function b(){return localStorage.getItem(y)}function _(){return localStorage.getItem($)}function k(e,t){localStorage.setItem(y,e),localStorage.setItem($,t)}function g(){localStorage.removeItem(y),localStorage.removeItem($)}class i extends Error{constructor(t,o,m,a){super(t),this.status=o,this.code=m,this.errors=a,this.name="ApiError"}}const A=e=>new Promise(t=>setTimeout(t,e));function E(e,t){const o=c.baseURL.endsWith("/")?c.baseURL.slice(0,-1):c.baseURL,m=e.startsWith("/")?e:`/${e}`;let a=`${o}${m}`;if(t){const l=new URLSearchParams;Object.entries(t).forEach(([v,u])=>{u!=null&&l.append(v,String(u))});const f=l.toString();f&&(a+=(a.includes("?")?"&":"?")+f)}return a}function P(e){if(typeof navigator<"u"&&"connection"in navigator){const t=navigator.connection;if(t?.saveData||t?.effectiveType==="slow-2g"||t?.effectiveType==="2g")return 3e3;if(t?.effectiveType==="3g")return 5e3}return e}async function j(){if(h&&p)return p;const e=_();return e?(h=!0,p=(async()=>{try{const t=await fetch(E(w.auth.refresh,void 0),{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({refreshToken:e})});if(!t.ok)return g(),null;const o=await t.json();return k(o.token,o.refreshToken),o.token}catch{return g(),null}finally{h=!1,p=null}})(),p):null}async function n(e,t={},o=1){if(typeof navigator<"u"&&!navigator.onLine)throw new i("Você está offline. Os dados serão sincronizados quando a conexão voltar.",0,"OFFLINE");const{params:m,timeout:a,...l}=t,f=a??P(c.timeout),v=E(e,m),u=new AbortController,T=setTimeout(()=>u.abort(),f);try{const s=b(),S={"Content-Type":"application/json",Accept:"application/json","X-App-Version":"1.0.0",...s&&{Authorization:`Bearer ${s}`},...l.headers},r=await fetch(v,{...l,signal:u.signal,headers:S});if(clearTimeout(T),r.status===401){if(!t._skipRefresh&&!h&&await j())return n(e,{...t,_skipRefresh:!0},o);throw g(),new i("Sessão expirada. Faça login novamente.",401,"UNAUTHENTICATED")}if(!r.ok){const d=await r.json().catch(()=>({}));throw new i(d.message||`HTTP ${r.status}: ${r.statusText}`,r.status,d.code,d.errors)}return r.status===204?{}:r.json()}catch(s){if(clearTimeout(T),s instanceof i&&s.status>=400&&s.status<500)throw s;if(o<c.retryAttempts)return await A(c.retryDelay*o),n(e,t,o+1);throw s instanceof Error&&s.name==="AbortError"?new i("Request timeout",408):s instanceof i?s:new i(s instanceof Error?s.message:"Network error",0)}}const I={get:(e,t)=>n(e,{method:"GET",params:t}),post:(e,t)=>n(e,{method:"POST",body:t?JSON.stringify(t):void 0}),put:(e,t)=>n(e,{method:"PUT",body:t?JSON.stringify(t):void 0}),patch:(e,t)=>n(e,{method:"PATCH",body:t?JSON.stringify(t):void 0}),delete:e=>n(e,{method:"DELETE"})},C=Object.freeze(Object.defineProperty({__proto__:null,ApiError:i,apiClient:I,clearAuthToken:g,getAuthToken:b,setTokens:k},Symbol.toStringTag,{value:"Module"}));export{c as A,w as E,R as Q,I as a,U as b,g as c,C as d,k as s};
