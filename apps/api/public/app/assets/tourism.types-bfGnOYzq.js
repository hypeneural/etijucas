import{r as d}from"./vendor-radix-i3jPA7eY.js";import{b as A,u as D,c as C}from"./vendor-query-1wfeA5IL.js";import{a as u,s as R}from"./localDatabase-RO7l9csX.js";import{a as l,E as g,Q as n,C as L}from"./client-IB6zYSiJ.js";import{h as E}from"./index-Csyk3IMF.js";const w={async getAll(){try{console.log("[TourismService] Fetching from API...");const a=await l.get(g.tourism.spots);return a.data&&a.data.length>0&&(await u.clear(),await u.saveMany(a.data),console.log("[TourismService] Cached",a.data.length,"spots to IndexedDB")),a.data||[]}catch(a){return console.warn("[TourismService] API failed, using cache:",a),await u.getAll()||[]}},async getById(a){try{return(await l.get(g.tourism.get(a))).data}catch{return console.warn("[TourismService] API failed for getById, using cache"),(await u.getAll()).find(s=>s.id===a)}},async getReviews(a){try{return(await l.get(g.tourism.reviews(a))).data||[]}catch(o){return console.warn("[TourismService] Failed to fetch reviews:",o),[]}},async toggleLike(a){return await l.post(g.tourism.like(a))},async toggleSave(a){return await l.post(g.tourism.save(a))},async createReview(a,o){return(await l.post(g.tourism.createReview(a),o)).data},async deleteReview(a){await l.delete(g.tourism.deleteReview(a))},async refresh(){await u.clear(),await this.getAll()}};function I(a){const o=A(),{isOnline:c}=E(),{data:s=[],isLoading:y,error:v,refetch:f}=D({queryKey:[...n.tourism.spots(),"enhanced"],queryFn:async()=>{if(c)try{const t=await w.getAll();return t&&t.length>0&&(await u.clear(),await u.saveMany(t)),t}catch(t){console.warn("[Tourism] API failed, using cache:",t)}const e=await u.getAll();return e.length>0?e:[]},staleTime:L.events}),b=d.useMemo(()=>{if(!s.length)return[];let e=[...s];if(a?.categoria&&(e=e.filter(t=>t.categoria===a.categoria)),a?.tags?.length&&(e=e.filter(t=>a.tags.some(r=>t.tags.includes(r)))),a?.bairroId&&(e=e.filter(t=>t.bairroId===a.bairroId)),a?.preco&&(e=e.filter(t=>t.preco===a.preco)),a?.rating&&(e=e.filter(t=>t.rating>=a.rating)),a?.search){const t=a.search.toLowerCase();e=e.filter(r=>r.titulo.toLowerCase().includes(t)||r.descCurta?.toLowerCase().includes(t)||r.descLonga?.toLowerCase().includes(t)||r.tags.some(i=>i.toLowerCase().includes(t))||r.bairroNome?.toLowerCase().includes(t))}switch(a?.sortBy){case"rating":e.sort((t,r)=>r.rating-t.rating);break;case"reviews":e.sort((t,r)=>r.reviewsCount-t.reviewsCount);break;case"popular":e.sort((t,r)=>r.likesCount-t.likesCount);break;case"recent":e.sort((t,r)=>new Date(r.createdAt).getTime()-new Date(t.createdAt).getTime());break;default:e.sort((t,r)=>t.isDestaque&&!r.isDestaque?-1:!t.isDestaque&&r.isDestaque?1:r.rating-t.rating)}return e},[s,a]),h=d.useCallback(e=>s.find(t=>t.id===e),[s]),p=d.useCallback(async e=>{try{return await w.getReviews(e)}catch{return[]}},[]),m=d.useMemo(()=>s.filter(e=>e.isDestaque).slice(0,4),[s]),S=d.useMemo(()=>{const e=new Set;return s.forEach(t=>t.tags.forEach(r=>e.add(r))),Array.from(e).sort()},[s]),M=d.useMemo(()=>{const e=new Set;return s.forEach(t=>{t.categoria&&e.add(t.categoria)}),Array.from(e)},[s]),k=C({mutationFn:async e=>(c||await R.add({type:"like",data:{spotId:e,entityType:"tourism"},idempotencyKey:`like-tourism-${e}-${Date.now()}`}),e),onMutate:async e=>{await o.cancelQueries({queryKey:n.tourism.spots()});const t=o.getQueryData([...n.tourism.spots(),"enhanced"]);return o.setQueryData([...n.tourism.spots(),"enhanced"],r=>r?.map(i=>i.id===e?{...i,liked:!i.liked,likesCount:i.likesCount+(i.liked?-1:1)}:i)),{previous:t}},onError:(e,t,r)=>{r?.previous&&o.setQueryData([...n.tourism.spots(),"enhanced"],r.previous)}}),T=C({mutationFn:async e=>(c||await R.add({type:"save",data:{spotId:e,entityType:"tourism"},idempotencyKey:`save-tourism-${e}-${Date.now()}`}),e),onMutate:async e=>{await o.cancelQueries({queryKey:n.tourism.spots()});const t=o.getQueryData([...n.tourism.spots(),"enhanced"]);return o.setQueryData([...n.tourism.spots(),"enhanced"],r=>r?.map(i=>i.id===e?{...i,isSaved:!i.isSaved}:i)),{previous:t}},onError:(e,t,r)=>{r?.previous&&o.setQueryData([...n.tourism.spots(),"enhanced"],r.previous)}});return{spots:b,rawSpots:s,featuredSpots:m,allTags:S,usedCategories:M,getSpotById:h,getReviews:p,isLoading:y,error:v,isOnline:c,refetch:f,likeSpot:k.mutate,saveSpot:T.mutate,isLiking:k.isPending,isSaving:T.isPending}}function O(a){A();const{getSpotById:o,likeSpot:c,saveSpot:s,isLoading:y,refetch:v}=I(),f=d.useMemo(()=>o(a),[o,a]),{data:b=[],isLoading:h,refetch:p}=D({queryKey:n.tourism.reviews(a),queryFn:()=>w.getReviews(a),enabled:!!a,staleTime:5*60*1e3}),m=C({mutationFn:S=>w.createReview(a,S),onSuccess:()=>{p(),v()}});return{spot:f,reviews:b,isLoading:y,reviewsLoading:h,likeSpot:()=>c(a),saveSpot:()=>s(a),createReview:m.mutate,isCreatingReview:m.isPending,refetchReviews:p}}const $={natureza:{label:"Natureza",icon:"ğŸŒ¿",color:"bg-green-100 text-green-700"},cultura:{label:"Cultura",icon:"ğŸ­",color:"bg-purple-100 text-purple-700"},historia:{label:"HistÃ³ria",icon:"ğŸ›ï¸",color:"bg-amber-100 text-amber-700"},gastronomia:{label:"Gastronomia",icon:"ğŸ½ï¸",color:"bg-orange-100 text-orange-700"},aventura:{label:"Aventura",icon:"ğŸ§—",color:"bg-red-100 text-red-700"},praia:{label:"Praia",icon:"ğŸ–ï¸",color:"bg-cyan-100 text-cyan-700"},religioso:{label:"Religioso",icon:"â›ª",color:"bg-indigo-100 text-indigo-700"},familia:{label:"FamÃ­lia",icon:"ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦",color:"bg-pink-100 text-pink-700"},compras:{label:"Compras",icon:"ğŸ›ï¸",color:"bg-rose-100 text-rose-700"},lazer:{label:"Lazer",icon:"ğŸ¡",color:"bg-teal-100 text-teal-700"}},B=[{value:"rating",label:"Mais bem avaliados"},{value:"reviews",label:"Mais comentados"},{value:"popular",label:"Mais populares"},{value:"recent",label:"Adicionados recentemente"}],F={gratis:{label:"Gratuito",icon:"ğŸ†“"},barato:{label:"$",icon:"ğŸ’µ"},moderado:{label:"$$",icon:"ğŸ’µğŸ’µ"},caro:{label:"$$$",icon:"ğŸ’µğŸ’µğŸ’µ"}};export{F as P,$ as T,I as a,B as b,O as u};
