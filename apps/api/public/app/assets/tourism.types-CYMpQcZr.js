import{aU as D,r as d,Z as E,aV as C}from"./vendor-app-CFsuVmH9.js";import{v as c,d as l,E as g,i as L,Q as n,q as R}from"./index-DeilxgjZ.js";const w={async getAll(){try{console.log("[TourismService] Fetching from API...");const a=await l.get(g.tourism.spots);return a.data&&a.data.length>0&&(await c.clear(),await c.saveMany(a.data),console.log("[TourismService] Cached",a.data.length,"spots to IndexedDB")),a.data||[]}catch(a){return console.warn("[TourismService] API failed, using cache:",a),await c.getAll()||[]}},async getById(a){try{return(await l.get(g.tourism.get(a))).data}catch{return console.warn("[TourismService] API failed for getById, using cache"),(await c.getAll()).find(s=>s.id===a)}},async getReviews(a){try{return(await l.get(g.tourism.reviews(a))).data||[]}catch(r){return console.warn("[TourismService] Failed to fetch reviews:",r),[]}},async toggleLike(a){return await l.post(g.tourism.like(a))},async toggleSave(a){return await l.post(g.tourism.save(a))},async createReview(a,r){return(await l.post(g.tourism.createReview(a),r)).data},async deleteReview(a){await l.delete(g.tourism.deleteReview(a))},async refresh(){await c.clear(),await this.getAll()}},T="2",A="etijucas-tourism-cache-version";async function _(){return localStorage.getItem(A)!==T?(console.log("[Tourism] Cache version changed, clearing IndexedDB..."),await c.clear(),localStorage.setItem(A,T),!0):!1}function q(a){const r=D(),{isOnline:u}=L(),{data:s=[],isLoading:y,error:v,refetch:h}=E({queryKey:[...n.tourism.spots(),"enhanced",T],queryFn:async()=>{if(await _(),u)try{console.log("[Tourism] Fetching from API...");const t=await w.getAll();return console.log("[Tourism] API returned:",t?.length||0,"spots"),t&&t.length>0&&(await c.clear(),await c.saveMany(t),console.log("[Tourism] Cached to IndexedDB")),t}catch(t){console.warn("[Tourism] API failed:",t)}console.log("[Tourism] Trying IndexedDB cache...");const e=await c.getAll();return e.length>0?(console.log("[Tourism] Using cached data:",e.length,"spots"),e):(console.log("[Tourism] No data available"),[])},staleTime:5*60*1e3}),f=d.useMemo(()=>{if(!s.length)return[];let e=[...s];if(a?.categoria&&(e=e.filter(t=>t.categoria===a.categoria)),a?.tags?.length&&(e=e.filter(t=>a.tags.some(o=>t.tags.includes(o)))),a?.bairroId&&(e=e.filter(t=>t.bairroId===a.bairroId)),a?.preco&&(e=e.filter(t=>t.preco===a.preco)),a?.rating&&(e=e.filter(t=>t.rating>=a.rating)),a?.search){const t=a.search.toLowerCase();e=e.filter(o=>o.titulo.toLowerCase().includes(t)||o.descCurta?.toLowerCase().includes(t)||o.descLonga?.toLowerCase().includes(t)||o.tags.some(i=>i.toLowerCase().includes(t))||o.bairroNome?.toLowerCase().includes(t))}switch(a?.sortBy){case"rating":e.sort((t,o)=>o.rating-t.rating);break;case"reviews":e.sort((t,o)=>o.reviewsCount-t.reviewsCount);break;case"popular":e.sort((t,o)=>o.likesCount-t.likesCount);break;case"recent":e.sort((t,o)=>new Date(o.createdAt).getTime()-new Date(t.createdAt).getTime());break;default:e.sort((t,o)=>t.isDestaque&&!o.isDestaque?-1:!t.isDestaque&&o.isDestaque?1:o.rating-t.rating)}return e},[s,a]),b=d.useCallback(e=>s.find(t=>t.id===e),[s]),m=d.useCallback(async e=>{try{return await w.getReviews(e)}catch{return[]}},[]),p=d.useMemo(()=>s.filter(e=>e.isDestaque).slice(0,4),[s]),S=d.useMemo(()=>{const e=new Set;return s.forEach(t=>t.tags.forEach(o=>e.add(o))),Array.from(e).sort()},[s]),M=d.useMemo(()=>{const e=new Set;return s.forEach(t=>{t.categoria&&e.add(t.categoria)}),Array.from(e)},[s]),k=C({mutationFn:async e=>(u||await R.add({type:"like",data:{spotId:e,entityType:"tourism"},idempotencyKey:`like-tourism-${e}-${Date.now()}`}),e),onMutate:async e=>{await r.cancelQueries({queryKey:n.tourism.spots()});const t=r.getQueryData([...n.tourism.spots(),"enhanced"]);return r.setQueryData([...n.tourism.spots(),"enhanced"],o=>o?.map(i=>i.id===e?{...i,liked:!i.liked,likesCount:i.likesCount+(i.liked?-1:1)}:i)),{previous:t}},onError:(e,t,o)=>{o?.previous&&r.setQueryData([...n.tourism.spots(),"enhanced"],o.previous)}}),I=C({mutationFn:async e=>(u||await R.add({type:"save",data:{spotId:e,entityType:"tourism"},idempotencyKey:`save-tourism-${e}-${Date.now()}`}),e),onMutate:async e=>{await r.cancelQueries({queryKey:n.tourism.spots()});const t=r.getQueryData([...n.tourism.spots(),"enhanced"]);return r.setQueryData([...n.tourism.spots(),"enhanced"],o=>o?.map(i=>i.id===e?{...i,isSaved:!i.isSaved}:i)),{previous:t}},onError:(e,t,o)=>{o?.previous&&r.setQueryData([...n.tourism.spots(),"enhanced"],o.previous)}});return{spots:f,rawSpots:s,featuredSpots:p,allTags:S,usedCategories:M,getSpotById:b,getReviews:m,isLoading:y,error:v,isOnline:u,refetch:h,likeSpot:k.mutate,saveSpot:I.mutate,isLiking:k.isPending,isSaving:I.isPending}}function O(a){D();const{getSpotById:r,likeSpot:u,saveSpot:s,isLoading:y,refetch:v}=q(),h=d.useMemo(()=>r(a),[r,a]),{data:f=[],isLoading:b,refetch:m}=E({queryKey:n.tourism.reviews(a),queryFn:()=>w.getReviews(a),enabled:!!a,staleTime:5*60*1e3}),p=C({mutationFn:S=>w.createReview(a,S),onSuccess:()=>{m(),v()}});return{spot:h,reviews:f,isLoading:y,reviewsLoading:b,likeSpot:()=>u(a),saveSpot:()=>s(a),createReview:p.mutate,isCreatingReview:p.isPending,refetchReviews:m}}const Q={natureza:{label:"Natureza",icon:"ğŸŒ¿",color:"bg-green-100 text-green-700"},cultura:{label:"Cultura",icon:"ğŸ­",color:"bg-purple-100 text-purple-700"},historia:{label:"HistÃ³ria",icon:"ğŸ›ï¸",color:"bg-amber-100 text-amber-700"},gastronomia:{label:"Gastronomia",icon:"ğŸ½ï¸",color:"bg-orange-100 text-orange-700"},aventura:{label:"Aventura",icon:"ğŸ§—",color:"bg-red-100 text-red-700"},praia:{label:"Praia",icon:"ğŸ–ï¸",color:"bg-cyan-100 text-cyan-700"},religioso:{label:"Religioso",icon:"â›ª",color:"bg-indigo-100 text-indigo-700"},familia:{label:"FamÃ­lia",icon:"ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦",color:"bg-pink-100 text-pink-700"},compras:{label:"Compras",icon:"ğŸ›ï¸",color:"bg-rose-100 text-rose-700"},lazer:{label:"Lazer",icon:"ğŸ¡",color:"bg-teal-100 text-teal-700"}},B=[{value:"rating",label:"Mais bem avaliados"},{value:"reviews",label:"Mais comentados"},{value:"popular",label:"Mais populares"},{value:"recent",label:"Adicionados recentemente"}],$={gratis:{label:"Gratuito",icon:"ğŸ†“"},barato:{label:"$",icon:"ğŸ’µ"},moderado:{label:"$$",icon:"ğŸ’µğŸ’µ"},caro:{label:"$$$",icon:"ğŸ’µğŸ’µğŸ’µ"}};export{$ as P,Q as T,q as a,B as b,O as u};
