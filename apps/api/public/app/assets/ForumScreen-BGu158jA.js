import{aR as Y,aQ as qe,r as h,aS as ue,a as Qe,j as e,m as g,y as ke,X as V,bI as We,aJ as Ke,M as Q,b0 as Ue,ah as ae,l as re,a9 as Se,bw as Te,bJ as ie,ax as He,O as Ve,ay as Ye,aY as Ge,a6 as P,W as Je,bK as Xe,o as Ee,ak as Ze,a8 as et,x as tt,$ as st,b4 as at,ar as rt,bf as Ie,bL as Oe,ao as it,aI as nt,be as ot,bM as lt,b1 as ct,K as dt,bv as ut}from"./vendor-app-B8nTTOoa.js";import{i as G,C as D,D as ne,h as B,c as ee,B as q,a as me,Q as R,d as mt,E as ht,f as ft,u as xt}from"./index-DCL-AqRy.js";import{u as gt}from"./useAppStore-BzXpTAO0.js";import{t as he,u as pt}from"./useUploadImage-CjV9LSmm.js";import{f as bt,a as vt,c as ge}from"./formatTimeAgo-EjzWxCyI.js";import{a as Ae}from"./useCityName-DUrWkBfG.js";import{I as Me}from"./input-Cl-fV-tt.js";import{S as oe,a as le,b as ce,c as de,d as _}from"./select-DK_g6Otv.js";import{u as Fe,a as yt}from"./useBairros-Ca0eLQc_.js";import{B as jt}from"./badge-DPVuWgFP.js";import{S as wt,a as Ct,b as Nt,c as kt}from"./sheet-D567H5Ek.js";import{T as St}from"./textarea-B8kNL_A9.js";import{S as Tt}from"./switch-Cbzd0rOf.js";import"./dropdown-menu-CdYQTbrW.js";import{u as Et}from"./useHaptic-D9J3ZOOx.js";import"./bairros-Cf5Z_oCw.js";import"./bairro.service-mjJtcZeS.js";const F=["offline","topics"];function It(r){r.invalidateQueries({queryKey:F}),r.invalidateQueries({queryKey:["topics"]})}function Ot(r){const{isOnline:l}=G(),t=Y(),a=qe({queryKey:[...F,r],queryFn:async()=>{let s=await D.getAll();if(l)try{const i=await he.getAll({categoria:r?.categoria!=="all"?r?.categoria:void 0,search:r?.search});i.data&&i.data.length>0&&(await D.saveMany(i.data),s=i.data)}catch(i){console.warn("[useOfflineTopics] API failed, using cache:",i)}if(r?.categoria&&r.categoria!=="all"&&(s=s.filter(i=>i.categoria===r.categoria)),r?.search){const i=r.search.toLowerCase();s=s.filter(o=>o.titulo.toLowerCase().includes(i)||o.texto.toLowerCase().includes(i))}return s.sort((i,o)=>new Date(o.createdAt).getTime()-new Date(i.createdAt).getTime())},staleTime:1e3*60*2,gcTime:1e3*60*60*24});return h.useEffect(()=>{l&&t.invalidateQueries({queryKey:F})},[l,t]),a}function At(){const r=Y(),{isOnline:l}=G();return ue({mutationFn:async t=>{if(console.log("[useCreateOfflineTopic] Creating topic, online:",l,"bairroId:",t.bairroId),!l){const a={id:`temp-${Date.now()}-${Math.random().toString(36).slice(2)}`,titulo:t.titulo,texto:t.texto,categoria:t.categoria,bairroId:t.bairroId,fotoUrl:t.fotoUrl,isAnon:t.isAnon??!1,autorNome:t.isAnon?"An√¥nimo":"Voc√™",likesCount:0,commentsCount:0,liked:!1,createdAt:new Date};return await D.save(a),await ne.add({type:"topic",data:t,idempotencyKey:`topic-${a.id}`}),B.info("üì¥ T√≥pico salvo offline. Ser√° enviado quando voltar online."),a}try{const a=await he.create(t);return B.success("‚úÖ T√≥pico publicado com sucesso!"),a}catch(a){const s=a instanceof Error?a.message:"Erro desconhecido";throw console.error("[useCreateOfflineTopic] Failed:",s),B.error(`‚ùå Falha ao publicar: ${s}`),a}},onMutate:async t=>{await r.cancelQueries({queryKey:F});const a=r.getQueryData(F),s={id:`temp-${Date.now()}`,titulo:t.titulo,texto:t.texto,categoria:t.categoria,bairroId:t.bairroId,fotoUrl:t.fotoUrl,isAnon:t.isAnon??!1,likesCount:0,commentsCount:0,confirmsCount:0,supportsCount:0,createdAt:new Date().toISOString(),syncStatus:"pending"};return a&&r.setQueryData(F,[s,...a]),{previousTopics:a}},onSuccess:()=>{It(r)},onError:(t,a,s)=>{s?.previousTopics&&r.setQueryData(F,s.previousTopics)}})}function Mt(){const r=Y(),{isOnline:l}=G();return ue({onMutate:async({id:t,currentlyLiked:a})=>{await r.cancelQueries({queryKey:F});const s=r.getQueryData(F);r.setQueryData(F,o=>o&&o.map(n=>n.id===t?{...n,liked:!a,likesCount:a?Math.max(0,n.likesCount-1):n.likesCount+1}:n));const i=await D.getById(t);if(i){const o={...i,liked:!a,likesCount:a?Math.max(0,i.likesCount-1):i.likesCount+1};await D.save(o)}return{previousTopics:s,topicId:t}},mutationFn:async({id:t,currentlyLiked:a})=>{if(l)try{const s=await he.toggleLike(t),i=await D.getById(t);return i&&await D.save({...i,liked:s.liked,likesCount:s.likesCount}),{id:t,newLiked:s.liked,likesCount:s.likesCount}}catch(s){console.error("[useLikeOfflineTopic] API failed:",s),await ne.add({type:"like",data:{topicId:t},idempotencyKey:`like-${t}-${Date.now()}`})}else await ne.add({type:"like",data:{topicId:t},idempotencyKey:`like-${t}-${Date.now()}`});return{id:t,newLiked:!a}},onError:(t,a,s)=>{s?.previousTopics&&r.setQueryData(F,s.previousTopics)},onSettled:()=>{setTimeout(()=>{r.invalidateQueries({queryKey:F})},500)}})}function $(r,l,t){let a=t.initialDeps??[],s,i=!0;function o(){var n,d,m;let c;t.key&&((n=t.debug)!=null&&n.call(t))&&(c=Date.now());const x=r();if(!(x.length!==a.length||x.some((T,v)=>a[v]!==T)))return s;a=x;let y;if(t.key&&((d=t.debug)!=null&&d.call(t))&&(y=Date.now()),s=l(...x),t.key&&((m=t.debug)!=null&&m.call(t))){const T=Math.round((Date.now()-c)*100)/100,v=Math.round((Date.now()-y)*100)/100,w=v/16,j=(k,E)=>{for(k=String(k);k.length<E;)k=" "+k;return k};console.info(`%c‚è± ${j(v,5)} /${j(T,5)} ms`,`
            font-size: .6rem;
            font-weight: bold;
            color: hsl(${Math.max(0,Math.min(120-120*w,120))}deg 100% 31%);`,t?.key)}return t?.onChange&&!(i&&t.skipInitialOnChange)&&t.onChange(s),i=!1,s}return o.updateDeps=n=>{a=n},o}function pe(r,l){if(r===void 0)throw new Error("Unexpected undefined");return r}const Ft=(r,l)=>Math.abs(r-l)<1.01,zt=(r,l,t)=>{let a;return function(...s){r.clearTimeout(a),a=r.setTimeout(()=>l.apply(this,s),t)}},be=r=>{const{offsetWidth:l,offsetHeight:t}=r;return{width:l,height:t}},Lt=r=>r,Rt=r=>{const l=Math.max(r.startIndex-r.overscan,0),t=Math.min(r.endIndex+r.overscan,r.count-1),a=[];for(let s=l;s<=t;s++)a.push(s);return a},Dt=(r,l)=>{const t=r.scrollElement;if(!t)return;const a=r.targetWindow;if(!a)return;const s=o=>{const{width:n,height:d}=o;l({width:Math.round(n),height:Math.round(d)})};if(s(be(t)),!a.ResizeObserver)return()=>{};const i=new a.ResizeObserver(o=>{const n=()=>{const d=o[0];if(d?.borderBoxSize){const m=d.borderBoxSize[0];if(m){s({width:m.inlineSize,height:m.blockSize});return}}s(be(t))};r.options.useAnimationFrameWithResizeObserver?requestAnimationFrame(n):n()});return i.observe(t,{box:"border-box"}),()=>{i.unobserve(t)}},ve={passive:!0},ye=typeof window>"u"?!0:"onscrollend"in window,_t=(r,l)=>{const t=r.scrollElement;if(!t)return;const a=r.targetWindow;if(!a)return;let s=0;const i=r.options.useScrollendEvent&&ye?()=>{}:zt(a,()=>{l(s,!1)},r.options.isScrollingResetDelay),o=c=>()=>{const{horizontal:x,isRtl:f}=r.options;s=x?t.scrollLeft*(f&&-1||1):t.scrollTop,i(),l(s,c)},n=o(!0),d=o(!1);t.addEventListener("scroll",n,ve);const m=r.options.useScrollendEvent&&ye;return m&&t.addEventListener("scrollend",d,ve),()=>{t.removeEventListener("scroll",n),m&&t.removeEventListener("scrollend",d)}},$t=(r,l,t)=>{if(l?.borderBoxSize){const a=l.borderBoxSize[0];if(a)return Math.round(a[t.options.horizontal?"inlineSize":"blockSize"])}return r[t.options.horizontal?"offsetWidth":"offsetHeight"]},Pt=(r,{adjustments:l=0,behavior:t},a)=>{var s,i;const o=r+l;(i=(s=a.scrollElement)==null?void 0:s.scrollTo)==null||i.call(s,{[a.options.horizontal?"left":"top"]:o,behavior:t})};class Bt{constructor(l){this.unsubs=[],this.scrollElement=null,this.targetWindow=null,this.isScrolling=!1,this.currentScrollToIndex=null,this.measurementsCache=[],this.itemSizeCache=new Map,this.laneAssignments=new Map,this.pendingMeasuredCacheIndexes=[],this.prevLanes=void 0,this.lanesChangedFlag=!1,this.lanesSettling=!1,this.scrollRect=null,this.scrollOffset=null,this.scrollDirection=null,this.scrollAdjustments=0,this.elementsCache=new Map,this.observer=(()=>{let t=null;const a=()=>t||(!this.targetWindow||!this.targetWindow.ResizeObserver?null:t=new this.targetWindow.ResizeObserver(s=>{s.forEach(i=>{const o=()=>{this._measureElement(i.target,i)};this.options.useAnimationFrameWithResizeObserver?requestAnimationFrame(o):o()})}));return{disconnect:()=>{var s;(s=a())==null||s.disconnect(),t=null},observe:s=>{var i;return(i=a())==null?void 0:i.observe(s,{box:"border-box"})},unobserve:s=>{var i;return(i=a())==null?void 0:i.unobserve(s)}}})(),this.range=null,this.setOptions=t=>{Object.entries(t).forEach(([a,s])=>{typeof s>"u"&&delete t[a]}),this.options={debug:!1,initialOffset:0,overscan:1,paddingStart:0,paddingEnd:0,scrollPaddingStart:0,scrollPaddingEnd:0,horizontal:!1,getItemKey:Lt,rangeExtractor:Rt,onChange:()=>{},measureElement:$t,initialRect:{width:0,height:0},scrollMargin:0,gap:0,indexAttribute:"data-index",initialMeasurementsCache:[],lanes:1,isScrollingResetDelay:150,enabled:!0,isRtl:!1,useScrollendEvent:!1,useAnimationFrameWithResizeObserver:!1,...t}},this.notify=t=>{var a,s;(s=(a=this.options).onChange)==null||s.call(a,this,t)},this.maybeNotify=$(()=>(this.calculateRange(),[this.isScrolling,this.range?this.range.startIndex:null,this.range?this.range.endIndex:null]),t=>{this.notify(t)},{key:!1,debug:()=>this.options.debug,initialDeps:[this.isScrolling,this.range?this.range.startIndex:null,this.range?this.range.endIndex:null]}),this.cleanup=()=>{this.unsubs.filter(Boolean).forEach(t=>t()),this.unsubs=[],this.observer.disconnect(),this.scrollElement=null,this.targetWindow=null},this._didMount=()=>()=>{this.cleanup()},this._willUpdate=()=>{var t;const a=this.options.enabled?this.options.getScrollElement():null;if(this.scrollElement!==a){if(this.cleanup(),!a){this.maybeNotify();return}this.scrollElement=a,this.scrollElement&&"ownerDocument"in this.scrollElement?this.targetWindow=this.scrollElement.ownerDocument.defaultView:this.targetWindow=((t=this.scrollElement)==null?void 0:t.window)??null,this.elementsCache.forEach(s=>{this.observer.observe(s)}),this.unsubs.push(this.options.observeElementRect(this,s=>{this.scrollRect=s,this.maybeNotify()})),this.unsubs.push(this.options.observeElementOffset(this,(s,i)=>{this.scrollAdjustments=0,this.scrollDirection=i?this.getScrollOffset()<s?"forward":"backward":null,this.scrollOffset=s,this.isScrolling=i,this.maybeNotify()})),this._scrollToOffset(this.getScrollOffset(),{adjustments:void 0,behavior:void 0})}},this.getSize=()=>this.options.enabled?(this.scrollRect=this.scrollRect??this.options.initialRect,this.scrollRect[this.options.horizontal?"width":"height"]):(this.scrollRect=null,0),this.getScrollOffset=()=>this.options.enabled?(this.scrollOffset=this.scrollOffset??(typeof this.options.initialOffset=="function"?this.options.initialOffset():this.options.initialOffset),this.scrollOffset):(this.scrollOffset=null,0),this.getFurthestMeasurement=(t,a)=>{const s=new Map,i=new Map;for(let o=a-1;o>=0;o--){const n=t[o];if(s.has(n.lane))continue;const d=i.get(n.lane);if(d==null||n.end>d.end?i.set(n.lane,n):n.end<d.end&&s.set(n.lane,!0),s.size===this.options.lanes)break}return i.size===this.options.lanes?Array.from(i.values()).sort((o,n)=>o.end===n.end?o.index-n.index:o.end-n.end)[0]:void 0},this.getMeasurementOptions=$(()=>[this.options.count,this.options.paddingStart,this.options.scrollMargin,this.options.getItemKey,this.options.enabled,this.options.lanes],(t,a,s,i,o,n)=>(this.prevLanes!==void 0&&this.prevLanes!==n&&(this.lanesChangedFlag=!0),this.prevLanes=n,this.pendingMeasuredCacheIndexes=[],{count:t,paddingStart:a,scrollMargin:s,getItemKey:i,enabled:o,lanes:n}),{key:!1}),this.getMeasurements=$(()=>[this.getMeasurementOptions(),this.itemSizeCache],({count:t,paddingStart:a,scrollMargin:s,getItemKey:i,enabled:o,lanes:n},d)=>{if(!o)return this.measurementsCache=[],this.itemSizeCache.clear(),this.laneAssignments.clear(),[];if(this.laneAssignments.size>t)for(const f of this.laneAssignments.keys())f>=t&&this.laneAssignments.delete(f);this.lanesChangedFlag&&(this.lanesChangedFlag=!1,this.lanesSettling=!0,this.measurementsCache=[],this.itemSizeCache.clear(),this.laneAssignments.clear(),this.pendingMeasuredCacheIndexes=[]),this.measurementsCache.length===0&&!this.lanesSettling&&(this.measurementsCache=this.options.initialMeasurementsCache,this.measurementsCache.forEach(f=>{this.itemSizeCache.set(f.key,f.size)}));const m=this.lanesSettling?0:this.pendingMeasuredCacheIndexes.length>0?Math.min(...this.pendingMeasuredCacheIndexes):0;this.pendingMeasuredCacheIndexes=[],this.lanesSettling&&this.measurementsCache.length===t&&(this.lanesSettling=!1);const c=this.measurementsCache.slice(0,m),x=new Array(n).fill(void 0);for(let f=0;f<m;f++){const y=c[f];y&&(x[y.lane]=f)}for(let f=m;f<t;f++){const y=i(f),T=this.laneAssignments.get(f);let v,w;if(T!==void 0&&this.options.lanes>1){v=T;const C=x[v],O=C!==void 0?c[C]:void 0;w=O?O.end+this.options.gap:a+s}else{const C=this.options.lanes===1?c[f-1]:this.getFurthestMeasurement(c,f);w=C?C.end+this.options.gap:a+s,v=C?C.lane:f%this.options.lanes,this.options.lanes>1&&this.laneAssignments.set(f,v)}const j=d.get(y),k=typeof j=="number"?j:this.options.estimateSize(f),E=w+k;c[f]={index:f,start:w,size:k,end:E,key:y,lane:v},x[v]=f}return this.measurementsCache=c,c},{key:!1,debug:()=>this.options.debug}),this.calculateRange=$(()=>[this.getMeasurements(),this.getSize(),this.getScrollOffset(),this.options.lanes],(t,a,s,i)=>this.range=t.length>0&&a>0?qt({measurements:t,outerSize:a,scrollOffset:s,lanes:i}):null,{key:!1,debug:()=>this.options.debug}),this.getVirtualIndexes=$(()=>{let t=null,a=null;const s=this.calculateRange();return s&&(t=s.startIndex,a=s.endIndex),this.maybeNotify.updateDeps([this.isScrolling,t,a]),[this.options.rangeExtractor,this.options.overscan,this.options.count,t,a]},(t,a,s,i,o)=>i===null||o===null?[]:t({startIndex:i,endIndex:o,overscan:a,count:s}),{key:!1,debug:()=>this.options.debug}),this.indexFromElement=t=>{const a=this.options.indexAttribute,s=t.getAttribute(a);return s?parseInt(s,10):(console.warn(`Missing attribute name '${a}={index}' on measured element.`),-1)},this._measureElement=(t,a)=>{const s=this.indexFromElement(t),i=this.measurementsCache[s];if(!i)return;const o=i.key,n=this.elementsCache.get(o);n!==t&&(n&&this.observer.unobserve(n),this.observer.observe(t),this.elementsCache.set(o,t)),t.isConnected&&this.resizeItem(s,this.options.measureElement(t,a,this))},this.resizeItem=(t,a)=>{const s=this.measurementsCache[t];if(!s)return;const i=this.itemSizeCache.get(s.key)??s.size,o=a-i;o!==0&&((this.shouldAdjustScrollPositionOnItemSizeChange!==void 0?this.shouldAdjustScrollPositionOnItemSizeChange(s,o,this):s.start<this.getScrollOffset()+this.scrollAdjustments)&&this._scrollToOffset(this.getScrollOffset(),{adjustments:this.scrollAdjustments+=o,behavior:void 0}),this.pendingMeasuredCacheIndexes.push(s.index),this.itemSizeCache=new Map(this.itemSizeCache.set(s.key,a)),this.notify(!1))},this.measureElement=t=>{if(!t){this.elementsCache.forEach((a,s)=>{a.isConnected||(this.observer.unobserve(a),this.elementsCache.delete(s))});return}this._measureElement(t,void 0)},this.getVirtualItems=$(()=>[this.getVirtualIndexes(),this.getMeasurements()],(t,a)=>{const s=[];for(let i=0,o=t.length;i<o;i++){const n=t[i],d=a[n];s.push(d)}return s},{key:!1,debug:()=>this.options.debug}),this.getVirtualItemForOffset=t=>{const a=this.getMeasurements();if(a.length!==0)return pe(a[ze(0,a.length-1,s=>pe(a[s]).start,t)])},this.getMaxScrollOffset=()=>{if(!this.scrollElement)return 0;if("scrollHeight"in this.scrollElement)return this.options.horizontal?this.scrollElement.scrollWidth-this.scrollElement.clientWidth:this.scrollElement.scrollHeight-this.scrollElement.clientHeight;{const t=this.scrollElement.document.documentElement;return this.options.horizontal?t.scrollWidth-this.scrollElement.innerWidth:t.scrollHeight-this.scrollElement.innerHeight}},this.getOffsetForAlignment=(t,a,s=0)=>{if(!this.scrollElement)return 0;const i=this.getSize(),o=this.getScrollOffset();a==="auto"&&(a=t>=o+i?"end":"start"),a==="center"?t+=(s-i)/2:a==="end"&&(t-=i);const n=this.getMaxScrollOffset();return Math.max(Math.min(n,t),0)},this.getOffsetForIndex=(t,a="auto")=>{t=Math.max(0,Math.min(t,this.options.count-1));const s=this.measurementsCache[t];if(!s)return;const i=this.getSize(),o=this.getScrollOffset();if(a==="auto")if(s.end>=o+i-this.options.scrollPaddingEnd)a="end";else if(s.start<=o+this.options.scrollPaddingStart)a="start";else return[o,a];if(a==="end"&&t===this.options.count-1)return[this.getMaxScrollOffset(),a];const n=a==="end"?s.end+this.options.scrollPaddingEnd:s.start-this.options.scrollPaddingStart;return[this.getOffsetForAlignment(n,a,s.size),a]},this.isDynamicMode=()=>this.elementsCache.size>0,this.scrollToOffset=(t,{align:a="start",behavior:s}={})=>{s==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),this._scrollToOffset(this.getOffsetForAlignment(t,a),{adjustments:void 0,behavior:s})},this.scrollToIndex=(t,{align:a="auto",behavior:s}={})=>{s==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),t=Math.max(0,Math.min(t,this.options.count-1)),this.currentScrollToIndex=t;let i=0;const o=10,n=m=>{if(!this.targetWindow)return;const c=this.getOffsetForIndex(t,m);if(!c){console.warn("Failed to get offset for index:",t);return}const[x,f]=c;this._scrollToOffset(x,{adjustments:void 0,behavior:s}),this.targetWindow.requestAnimationFrame(()=>{const y=()=>{if(this.currentScrollToIndex!==t)return;const T=this.getScrollOffset(),v=this.getOffsetForIndex(t,f);if(!v){console.warn("Failed to get offset for index:",t);return}Ft(v[0],T)||d(f)};this.isDynamicMode()?this.targetWindow.requestAnimationFrame(y):y()})},d=m=>{this.targetWindow&&this.currentScrollToIndex===t&&(i++,i<o?this.targetWindow.requestAnimationFrame(()=>n(m)):console.warn(`Failed to scroll to index ${t} after ${o} attempts.`))};n(a)},this.scrollBy=(t,{behavior:a}={})=>{a==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),this._scrollToOffset(this.getScrollOffset()+t,{adjustments:void 0,behavior:a})},this.getTotalSize=()=>{var t;const a=this.getMeasurements();let s;if(a.length===0)s=this.options.paddingStart;else if(this.options.lanes===1)s=((t=a[a.length-1])==null?void 0:t.end)??0;else{const i=Array(this.options.lanes).fill(null);let o=a.length-1;for(;o>=0&&i.some(n=>n===null);){const n=a[o];i[n.lane]===null&&(i[n.lane]=n.end),o--}s=Math.max(...i.filter(n=>n!==null))}return Math.max(s-this.options.scrollMargin+this.options.paddingEnd,0)},this._scrollToOffset=(t,{adjustments:a,behavior:s})=>{this.options.scrollToFn(t,{behavior:s,adjustments:a},this)},this.measure=()=>{this.itemSizeCache=new Map,this.laneAssignments=new Map,this.notify(!1)},this.setOptions(l)}}const ze=(r,l,t,a)=>{for(;r<=l;){const s=(r+l)/2|0,i=t(s);if(i<a)r=s+1;else if(i>a)l=s-1;else return s}return r>0?r-1:0};function qt({measurements:r,outerSize:l,scrollOffset:t,lanes:a}){const s=r.length-1,i=d=>r[d].start;if(r.length<=a)return{startIndex:0,endIndex:s};let o=ze(0,s,i,t),n=o;if(a===1)for(;n<s&&r[n].end<t+l;)n++;else if(a>1){const d=Array(a).fill(0);for(;n<s&&d.some(c=>c<t+l);){const c=r[n];d[c.lane]=c.end,n++}const m=Array(a).fill(t+l);for(;o>=0&&m.some(c=>c>=t);){const c=r[o];m[c.lane]=c.start,o--}o=Math.max(0,o-o%a),n=Math.min(s,n+(a-1-n%a))}return{startIndex:o,endIndex:n}}const je=typeof document<"u"?h.useLayoutEffect:h.useEffect;function Qt({useFlushSync:r=!0,...l}){const t=h.useReducer(()=>({}),{})[1],a={...l,onChange:(i,o)=>{var n;r&&o?Qe.flushSync(t):t(),(n=l.onChange)==null||n.call(l,i,o)}},[s]=h.useState(()=>new Bt(a));return s.setOptions(a),je(()=>s._didMount(),[]),je(()=>s._willUpdate()),s}function Wt(r){return Qt({observeElementRect:Dt,observeElementOffset:_t,scrollToFn:Pt,...r})}function Kt({items:r,estimatedItemSize:l=100,overscan:t=5,height:a,className:s,gap:i=0,renderItem:o,getItemKey:n,emptyState:d,isLoading:m,loadingComponent:c,scrollRef:x}){const f=h.useRef(null),y=Wt({count:r.length,getScrollElement:()=>f.current,estimateSize:()=>l,overscan:t,gap:i}),T=y.getVirtualItems(),v=h.useCallback(w=>{f.current=w,x&&x(w)},[x]);return m?e.jsx("div",{className:ee("flex items-center justify-center",s),style:{height:a},children:c||e.jsx("div",{className:"animate-pulse text-muted-foreground",children:"Carregando..."})}):r.length===0?e.jsx("div",{className:ee("flex items-center justify-center",s),style:{height:a},children:d||e.jsx("div",{className:"text-muted-foreground",children:"Nenhum item encontrado"})}):e.jsx("div",{ref:v,className:ee("overflow-auto",s),style:{height:a},children:e.jsx("div",{style:{height:`${y.getTotalSize()}px`,width:"100%",position:"relative"},children:T.map(w=>{const j=r[w.index],k=n?n(j,w.index):w.index;return e.jsx("div",{"data-index":w.index,ref:y.measureElement,style:{position:"absolute",top:0,left:0,width:"100%",transform:`translateY(${w.start}px)`},children:o(j,w.index)},k)})})})}function Ut({onSearch:r,onSearchFocus:l}){const[t,a]=h.useState(""),[s,i]=h.useState(!1),{name:o}=Ae(),n=c=>{a(c),r?.(c)},d=()=>{a(""),r?.("")},m=()=>{i(!0),l?.()};return e.jsxs("div",{className:"sticky top-0 z-20 bg-background/95 backdrop-blur-md safe-top",children:[e.jsxs(g.div,{className:"px-4 pt-4 pb-3",initial:{opacity:0,y:-10},animate:{opacity:1,y:0},transition:{duration:.3},children:[e.jsx("h1",{className:"text-2xl font-bold text-foreground tracking-tight",children:"Papo dos Observadores"}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-0.5",children:["Comunidade de ",o]})]}),e.jsx("div",{className:"px-4 pb-3",children:e.jsxs(g.div,{className:"relative",animate:{scale:s?1.01:1},transition:{duration:.2},children:[e.jsx(ke,{className:`absolute left-3.5 top-1/2 -translate-y-1/2 w-5 h-5 transition-colors ${s?"text-primary":"text-muted-foreground"}`}),e.jsx(Me,{value:t,onChange:c=>n(c.target.value),onFocus:m,onBlur:()=>i(!1),placeholder:"Buscar assunto, rua, bairro‚Ä¶",className:`pl-11 pr-10 h-12 rounded-2xl border-2 text-base transition-all ${s?"border-primary bg-background shadow-lg":"border-transparent bg-muted/50"}`}),t&&e.jsx(g.button,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.8},onClick:d,className:"absolute right-3 top-1/2 -translate-y-1/2 p-1 rounded-full bg-muted hover:bg-muted-foreground/20 transition-colors","aria-label":"Limpar busca",children:e.jsx(V,{className:"w-4 h-4 text-muted-foreground"})})]})})]})}const te=[{id:"curtidos",label:"Mais curtidos",icon:We},{id:"recentes",label:"Recentes",icon:Ke},{id:"perto",label:"Perto de mim",icon:Q}];function Ht({value:r,onChange:l}){return e.jsx("div",{className:"px-4 pb-3",children:e.jsxs("div",{className:"relative flex bg-muted/60 rounded-xl p-1",children:[e.jsx(g.div,{className:"absolute inset-y-1 bg-background rounded-lg shadow-sm",initial:!1,animate:{x:`${te.findIndex(t=>t.id===r)*100}%`,width:`${100/te.length}%`},transition:{type:"spring",stiffness:400,damping:30},style:{left:"4px",right:"4px"}}),te.map(t=>{const a=t.icon,s=r===t.id;return e.jsxs(g.button,{onClick:()=>l(t.id),whileTap:{scale:.97},className:`relative flex-1 flex items-center justify-center gap-1.5 py-2.5 px-2 rounded-lg text-sm font-medium transition-colors z-10 min-h-[44px] ${s?"text-foreground":"text-muted-foreground"}`,"aria-pressed":s,"aria-label":t.label,children:[e.jsx(a,{className:`w-4 h-4 ${s?"text-primary":""}`}),e.jsx("span",{className:"hidden xs:inline",children:t.label}),e.jsx("span",{className:"xs:hidden",children:t.label.split(" ")[0]})]},t.id)})]})})}const we=[{value:"reclamacao",label:"Reclama√ß√£o",color:"bg-red-100 text-red-700 border-red-200"},{value:"sugestao",label:"Sugest√£o",color:"bg-blue-100 text-blue-700 border-blue-200"},{value:"duvida",label:"D√∫vida",color:"bg-purple-100 text-purple-700 border-purple-200"},{value:"alerta",label:"Alerta",color:"bg-orange-100 text-orange-700 border-orange-200"},{value:"elogio",label:"Elogio",color:"bg-green-100 text-green-700 border-green-200"},{value:"comercio",label:"Com√©rcio",color:"bg-emerald-100 text-emerald-700 border-emerald-200"},{value:"eventos",label:"Eventos",color:"bg-pink-100 text-pink-700 border-pink-200"},{value:"outros",label:"Outros",color:"bg-gray-100 text-gray-700 border-gray-200"}],Vt=[{value:"hoje",label:"Hoje"},{value:"7dias",label:"7 dias"},{value:"30dias",label:"30 dias"},{value:"todos",label:"Todos"}];function Yt({filters:r,onChange:l,userBairroId:t}){const[a,s]=h.useState(!1),{data:i=[]}=Fe(),o=Object.values(r).filter(Boolean).length,n=(c,x)=>{l({...r,[c]:x})},d=c=>{const x={...r};delete x[c],l(x)},m=()=>{l({})};return e.jsxs("div",{className:"px-4 pb-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsxs(g.button,{onClick:()=>s(!a),whileTap:{scale:.95},className:`flex items-center gap-1.5 px-3 py-2 rounded-full text-sm font-medium transition-colors min-h-[44px] ${a||o>0?"bg-primary/10 text-primary":"bg-muted text-muted-foreground"}`,children:[e.jsx("span",{children:"Filtros"}),o>0&&e.jsx("span",{className:"bg-primary text-primary-foreground w-5 h-5 rounded-full text-xs flex items-center justify-center",children:o}),e.jsx(g.div,{animate:{rotate:a?180:0},transition:{duration:.2},children:e.jsx(Ue,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"flex-1 overflow-x-auto scrollbar-hide",children:e.jsxs("div",{className:"flex gap-1.5",children:[r.categoria&&e.jsx(se,{label:we.find(c=>c.value===r.categoria)?.label||"",onRemove:()=>d("categoria")}),r.comFoto&&e.jsx(se,{label:"Com foto",icon:e.jsx(ae,{className:"w-3 h-3"}),onRemove:()=>d("comFoto")}),r.meuBairro&&e.jsx(se,{label:"Meu bairro",icon:e.jsx(Q,{className:"w-3 h-3"}),onRemove:()=>d("meuBairro")})]})}),o>0&&e.jsx("button",{onClick:m,className:"text-xs text-muted-foreground hover:text-foreground transition-colors whitespace-nowrap",children:"Limpar"})]}),e.jsx(re,{children:a&&e.jsx(g.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.2},className:"overflow-hidden",children:e.jsxs("div",{className:"space-y-3 py-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-muted-foreground mb-1.5 block",children:"Categoria"}),e.jsx("div",{className:"flex flex-wrap gap-1.5",children:we.map(c=>e.jsx(g.button,{whileTap:{scale:.95},onClick:()=>n("categoria",r.categoria===c.value?void 0:c.value),className:`px-3 py-1.5 rounded-full text-sm font-medium border transition-all min-h-[36px] ${r.categoria===c.value?`${c.color} border-current`:"bg-background border-border text-muted-foreground hover:border-foreground/30"}`,children:c.label},c.value))})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"text-xs font-medium text-muted-foreground mb-1.5 block",children:"Bairro"}),e.jsxs(oe,{value:r.bairroId||"__all__",onValueChange:c=>n("bairroId",c==="__all__"?void 0:c),children:[e.jsx(le,{className:"h-11 rounded-xl",children:e.jsx(ce,{placeholder:"Todos"})}),e.jsxs(de,{children:[e.jsx(_,{value:"__all__",children:"Todos"}),i.map(c=>e.jsx(_,{value:c.id,children:c.nome},c.id))]})]})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"text-xs font-medium text-muted-foreground mb-1.5 block",children:"Per√≠odo"}),e.jsxs(oe,{value:r.periodo||"__all__",onValueChange:c=>n("periodo",c==="__all__"?void 0:c),children:[e.jsx(le,{className:"h-11 rounded-xl",children:e.jsx(ce,{placeholder:"Todos"})}),e.jsxs(de,{children:[e.jsx(_,{value:"__all__",children:"Todos"}),Vt.map(c=>e.jsx(_,{value:c.value,children:c.label},c.value))]})]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Ce,{label:"S√≥ com foto",icon:e.jsx(ae,{className:"w-4 h-4"}),active:!!r.comFoto,onClick:()=>n("comFoto",!r.comFoto)}),t&&e.jsx(Ce,{label:"Meu bairro",icon:e.jsx(Q,{className:"w-4 h-4"}),active:!!r.meuBairro,onClick:()=>n("meuBairro",!r.meuBairro)})]})]})})})]})}function se({label:r,icon:l,onRemove:t}){return e.jsxs(g.span,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.8},className:"inline-flex items-center gap-1 px-2 py-1 rounded-full bg-primary/10 text-primary text-xs font-medium",children:[l,r,e.jsx("button",{onClick:t,className:"ml-0.5 p-0.5 rounded-full hover:bg-primary/20 transition-colors","aria-label":`Remover filtro ${r}`,children:e.jsx(V,{className:"w-3 h-3"})})]})}function Ce({label:r,icon:l,active:t,onClick:a}){return e.jsxs(g.button,{whileTap:{scale:.95},onClick:a,className:`flex items-center gap-2 px-3 py-2 rounded-full text-sm font-medium transition-all min-h-[44px] ${t?"bg-primary text-primary-foreground":"bg-muted text-muted-foreground hover:bg-muted-foreground/10"}`,children:[l,r]})}const Ne={reclamacao:{label:"Relato",color:"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400"},reclamacoes:{label:"Relato",color:"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400"},sugestao:{label:"Ideia",color:"bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400"},duvida:{label:"Pergunta",color:"bg-purple-100 text-purple-700 dark:bg-purple-900/30 dark:text-purple-400"},alerta:{label:"Alerta",color:"bg-orange-100 text-orange-700 dark:bg-orange-900/30 dark:text-orange-400"},elogio:{label:"Elogio",color:"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400"},comercio:{label:"Com√©rcio",color:"bg-emerald-100 text-emerald-700 dark:bg-emerald-900/30 dark:text-emerald-400"},eventos:{label:"Eventos",color:"bg-pink-100 text-pink-700 dark:bg-pink-900/30 dark:text-pink-400"},outros:{label:"Outros",color:"bg-gray-100 text-gray-700 dark:bg-gray-800 dark:text-gray-400"}},Gt=h.memo(function({topic:l,onPress:t,onLike:a,onComment:s,onShare:i,onMore:o,onConfirm:n,onSupport:d}){const m=Ne[l.categoria]||Ne.outros,c=yt(l.bairroId),{name:x}=Ae(),f=bt(l.createdAt),y=vt(l.createdAt),T=C=>{C.stopPropagation(),navigator.vibrate&&navigator.vibrate(10),a?.()},v=C=>{C.stopPropagation(),s?.()},w=C=>{C.stopPropagation();const O=`${window.location.origin}/topico/${l.id}`,S=`üëÄ Observadores de ${x}: ${l.titulo}
${O}
(Comunidade independente, n√£o oficial)`;navigator.share?navigator.share({title:l.titulo,text:S,url:O}).catch(()=>{}):navigator.clipboard.writeText(S),i?.()},j=C=>{C.stopPropagation(),o?.()},k=C=>{C.stopPropagation(),navigator.vibrate&&navigator.vibrate(10),n?.()},E=C=>{C.stopPropagation(),navigator.vibrate&&navigator.vibrate(10),d?.()};return e.jsxs(g.article,{layout:!0,initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,scale:.95},whileTap:{scale:.99},onClick:t,className:"bg-card rounded-2xl p-4 shadow-sm border border-border/50 cursor-pointer active:bg-muted/50 transition-colors",role:"article","aria-label":`${l.titulo} - ${m.label} em ${c}`,children:[e.jsxs("div",{className:"flex items-center justify-between gap-2 mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap min-w-0",children:[e.jsx(jt,{variant:"secondary",className:`${m.color} border-0 font-medium text-xs px-2 py-0.5`,children:m.label}),e.jsxs("span",{className:"text-xs text-muted-foreground flex items-center gap-1 truncate",children:[e.jsx(Q,{className:"w-3 h-3 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:c})]})]}),e.jsx("time",{dateTime:new Date(l.createdAt).toISOString(),title:y,className:"text-xs text-muted-foreground whitespace-nowrap",children:f})]}),e.jsx("h3",{className:"font-semibold text-foreground text-base leading-snug line-clamp-2 mb-1",children:l.titulo}),e.jsx("p",{className:"text-sm text-muted-foreground leading-relaxed line-clamp-2 mb-3",children:l.texto}),l.fotoUrl&&e.jsxs("div",{className:"relative mb-3 rounded-xl overflow-hidden bg-muted aspect-video",children:[e.jsx("img",{src:l.fotoUrl,alt:"",loading:"lazy",className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/20 to-transparent"})]}),e.jsxs("div",{className:"flex items-center gap-2 mb-3 overflow-x-auto scrollbar-hide -mx-1 px-1",children:[e.jsxs(g.button,{whileTap:{scale:.95},onClick:k,className:"flex items-center gap-1.5 px-3 py-1.5 rounded-full bg-muted/50 hover:bg-muted text-xs font-medium text-muted-foreground hover:text-foreground transition-colors whitespace-nowrap","aria-label":"Confirmar que vi tamb√©m",children:[e.jsx(Se,{className:"w-3.5 h-3.5"}),"Eu vi tamb√©m"]}),e.jsxs(g.button,{whileTap:{scale:.95},onClick:E,className:"flex items-center gap-1.5 px-3 py-1.5 rounded-full bg-muted/50 hover:bg-muted text-xs font-medium text-muted-foreground hover:text-foreground transition-colors whitespace-nowrap","aria-label":"Apoiar esta ideia",children:[e.jsx(Te,{className:"w-3.5 h-3.5"}),"Apoiar"]}),e.jsxs(g.button,{whileTap:{scale:.95},onClick:v,className:"flex items-center gap-1.5 px-3 py-1.5 rounded-full bg-muted/50 hover:bg-muted text-xs font-medium text-muted-foreground hover:text-foreground transition-colors whitespace-nowrap","aria-label":"Tenho informa√ß√µes",children:[e.jsx(ie,{className:"w-3.5 h-3.5"}),"Tenho info"]})]}),e.jsxs("div",{className:"flex items-center justify-between pt-2 border-t border-border/50",children:[e.jsxs(g.button,{whileTap:{scale:.9},onClick:T,className:"flex items-center gap-1.5 py-2 px-3 -ml-3 rounded-lg hover:bg-muted/50 transition-colors min-h-[44px]","aria-label":l.liked?"Remover curtida":"Curtir","aria-pressed":l.liked,children:[e.jsx(g.div,{animate:l.liked?{scale:[1,1.3,1]}:{},transition:{duration:.3},children:e.jsx(He,{className:`w-5 h-5 ${l.liked?"fill-red-500 text-red-500":"text-muted-foreground"}`})}),e.jsx("span",{className:`text-sm font-medium ${l.liked?"text-red-500":"text-muted-foreground"}`,children:l.likesCount>0?l.likesCount:"Curtir"})]}),e.jsxs(g.button,{whileTap:{scale:.9},onClick:v,className:"flex items-center gap-1.5 py-2 px-3 rounded-lg hover:bg-muted/50 transition-colors min-h-[44px]","aria-label":`${l.commentsCount} coment√°rios`,children:[e.jsx(Ve,{className:"w-5 h-5 text-muted-foreground"}),e.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:l.commentsCount>0?l.commentsCount:"Comentar"})]}),e.jsx(g.button,{whileTap:{scale:.9},onClick:w,className:"flex items-center gap-1.5 py-2 px-3 rounded-lg hover:bg-muted/50 transition-colors min-h-[44px]","aria-label":"Compartilhar",children:e.jsx(Ye,{className:"w-5 h-5 text-muted-foreground"})}),e.jsx(g.button,{whileTap:{scale:.9},onClick:j,className:"flex items-center justify-center p-2 rounded-lg hover:bg-muted/50 transition-colors min-h-[44px] min-w-[44px]","aria-label":"Mais op√ß√µes",children:e.jsx(Ge,{className:"w-5 h-5 text-muted-foreground"})})]})]})});function Jt(){return e.jsxs(g.div,{initial:{opacity:0},animate:{opacity:1},className:"bg-card rounded-2xl p-4 shadow-sm border border-border/50",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2 mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-5 w-20 bg-muted rounded-full animate-pulse"}),e.jsx("div",{className:"h-4 w-24 bg-muted rounded animate-pulse"})]}),e.jsx("div",{className:"h-4 w-12 bg-muted rounded animate-pulse"})]}),e.jsx("div",{className:"h-5 w-3/4 bg-muted rounded animate-pulse mb-2"}),e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsx("div",{className:"h-4 w-full bg-muted rounded animate-pulse"}),e.jsx("div",{className:"h-4 w-2/3 bg-muted rounded animate-pulse"})]}),e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("div",{className:"w-6 h-6 rounded-full bg-muted animate-pulse"}),e.jsx("div",{className:"h-3 w-16 bg-muted rounded animate-pulse"})]}),e.jsxs("div",{className:"flex items-center gap-6 pt-3 border-t border-border/50",children:[e.jsx("div",{className:"h-5 w-14 bg-muted rounded animate-pulse"}),e.jsx("div",{className:"h-5 w-14 bg-muted rounded animate-pulse"}),e.jsx("div",{className:"h-5 w-8 bg-muted rounded animate-pulse"})]})]})}function Xt({count:r=3}){return e.jsx("div",{className:"space-y-3",children:Array.from({length:r}).map((l,t)=>e.jsx(Jt,{},t))})}const Zt={empty:{icon:Xe,title:"Nenhuma observa√ß√£o ainda",description:"Seja o primeiro a abrir um assunto na comunidade!",actionLabel:"Criar observa√ß√£o",iconColor:"text-primary"},"no-results":{icon:ke,title:"Sem resultados",description:"Tente outro termo ou remova alguns filtros.",actionLabel:"Limpar filtros",iconColor:"text-muted-foreground"},offline:{icon:Je,title:"Voc√™ est√° offline",description:"Mostrando observa√ß√µes salvas. Conecte-se para ver novidades.",actionLabel:"Tentar novamente",iconColor:"text-orange-500"},error:{icon:P,title:"Algo deu errado",description:"N√£o foi poss√≠vel carregar as observa√ß√µes. Tente novamente.",actionLabel:"Tentar novamente",iconColor:"text-red-500"}};function es({type:r,onAction:l,onClearFilters:t}){const a=Zt[r],s=a.icon,i=()=>{r==="no-results"&&t?t():l?.()};return e.jsxs(g.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"flex flex-col items-center justify-center py-16 px-6 text-center",children:[e.jsx(g.div,{initial:{scale:.8},animate:{scale:1},transition:{delay:.1,type:"spring",stiffness:200},className:`w-16 h-16 rounded-full bg-muted flex items-center justify-center mb-4 ${a.iconColor}`,children:e.jsx(s,{className:"w-8 h-8"})}),e.jsx("h3",{className:"text-lg font-semibold text-foreground mb-2",children:a.title}),e.jsx("p",{className:"text-sm text-muted-foreground mb-6 max-w-[260px]",children:a.description}),l&&e.jsxs(q,{onClick:i,variant:r==="empty"?"default":"outline",className:"min-h-[44px] px-6 rounded-full",children:[r==="error"||r==="offline"?e.jsx(Ee,{className:"w-4 h-4 mr-2"}):null,a.actionLabel]})]})}const ts=[{value:"reclamacao",label:"Relato",icon:e.jsx(rt,{className:"w-4 h-4"}),color:"bg-red-100 text-red-700 border-red-200"},{value:"sugestao",label:"Ideia",icon:e.jsx(Ie,{className:"w-4 h-4"}),color:"bg-blue-100 text-blue-700 border-blue-200"},{value:"duvida",label:"Pergunta",icon:e.jsx(Oe,{className:"w-4 h-4"}),color:"bg-purple-100 text-purple-700 border-purple-200"},{value:"alerta",label:"Alerta",icon:e.jsx(it,{className:"w-4 h-4"}),color:"bg-orange-100 text-orange-700 border-orange-200"},{value:"elogio",label:"Elogio",icon:e.jsx(Te,{className:"w-4 h-4"}),color:"bg-green-100 text-green-700 border-green-200"},{value:"comercio",label:"Com√©rcio",icon:e.jsx(ie,{className:"w-4 h-4"}),color:"bg-emerald-100 text-emerald-700 border-emerald-200"},{value:"eventos",label:"Eventos",icon:e.jsx(nt,{className:"w-4 h-4"}),color:"bg-pink-100 text-pink-700 border-pink-200"},{value:"outros",label:"Outros",icon:e.jsx(ie,{className:"w-4 h-4"}),color:"bg-gray-100 text-gray-700 border-gray-200"}];function ss({open:r,onOpenChange:l,onSubmit:t,defaultBairroId:a}){const[s,i]=h.useState(null),[o,n]=h.useState(""),[d,m]=h.useState(""),[c,x]=h.useState(a||"none"),[f,y]=h.useState(!1),[T,v]=h.useState(null),[w,j]=h.useState(null),[k,E]=h.useState(!1),[C,O]=h.useState("idle"),[S,z]=h.useState({}),A=h.useRef(null),{uploadAsync:J}=pt(),{data:W=[],isLoading:fe}=Fe(),K=()=>{const b={};return s||(b.categoria="Escolha um tipo: Relato, Ideia, Pergunta‚Ä¶"),o.trim()?o.length<5&&(b.titulo="O t√≠tulo precisa ter pelo menos 5 caracteres"):b.titulo="D√™ um t√≠tulo curto pro pessoal entender r√°pido",d.trim()||(b.texto="Conte mais detalhes sobre o assunto"),z(b),Object.keys(b).length===0},U=async()=>{if(!(!K()||!s)){E(!0),O("idle");try{let b;if(w)try{b=(await J(w)).url}catch(N){const L=N instanceof Error?N.message:"Erro no upload";B.error(`Falha no upload da imagem: ${L}`),E(!1);return}await t({titulo:o.trim(),texto:d.trim(),categoria:s,bairroId:c&&c!=="none"?c:null,isAnon:f,fotoUrl:b}),navigator.vibrate&&navigator.vibrate([30,50,30]),O("success"),setTimeout(()=>{H(),l(!1)},800)}catch{O("error")}finally{E(!1)}}},H=()=>{i(null),n(""),m(""),x(a||"none"),y(!1),v(null),j(null),z({}),O("idle")},X=b=>{const N=b.target.files?.[0];if(N){j(N);const L=new FileReader;L.onload=()=>{v(L.result)},L.readAsDataURL(N)}},Z=()=>{v(null),j(null),A.current&&(A.current.value="")};return e.jsx(wt,{open:r,onOpenChange:l,children:e.jsxs(Ct,{side:"bottom",className:"rounded-t-3xl h-[85vh] flex flex-col p-0 overflow-hidden",children:[e.jsx(Nt,{className:"px-4 py-4 border-b flex-shrink-0",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(kt,{className:"text-lg font-semibold",children:"Nova Observa√ß√£o"}),e.jsx("button",{onClick:()=>l(!1),className:"p-2 -mr-2 rounded-full hover:bg-muted transition-colors min-h-[44px] min-w-[44px] flex items-center justify-center","aria-label":"Fechar",children:e.jsx(V,{className:"w-5 h-5"})})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto px-4 py-4 space-y-5",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-foreground mb-2 block",children:"O que voc√™ quer compartilhar?"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:ts.map(b=>e.jsxs(g.button,{whileTap:{scale:.95},onClick:()=>{i(b.value),z(N=>({...N,categoria:""}))},className:`flex items-center gap-1.5 px-4 py-2.5 rounded-full text-sm font-medium border transition-all min-h-[44px] ${s===b.value?`${b.color} border-current shadow-sm`:"bg-background border-border text-muted-foreground hover:border-foreground/30"}`,children:[b.icon,e.jsx("span",{children:b.label})]},b.value))}),S.categoria&&e.jsxs("p",{className:"text-xs text-red-500 mt-2 flex items-center gap-1",children:[e.jsx(P,{className:"w-3 h-3"}),S.categoria]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-foreground mb-2 block",children:"T√≠tulo"}),e.jsx(Me,{value:o,onChange:b=>{n(b.target.value),z(N=>({...N,titulo:""}))},placeholder:"Ex: Buraco na Rua X perto do mercado",className:`h-12 rounded-xl text-base ${S.titulo?"border-red-500":""}`,maxLength:100}),S.titulo&&e.jsxs("p",{className:"text-xs text-red-500 mt-1.5 flex items-center gap-1",children:[e.jsx(P,{className:"w-3 h-3"}),S.titulo]}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1 text-right",children:[o.length,"/100"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-foreground mb-2 block",children:"Conte mais detalhes"}),e.jsx(St,{value:d,onChange:b=>{m(b.target.value),z(N=>({...N,texto:""}))},placeholder:"Diga onde √© e o que est√° acontecendo‚Ä¶",className:`min-h-[120px] rounded-xl resize-none text-base ${S.texto?"border-red-500":""}`,maxLength:500}),S.texto&&e.jsxs("p",{className:"text-xs text-red-500 mt-1.5 flex items-center gap-1",children:[e.jsx(P,{className:"w-3 h-3"}),S.texto]}),e.jsxs("div",{className:"flex justify-between mt-1",children:[e.jsx("p",{className:`text-xs ${d.length>0&&d.length<10?"text-amber-500":"text-muted-foreground"}`,children:d.length>0&&d.length<10?`M√≠nimo 10 caracteres (${10-d.length} restantes)`:""}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[d.length,"/500"]})]})]}),e.jsx(re,{children:T&&e.jsxs(g.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"relative",children:[e.jsx("img",{src:T,alt:"Preview",className:"w-full h-40 object-cover rounded-xl"}),e.jsx("button",{onClick:Z,className:"absolute top-2 right-2 p-2 bg-black/50 rounded-full text-white hover:bg-black/70 transition-colors","aria-label":"Remover imagem",children:e.jsx(V,{className:"w-4 h-4"})})]})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(g.button,{whileTap:{scale:.95},onClick:()=>{A.current&&(A.current.accept="image/*",A.current.capture="environment",A.current.click())},className:"flex items-center gap-2 px-4 py-2.5 rounded-xl bg-muted text-muted-foreground hover:bg-muted-foreground/10 transition-colors min-h-[44px]",children:[e.jsx(Ze,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm font-medium",children:"C√¢mera"})]}),e.jsxs(g.button,{whileTap:{scale:.95},onClick:()=>{A.current&&(A.current.accept="image/*",A.current.removeAttribute("capture"),A.current.click())},className:"flex items-center gap-2 px-4 py-2.5 rounded-xl bg-muted text-muted-foreground hover:bg-muted-foreground/10 transition-colors min-h-[44px]",children:[e.jsx(ae,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm font-medium",children:"Galeria"})]}),e.jsx("input",{ref:A,type:"file",accept:"image/*",onChange:X,className:"hidden"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-sm font-medium text-foreground mb-2 block",children:[e.jsx(Q,{className:"w-4 h-4 inline mr-1"}),"Bairro"]}),e.jsxs(oe,{value:c,onValueChange:b=>{x(b),z(N=>({...N,bairroId:""}))},children:[e.jsx(le,{className:`h-12 rounded-xl ${S.bairroId?"border-red-500":""}`,children:e.jsx(ce,{placeholder:"Selecione o bairro"})}),e.jsxs(de,{children:[e.jsx(_,{value:"none",className:"text-muted-foreground italic",children:"N√£o quero informar bairro"}),fe?e.jsx(_,{value:"loading",disabled:!0,children:"Carregando..."}):W.map(b=>e.jsx(_,{value:b.id,children:b.nome},b.id))]})]}),S.bairroId&&e.jsxs("p",{className:"text-xs text-red-500 mt-1.5 flex items-center gap-1",children:[e.jsx(P,{className:"w-3 h-3"}),S.bairroId]})]}),e.jsxs("div",{className:"flex items-center justify-between py-3 px-4 bg-muted/50 rounded-xl",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[f?e.jsx(et,{className:"w-5 h-5 text-muted-foreground"}):e.jsx(Se,{className:"w-5 h-5 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-foreground",children:"Postar anonimamente"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Seu nome n√£o aparecer√° no post"})]})]}),e.jsx(Tt,{checked:f,onCheckedChange:y})]})]}),e.jsx("div",{className:"px-4 py-4 border-t bg-background safe-bottom flex-shrink-0",children:e.jsx(q,{onClick:U,disabled:k,className:"w-full h-14 rounded-2xl text-base font-semibold",children:e.jsx(re,{mode:"wait",children:k?e.jsxs(g.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"flex items-center gap-2",children:[e.jsx(tt,{className:"w-5 h-5 animate-spin"}),e.jsx("span",{children:"Publicando..."})]},"loading"):C==="success"?e.jsxs(g.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},className:"flex items-center gap-2 text-green-500",children:[e.jsx(st,{className:"w-5 h-5"}),e.jsx("span",{children:"Publicado!"})]},"success"):C==="error"?e.jsxs(g.div,{initial:{opacity:0},animate:{opacity:1},className:"flex items-center gap-2",children:[e.jsx(P,{className:"w-5 h-5"}),e.jsx("span",{children:"Tentar novamente"})]},"error"):e.jsxs(g.div,{initial:{opacity:0},animate:{opacity:1},className:"flex items-center gap-2",children:[e.jsx(at,{className:"w-5 h-5"}),e.jsx("span",{children:"Publicar"})]},"idle")})})})]})})}function as(){return e.jsx("div",{className:"px-4 py-2 bg-blue-50/50 dark:bg-blue-900/10 border-b border-blue-100/50 dark:border-blue-800/20",children:e.jsxs("div",{className:"flex gap-2 text-[10px] leading-tight text-blue-700 dark:text-blue-300 items-start",children:[e.jsx(ot,{className:"w-3 h-3 flex-shrink-0 mt-0.5"}),e.jsxs("p",{children:["Comunidade independente de Observadores.",e.jsx("span",{className:"opacity-70 ml-1",children:"N√£o √© um canal oficial da Prefeitura ou √≥rg√£os p√∫blicos."})]})]})})}const rs=[{id:"todos",label:"Todos",icon:lt},{id:"relatos",label:"Relatos",icon:ct},{id:"ideias",label:"Ideias",icon:Ie},{id:"perguntas",label:"Perguntas",icon:Oe}];function is({activeTab:r,onChange:l}){return e.jsx("div",{className:"px-4 py-2",children:e.jsx("div",{className:"flex gap-2 overflow-x-auto scrollbar-hide -mx-4 px-4",children:rs.map(t=>{const a=t.icon,s=r===t.id;return e.jsxs(g.button,{whileTap:{scale:.95},onClick:()=>l(t.id),className:`relative flex items-center gap-1.5 px-4 py-2 rounded-full whitespace-nowrap text-sm font-medium transition-all min-h-[40px] ${s?"bg-primary text-primary-foreground shadow-sm":"bg-muted/50 text-muted-foreground hover:bg-muted"}`,children:[e.jsx(a,{className:"w-4 h-4"}),t.label,s&&e.jsx(g.div,{layoutId:"activeCategoryTab",className:"absolute inset-0 bg-primary rounded-full -z-10",transition:{type:"spring",stiffness:400,damping:30}})]},t.id)})})})}function ns(r){switch(r){case"relatos":return["reclamacao","reclamacoes","alerta","comercio"];case"ideias":return["sugestao","elogio"];case"perguntas":return["duvida","outros"];case"todos":default:return null}}function os(r,l){const t=Y(),a=Et(),{isAuthenticated:s}=me(),i=ue({mutationFn:async n=>await mt.post(ht.forum.react(r),{type:n}),onMutate:async n=>{a.light(),await t.cancelQueries({queryKey:R.topics.detail(r)}),await t.cancelQueries({queryKey:R.topics.all});const d=t.getQueryData(R.topics.detail(r));if(d){const m=n==="confirm"?d.confirmed:d.supported,c=n==="confirm"?"confirmed":"supported",x=n==="confirm"?"confirmsCount":"supportsCount";t.setQueryData(R.topics.detail(r),{...d,[c]:!m,[x]:m?(d[x]||1)-1:(d[x]||0)+1})}return t.setQueriesData({queryKey:R.topics.all},m=>m?.data?{...m,data:m.data.map(c=>{if(c.id!==r)return c;const x=n==="confirm"?c.confirmed:c.supported,f=n==="confirm"?"confirmed":"supported",y=n==="confirm"?"confirmsCount":"supportsCount";return{...c,[f]:!x,[y]:x?(c[y]||1)-1:(c[y]||0)+1}})}:m),{previousTopic:d}},onError:(n,d,m)=>{a.error(),m?.previousTopic&&t.setQueryData(R.topics.detail(r),m.previousTopic)},onSuccess:n=>{a.success()},onSettled:()=>{setTimeout(()=>{t.invalidateQueries({queryKey:R.topics.detail(r)})},500)}}),o=n=>s?(i.mutate(n),{requiresAuth:!1}):{requiresAuth:!0};return{toggleReaction:o,confirm:()=>o("confirm"),support:()=>o("support"),isLoading:i.isPending,isConfirmLoading:i.isPending&&i.variables==="confirm",isSupportLoading:i.isPending&&i.variables==="support"}}function ls({topic:r,onPress:l,onLike:t,onComment:a,onShare:s,onMore:i,onRequireAuth:o}){const{isAuthenticated:n}=me(),{confirm:d,support:m}=os(r.id),c=()=>{if(!n){o?o("confirmar a observa√ß√£o"):B.info("Fa√ßa login para confirmar que vi tamb√©m");return}d()},x=()=>{if(!n){o?o("apoiar esta observa√ß√£o"):B.info("Fa√ßa login para apoiar");return}m()};return e.jsx(Gt,{topic:r,onPress:l,onLike:t,onComment:a,onShare:s,onMore:i,onConfirm:c,onSupport:x})}function Ts({scrollRef:r}){const{selectedBairro:l}=gt(),{isAuthenticated:t}=me(),{isOnline:a}=G(),{toast:s}=ft(),i=xt(),[o,n]=dt(),{data:d=[],isLoading:m,refetch:c}=Ot(),x=Mt(),f=At(),[y,T]=h.useState("curtidos"),[v,w]=h.useState(""),[j,k]=h.useState({}),[E,C]=h.useState("todos"),[O,S]=h.useState(!1),[z,A]=h.useState(!1),[J,W]=h.useState(!1);h.useEffect(()=>{o.get("novo")==="true"&&(o.delete("novo"),n(o,{replace:!0}),t?S(!0):s({title:"Login necess√°rio",description:"Para criar uma observa√ß√£o, voc√™ precisa estar logado.",action:e.jsx(q,{variant:"outline",size:"sm",onClick:()=>i(`/login?redirect=${encodeURIComponent(window.location.pathname)}`),children:"Entrar"})}))},[o,n,t,s]);const[fe,K]=h.useState(10),[U,H]=h.useState(!1),X=h.useRef(null),Z=h.useRef(null);h.useEffect(()=>{const u=X.current;if(!u)return;const M=new IntersectionObserver(p=>{p[0].isIntersecting&&!U&&(H(!0),setTimeout(()=>{K(I=>I+10),H(!1)},300))},{rootMargin:"200px"});return M.observe(u),()=>M.disconnect()},[U]),h.useEffect(()=>{K(10)},[v,j,y,E]);const b=h.useMemo(()=>{let u=[...d];const M=ns(E);if(M&&(u=u.filter(p=>M.includes(p.categoria))),v.trim()){const p=v.toLowerCase();u=u.filter(I=>I.titulo.toLowerCase().includes(p)||I.texto.toLowerCase().includes(p))}if(j.categoria&&(u=u.filter(p=>p.categoria===j.categoria)),j.bairroId&&(u=u.filter(p=>p.bairroId===j.bairroId)),j.meuBairro&&l&&(u=u.filter(p=>p.bairroId===l.id)),j.comFoto&&(u=u.filter(p=>p.fotoUrl)),j.periodo){const p=new Date;switch(j.periodo){case"hoje":p.setHours(0,0,0,0);break;case"7dias":p.setDate(p.getDate()-7);break;case"30dias":p.setDate(p.getDate()-30);break}j.periodo!=="todos"&&(u=u.filter(I=>new Date(I.createdAt)>=p))}switch(y){case"curtidos":u.sort((p,I)=>{const Be=ge(p.likesCount,p.commentsCount,p.createdAt);return ge(I.likesCount,I.commentsCount,I.createdAt)-Be});break;case"recentes":u.sort((p,I)=>new Date(I.createdAt).getTime()-new Date(p.createdAt).getTime());break;case"perto":u=u.filter(p=>p.bairroId===l?.id).sort((p,I)=>new Date(I.createdAt).getTime()-new Date(p.createdAt).getTime());break}return u},[d,v,j,y,l,E]),N=h.useCallback(u=>t?!0:(s({title:"Login necess√°rio",description:`Para ${u}, voc√™ precisa estar logado.`,action:e.jsx(q,{variant:"outline",size:"sm",onClick:()=>i("/login"),children:"Entrar"})}),!1),[t,s]),L=h.useCallback(u=>{if(!N("curtir"))return;const M=d.find(p=>p.id===u);M&&x.mutate({id:u,currentlyLiked:M.liked??!1})},[d,x,N]),Le=h.useCallback(async u=>{const M={title:u.titulo,text:u.texto,url:`${window.location.origin}/topico/${u.id}`};if(navigator.share)try{await navigator.share(M)}catch{}else await navigator.clipboard.writeText(M.url),s({title:"Link copiado!",description:"O link foi copiado para a √°rea de transfer√™ncia."})},[s]),Re=h.useCallback(u=>{i(`/topico/${u}`)},[i]),De=h.useCallback(u=>{N("comentar")&&i(`/topico/${u}?comment=true`)},[N,i]),_e=h.useCallback(async u=>{try{await f.mutateAsync({categoria:u.categoria,titulo:u.titulo,texto:u.texto,isAnon:u.isAnon,bairroId:u.bairroId,fotoUrl:u.fotoUrl}),s({title:"Observa√ß√£o publicada! üéâ",description:a?"Sua observa√ß√£o foi publicada na comunidade.":"Sua observa√ß√£o ser√° publicada quando voltar online."})}catch{s({title:"Erro ao publicar",description:"Tente novamente.",variant:"destructive"})}},[f,s,a]);h.useCallback(async()=>{W(!0),await c(),W(!1),s({title:"Atualizado!",description:"O feed foi atualizado."})},[c,s]);const xe=h.useCallback(()=>{k({}),w("")},[]),$e=()=>!a&&d.length===0?"offline":v||Object.keys(j).length>0?"no-results":"empty",Pe=v||Object.keys(j).length>0;return e.jsxs("div",{ref:u=>{r?.(u),Z.current=u},className:"h-full overflow-y-auto bg-background",children:[e.jsx(Ut,{onSearch:w,onSearchFocus:()=>{}}),e.jsx(as,{}),e.jsx(Ht,{value:y,onChange:T}),e.jsx(is,{activeTab:E,onChange:C}),e.jsx(Yt,{filters:j,onChange:k,userBairroId:l?.id}),!a&&e.jsxs(g.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"mx-4 mb-3 px-4 py-2 bg-orange-100 dark:bg-orange-900/30 rounded-xl flex items-center gap-2 text-sm text-orange-700 dark:text-orange-400",children:[e.jsx("span",{children:"üì°"}),e.jsx("span",{children:"Voc√™ est√° offline. Mostrando observa√ß√µes salvas."})]}),J&&e.jsx(g.div,{initial:{opacity:0},animate:{opacity:1},className:"flex justify-center py-2",children:e.jsx(Ee,{className:"w-5 h-5 animate-spin text-primary"})}),e.jsx("div",{className:"flex-1 px-4 pb-32",children:z||m?e.jsx(Xt,{count:3}):b.length>0?e.jsx(Kt,{items:b,estimatedItemSize:180,overscan:3,gap:12,className:"h-full",getItemKey:u=>u.id,renderItem:u=>e.jsx(ls,{topic:u,onPress:()=>Re(u.id),onLike:()=>L(u.id),onComment:()=>De(u.id),onShare:()=>Le(u),onRequireAuth:N})}):e.jsx(es,{type:$e(),onAction:Pe?xe:()=>{N("criar uma observa√ß√£o")&&S(!0)},onClearFilters:xe})}),e.jsx(g.div,{initial:{scale:0,opacity:0},animate:{scale:1,opacity:1},transition:{type:"spring",stiffness:400,damping:15,delay:.3},className:"fixed bottom-24 right-4 z-30",children:e.jsx(g.div,{whileHover:{scale:1.05},whileTap:{scale:.95},children:e.jsx(q,{onClick:()=>{N("criar uma observa√ß√£o")&&S(!0)},size:"lg",className:"w-14 h-14 rounded-full shadow-lg bg-primary text-primary-foreground hover:bg-primary/90","aria-label":"Criar nova observa√ß√£o",children:e.jsx(ut,{className:"w-6 h-6"})})})}),e.jsx(ss,{open:O,onOpenChange:S,onSubmit:_e,defaultBairroId:l?.id})]})}export{Ts as default};
