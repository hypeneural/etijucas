import{r as g,j as e,m as x,a9 as $,bw as D,O as k,x as q,b4 as G,aE as H,aQ as Q,b1 as U,ar as _,ba as O,aJ as B,w as I,W as K,bo as V,ay as W,aI as J,bx as X,M as z,_ as Y,az as P,l as Z,X as ee}from"./vendor-app-B8nTTOoa.js";import{a as se,u as F,f as ae,B as u,b as te,c as h,h as M,r as re}from"./index-DCL-AqRy.js";import{B as L}from"./badge-DPVuWgFP.js";import{C}from"./card-BX7Tpw0d.js";import{S as f}from"./skeleton-dk3BRpuY.js";import{A as E}from"./aspect-ratio-D25PUWYZ.js";import{L as le}from"./LocationMap-CN84PvcV.js";import{C as oe}from"./CategoryIcon-BJgxNUEC.js";import{T as ie}from"./textarea-B8kNL_A9.js";import{f as ne}from"./formatTimeAgo-EjzWxCyI.js";import{B as ce}from"./BottomTabBar-C1TySGJ8.js";import{p as A}from"./pt-BR-Cy3ubUx4.js";import"./vendor-maps-Cw-Hd0sv.js";import"./useHaptic-D9J3ZOOx.js";import"./iconify-D28nYmSY.js";import"./useCityName-DUrWkBfG.js";const de={confirm:{icon:$,label:"Confirmou",color:"text-blue-600 bg-blue-50"},support:{icon:D,label:"Apoiou",color:"text-green-600 bg-green-50"},info:{icon:k,label:"Info",color:"text-purple-600 bg-purple-50"},normal:{icon:k,label:"",color:""}};function me({reportId:a,comments:o=[],onAddComment:r}){const{isAuthenticated:t}=se(),n=F(),{toast:c}=ae(),[i,d]=g.useState(""),[p,s]=g.useState(!1),[y,w]=g.useState("normal"),b=async()=>{if(!t){c({title:"Login necessário",description:"Para comentar, você precisa estar logado.",action:e.jsx(u,{variant:"outline",size:"sm",onClick:()=>n("/login"),children:"Entrar"})});return}if(i.trim()){s(!0);try{await r?.(i,y),d(""),w("normal"),c({title:"Comentário adicionado!"})}catch{c({title:"Erro ao comentar",variant:"destructive"})}finally{s(!1)}}},N=async l=>{if(!t){c({title:"Login necessário",description:"Para interagir, você precisa estar logado."});return}const j={confirm:"Eu vi isso também!",support:"Apoio essa observação!",info:""};if(l==="info")w("info");else{s(!0);try{await r?.(j[l],l),c({title:l==="confirm"?"Confirmação registrada!":"Apoio registrado!"})}catch{c({title:"Erro",variant:"destructive"})}finally{s(!1)}}};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-2 overflow-x-auto scrollbar-hide -mx-4 px-4",children:[e.jsxs(x.button,{whileTap:{scale:.95},onClick:()=>N("confirm"),disabled:p,className:"flex items-center gap-1.5 px-4 py-2 rounded-full bg-blue-50 text-blue-700 text-sm font-medium whitespace-nowrap hover:bg-blue-100 transition-colors",children:[e.jsx($,{className:"w-4 h-4"}),"Eu vi também"]}),e.jsxs(x.button,{whileTap:{scale:.95},onClick:()=>N("support"),disabled:p,className:"flex items-center gap-1.5 px-4 py-2 rounded-full bg-green-50 text-green-700 text-sm font-medium whitespace-nowrap hover:bg-green-100 transition-colors",children:[e.jsx(D,{className:"w-4 h-4"}),"Apoiar"]}),e.jsxs(x.button,{whileTap:{scale:.95},onClick:()=>N("info"),disabled:p,className:"flex items-center gap-1.5 px-4 py-2 rounded-full bg-purple-50 text-purple-700 text-sm font-medium whitespace-nowrap hover:bg-purple-100 transition-colors",children:[e.jsx(k,{className:"w-4 h-4"}),"Tenho info"]})]}),e.jsx("div",{className:"space-y-3",children:o.length===0?e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(k,{className:"w-8 h-8 mx-auto mb-2 opacity-50"}),e.jsx("p",{className:"text-sm",children:"Seja o primeiro a comentar!"})]}):o.map(l=>{const j=de[l.type||"normal"],T=j.icon;return e.jsx(x.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"bg-muted/30 rounded-xl p-3",children:e.jsxs("div",{className:"flex items-start gap-2",children:[l.type&&l.type!=="normal"&&e.jsx("div",{className:`p-1 rounded ${j.color}`,children:e.jsx(T,{className:"w-3 h-3"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"text-xs font-medium",children:l.isAnon?"Observador Anônimo":l.authorName}),e.jsx("span",{className:"text-[10px] text-muted-foreground",children:ne(l.createdAt)})]}),e.jsx("p",{className:"text-sm text-foreground",children:l.text})]})]})},l.id)})}),e.jsx("div",{className:"sticky bottom-0 bg-background pt-2 border-t",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(ie,{value:i,onChange:l=>d(l.target.value),placeholder:y==="info"?"Compartilhe informações...":"Adicione um comentário...",className:"min-h-[44px] max-h-24 resize-none rounded-xl",rows:1}),e.jsx(u,{onClick:b,disabled:!i.trim()||p,size:"icon",className:"shrink-0 rounded-xl",children:p?e.jsx(q,{className:"w-4 h-4 animate-spin"}):e.jsx(G,{className:"w-4 h-4"})})]})})]})}const v={recebido:{label:"Recebido",color:"text-blue-600",bgColor:"bg-blue-100 dark:bg-blue-900/30",icon:U},em_analise:{label:"Em verificação",color:"text-yellow-600",bgColor:"bg-yellow-100 dark:bg-yellow-900/30",icon:B},resolvido:{label:"Melhoria concluída",color:"text-green-600",bgColor:"bg-green-100 dark:bg-green-900/30",icon:O},rejeitado:{label:"Arquivado",color:"text-red-600",bgColor:"bg-red-100 dark:bg-red-900/30",icon:_}};function xe({images:a,onImageClick:o}){return!a||a.length===0?null:a.length===1?e.jsx(x.div,{whileTap:{scale:.98},onClick:()=>o(0),className:"cursor-pointer",children:e.jsx(E,{ratio:16/9,className:"overflow-hidden rounded-2xl",children:e.jsx("img",{src:a[0].thumbUrl||a[0].url,alt:"Foto da denúncia",className:"w-full h-full object-cover"})})}):e.jsx("div",{className:"grid grid-cols-2 gap-2",children:a.slice(0,4).map((r,t)=>e.jsxs(x.div,{whileTap:{scale:.95},onClick:()=>o(t),className:h("cursor-pointer overflow-hidden rounded-xl relative",t===0&&a.length>2&&"col-span-2"),children:[e.jsx(E,{ratio:t===0?16/9:1,children:e.jsx("img",{src:r.thumbUrl||r.url,alt:`Foto ${t+1}`,className:"w-full h-full object-cover"})}),t===3&&a.length>4&&e.jsx("div",{className:"absolute inset-0 bg-black/50 flex items-center justify-center",children:e.jsxs("span",{className:"text-white text-lg font-semibold",children:["+",a.length-4]})})]},r.id))})}function ue({history:a}){if(!a||a.length===0)return null;const o=[...a].sort((r,t)=>new Date(t.at).getTime()-new Date(r.at).getTime());return e.jsx("div",{className:"space-y-0",children:o.map((r,t)=>{const n=v[r.status]||v.recebido,c=n.icon,i=t===0,d=t===o.length-1;return e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:h("w-8 h-8 rounded-full flex items-center justify-center shrink-0",i?n.bgColor:"bg-muted"),children:e.jsx(c,{className:h("w-4 h-4",i?n.color:"text-muted-foreground")})}),!d&&e.jsx("div",{className:"w-0.5 flex-1 bg-border min-h-[24px]"})]}),e.jsxs("div",{className:h("pb-4",d&&"pb-0"),children:[e.jsx("p",{className:h("font-medium",i?n.color:"text-muted-foreground"),children:n.label}),r.note&&e.jsx("p",{className:"text-sm text-muted-foreground mt-0.5",children:r.note}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[P(new Date(r.at),"d 'de' MMMM, HH:mm",{locale:A}),r.by&&` • ${r.by}`]})]})]},t)})})}function he({images:a,initialIndex:o,onClose:r}){const[t,n]=g.useState(o);return e.jsxs(x.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-50 bg-black flex flex-col",children:[e.jsxs("div",{className:"safe-top flex items-center justify-between p-4",children:[e.jsx(u,{variant:"ghost",size:"icon",onClick:r,className:"text-white",children:e.jsx(ee,{className:"w-6 h-6"})}),e.jsxs("span",{className:"text-white text-sm",children:[t+1," / ",a.length]}),e.jsx("div",{className:"w-10"})," "]}),e.jsx("div",{className:"flex-1 flex items-center justify-center p-4",children:e.jsx("img",{src:a[t].url,alt:`Foto ${t+1}`,className:"max-w-full max-h-full object-contain"})}),a.length>1&&e.jsx("div",{className:"safe-bottom flex gap-2 p-4 overflow-x-auto",children:a.map((c,i)=>e.jsx(x.button,{whileTap:{scale:.9},onClick:()=>n(i),className:h("w-16 h-16 rounded-lg overflow-hidden shrink-0 border-2",i===t?"border-white":"border-transparent opacity-50"),children:e.jsx("img",{src:c.url,alt:"",className:"w-full h-full object-cover"})},i))})]})}function pe(){return e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx("div",{className:"safe-top bg-background border-b",children:e.jsxs("div",{className:"flex items-center gap-3 px-4 py-3",children:[e.jsx(f,{className:"w-10 h-10 rounded-full"}),e.jsx(f,{className:"h-6 w-32"})]})}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsx(f,{className:"h-48 w-full rounded-2xl"}),e.jsx(f,{className:"h-6 w-3/4"}),e.jsx(f,{className:"h-4 w-full"}),e.jsx(f,{className:"h-4 w-2/3"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(f,{className:"h-8 w-24 rounded-full"}),e.jsx(f,{className:"h-8 w-24 rounded-full"})]})]})]})}function Le(){const{id:a}=H(),o=F(),r=te(m=>m.tenantKey??m.city?.slug??"global"),[t,n]=g.useState(!1),[c,i]=g.useState(0),[d,p]=g.useState("detalhes"),{data:s,isLoading:y,error:w}=Q({queryKey:["reports",r,"detail",a||""],queryFn:()=>re.getReportById(a||""),enabled:!!a,staleTime:1e3*60*5}),b=g.useMemo(()=>s&&v[s.status]||v.recebido,[s]),N=()=>{s?.protocol&&(navigator.clipboard.writeText(s.protocol),M.success("Protocolo copiado!"))},l=async()=>{const m=`${window.location.origin}/denuncia/${a}`;if(navigator.share)try{await navigator.share({title:s?.title||"Observação",text:`Sou Observador em Tijucas. Olha essa observação: ${s?.title}`,url:m})}catch{}else navigator.clipboard.writeText(m),M.success("Link copiado!")},j=m=>{i(m),n(!0)},T=m=>{o(`/?tab=${m}`)};if(y)return e.jsx(pe,{});if(w||!s)return e.jsxs("div",{className:"min-h-screen bg-background flex flex-col",children:[e.jsx("div",{className:"safe-top bg-background border-b",children:e.jsxs("div",{className:"flex items-center gap-3 px-4 py-3",children:[e.jsx(u,{variant:"ghost",size:"icon",onClick:()=>o(-1),children:e.jsx(I,{className:"w-5 h-5"})}),e.jsx("h1",{className:"font-semibold",children:"Observação"})]})}),e.jsx("div",{className:"flex-1 flex items-center justify-center p-8",children:e.jsxs("div",{className:"text-center",children:[e.jsx(K,{className:"w-12 h-12 mx-auto mb-4 text-muted-foreground"}),e.jsx("h2",{className:"text-lg font-semibold mb-2",children:"Não foi possível carregar"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Verifique sua conexão e tente novamente"}),e.jsx(u,{onClick:()=>o(-1),children:"Voltar"})]})})]});const R=b.icon;return e.jsxs("div",{className:"relative min-h-screen bg-slate-50 dark:bg-slate-950",children:[e.jsxs("div",{className:"pb-32",children:[e.jsx("div",{className:"safe-top bg-white dark:bg-slate-900 border-b sticky top-0 z-30",children:e.jsxs("div",{className:"flex items-center justify-between px-4 py-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(u,{variant:"ghost",size:"icon",onClick:()=>o(-1),className:"shrink-0",children:e.jsx(I,{className:"w-5 h-5"})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"text-xs text-muted-foreground truncate",children:"Código de acompanhamento"}),e.jsx("p",{className:"font-mono text-sm font-medium truncate",children:s.protocol})]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(u,{variant:"ghost",size:"icon",onClick:N,children:e.jsx(V,{className:"w-4 h-4"})}),e.jsx(u,{variant:"ghost",size:"icon",onClick:l,children:e.jsx(W,{className:"w-4 h-4"})})]})]})}),e.jsxs("div",{className:"flex border-b bg-white dark:bg-slate-900 sticky top-14 z-20",children:[e.jsxs("button",{onClick:()=>p("detalhes"),className:h("flex-1 py-3 text-sm font-medium transition-colors relative",d==="detalhes"?"text-primary":"text-muted-foreground"),children:["Detalhes",d==="detalhes"&&e.jsx(x.div,{layoutId:"reportActiveTab",className:"absolute bottom-0 left-0 right-0 h-0.5 bg-primary"})]}),e.jsxs("button",{onClick:()=>p("discussao"),className:h("flex-1 py-3 text-sm font-medium transition-colors relative",d==="discussao"?"text-primary":"text-muted-foreground"),children:["Discussão",d==="discussao"&&e.jsx(x.div,{layoutId:"reportActiveTab",className:"absolute bottom-0 left-0 right-0 h-0.5 bg-primary"})]})]}),d==="detalhes"?e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{className:h("inline-flex items-center gap-2 px-3 py-1.5 rounded-full text-sm font-medium",b.bgColor,b.color),children:[e.jsx(R,{className:"w-4 h-4"}),b.label]}),e.jsx(xe,{images:s.media||[],onImageClick:j}),e.jsxs(C,{className:"p-4",children:[e.jsx("h1",{className:"text-xl font-bold mb-2",children:s.title}),e.jsx("p",{className:"text-muted-foreground",children:s.description})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[s.category&&e.jsxs(L,{variant:"secondary",className:"gap-1.5 pl-1.5 pr-2.5",style:{backgroundColor:`${s.category.color}20`,color:s.category.color},children:[e.jsx(oe,{icon:s.category.icon,color:s.category.color,size:"sm"}),s.category.name]}),e.jsxs(L,{variant:"outline",className:"gap-1.5",children:[e.jsx(J,{className:"w-3 h-3"}),X(new Date(s.createdAt),{addSuffix:!0,locale:A})]})]}),s.latitude&&s.longitude&&e.jsxs(C,{className:"overflow-hidden",children:[e.jsx("div",{className:"p-4 border-b",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-primary/10 text-primary shrink-0",children:e.jsx(z,{className:"w-5 h-5"})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"font-medium",children:"Localização"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.addressText||"Endereço aproximado"}),s.bairro?.nome&&e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:s.bairro.nome})]})]})}),e.jsx("div",{className:"relative z-0",children:e.jsx(le,{latitude:s.latitude,longitude:s.longitude,onLocationChange:()=>{},className:"h-48 w-full border-none rounded-none",readOnly:!0})}),e.jsx("div",{className:"p-3 bg-muted/30",children:e.jsx(u,{variant:"outline",className:"w-full gap-2",asChild:!0,children:e.jsxs("a",{href:`https://www.google.com/maps?q=${s.latitude},${s.longitude}`,target:"_blank",rel:"noopener noreferrer",children:[e.jsx(z,{className:"w-4 h-4 text-red-500"}),"Abrir no Google Maps",e.jsx(Y,{className:"w-3 h-3 ml-auto opacity-50"})]})})})]}),s.history&&s.history.length>0&&e.jsxs(C,{className:"p-4",children:[e.jsxs("h2",{className:"font-semibold mb-4 flex items-center gap-2",children:[e.jsx(B,{className:"w-4 h-4 text-primary"}),"Histórico"]}),e.jsx(ue,{history:s.history})]}),s.resolvedAt&&e.jsx(C,{className:"p-4 bg-green-50 dark:bg-green-950/20 border-green-200 dark:border-green-900",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(O,{className:"w-5 h-5 text-green-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-green-700 dark:text-green-400",children:"Melhoria concluída"}),e.jsx("p",{className:"text-sm text-green-600/80 dark:text-green-400/80",children:P(new Date(s.resolvedAt),"d 'de' MMMM 'de' yyyy",{locale:A})})]})]})}),e.jsx("div",{className:"text-[10px] text-center text-muted-foreground/60 px-4 leading-tight",children:"Plataforma comunitária e independente. Não é canal oficial da prefeitura."})]}):e.jsx("div",{className:"p-4",children:e.jsx(me,{reportId:a||"",comments:[],onAddComment:async(m,S)=>{console.log("Add comment:",{text:m,type:S})}})})]}),e.jsx("div",{className:"fixed bottom-0 left-0 right-0 z-50",children:e.jsx(ce,{activeTab:"reportar",onTabChange:T})}),e.jsx(Z,{children:t&&s.media&&e.jsx(he,{images:s.media,initialIndex:c,onClose:()=>n(!1)})})]})}export{Le as default};
