import{r as i,j as e}from"./vendor-radix-CUH4rfwv.js";import{u as O}from"./vendor-query-BEEFX5y8.js";import{B}from"./BottomTabBar-CXtxYxQQ.js";import{u as I}from"./useAppStore-DXLumZkx.js";import{u as H}from"./useAuthStore-zZ7TxdTJ.js";import{A as P,m as p}from"./vendor-motion-BFiVL1R0.js";import{X as D,b as U,u as F,O as G}from"./index-BVA5RKso.js";import{a as M}from"./auth.service-qU9X3PjQ.js";import{U as R}from"./user-BmSqbS1T.js";import{M as z}from"./map-pin-cU88BSkl.js";import{L as E}from"./loader-circle-LHwZ3hLd.js";import{N as $}from"./navigation-BZdjtLDx.js";import{C as W}from"./check-DCTEPUCF.js";import{S as Q}from"./shield-CXJW7hMo.js";import{C as q}from"./chevron-right-C-gmj4LP.js";import{a as V,E as _}from"./client-w4Cmw8pS.js";import{b as A}from"./localDatabase-CVyEoWCW.js";import"./house-D_Wsd6i2.js";import"./triangle-alert-2jm6RgBv.js";import"./calendar-DPc-vvlx.js";import"./ellipsis-D7UcCh3N.js";import"./middleware-WYGlAF-S.js";import"./uuid-BwYzP5ph.js";import"./vendor-utils-DF9nhviX.js";async function K(){(await A.getAll()).length}const X={async getAll(){await K();try{const r=await V.get(_.bairros.list);return r.data&&r.data.length>0&&(await A.clear(),await A.saveMany(r.data)),r.data}catch(r){return console.warn("[BairroService] API failed, using cache:",r),A.getAll()}}},J=100;function Y({isOpen:r,onClose:o,children:n,title:g,snapPoints:a=[.5,.9],initialSnap:l=0,className:c=""}){const[x,d]=i.useState(l),m=i.useRef(null);i.useRef(0);const f=`${a[x]*100}vh`,u=i.useCallback((y,s)=>{const{velocity:j,offset:b}=s;if(j.y>500||b.y>J){o();return}if(j.y<-500){d(a.length-1);return}const S=window.innerHeight,v=((m.current?.offsetHeight||0)-b.y)/S;let C=0,k=Math.abs(a[0]-v);a.forEach((T,w)=>{const t=Math.abs(T-v);t<k&&(k=t,C=w)}),d(C)},[o,a]);return e.jsx(P,{children:r&&e.jsxs(e.Fragment,{children:[e.jsx(p.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:o,className:"fixed inset-0 bg-black/50 z-40"}),e.jsxs(p.div,{ref:m,initial:{y:"100%"},animate:{y:0,height:f},exit:{y:"100%"},transition:{type:"spring",damping:30,stiffness:300},drag:"y",dragConstraints:{top:0,bottom:0},dragElastic:.2,onDragEnd:u,className:`fixed bottom-0 left-0 right-0 bg-background rounded-t-3xl z-50 overflow-hidden shadow-elevated ${c}`,children:[e.jsx("div",{className:"flex justify-center pt-3 pb-2 cursor-grab active:cursor-grabbing",children:e.jsx("div",{className:"w-10 h-1 rounded-full bg-muted-foreground/30"})}),g&&e.jsxs("div",{className:"flex items-center justify-between px-4 pb-3 border-b border-border",children:[e.jsx("h3",{className:"text-lg font-semibold",children:g}),e.jsx("button",{onClick:o,className:"p-2 rounded-full hover:bg-muted transition-colors",children:e.jsx(D,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"overflow-y-auto h-full pb-safe",children:n})]})]})})}function Z({isOpen:r,onComplete:o,bairros:n}){const{updateUser:g}=H(),[a,l]=i.useState("name"),[c,x]=i.useState(""),[d,m]=i.useState(),[f,u]=i.useState(!1),[y,s]=i.useState(!1),[j,b]=i.useState(!1),[S,h]=i.useState(null),N=c.trim().length>=2,v=a==="name"?N:a==="bairro"?!0:f,C=async()=>{if(!navigator.geolocation){h("GPS não suportado neste dispositivo");return}b(!0),h(null),navigator.geolocation.getCurrentPosition(async t=>{console.log("GPS:",t.coords.latitude,t.coords.longitude),n.length>0&&m(n[0].id),b(!1)},t=>{console.error("GPS error:",t),h("Não foi possível obter sua localização"),b(!1)},{enableHighAccuracy:!0,timeout:1e4})},k=async()=>{if(!(!N||!f)){s(!0),h(null);try{const t=await M.completeProfile({nome:c.trim(),bairroId:d,termsAccepted:!0});g(t.user),"vibrate"in navigator&&navigator.vibrate(50),o()}catch(t){h(t.message||"Erro ao salvar perfil")}finally{s(!1)}}},T=()=>{a==="name"&&N?l("bairro"):a==="bairro"?l("terms"):a==="terms"&&f&&k()};i.useEffect(()=>{r||(l("name"),x(""),m(void 0),u(!1),h(null))},[r]);const w={initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20}};return e.jsx(Y,{isOpen:r,onClose:()=>{},title:"Bem-vindo ao eTijucas!",snapPoints:[.6,.9],initialSnap:0,children:e.jsxs("div",{className:"px-6 py-4",children:[e.jsx("div",{className:"flex gap-2 mb-6",children:["name","bairro","terms"].map((t,L)=>e.jsx("div",{className:`h-1 flex-1 rounded-full transition-colors ${t===a?"bg-primary":L<["name","bairro","terms"].indexOf(a)?"bg-primary/50":"bg-muted"}`},t))}),e.jsxs(P,{mode:"wait",children:[a==="name"&&e.jsxs(p.div,{variants:w,initial:"initial",animate:"animate",exit:"exit",className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-primary/10 flex items-center justify-center",children:e.jsx(R,{className:"w-6 h-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-semibold",children:"Como podemos te chamar?"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Seu nome será exibido nas suas publicações"})]})]}),e.jsx("input",{type:"text",value:c,onChange:t=>x(t.target.value),placeholder:"Seu nome",autoFocus:!0,className:"w-full px-4 py-3 rounded-xl border border-border bg-muted/50 focus:border-primary focus:ring-2 focus:ring-primary/20 transition-all text-lg"}),c.length>0&&!N&&e.jsx("p",{className:"text-sm text-destructive",children:"Nome deve ter pelo menos 2 caracteres"})]},"name"),a==="bairro"&&e.jsxs(p.div,{variants:w,initial:"initial",animate:"animate",exit:"exit",className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-primary/10 flex items-center justify-center",children:e.jsx(z,{className:"w-6 h-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-semibold",children:"Qual seu bairro? (opcional)"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Para mostrar notícias e eventos perto de você"})]})]}),e.jsxs("button",{onClick:C,disabled:j,className:"w-full flex items-center gap-3 px-4 py-3 rounded-xl border border-primary/30 bg-primary/5 hover:bg-primary/10 transition-all text-primary",children:[j?e.jsx(E,{className:"w-5 h-5 animate-spin"}):e.jsx($,{className:"w-5 h-5"}),e.jsx("span",{className:"font-medium",children:"Usar minha localização"})]}),e.jsx("div",{className:"max-h-48 overflow-y-auto space-y-1",children:n.map(t=>e.jsxs("button",{onClick:()=>m(t.id),className:`w-full flex items-center justify-between px-4 py-3 rounded-lg transition-all ${d===t.id?"bg-primary text-primary-foreground":"hover:bg-muted"}`,children:[e.jsx("span",{children:t.nome}),d===t.id&&e.jsx(W,{className:"w-5 h-5"})]},t.id))})]},"bairro"),a==="terms"&&e.jsxs(p.div,{variants:w,initial:"initial",animate:"animate",exit:"exit",className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-primary/10 flex items-center justify-center",children:e.jsx(Q,{className:"w-6 h-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-semibold",children:"Termos de Uso"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Quase pronto! Aceite os termos para continuar"})]})]}),e.jsx("div",{className:"p-4 rounded-xl bg-muted/50 border border-border",children:e.jsx("p",{className:"text-sm text-muted-foreground leading-relaxed",children:"Ao usar o eTijucas, você concorda em respeitar outros usuários, não publicar conteúdo ofensivo e usar o app de forma responsável. Seus dados são protegidos conforme nossa política de privacidade."})}),e.jsxs("label",{className:"flex items-center gap-3 cursor-pointer p-4 rounded-xl border border-border hover:border-primary/50 transition-colors",children:[e.jsx("input",{type:"checkbox",checked:f,onChange:t=>u(t.target.checked),className:"w-5 h-5 rounded border-border text-primary focus:ring-primary"}),e.jsxs("span",{className:"text-sm",children:["Li e aceito os ",e.jsx("span",{className:"text-primary font-medium",children:"Termos de Uso"})," e a"," ",e.jsx("span",{className:"text-primary font-medium",children:"Política de Privacidade"})]})]})]},"terms")]}),S&&e.jsx(p.p,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"text-sm text-destructive mt-4 text-center",children:S}),e.jsx(p.button,{onClick:T,disabled:!v||y,className:`w-full mt-6 py-4 rounded-2xl font-semibold text-lg flex items-center justify-center gap-2 transition-all ${v?"bg-primary text-primary-foreground hover:bg-primary/90":"bg-muted text-muted-foreground cursor-not-allowed"}`,whileTap:v?{scale:.98}:void 0,children:y?e.jsxs(e.Fragment,{children:[e.jsx(E,{className:"w-5 h-5 animate-spin"}),"Salvando..."]}):a==="terms"?e.jsxs(e.Fragment,{children:[e.jsx(W,{className:"w-5 h-5"}),"Concluir"]}):e.jsxs(e.Fragment,{children:["Continuar",e.jsx(q,{className:"w-5 h-5"})]})}),a==="bairro"&&e.jsx("button",{onClick:()=>l("terms"),className:"w-full mt-3 py-2 text-sm text-muted-foreground hover:text-foreground transition-colors",children:"Pular por agora"})]})})}function Se(){const r=U(),o=F(),{setActiveTab:n}=I(),{isAuthenticated:g,user:a,needsOnboarding:l}=H(),[c,x]=i.useState(!1),{data:d=[]}=O({queryKey:["bairros"],queryFn:X.getAll,staleTime:1e3*60*60});i.useEffect(()=>{l()&&x(!0)},[g,a]);const m=()=>{x(!1)},u=(s=>s==="/"?"home":s.startsWith("/denuncia")||s.startsWith("/minhas-denuncias")?"reportar":s.startsWith("/forum")||s.startsWith("/topico")?"forum":s.startsWith("/agenda")||s.startsWith("/evento")?"agenda":s.startsWith("/telefones")||s.startsWith("/coleta-lixo")||s.startsWith("/pontos-turisticos")||s.startsWith("/ponto-turistico")||s.startsWith("/missas")||s.startsWith("/votacoes")||s.startsWith("/vereadores")||s.startsWith("/perfil")?"mais":"home")(r.pathname);i.useEffect(()=>{n(u)},[u,n]);const y=s=>{switch(s){case"home":o("/");break;case"reportar":o("/denuncias");break;case"forum":o("/forum");break;case"agenda":o("/agenda");break;case"mais":o("/telefones");break}};return e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-muted/50",children:e.jsxs("div",{className:"relative w-full max-w-[420px] h-full bg-background overflow-hidden shadow-elevated",children:[e.jsx("div",{className:"absolute inset-0 overflow-y-auto scrollbar-hide pb-20",children:e.jsx(G,{})}),e.jsx(B,{activeTab:u,onTabChange:y}),e.jsx(Z,{isOpen:c,onComplete:m,bairros:d})]})})}export{Se as default};
