import{j as s}from"./vendor-radix-i3jPA7eY.js";import{B as d}from"./button-DNNbzV2i.js";import{C as f}from"./card--lNjvRYB.js";import{b as h,u as y}from"./index-BA7GKMAo.js";import{m as p}from"./vendor-motion-CFwwOuCD.js";import{C as x}from"./circle-alert-BjXcL1t5.js";import{L as v}from"./log-in-DrY9mpHx.js";import{b as S,c as w,u as R}from"./vendor-query-1wfeA5IL.js";import{a as i,E as n}from"./client-BoGyDRku.js";import{r as c,s as u}from"./localDatabase-D5_Pm7f1.js";import{u as b}from"./useAuthStore-CH38A1GO.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const j=h("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]);async function I(){try{return(await i.get(n.reports.categories)).data}catch(e){throw console.error("[ReportService] Failed to fetch categories:",e),e}}async function N(e,r){const t=new FormData;t.append("categoryId",e.categoryId),t.append("title",e.title),t.append("description",e.description),e.addressText&&t.append("addressText",e.addressText),e.addressSource&&t.append("addressSource",e.addressSource),e.locationQuality&&t.append("locationQuality",e.locationQuality),e.latitude!==void 0&&t.append("latitude",String(e.latitude)),e.longitude!==void 0&&t.append("longitude",String(e.longitude)),e.locationAccuracyM!==void 0&&t.append("locationAccuracyM",String(e.locationAccuracyM)),e.bairroId&&t.append("bairroId",e.bairroId),e.images&&e.images.length>0&&e.images.forEach(a=>{t.append("images[]",a)});try{const a=await i.postFormData(n.reports.create,t,{headers:{"X-Idempotency-Key":r}});return a.data&&await c.save(a.data),a.data}catch(a){throw console.error("[ReportService] Failed to create report:",a),await u.exists(r)||await u.add({type:"report",data:{...e,images:[]},idempotencyKey:r}),a}}async function C(e){try{const r=new URLSearchParams;e?.status&&r.append("status",e.status),e?.categoryId&&r.append("categoryId",e.categoryId),e?.page&&r.append("page",String(e.page)),e?.perPage&&r.append("perPage",String(e.perPage));const t=r.toString(),a=t?`${n.reports.myReports}?${t}`:n.reports.myReports,o=await i.get(a);return o.data.length>0&&await c.saveMany(o.data),o}catch(r){console.error("[ReportService] Failed to fetch my reports:",r);const t=await c.getAll();return{data:t,meta:{current_page:1,last_page:1,per_page:10,total:t.length}}}}async function M(e){try{const r=await i.get(n.reports.get(e));return await c.save(r.data),r.data}catch(r){return console.error("[ReportService] Failed to fetch report:",r),await c.getById(e)}}async function L(e,r){const t=new FormData;return r.forEach(o=>{t.append("images[]",o)}),(await i.postFormData(n.reports.addMedia(e),t)).data}async function k(e,r){await i.delete(n.reports.removeMedia(e,r))}async function A(e,r,t){try{const a=new URLSearchParams({q:e});return r!==void 0&&a.append("lat",String(r)),t!==void 0&&a.append("lon",String(t)),(await i.get(`${n.geocode.autocomplete}?${a.toString()}`)).data}catch(a){return console.error("[ReportService] Geocode autocomplete failed:",a),[]}}async function F(e,r){try{const t=new URLSearchParams({lat:String(e),lon:String(r)});return(await i.get(`${n.geocode.reverse}?${t.toString()}`)).data}catch(t){return console.error("[ReportService] Geocode reverse failed:",t),null}}const m={getCategories:I,createReport:N,getMyReports:C,getReportById:M,addReportMedia:L,removeReportMedia:k,geocodeAutocomplete:A,geocodeReverse:F};function G({title:e="Login necessário",message:r="Você precisa estar logado para acessar esta funcionalidade.",returnUrl:t}){const a=y(),o=()=>{t&&sessionStorage.setItem("returnUrl",t),a("/login")},l=()=>{t&&sessionStorage.setItem("returnUrl",t),a("/register")};return s.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center p-4",children:s.jsx(p.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"w-full max-w-md",children:s.jsxs(f,{className:"p-8 text-center",children:[s.jsx(p.div,{initial:{scale:0},animate:{scale:1},transition:{type:"spring",delay:.1},className:"w-20 h-20 rounded-full bg-amber-100 dark:bg-amber-900/30 flex items-center justify-center mx-auto mb-6",children:s.jsx(x,{className:"h-10 w-10 text-amber-600 dark:text-amber-400"})}),s.jsx("h1",{className:"text-2xl font-bold mb-2",children:e}),s.jsx("p",{className:"text-muted-foreground mb-8",children:r}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs(d,{size:"lg",className:"w-full h-14 rounded-xl text-base",onClick:o,children:[s.jsx(v,{className:"h-5 w-5 mr-2"}),"Entrar"]}),s.jsxs(d,{size:"lg",variant:"outline",className:"w-full h-14 rounded-xl text-base",onClick:l,children:[s.jsx(j,{className:"h-5 w-5 mr-2"}),"Criar conta"]})]}),s.jsx("p",{className:"text-xs text-muted-foreground mt-6",children:"Ao fazer login, você poderá acompanhar suas denúncias e receber atualizações."})]})})})}const g={myReports:["reports","mine"]};function K(e){const{isAuthenticated:r}=b(),t=R({queryKey:[...g.myReports,e],queryFn:()=>m.getMyReports(e),staleTime:2*60*1e3,enabled:r});return{reports:t.data?.data??[],meta:t.data?.meta,isLoading:t.isLoading,error:t.error,refetch:t.refetch}}function Y(){const e=S(),r=w({mutationFn:({payload:t,idempotencyKey:a})=>m.createReport(t,a),onSuccess:()=>{e.invalidateQueries({queryKey:g.myReports})}});return{createReport:r.mutateAsync,isCreating:r.isPending,error:r.error,reset:r.reset}}export{G as L,Y as a,m as r,K as u};
